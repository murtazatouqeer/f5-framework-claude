name: Insured
display_name: Insured Person
description: |
  Person covered by the insurance policy.
  May be the policyholder or a dependent. Contains risk factors.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: insureds
  primary_key: id
  indexes:
    - columns: [policy_id]
    - columns: [national_id]
    - columns: [relationship_to_policyholder]
    - columns: [status]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: policy_id
    type: uuid
    description: Parent policy
    required: true

  - name: policyholder_id
    type: uuid
    description: Related policyholder

  # Relationship
  - name: relationship_to_policyholder
    type: enum
    description: Relation to policy owner
    values:
      - self
      - spouse
      - child
      - parent
      - sibling
      - grandparent
      - grandchild
      - employee
      - business_partner
      - other
    default: self

  - name: is_primary
    type: boolean
    description: Is primary insured
    default: true

  # Personal details
  - name: title
    type: enum
    description: Title/salutation
    values:
      - mr
      - mrs
      - ms
      - miss
      - dr
      - prof

  - name: first_name
    type: string
    description: First name
    max_length: 100
    required: true

  - name: middle_name
    type: string
    description: Middle name
    max_length: 100

  - name: last_name
    type: string
    description: Last name
    max_length: 100
    required: true

  - name: full_name
    type: string
    description: Complete name
    max_length: 300
    computed: "first_name + ' ' + last_name"

  - name: date_of_birth
    type: date
    description: Birth date
    required: true

  - name: age_at_inception
    type: integer
    description: Age when policy started
    computed: "effective_date - date_of_birth"

  - name: current_age
    type: integer
    description: Current age
    computed: "NOW() - date_of_birth"

  - name: gender
    type: enum
    description: Gender
    values:
      - male
      - female
      - other
    required: true

  - name: marital_status
    type: enum
    description: Marital status
    values:
      - single
      - married
      - divorced
      - widowed

  - name: nationality
    type: string
    description: Nationality
    max_length: 50

  # Identity
  - name: national_id
    type: string
    description: National ID number
    max_length: 50

  - name: passport_number
    type: string
    description: Passport number
    max_length: 50

  # Contact
  - name: email
    type: string
    description: Email address
    format: email

  - name: phone
    type: string
    description: Phone number
    max_length: 20

  - name: address
    type: object
    description: Address
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      province:
        type: string
      postal_code:
        type: string
      country:
        type: string

  # Occupation
  - name: occupation
    type: string
    description: Occupation
    max_length: 100

  - name: occupation_code
    type: string
    description: Standard occupation code

  - name: occupation_class
    type: integer
    description: Occupation risk class
    minimum: 1
    maximum: 4
    default: 1

  - name: occupation_description
    type: text
    description: Job duties description

  - name: employer_name
    type: string
    description: Employer name

  - name: employment_status
    type: enum
    description: Employment status
    values:
      - employed
      - self_employed
      - unemployed
      - student
      - retired
      - homemaker

  # Health information
  - name: height_cm
    type: decimal
    description: Height in centimeters
    precision: 5
    scale: 2

  - name: weight_kg
    type: decimal
    description: Weight in kilograms
    precision: 5
    scale: 2

  - name: bmi
    type: decimal
    description: Body mass index
    precision: 4
    scale: 2
    computed: "weight_kg / (height_cm/100)^2"

  - name: smoker_status
    type: enum
    description: Smoking status
    values:
      - non_smoker
      - smoker
      - ex_smoker
    default: non_smoker

  - name: smoking_frequency
    type: string
    description: Smoking details

  - name: alcohol_consumption
    type: enum
    description: Alcohol consumption
    values:
      - none
      - occasional
      - moderate
      - heavy
    default: none

  - name: medical_history
    type: object
    description: Medical history
    properties:
      has_conditions:
        type: boolean
      conditions:
        type: array
        items:
          type: object
          properties:
            condition:
              type: string
            diagnosed_date:
              type: date
            current_status:
              type: string
            treatment:
              type: string
      hospitalization_history:
        type: array
        items:
          type: object
          properties:
            reason:
              type: string
            hospital:
              type: string
            admission_date:
              type: date
            discharge_date:
              type: date
      surgeries:
        type: array
      current_medications:
        type: array
      allergies:
        type: array
      family_history:
        type: object

  # Lifestyle
  - name: lifestyle_risks
    type: object
    description: Lifestyle risk factors
    properties:
      hazardous_activities:
        type: array
        items:
          type: string
      sports_activities:
        type: array
      travel_frequency:
        type: string
      high_risk_countries:
        type: boolean

  # Coverage
  - name: sum_insured
    type: decimal
    description: Sum insured for this person
    precision: 15
    scale: 2

  - name: coverage_ids
    type: array
    description: Coverages for this insured
    items:
      type: uuid

  - name: rider_ids
    type: array
    description: Riders for this insured
    items:
      type: uuid

  - name: coverage_details
    type: array
    description: Detailed coverage allocations
    items:
      type: object
      properties:
        coverage_id:
          type: uuid
        sum_insured:
          type: decimal
        premium:
          type: decimal
        loading_percent:
          type: decimal
        exclusions:
          type: array

  # Underwriting
  - name: risk_class
    type: enum
    description: Risk classification
    values:
      - standard
      - preferred
      - substandard
      - declined
    default: standard

  - name: substandard_rating
    type: decimal
    description: Substandard percentage
    precision: 5
    scale: 2

  - name: loadings
    type: array
    description: Premium loadings
    items:
      type: object
      properties:
        type:
          type: string
        percentage:
          type: decimal
        reason:
          type: string
        duration:
          type: string
        expires_at:
          type: date

  - name: exclusions
    type: array
    description: Coverage exclusions
    items:
      type: object
      properties:
        exclusion_code:
          type: string
        description:
          type: string
        reason:
          type: string
        permanent:
          type: boolean
        review_date:
          type: date

  - name: waiting_periods
    type: array
    description: Coverage waiting periods
    items:
      type: object
      properties:
        coverage_id:
          type: uuid
        waiting_days:
          type: integer
        expires_at:
          type: date

  # Medical exams
  - name: medical_exams
    type: array
    description: Required medical examinations
    items:
      type: object
      properties:
        exam_type:
          type: string
        required:
          type: boolean
        completed:
          type: boolean
        exam_date:
          type: date
        facility:
          type: string
        results:
          type: object
        document_url:
          type: string

  # Status
  - name: status
    type: enum
    description: Coverage status
    values:
      - active
      - pending
      - suspended
      - terminated
      - deceased
    default: pending

  - name: effective_date
    type: date
    description: Coverage start date

  - name: termination_date
    type: date
    description: Coverage end date

  - name: termination_reason
    type: string
    description: Why coverage ended

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: policy
    type: belongs_to
    entity: Policy
    foreign_key: policy_id

  - name: policyholder
    type: belongs_to
    entity: Policyholder
    foreign_key: policyholder_id

  - name: coverages
    type: has_many
    entity: PolicyCoverage
    through: insured_coverages

  - name: claims
    type: has_many
    entity: Claim
    foreign_key: insured_id

business_rules:
  - rule: BR-INS-001
    description: Age at inception must be within product limits
    validation: age_at_inception BETWEEN product.min_entry_age AND product.max_entry_age

  - rule: BR-INS-002
    description: Primary insured must exist for each policy
    validation: COUNT(is_primary = true) >= 1 PER policy

  - rule: BR-INS-003
    description: Child must be under 18 at inception
    validation: IF relationship_to_policyholder = 'child' THEN age_at_inception < 18

  - rule: BR-INS-004
    description: National ID or passport required
    validation: national_id IS NOT NULL OR passport_number IS NOT NULL

events:
  - name: insured.added
    payload: [policy_id, insured_id, relationship]

  - name: insured.risk_assessed
    payload: [insured_id, risk_class, loadings]

  - name: insured.coverage_activated
    payload: [insured_id, effective_date]

  - name: insured.terminated
    payload: [insured_id, termination_date, reason]

  - name: insured.deceased
    payload: [insured_id, date_of_death]
