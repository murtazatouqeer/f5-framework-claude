name: Policyholder
display_name: Policy Owner
description: |
  Policy owner/customer who owns the insurance contract.
  May be different from the insured person. Contains KYC information.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: policyholders
  primary_key: id
  indexes:
    - columns: [customer_number]
      unique: true
    - columns: [national_id]
    - columns: [email]
    - columns: [phone]
    - columns: [customer_type]
    - columns: [kyc_status]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: customer_number
    type: string
    description: Unique customer reference
    pattern: "CUS-[A-Z0-9]{8}"
    example: "CUS-2024A001"
    required: true
    unique: true

  - name: external_id
    type: string
    description: ID from external CRM system

  # Type
  - name: customer_type
    type: enum
    description: Customer category
    values:
      - individual
      - corporate
      - trust
      - estate
    default: individual

  # Individual details
  - name: title
    type: enum
    description: Title/salutation
    values:
      - mr
      - mrs
      - ms
      - miss
      - dr
      - prof

  - name: first_name
    type: string
    description: First/given name
    max_length: 100

  - name: middle_name
    type: string
    description: Middle name
    max_length: 100

  - name: last_name
    type: string
    description: Last/family name
    max_length: 100

  - name: full_name
    type: string
    description: Complete name
    max_length: 300
    required: true

  - name: date_of_birth
    type: date
    description: Birth date

  - name: gender
    type: enum
    description: Gender
    values:
      - male
      - female
      - other
      - prefer_not_to_say

  - name: marital_status
    type: enum
    description: Marital status
    values:
      - single
      - married
      - divorced
      - widowed
      - separated

  - name: nationality
    type: string
    description: Nationality
    max_length: 50

  # Corporate details
  - name: company_name
    type: string
    description: Company name
    max_length: 200

  - name: company_registration_number
    type: string
    description: Business registration

  - name: company_type
    type: enum
    description: Company type
    values:
      - llc
      - corporation
      - partnership
      - sole_proprietorship
      - ngo
      - government

  - name: industry
    type: string
    description: Industry sector

  - name: company_size
    type: enum
    description: Employee count category
    values:
      - small
      - medium
      - large
      - enterprise

  # Identity documents
  - name: national_id
    type: string
    description: National ID number
    max_length: 50

  - name: national_id_issue_date
    type: date
    description: ID issue date

  - name: national_id_expiry_date
    type: date
    description: ID expiry date

  - name: national_id_issue_place
    type: string
    description: ID issue location

  - name: passport_number
    type: string
    description: Passport number
    max_length: 50

  - name: passport_expiry_date
    type: date
    description: Passport expiry

  - name: passport_country
    type: string
    description: Passport issuing country

  - name: tax_id
    type: string
    description: Tax identification number
    max_length: 50

  - name: driving_license
    type: string
    description: Driving license number

  # Contact
  - name: email
    type: string
    description: Primary email
    format: email
    required: true

  - name: secondary_email
    type: string
    description: Alternative email
    format: email

  - name: phone
    type: string
    description: Primary phone
    max_length: 20
    required: true

  - name: mobile
    type: string
    description: Mobile number
    max_length: 20

  - name: work_phone
    type: string
    description: Work phone
    max_length: 20

  - name: fax
    type: string
    description: Fax number
    max_length: 20

  # Address
  - name: address
    type: object
    description: Primary address
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      district:
        type: string
      province:
        type: string
      postal_code:
        type: string
      country:
        type: string
        default: "VN"

  - name: mailing_address
    type: object
    description: Mailing address
    properties:
      same_as_primary:
        type: boolean
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      province:
        type: string
      postal_code:
        type: string
      country:
        type: string

  # Employment
  - name: occupation
    type: string
    description: Occupation/profession
    max_length: 100

  - name: occupation_class
    type: integer
    description: Occupation risk class
    minimum: 1
    maximum: 4

  - name: employer_name
    type: string
    description: Employer name
    max_length: 200

  - name: employer_address
    type: string
    description: Employer address

  - name: annual_income
    type: decimal
    description: Annual income
    precision: 15
    scale: 2

  - name: income_source
    type: enum
    description: Primary income source
    values:
      - employment
      - self_employed
      - business
      - investments
      - pension
      - other

  # Financial
  - name: bank_accounts
    type: array
    description: Bank account details
    items:
      type: object
      properties:
        bank_name:
          type: string
        account_number:
          type: string
        account_holder:
          type: string
        is_primary:
          type: boolean
        for_premium_debit:
          type: boolean
        for_claim_credit:
          type: boolean

  - name: net_worth
    type: decimal
    description: Net worth estimate
    precision: 15
    scale: 2

  # KYC/AML
  - name: kyc_status
    type: enum
    description: KYC verification status
    values:
      - pending
      - in_progress
      - verified
      - rejected
      - expired
    default: pending

  - name: kyc_verified_at
    type: timestamp
    description: KYC verification date

  - name: kyc_verified_by
    type: uuid
    description: KYC verifier

  - name: kyc_expiry_date
    type: date
    description: KYC valid until

  - name: kyc_documents
    type: array
    description: KYC documents
    items:
      type: object
      properties:
        document_type:
          type: string
        document_number:
          type: string
        file_url:
          type: string
        verified:
          type: boolean
        verified_at:
          type: timestamp

  - name: aml_risk_rating
    type: enum
    description: AML risk level
    values:
      - low
      - medium
      - high
    default: low

  - name: pep_status
    type: boolean
    description: Politically exposed person
    default: false

  - name: sanctions_check
    type: object
    description: Sanctions screening
    properties:
      checked_at:
        type: timestamp
      result:
        type: string
      matched:
        type: boolean

  # Preferences
  - name: communication_preference
    type: enum
    description: Preferred contact method
    values:
      - email
      - sms
      - phone
      - mail
      - app
    default: email

  - name: language_preference
    type: string
    description: Preferred language
    default: "vi"

  - name: marketing_consent
    type: boolean
    description: Marketing opt-in
    default: false

  - name: data_sharing_consent
    type: boolean
    description: Data sharing opt-in
    default: false

  # Status
  - name: status
    type: enum
    description: Customer status
    values:
      - active
      - inactive
      - suspended
      - blacklisted
    default: active

  - name: blacklist_reason
    type: string
    description: Why blacklisted

  # Relations
  - name: related_customers
    type: array
    description: Related parties
    items:
      type: object
      properties:
        customer_id:
          type: uuid
        relationship:
          type: string
        relationship_type:
          type: enum
          values: [spouse, child, parent, business_partner, employer]

  # Representative (for corporate)
  - name: authorized_representatives
    type: array
    description: Authorized signatories
    items:
      type: object
      properties:
        name:
          type: string
        title:
          type: string
        email:
          type: string
        phone:
          type: string
        authority_level:
          type: string

  # Source
  - name: acquisition_channel
    type: enum
    description: How customer was acquired
    values:
      - direct
      - agent
      - broker
      - referral
      - online
      - bancassurance
      - partnership

  - name: referred_by
    type: uuid
    description: Referrer customer ID

  - name: agent_id
    type: uuid
    description: Primary agent

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

  - name: created_by
    type: uuid

relationships:
  - name: policies
    type: has_many
    entity: Policy
    foreign_key: policyholder_id

  - name: quotes
    type: has_many
    entity: Quote
    foreign_key: prospect_id

  - name: applications
    type: has_many
    entity: Application
    foreign_key: policyholder_id

  - name: claims
    type: has_many
    entity: Claim
    foreign_key: claimant_id

  - name: agent
    type: belongs_to
    entity: Agent
    foreign_key: agent_id

business_rules:
  - rule: BR-PH-001
    description: Individual must have date of birth
    validation: IF customer_type = 'individual' THEN date_of_birth IS NOT NULL

  - rule: BR-PH-002
    description: Corporate must have company registration
    validation: IF customer_type = 'corporate' THEN company_registration_number IS NOT NULL

  - rule: BR-PH-003
    description: KYC required before policy issuance
    validation: kyc_status = 'verified' FOR active policies

  - rule: BR-PH-004
    description: National ID or passport required
    validation: national_id IS NOT NULL OR passport_number IS NOT NULL

events:
  - name: policyholder.created
    payload: [customer_id, customer_number, customer_type]

  - name: policyholder.kyc_verified
    payload: [customer_id, verified_at]

  - name: policyholder.kyc_rejected
    payload: [customer_id, rejection_reason]

  - name: policyholder.blacklisted
    payload: [customer_id, reason]

api_endpoints:
  - method: POST
    path: /policyholders
    description: Create policyholder

  - method: GET
    path: /policyholders/{id}
    description: Get policyholder details

  - method: PUT
    path: /policyholders/{id}
    description: Update policyholder

  - method: POST
    path: /policyholders/{id}/kyc
    description: Submit KYC documents

  - method: POST
    path: /policyholders/{id}/verify-kyc
    description: Verify KYC
