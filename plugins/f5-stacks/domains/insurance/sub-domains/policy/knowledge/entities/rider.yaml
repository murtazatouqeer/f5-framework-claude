name: Rider
display_name: Policy Rider
description: |
  Optional add-on coverage attached to base policy.
  Provides supplementary benefits beyond the main coverage.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: riders
  primary_key: id
  indexes:
    - columns: [rider_code]
      unique: true
    - columns: [rider_type]
    - columns: [status]
    - columns: [base_product_id]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: rider_code
    type: string
    description: Unique rider code
    pattern: "RDR-[A-Z]{2,4}-[0-9]{3}"
    example: "RDR-ACC-001"
    required: true
    unique: true

  - name: name
    type: string
    description: Rider name
    max_length: 100
    required: true

  - name: display_name
    type: string
    description: Customer-facing name
    max_length: 150

  - name: description
    type: text
    description: Rider description
    max_length: 2000

  # Classification
  - name: status
    type: enum
    description: Rider status
    values:
      - active
      - discontinued
      - draft
    default: active

  - name: rider_type
    type: enum
    description: Rider category
    values:
      - death_benefit
      - accidental_death
      - critical_illness
      - hospitalization
      - waiver_of_premium
      - term_conversion
      - guaranteed_insurability
      - income_protection
      - long_term_care
      - return_of_premium
    required: true

  - name: category
    type: enum
    description: Benefit category
    values:
      - life
      - health
      - accident
      - disability
      - investment
    required: true

  # Product attachment
  - name: base_product_id
    type: uuid
    description: Base product this attaches to

  - name: compatible_products
    type: array
    description: Compatible base products
    items:
      type: uuid

  - name: incompatible_riders
    type: array
    description: Cannot combine with
    items:
      type: uuid

  - name: prerequisite_riders
    type: array
    description: Required riders
    items:
      type: uuid

  - name: is_mandatory
    type: boolean
    description: Required with product
    default: false

  - name: is_standalone
    type: boolean
    description: Can exist without base
    default: false

  # Coverage details
  - name: benefit_type
    type: enum
    description: How benefit is paid
    values:
      - lump_sum
      - income
      - reimbursement
      - waiver
      - accelerated
    default: lump_sum

  - name: benefit_trigger
    type: array
    description: Events that trigger benefit
    items:
      type: string
    example: ["death", "critical_illness", "disability"]

  - name: benefit_calculation
    type: enum
    description: How benefit is calculated
    values:
      - fixed_amount
      - percentage_of_base
      - multiple_of_premium
      - actual_expense
    default: fixed_amount

  - name: benefit_percentage
    type: decimal
    description: Percentage of base sum insured
    precision: 5
    scale: 2

  - name: benefit_multiple
    type: decimal
    description: Multiple factor
    precision: 3
    scale: 1

  # Sum insured
  - name: min_sum_insured
    type: decimal
    description: Minimum sum insured
    precision: 15
    scale: 2

  - name: max_sum_insured
    type: decimal
    description: Maximum sum insured
    precision: 15
    scale: 2

  - name: max_percentage_of_base
    type: decimal
    description: Max % of base sum insured
    precision: 5
    scale: 2

  - name: sum_insured_increments
    type: decimal
    description: Sum insured multiples
    precision: 10
    scale: 2

  # Eligibility
  - name: min_entry_age
    type: integer
    description: Minimum age at entry
    minimum: 0
    default: 18

  - name: max_entry_age
    type: integer
    description: Maximum age at entry
    maximum: 100
    default: 65

  - name: max_coverage_age
    type: integer
    description: Coverage ends at age
    default: 75

  - name: max_benefit_period
    type: integer
    description: Max benefit period (years)

  - name: occupation_restrictions
    type: array
    description: Occupation classes excluded
    items:
      type: integer

  - name: health_requirements
    type: array
    description: Health requirements
    items:
      type: object
      properties:
        sum_insured_threshold:
          type: decimal
        requirements:
          type: array

  # Premium
  - name: premium_basis
    type: enum
    description: Premium calculation basis
    values:
      - per_mille
      - flat_rate
      - age_based
      - percentage_of_base
    default: per_mille

  - name: rate_per_mille
    type: decimal
    description: Rate per 1000 sum insured
    precision: 8
    scale: 4

  - name: flat_premium
    type: decimal
    description: Fixed premium amount
    precision: 10
    scale: 2

  - name: base_premium_percentage
    type: decimal
    description: Percentage of base premium
    precision: 5
    scale: 2

  - name: rate_table_id
    type: uuid
    description: Age-based rate table

  - name: loading_factors
    type: array
    description: Loading conditions
    items:
      type: object
      properties:
        factor:
          type: string
        percentage:
          type: decimal
        conditions:
          type: string

  - name: minimum_premium
    type: decimal
    description: Minimum premium
    precision: 10
    scale: 2

  # Waiting periods
  - name: waiting_period_days
    type: integer
    description: General waiting period
    default: 0

  - name: specific_waiting_periods
    type: array
    description: Condition-specific waits
    items:
      type: object
      properties:
        condition:
          type: string
        waiting_days:
          type: integer

  # Exclusions
  - name: standard_exclusions
    type: array
    description: Standard exclusions
    items:
      type: object
      properties:
        code:
          type: string
        description:
          type: string

  - name: pre_existing_exclusion
    type: boolean
    description: Pre-existing excluded
    default: true

  - name: pre_existing_waiting_months
    type: integer
    description: Pre-existing waiting period
    default: 24

  # Limits
  - name: annual_limit
    type: decimal
    description: Maximum per year
    precision: 15
    scale: 2

  - name: lifetime_limit
    type: decimal
    description: Maximum lifetime
    precision: 15
    scale: 2

  - name: per_occurrence_limit
    type: decimal
    description: Maximum per event
    precision: 15
    scale: 2

  - name: claim_frequency_limit
    type: integer
    description: Max claims per year

  # Commission
  - name: first_year_commission
    type: decimal
    description: First year commission %
    precision: 5
    scale: 2

  - name: renewal_commission
    type: decimal
    description: Renewal commission %
    precision: 5
    scale: 2

  # Term
  - name: term_options
    type: array
    description: Available terms
    items:
      type: integer
    example: [5, 10, 15, 20]

  - name: coterminous
    type: boolean
    description: Must match base term
    default: true

  - name: renewable
    type: boolean
    description: Can be renewed
    default: true

  - name: convertible
    type: boolean
    description: Can convert to other
    default: false

  # Documents
  - name: brochure_url
    type: string
    description: Rider brochure
    format: uri

  - name: terms_url
    type: string
    description: Terms and conditions
    format: uri

  # Features
  - name: features
    type: array
    description: Key features
    items:
      type: object
      properties:
        feature:
          type: string
        description:
          type: string

  # Dates
  - name: launched_at
    type: date
    description: Launch date

  - name: discontinued_at
    type: date
    description: Discontinuation date

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: base_product
    type: belongs_to
    entity: Product
    foreign_key: base_product_id

  - name: products
    type: belongs_to_many
    entity: Product
    through: product_riders

  - name: policy_riders
    type: has_many
    entity: PolicyRider
    foreign_key: rider_id

  - name: rate_table
    type: belongs_to
    entity: RateTable
    foreign_key: rate_table_id

business_rules:
  - rule: BR-RDR-001
    description: Rider sum cannot exceed base policy
    validation: rider_sum_insured <= base_policy.sum_insured * max_percentage_of_base

  - rule: BR-RDR-002
    description: Coterminous rider must match base term
    validation: IF coterminous = true THEN rider_term = base_policy.term

  - rule: BR-RDR-003
    description: Active rider must have premium basis
    validation: IF status = 'active' THEN premium_basis IS NOT NULL

events:
  - name: rider.created
    payload: [rider_id, rider_code, rider_type]

  - name: rider.discontinued
    payload: [rider_id, discontinued_at]

  - name: rider.attached_to_policy
    payload: [rider_id, policy_id, sum_insured]
