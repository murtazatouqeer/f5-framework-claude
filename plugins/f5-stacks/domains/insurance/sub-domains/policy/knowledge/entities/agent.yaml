name: Agent
display_name: Insurance Agent
description: |
  Insurance agent or broker information.
  Tracks licensing, hierarchy, and performance metrics.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: agents
  primary_key: id
  indexes:
    - columns: [agent_code]
      unique: true
    - columns: [license_number]
    - columns: [status]
    - columns: [agent_type]
    - columns: [manager_id]
    - columns: [branch_id]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: agent_code
    type: string
    description: Unique agent code
    pattern: "AGT-[A-Z0-9]{6}"
    example: "AGT-A00001"
    required: true
    unique: true

  - name: user_id
    type: uuid
    description: Linked user account

  - name: external_id
    type: string
    description: External system ID

  # Type
  - name: agent_type
    type: enum
    description: Agent classification
    values:
      - tied_agent
      - independent_agent
      - broker
      - bancassurance
      - direct_sales
      - corporate_agent
      - aggregator
    required: true

  - name: agent_category
    type: enum
    description: Agent tier/category
    values:
      - trainee
      - junior
      - senior
      - manager
      - director
    default: junior

  # Personal details
  - name: title
    type: enum
    description: Title
    values:
      - mr
      - mrs
      - ms
      - miss
      - dr

  - name: first_name
    type: string
    description: First name
    max_length: 100
    required: true

  - name: last_name
    type: string
    description: Last name
    max_length: 100
    required: true

  - name: full_name
    type: string
    description: Full name
    max_length: 300
    computed: "first_name + ' ' + last_name"

  - name: date_of_birth
    type: date
    description: Birth date

  - name: gender
    type: enum
    description: Gender
    values:
      - male
      - female
      - other

  - name: nationality
    type: string
    description: Nationality

  # Identity
  - name: national_id
    type: string
    description: National ID
    max_length: 50

  - name: tax_id
    type: string
    description: Tax ID
    max_length: 50

  # Contact
  - name: email
    type: string
    description: Email address
    format: email
    required: true

  - name: phone
    type: string
    description: Phone number
    max_length: 20
    required: true

  - name: mobile
    type: string
    description: Mobile number
    max_length: 20

  - name: address
    type: object
    description: Address
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      province:
        type: string
      postal_code:
        type: string
      country:
        type: string

  # Licensing
  - name: license_number
    type: string
    description: Insurance license number
    max_length: 50
    required: true

  - name: license_type
    type: enum
    description: License type
    values:
      - life
      - non_life
      - composite
      - broker
    required: true

  - name: license_issue_date
    type: date
    description: License issue date

  - name: license_expiry_date
    type: date
    description: License expiry date

  - name: license_issuer
    type: string
    description: Licensing authority

  - name: license_status
    type: enum
    description: License status
    values:
      - active
      - expired
      - suspended
      - revoked
    default: active

  - name: certifications
    type: array
    description: Professional certifications
    items:
      type: object
      properties:
        name:
          type: string
        issuer:
          type: string
        issue_date:
          type: date
        expiry_date:
          type: date
        certificate_url:
          type: string

  # Hierarchy
  - name: manager_id
    type: uuid
    description: Reporting manager

  - name: branch_id
    type: uuid
    description: Branch/office

  - name: team_id
    type: uuid
    description: Sales team

  - name: channel_id
    type: uuid
    description: Distribution channel

  - name: hierarchy_level
    type: integer
    description: Level in hierarchy
    minimum: 1
    maximum: 10

  - name: direct_reports
    type: array
    description: Direct report agent IDs
    items:
      type: uuid

  # Products
  - name: authorized_products
    type: array
    description: Products can sell
    items:
      type: uuid

  - name: product_restrictions
    type: array
    description: Products cannot sell
    items:
      type: uuid

  - name: specializations
    type: array
    description: Product specializations
    items:
      type: string
    example: ["life", "health", "motor"]

  # Commission
  - name: commission_tier
    type: enum
    description: Commission tier
    values:
      - standard
      - preferred
      - premium
      - elite
    default: standard

  - name: commission_overrides
    type: array
    description: Special commission rates
    items:
      type: object
      properties:
        product_id:
          type: uuid
        first_year_rate:
          type: decimal
        renewal_rate:
          type: decimal
        effective_from:
          type: date
        effective_to:
          type: date

  - name: override_percentage
    type: decimal
    description: Override on downline
    precision: 5
    scale: 2

  # Bank details
  - name: bank_details
    type: object
    description: Payment account
    properties:
      bank_name:
        type: string
      account_number:
        type: string
      account_holder:
        type: string
      swift_code:
        type: string

  - name: payment_frequency
    type: enum
    description: Commission payment frequency
    values:
      - weekly
      - bi_weekly
      - monthly
    default: monthly

  # Status
  - name: status
    type: enum
    description: Agent status
    values:
      - active
      - inactive
      - suspended
      - terminated
      - pending_approval
    default: pending_approval

  - name: status_reason
    type: string
    description: Status reason

  - name: termination_date
    type: date
    description: When terminated

  - name: termination_reason
    type: string
    description: Why terminated

  # Dates
  - name: joined_date
    type: date
    description: Date joined
    required: true

  - name: contract_start_date
    type: date
    description: Contract start

  - name: contract_end_date
    type: date
    description: Contract end

  - name: last_active_date
    type: date
    description: Last activity

  # Training
  - name: training_completed
    type: array
    description: Completed training
    items:
      type: object
      properties:
        training_id:
          type: string
        name:
          type: string
        completed_date:
          type: date
        score:
          type: decimal
        certificate_url:
          type: string

  - name: training_required
    type: array
    description: Required training
    items:
      type: object
      properties:
        training_id:
          type: string
        name:
          type: string
        due_date:
          type: date

  # Performance metrics
  - name: performance_metrics
    type: object
    description: Performance data
    properties:
      ytd_premium:
        type: decimal
      ytd_policies:
        type: integer
      ytd_commission:
        type: decimal
      persistency_ratio:
        type: decimal
      conversion_rate:
        type: decimal
      avg_premium:
        type: decimal
      renewal_rate:
        type: decimal
      complaints_count:
        type: integer

  - name: targets
    type: object
    description: Sales targets
    properties:
      annual_premium_target:
        type: decimal
      annual_policy_target:
        type: integer
      quarterly_premium_target:
        type: decimal
      monthly_premium_target:
        type: decimal

  - name: achievement_percentage
    type: decimal
    description: Target achievement %
    precision: 5
    scale: 2
    computed: "ytd_premium / annual_premium_target * 100"

  # Awards/Recognition
  - name: awards
    type: array
    description: Awards received
    items:
      type: object
      properties:
        award_name:
          type: string
        year:
          type: integer
        description:
          type: string

  - name: mdrt_status
    type: boolean
    description: MDRT member
    default: false

  - name: club_membership
    type: array
    description: Club memberships
    items:
      type: string

  # Compliance
  - name: compliance_status
    type: enum
    description: Compliance status
    values:
      - compliant
      - warning
      - non_compliant
    default: compliant

  - name: compliance_issues
    type: array
    description: Compliance issues
    items:
      type: object
      properties:
        issue:
          type: string
        date:
          type: date
        resolution:
          type: string
        resolved:
          type: boolean

  - name: last_compliance_review
    type: date
    description: Last compliance review

  # Documents
  - name: documents
    type: array
    description: Agent documents
    items:
      type: object
      properties:
        document_type:
          type: string
        file_url:
          type: string
        uploaded_at:
          type: timestamp
        verified:
          type: boolean

  - name: photo_url
    type: string
    description: Profile photo
    format: uri

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

  - name: approved_by
    type: uuid
    description: Who approved agent

  - name: approved_at
    type: timestamp

relationships:
  - name: manager
    type: belongs_to
    entity: Agent
    foreign_key: manager_id

  - name: direct_reports
    type: has_many
    entity: Agent
    foreign_key: manager_id

  - name: branch
    type: belongs_to
    entity: Branch
    foreign_key: branch_id

  - name: policies
    type: has_many
    entity: Policy
    foreign_key: agent_id

  - name: commissions
    type: has_many
    entity: Commission
    foreign_key: agent_id

  - name: customers
    type: has_many
    entity: Policyholder
    foreign_key: agent_id

business_rules:
  - rule: BR-AGT-001
    description: Active agent must have valid license
    validation: IF status = 'active' THEN license_status = 'active' AND license_expiry_date > NOW()

  - rule: BR-AGT-002
    description: Can only sell authorized products
    validation: product_id IN authorized_products

  - rule: BR-AGT-003
    description: Terminated agent cannot write new business
    validation: IF status = 'terminated' THEN no new policies

events:
  - name: agent.registered
    payload: [agent_id, agent_code, agent_type]

  - name: agent.activated
    payload: [agent_id, approved_by]

  - name: agent.suspended
    payload: [agent_id, reason]

  - name: agent.terminated
    payload: [agent_id, termination_date, reason]

  - name: agent.license_expiring
    payload: [agent_id, expiry_date]

  - name: agent.target_achieved
    payload: [agent_id, target_type, achievement_percentage]

api_endpoints:
  - method: GET
    path: /agents
    description: List agents

  - method: GET
    path: /agents/{id}
    description: Get agent details

  - method: POST
    path: /agents
    description: Register agent

  - method: PUT
    path: /agents/{id}
    description: Update agent

  - method: POST
    path: /agents/{id}/activate
    description: Activate agent

  - method: POST
    path: /agents/{id}/suspend
    description: Suspend agent

  - method: GET
    path: /agents/{id}/performance
    description: Get performance metrics

  - method: GET
    path: /agents/{id}/hierarchy
    description: Get agent hierarchy
