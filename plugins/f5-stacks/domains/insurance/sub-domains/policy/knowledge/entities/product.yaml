name: Product
display_name: Insurance Product
description: |
  Insurance product definition and configuration.
  Defines coverages, eligibility, pricing, and terms.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: products
  primary_key: id
  indexes:
    - columns: [product_code]
      unique: true
    - columns: [status]
    - columns: [product_type]
    - columns: [line_of_business]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: product_code
    type: string
    description: Unique product code
    pattern: "[A-Z]{2,4}-[0-9]{3}"
    example: "TL-001"
    required: true
    unique: true

  - name: name
    type: string
    description: Internal product name
    max_length: 100
    required: true

  - name: marketing_name
    type: string
    description: Customer-facing name
    max_length: 150

  - name: description
    type: text
    description: Product description
    max_length: 2000

  # Classification
  - name: status
    type: enum
    description: Product status
    values:
      - draft
      - active
      - suspended
      - discontinued
    default: draft

  - name: product_type
    type: enum
    description: Main product category
    values:
      - life
      - health
      - motor
      - property
      - travel
      - liability
      - marine
      - fire
      - personal_accident
      - critical_illness
    required: true

  - name: product_subtype
    type: enum
    description: Product subcategory
    values:
      # Life
      - term_life
      - whole_life
      - endowment
      - unit_linked
      - annuity
      - universal_life
      # Health
      - health_individual
      - health_group
      - health_family
      - dental
      - vision
      # Motor
      - motor_comprehensive
      - motor_third_party
      - motor_own_damage
      # Property
      - home_owner
      - home_content
      - fire_theft
      # Travel
      - travel_single_trip
      - travel_annual
      - travel_business
      # Liability
      - public_liability
      - professional_indemnity
      - directors_officers

  - name: line_of_business
    type: string
    description: LOB for reporting
    max_length: 50

  - name: category_id
    type: uuid
    description: Product category

  - name: is_individual
    type: boolean
    description: Available for individuals
    default: true

  - name: is_group
    type: boolean
    description: Available for groups
    default: false

  - name: is_corporate
    type: boolean
    description: Available for corporates
    default: false

  # Coverages
  - name: base_coverages
    type: array
    description: Included coverages
    items:
      type: object
      properties:
        coverage_id:
          type: uuid
        coverage_code:
          type: string
        is_mandatory:
          type: boolean
        default_included:
          type: boolean

  - name: optional_coverages
    type: array
    description: Optional coverages
    items:
      type: object
      properties:
        coverage_id:
          type: uuid
        coverage_code:
          type: string

  - name: available_riders
    type: array
    description: Available rider options
    items:
      type: uuid

  - name: exclusions
    type: array
    description: Standard exclusions
    items:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
        applies_to:
          type: string

  # Eligibility
  - name: min_entry_age
    type: integer
    description: Minimum age at entry
    minimum: 0
    default: 18

  - name: max_entry_age
    type: integer
    description: Maximum age at entry
    maximum: 100
    default: 65

  - name: max_coverage_age
    type: integer
    description: Maximum age for coverage
    default: 75

  - name: min_sum_insured
    type: decimal
    description: Minimum sum insured
    precision: 15
    scale: 2

  - name: max_sum_insured
    type: decimal
    description: Maximum sum insured
    precision: 15
    scale: 2

  - name: occupation_classes_allowed
    type: array
    description: Allowed occupation classes
    items:
      type: integer
    default: [1, 2, 3]

  - name: occupation_classes_excluded
    type: array
    description: Excluded occupation classes
    items:
      type: integer
    default: [4]

  - name: health_requirements
    type: array
    description: Health requirements by sum
    items:
      type: object
      properties:
        sum_insured_threshold:
          type: decimal
        requirements:
          type: array
          items:
            type: string

  - name: geographic_availability
    type: array
    description: Countries/regions available
    items:
      type: string
    default: ["VN"]

  # Terms
  - name: min_term_months
    type: integer
    description: Minimum policy term
    default: 12

  - name: max_term_months
    type: integer
    description: Maximum policy term
    default: 360

  - name: available_terms
    type: array
    description: Available term options
    items:
      type: integer
    example: [12, 60, 120, 180, 240]

  - name: renewable
    type: boolean
    description: Can be renewed
    default: true

  - name: convertible
    type: boolean
    description: Can convert to another product
    default: false

  - name: convertible_to
    type: array
    description: Products can convert to
    items:
      type: uuid

  # Premium
  - name: premium_calculation_method
    type: enum
    description: How premium is calculated
    values:
      - rate_table
      - formula
      - api
      - manual
    default: rate_table

  - name: base_rate_table_id
    type: uuid
    description: Rate table for pricing

  - name: loading_factors
    type: array
    description: Standard loading factors
    items:
      type: object
      properties:
        factor_type:
          type: string
        calculation:
          type: string
        parameters:
          type: object

  - name: discount_rules
    type: array
    description: Available discounts
    items:
      type: object
      properties:
        discount_type:
          type: string
        percentage:
          type: decimal
        conditions:
          type: string

  - name: minimum_premium
    type: decimal
    description: Minimum premium amount
    precision: 10
    scale: 2

  - name: payment_frequencies
    type: array
    description: Allowed payment frequencies
    items:
      type: string
    default: ["monthly", "quarterly", "semi_annual", "annual"]

  # Commission
  - name: first_year_commission_percent
    type: decimal
    description: First year commission rate
    precision: 5
    scale: 2

  - name: renewal_commission_percent
    type: decimal
    description: Renewal commission rate
    precision: 5
    scale: 2

  - name: commission_structure
    type: object
    description: Detailed commission structure
    properties:
      year_1:
        type: decimal
      year_2:
        type: decimal
      year_3_plus:
        type: decimal
      override:
        type: decimal

  # Underwriting
  - name: auto_accept_limit
    type: decimal
    description: Auto-accept sum insured limit
    precision: 15
    scale: 2

  - name: requires_medical
    type: object
    description: Medical requirements
    properties:
      above_sum_insured:
        type: decimal
      above_age:
        type: integer
      tests_required:
        type: array

  # Documents
  - name: brochure_url
    type: string
    description: Product brochure
    format: uri

  - name: policy_wording_url
    type: string
    description: Policy wording document
    format: uri

  - name: proposal_form_url
    type: string
    description: Application form
    format: uri

  - name: claim_form_url
    type: string
    description: Claim form
    format: uri

  # Features
  - name: features
    type: array
    description: Product features/benefits
    items:
      type: object
      properties:
        feature:
          type: string
        description:
          type: string

  - name: waiting_periods
    type: object
    description: Waiting period configuration
    properties:
      general:
        type: integer
      pre_existing:
        type: integer
      maternity:
        type: integer
      critical_illness:
        type: integer

  # Regulatory
  - name: regulatory_approval_number
    type: string
    description: Regulatory approval reference

  - name: regulatory_approval_date
    type: date
    description: Approval date

  # Audit
  - name: launched_at
    type: date
    description: Product launch date

  - name: discontinued_at
    type: date
    description: Discontinuation date

  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: coverages
    type: has_many
    entity: Coverage
    through: product_coverages

  - name: riders
    type: has_many
    entity: Rider
    through: product_riders

  - name: rate_table
    type: belongs_to
    entity: RateTable
    foreign_key: base_rate_table_id

  - name: policies
    type: has_many
    entity: Policy
    foreign_key: product_id

  - name: quotes
    type: has_many
    entity: Quote
    foreign_key: product_id

business_rules:
  - rule: BR-PRD-001
    description: Max entry age must be less than max coverage age
    validation: max_entry_age < max_coverage_age

  - rule: BR-PRD-002
    description: Min sum must be less than max sum
    validation: min_sum_insured < max_sum_insured

  - rule: BR-PRD-003
    description: Active product must have at least one base coverage
    validation: IF status = 'active' THEN COUNT(base_coverages) >= 1

events:
  - name: product.created
    payload: [product_id, product_code]

  - name: product.launched
    payload: [product_id, launch_date]

  - name: product.discontinued
    payload: [product_id, discontinue_date]

  - name: product.updated
    payload: [product_id, changes]
