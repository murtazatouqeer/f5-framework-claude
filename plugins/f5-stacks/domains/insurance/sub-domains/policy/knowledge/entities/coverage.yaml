name: Coverage
display_name: Insurance Coverage
description: |
  Coverage type definition specifying what perils are covered,
  limits, deductibles, and exclusions.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: coverages
  primary_key: id
  indexes:
    - columns: [coverage_code]
      unique: true
    - columns: [coverage_type]
    - columns: [status]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: coverage_code
    type: string
    description: Unique coverage code
    pattern: "COV-[A-Z]{2,4}-[0-9]{3}"
    example: "COV-LIFE-001"
    required: true
    unique: true

  - name: name
    type: string
    description: Coverage name
    max_length: 100
    required: true

  - name: display_name
    type: string
    description: Customer-facing name
    max_length: 150

  - name: description
    type: text
    description: Coverage description
    max_length: 2000

  # Classification
  - name: status
    type: enum
    description: Coverage status
    values:
      - active
      - discontinued
      - draft
    default: active

  - name: coverage_type
    type: enum
    description: Coverage category
    values:
      - base
      - optional
      - rider
      - endorsement
    default: base

  - name: category
    type: enum
    description: Coverage category
    values:
      - life
      - health
      - accident
      - disability
      - property
      - liability
      - motor
      - travel
    required: true

  # Perils covered
  - name: perils_covered
    type: array
    description: What events/perils are covered
    items:
      type: enum
      values:
        # Life
        - death
        - terminal_illness
        # Health
        - hospitalization
        - outpatient
        - surgery
        - maternity
        - dental
        - vision
        # Accident
        - accidental_death
        - permanent_disability
        - temporary_disability
        - medical_expenses
        # Property
        - fire
        - theft
        - natural_disaster
        - water_damage
        # Motor
        - own_damage
        - third_party_liability
        - third_party_property
        # Travel
        - trip_cancellation
        - baggage_loss
        - flight_delay
        # Critical Illness
        - cancer
        - heart_attack
        - stroke
        - organ_failure

  - name: coverage_basis
    type: enum
    description: When coverage applies
    values:
      - occurrence    # Event during policy period
      - claims_made   # Claim during policy period
      - accident_date # Based on accident date
    default: occurrence

  # Sum Insured
  - name: sum_insured_type
    type: enum
    description: Sum insured calculation
    values:
      - fixed
      - multiple_of_salary
      - declining
      - increasing
      - level
    default: fixed

  - name: min_sum_insured
    type: decimal
    description: Minimum sum insured
    precision: 15
    scale: 2

  - name: max_sum_insured
    type: decimal
    description: Maximum sum insured
    precision: 15
    scale: 2

  - name: sum_insured_increments
    type: decimal
    description: Sum insured must be multiple of
    precision: 10
    scale: 2

  - name: default_sum_insured
    type: decimal
    description: Default sum insured
    precision: 15
    scale: 2

  # Limits
  - name: sub_limits
    type: array
    description: Coverage sub-limits
    items:
      type: object
      properties:
        item:
          type: string
          description: What the limit applies to
        limit:
          type: decimal
        limit_type:
          type: enum
          values: [per_event, per_day, per_year, aggregate, lifetime]
        basis:
          type: string

  - name: aggregate_limit
    type: decimal
    description: Maximum total payout
    precision: 15
    scale: 2

  - name: per_occurrence_limit
    type: decimal
    description: Maximum per claim/event
    precision: 15
    scale: 2

  - name: annual_limit
    type: decimal
    description: Maximum per policy year
    precision: 15
    scale: 2

  # Deductible
  - name: deductible_type
    type: enum
    description: Deductible application
    values:
      - none
      - fixed
      - percentage
      - waiting_period
      - per_claim
      - annual_aggregate
    default: none

  - name: deductible_amount
    type: decimal
    description: Deductible amount/percentage
    precision: 10
    scale: 2

  - name: deductible_options
    type: array
    description: Available deductible choices
    items:
      type: object
      properties:
        amount:
          type: decimal
        discount_percent:
          type: decimal

  - name: waiting_period_days
    type: integer
    description: Waiting period for coverage
    default: 0

  # Co-payment
  - name: copay_percent
    type: decimal
    description: Copayment percentage
    precision: 5
    scale: 2

  - name: coinsurance_percent
    type: decimal
    description: Coinsurance percentage
    precision: 5
    scale: 2

  # Exclusions
  - name: exclusions
    type: array
    description: What is not covered
    items:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
        is_standard:
          type: boolean

  - name: pre_existing_condition_waiting
    type: integer
    description: Months waiting for pre-existing
    default: 12

  - name: pre_existing_excluded
    type: boolean
    description: Pre-existing fully excluded
    default: false

  # Premium
  - name: rate_per_mille
    type: decimal
    description: Rate per 1000 sum insured
    precision: 8
    scale: 4

  - name: flat_premium
    type: decimal
    description: Fixed premium amount
    precision: 10
    scale: 2

  - name: rate_basis
    type: enum
    description: Rate calculation basis
    values:
      - sum_insured
      - flat
      - age_based
      - experience_rated
    default: sum_insured

  - name: loading_factors
    type: array
    description: Applicable loadings
    items:
      type: object
      properties:
        factor:
          type: string
        percentage:
          type: decimal
        conditions:
          type: string

  # Dependencies
  - name: requires_base_coverage
    type: boolean
    description: Must have base coverage
    default: false

  - name: prerequisite_coverages
    type: array
    description: Required prerequisite coverages
    items:
      type: uuid

  - name: incompatible_coverages
    type: array
    description: Cannot combine with these
    items:
      type: uuid

  # Benefit payout
  - name: benefit_type
    type: enum
    description: How benefit is paid
    values:
      - lump_sum
      - reimbursement
      - indemnity
      - per_diem
      - scheduled_benefit
    default: lump_sum

  - name: benefit_schedule
    type: array
    description: Scheduled benefits
    items:
      type: object
      properties:
        condition:
          type: string
        benefit_percent:
          type: decimal
        max_amount:
          type: decimal

  # Audit
  - name: effective_from
    type: date
    description: Coverage available from

  - name: effective_to
    type: date
    description: Coverage available until

  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: products
    type: belongs_to_many
    entity: Product
    through: product_coverages

  - name: policy_coverages
    type: has_many
    entity: PolicyCoverage
    foreign_key: coverage_id

business_rules:
  - rule: BR-COV-001
    description: Max sum must exceed min sum
    validation: max_sum_insured > min_sum_insured

  - rule: BR-COV-002
    description: Rider coverage requires base coverage
    validation: IF coverage_type = 'rider' THEN requires_base_coverage = true

  - rule: BR-COV-003
    description: Active coverage must have at least one peril
    validation: IF status = 'active' THEN COUNT(perils_covered) >= 1

events:
  - name: coverage.created
    payload: [coverage_id, coverage_code]

  - name: coverage.updated
    payload: [coverage_id, changes]

  - name: coverage.discontinued
    payload: [coverage_id, effective_date]
