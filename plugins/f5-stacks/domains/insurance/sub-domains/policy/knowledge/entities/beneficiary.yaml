name: Beneficiary
display_name: Policy Beneficiary
description: |
  Person or entity designated to receive policy benefits.
  Includes allocation percentages and claim payment details.

domain: insurance
subdomain: policy
category: entities
version: "1.0.0"
status: active

database:
  table_name: beneficiaries
  primary_key: id
  indexes:
    - columns: [policy_id]
    - columns: [beneficiary_type]
    - columns: [national_id]
    - columns: [status]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: policy_id
    type: uuid
    description: Parent policy
    required: true

  - name: insured_id
    type: uuid
    description: Related insured person

  # Beneficiary type
  - name: beneficiary_type
    type: enum
    description: Beneficiary classification
    values:
      - primary
      - contingent
      - tertiary
    default: primary

  - name: entity_type
    type: enum
    description: Beneficiary entity type
    values:
      - individual
      - trust
      - estate
      - charity
      - corporation
    default: individual

  # Individual details
  - name: title
    type: enum
    description: Title/salutation
    values:
      - mr
      - mrs
      - ms
      - miss
      - dr
      - prof

  - name: first_name
    type: string
    description: First name
    max_length: 100

  - name: middle_name
    type: string
    description: Middle name
    max_length: 100

  - name: last_name
    type: string
    description: Last name
    max_length: 100

  - name: full_name
    type: string
    description: Complete name
    max_length: 300
    required: true

  - name: date_of_birth
    type: date
    description: Birth date

  - name: gender
    type: enum
    description: Gender
    values:
      - male
      - female
      - other

  # Relationship
  - name: relationship_to_insured
    type: enum
    description: Relation to insured
    values:
      - spouse
      - child
      - parent
      - sibling
      - grandparent
      - grandchild
      - legal_guardian
      - business_partner
      - employer
      - estate
      - trust
      - charity
      - other
    required: true

  - name: relationship_details
    type: string
    description: Relationship explanation

  # Identity
  - name: national_id
    type: string
    description: National ID number
    max_length: 50

  - name: passport_number
    type: string
    description: Passport number
    max_length: 50

  - name: tax_id
    type: string
    description: Tax identification number

  # Contact
  - name: email
    type: string
    description: Email address
    format: email

  - name: phone
    type: string
    description: Phone number
    max_length: 20

  - name: mobile
    type: string
    description: Mobile number
    max_length: 20

  - name: address
    type: object
    description: Mailing address
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      province:
        type: string
      postal_code:
        type: string
      country:
        type: string

  # Entity details (for non-individuals)
  - name: entity_name
    type: string
    description: Organization name
    max_length: 200

  - name: registration_number
    type: string
    description: Entity registration number

  - name: trust_name
    type: string
    description: Trust name if applicable

  - name: trustee_name
    type: string
    description: Trustee name

  - name: charity_registration
    type: string
    description: Charity registration number

  # Allocation
  - name: allocation_percent
    type: decimal
    description: Percentage of benefit
    precision: 5
    scale: 2
    required: true
    minimum: 0.01
    maximum: 100.00

  - name: allocation_amount
    type: decimal
    description: Fixed amount if applicable
    precision: 15
    scale: 2

  - name: allocation_type
    type: enum
    description: Allocation method
    values:
      - percentage
      - fixed_amount
      - remainder
    default: percentage

  # Irrevocability
  - name: is_irrevocable
    type: boolean
    description: Cannot be changed
    default: false

  - name: irrevocable_reason
    type: string
    description: Why irrevocable

  - name: irrevocable_date
    type: date
    description: When made irrevocable

  - name: requires_consent
    type: boolean
    description: Needs beneficiary consent
    default: false

  # Minor beneficiary
  - name: is_minor
    type: boolean
    description: Under legal age
    default: false

  - name: guardian_name
    type: string
    description: Legal guardian name

  - name: guardian_relationship
    type: string
    description: Guardian relationship

  - name: guardian_contact
    type: object
    description: Guardian contact info
    properties:
      email:
        type: string
      phone:
        type: string
      address:
        type: object

  # Bank details (for payment)
  - name: bank_details
    type: object
    description: Payment account
    properties:
      bank_name:
        type: string
      bank_code:
        type: string
      branch_name:
        type: string
      account_number:
        type: string
      account_holder_name:
        type: string
      swift_code:
        type: string

  # Status
  - name: status
    type: enum
    description: Beneficiary status
    values:
      - active
      - inactive
      - deceased
      - removed
    default: active

  - name: effective_date
    type: date
    description: When became beneficiary

  - name: termination_date
    type: date
    description: When removed

  - name: termination_reason
    type: string
    description: Why removed

  # Verification
  - name: verified
    type: boolean
    description: Identity verified
    default: false

  - name: verified_at
    type: timestamp
    description: Verification date

  - name: verified_by
    type: uuid
    description: Verifier

  - name: verification_documents
    type: array
    description: Verification docs
    items:
      type: object
      properties:
        document_type:
          type: string
        file_url:
          type: string
        uploaded_at:
          type: timestamp

  # Special instructions
  - name: special_instructions
    type: text
    description: Payment instructions

  - name: payment_preference
    type: enum
    description: How to receive payment
    values:
      - bank_transfer
      - cheque
      - cash
      - other
    default: bank_transfer

  # Claims
  - name: claims_received
    type: integer
    description: Number of claims received
    default: 0

  - name: total_amount_received
    type: decimal
    description: Total benefits received
    precision: 15
    scale: 2
    default: 0

  # Nomination history
  - name: nomination_date
    type: date
    description: When nominated

  - name: nomination_witness
    type: object
    description: Witness details
    properties:
      name:
        type: string
      relationship:
        type: string
      contact:
        type: string

  - name: previous_allocation
    type: decimal
    description: Previous allocation %
    precision: 5
    scale: 2

  - name: change_reason
    type: string
    description: Why allocation changed

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

  - name: created_by
    type: uuid

relationships:
  - name: policy
    type: belongs_to
    entity: Policy
    foreign_key: policy_id

  - name: insured
    type: belongs_to
    entity: Insured
    foreign_key: insured_id

  - name: claim_payments
    type: has_many
    entity: ClaimPayment
    foreign_key: beneficiary_id

business_rules:
  - rule: BR-BEN-001
    description: Primary beneficiaries must total 100%
    validation: SUM(allocation_percent) WHERE beneficiary_type = 'primary' = 100

  - rule: BR-BEN-002
    description: Contingent only pays if no primary survives
    validation: contingent_pays ONLY IF all_primary_deceased

  - rule: BR-BEN-003
    description: Minor beneficiary must have guardian
    validation: IF is_minor = true THEN guardian_name IS NOT NULL

  - rule: BR-BEN-004
    description: Irrevocable requires consent to change
    validation: IF is_irrevocable = true THEN requires_consent = true

  - rule: BR-BEN-005
    description: Bank details required for bank transfer
    validation: IF payment_preference = 'bank_transfer' THEN bank_details IS NOT NULL

events:
  - name: beneficiary.nominated
    payload: [policy_id, beneficiary_id, allocation_percent]

  - name: beneficiary.updated
    payload: [beneficiary_id, previous_allocation, new_allocation]

  - name: beneficiary.removed
    payload: [beneficiary_id, removal_reason]

  - name: beneficiary.verified
    payload: [beneficiary_id, verified_at]

  - name: beneficiary.claim_paid
    payload: [beneficiary_id, claim_id, amount]
