name: claim_item
display_name: Claim Item
description: |
  Individual line items within a claim representing specific
  expenses, damages, or benefit components.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique item identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Parent claim

    - name: item_number
      type: integer
      auto_increment: true
      scope: claim_id
      description: Item sequence within claim

  classification:
    - name: item_type
      type: enum
      values:
        - medical_expense
        - hospitalization
        - surgery
        - medication
        - diagnostic
        - rehabilitation
        - property_damage
        - vehicle_repair
        - vehicle_replacement
        - personal_property
        - loss_of_income
        - death_benefit
        - disability_benefit
        - critical_illness_benefit
        - third_party_damage
        - third_party_injury
        - legal_cost
        - travel_expense
        - accommodation
        - other
      required: true
      description: Type of claim item

    - name: category
      type: string
      description: Sub-category of item

    - name: subcategory
      type: string
      description: Further classification

  status:
    - name: status
      type: enum
      values:
        - pending
        - under_review
        - approved
        - partially_approved
        - denied
        - paid
      default: pending
      description: Item approval status

  details:
    - name: description
      type: text
      required: true
      description: Item description

    - name: service_date
      type: date
      description: Date service was provided

    - name: service_provider
      type: string
      description: Provider name (hospital, garage, etc.)

    - name: service_provider_id
      type: string
      description: Provider registration/license number

    - name: quantity
      type: integer
      default: 1
      description: Quantity of items/services

    - name: unit_cost
      type: decimal
      precision: 2
      description: Cost per unit

  amounts:
    - name: claimed_amount
      type: decimal
      precision: 2
      required: true
      description: Amount claimed

    - name: currency
      type: string
      default: VND
      description: Currency

    - name: assessed_amount
      type: decimal
      precision: 2
      description: Amount after assessment

    - name: approved_amount
      type: decimal
      precision: 2
      description: Final approved amount

    - name: paid_amount
      type: decimal
      precision: 2
      default: 0
      description: Amount paid

    - name: variance
      type: decimal
      precision: 2
      computed: true
      formula: "claimed_amount - approved_amount"
      description: Difference from claimed

  assessment:
    - name: reasonable_and_customary
      type: boolean
      description: Amount within R&C limits

    - name: rac_limit
      type: decimal
      precision: 2
      description: Reasonable and customary limit

    - name: adjustment_reason
      type: enum
      values:
        - within_limit
        - exceeds_rac
        - not_covered
        - duplicate
        - pre_existing
        - waiting_period
        - exceeds_sum_insured
        - policy_exclusion
        - partial_coverage
        - other
      description: Reason for adjustment

    - name: adjustment_notes
      type: text
      description: Detailed adjustment explanation

    - name: assessed_by
      type: uuid
      foreign_key: user.id
      description: Assessor

    - name: assessed_at
      type: datetime
      description: Assessment date

  denial:
    - name: denial_reason
      type: enum
      values:
        - not_covered
        - exclusion_applies
        - exceeds_limit
        - no_documentation
        - invalid_documentation
        - duplicate_claim
        - pre_existing
        - waiting_period
        - policy_condition
        - other
      description: Reason for denial

    - name: denial_details
      type: text
      description: Detailed denial explanation

  documentation:
    - name: receipt_url
      type: string
      format: url
      description: Receipt/bill document

    - name: invoice_url
      type: string
      format: url
      description: Invoice document

    - name: supporting_docs
      type: array
      items: string
      description: Additional document URLs

    - name: verification_status
      type: enum
      values:
        - pending
        - verified
        - rejected
        - needs_review
      default: pending
      description: Document verification status

  medical_specific:
    - name: diagnosis_code
      type: string
      description: ICD-10 diagnosis code

    - name: procedure_code
      type: string
      description: Procedure code

    - name: is_emergency
      type: boolean
      default: false
      description: Emergency treatment

    - name: is_planned
      type: boolean
      default: false
      description: Planned/elective treatment

    - name: admission_date
      type: date
      description: Hospital admission date

    - name: discharge_date
      type: date
      description: Hospital discharge date

    - name: length_of_stay
      type: integer
      computed: true
      formula: "discharge_date - admission_date + 1"
      description: Days in hospital

  property_specific:
    - name: property_type
      type: string
      description: Type of property

    - name: damage_description
      type: text
      description: Description of damage

    - name: repair_estimate
      type: decimal
      precision: 2
      description: Repair cost estimate

    - name: replacement_cost
      type: decimal
      precision: 2
      description: Replacement cost

    - name: actual_cash_value
      type: decimal
      precision: 2
      description: ACV (depreciated value)

    - name: depreciation
      type: decimal
      precision: 2
      description: Depreciation applied

  timestamps:
    - name: created_at
      type: datetime
      auto: true
      description: Creation timestamp

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Update timestamp

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Parent claim

  - name: assessment
    type: has_one
    entity: assessment
    description: Item assessment

  - name: documents
    type: has_many
    entity: claim_document
    description: Supporting documents

business_rules:
  - rule: BR-ITM-001
    name: Amount validation
    condition: "claimed_amount > 0"
    error_message: "Claimed amount must be positive"

  - rule: BR-ITM-002
    name: Documentation required
    condition: "receipt_url IS NOT NULL OR invoice_url IS NOT NULL"
    for_types: [medical_expense, property_damage]
    error_message: "Receipt or invoice required"

  - rule: BR-ITM-003
    name: Approved not exceed claimed
    condition: "approved_amount <= claimed_amount"
    error_message: "Approved amount cannot exceed claimed"

  - rule: BR-ITM-004
    name: Sum insured check
    condition: "total_approved_items <= policy.sum_insured"
    error_message: "Total exceeds sum insured"

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/items
    description: Add claim item
    request_body: ClaimItemCreateRequest
    response: ClaimItemResponse

  - method: GET
    path: /claims/{claim_id}/items
    description: List claim items
    response: ClaimItemListResponse

  - method: GET
    path: /claims/{claim_id}/items/{id}
    description: Get item details
    response: ClaimItemResponse

  - method: PUT
    path: /claims/{claim_id}/items/{id}
    description: Update item
    request_body: ClaimItemUpdateRequest
    response: ClaimItemResponse

  - method: POST
    path: /claims/{claim_id}/items/{id}/assess
    description: Assess item
    request_body: ItemAssessmentRequest
    response: ClaimItemResponse

  - method: DELETE
    path: /claims/{claim_id}/items/{id}
    description: Remove item
    condition: "claim.status = 'reported'"
