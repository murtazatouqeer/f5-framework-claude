name: surveyor_report
display_name: Surveyor Report
description: |
  Survey and loss adjustment report for property, motor, and other claims
  requiring physical inspection and valuation.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique report identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Associated claim

    - name: assessment_id
      type: uuid
      foreign_key: assessment.id
      description: Linked assessment

    - name: report_number
      type: string
      format: "SRV-{YYYYMMDD}-{NNNN}"
      description: Report reference number

  surveyor:
    - name: surveyor_id
      type: uuid
      description: Surveyor user ID

    - name: surveyor_name
      type: string
      required: true
      description: Surveyor full name

    - name: surveyor_company
      type: string
      description: Survey company name

    - name: surveyor_license
      type: string
      description: Professional license number

    - name: surveyor_contact
      type: object
      properties:
        phone: string
        email: string
      description: Surveyor contact details

    - name: surveyor_specialization
      type: array
      items:
        type: enum
        values:
          - motor
          - property
          - marine
          - engineering
          - agriculture
          - aviation
      description: Surveyor specializations

  status:
    - name: status
      type: enum
      values:
        - assigned
        - accepted
        - scheduled
        - inspected
        - draft_submitted
        - under_review
        - revision_requested
        - finalized
        - cancelled
      default: assigned
      description: Report status

  survey_details:
    - name: survey_type
      type: enum
      values:
        - motor_damage
        - motor_theft
        - property_fire
        - property_theft
        - property_natural
        - property_flood
        - marine_cargo
        - marine_hull
        - engineering
        - general
      required: true
      description: Type of survey

    - name: survey_scope
      type: text
      description: Scope of survey requested

    - name: survey_date
      type: datetime
      description: Date and time of inspection

    - name: survey_location
      type: object
      properties:
        address: string
        city: string
        province: string
        latitude: decimal
        longitude: decimal
        access_notes: string
      description: Inspection location

    - name: survey_duration_hours
      type: decimal
      precision: 1
      description: Time spent on survey

    - name: persons_present
      type: array
      items:
        type: object
        properties:
          name: string
          role: string
          contact: string
      description: People present at survey

  findings:
    - name: subject_description
      type: text
      description: Description of subject (vehicle, property, etc.)

    - name: damage_description
      type: text
      description: Detailed damage description

    - name: cause_of_damage
      type: text
      description: Surveyor's assessment of cause

    - name: cause_category
      type: enum
      values:
        - accident
        - fire
        - theft
        - natural_disaster
        - wear_and_tear
        - negligence
        - deliberate
        - unknown
      description: Cause category

    - name: pre_existing_damage
      type: boolean
      default: false
      description: Pre-existing damage found

    - name: pre_existing_details
      type: text
      description: Details of pre-existing damage

    - name: damage_extent
      type: enum
      values:
        - total_loss
        - constructive_total_loss
        - major_damage
        - partial_loss
        - minor_damage
        - no_damage
      description: Extent of damage

    - name: repairable
      type: boolean
      description: Damage can be repaired

    - name: consistency_with_claim
      type: enum
      values:
        - consistent
        - partially_consistent
        - inconsistent
      description: Consistency with claim narrative

    - name: consistency_notes
      type: text
      description: Notes on consistency

  motor_specific:
    - name: vehicle_details
      type: object
      properties:
        make: string
        model: string
        year: integer
        registration: string
        vin: string
        odometer: integer
        color: string
        fuel_type: string
      description: Vehicle information

    - name: parts_affected
      type: array
      items:
        type: object
        properties:
          part_name: string
          damage_type: string
          repair_or_replace: enum[repair, replace]
          estimated_cost: decimal
      description: Affected parts

    - name: repair_shop_recommendation
      type: object
      properties:
        name: string
        address: string
        contact: string
        authorized: boolean
      description: Recommended repair shop

  property_specific:
    - name: property_details
      type: object
      properties:
        property_type: string
        construction_type: string
        year_built: integer
        total_area: decimal
        floors: integer
        occupancy: string
      description: Property information

    - name: affected_areas
      type: array
      items:
        type: object
        properties:
          area: string
          damage_type: string
          area_size: decimal
          estimated_cost: decimal
      description: Affected areas

    - name: contents_damage
      type: array
      items:
        type: object
        properties:
          item: string
          quantity: integer
          age: string
          condition_before: string
          damage: string
          value: decimal
      description: Contents affected

  valuation:
    - name: claimed_amount
      type: decimal
      precision: 2
      description: Amount claimed

    - name: replacement_cost_new
      type: decimal
      precision: 2
      description: Cost to replace new

    - name: actual_cash_value
      type: decimal
      precision: 2
      description: Value with depreciation

    - name: repair_cost
      type: decimal
      precision: 2
      description: Cost to repair

    - name: depreciation_percentage
      type: decimal
      precision: 2
      description: Depreciation rate

    - name: depreciation_amount
      type: decimal
      precision: 2
      description: Depreciation value

    - name: salvage_value
      type: decimal
      precision: 2
      description: Salvage/scrap value

    - name: betterment_deduction
      type: decimal
      precision: 2
      description: Betterment adjustment

    - name: assessed_loss
      type: decimal
      precision: 2
      description: Surveyor's assessed loss

    - name: recommended_settlement
      type: decimal
      precision: 2
      description: Recommended settlement amount

    - name: valuation_basis
      type: enum
      values:
        - replacement_cost
        - actual_cash_value
        - repair_cost
        - market_value
        - agreed_value
      description: Basis for valuation

    - name: valuation_notes
      type: text
      description: Valuation methodology notes

  evidence:
    - name: photographs
      type: array
      items:
        type: object
        properties:
          url: string
          description: string
          taken_at: datetime
          location: string
      description: Survey photographs

    - name: videos
      type: array
      items:
        type: object
        properties:
          url: string
          description: string
          duration_seconds: integer
      description: Video recordings

    - name: documents_collected
      type: array
      items:
        type: object
        properties:
          document_type: string
          document_url: string
          description: string
      description: Documents collected during survey

  recommendation:
    - name: recommendation
      type: enum
      values:
        - approve
        - approve_partial
        - deny
        - further_investigation
        - refer_to_siu
      required: true
      description: Surveyor recommendation

    - name: recommendation_reason
      type: text
      description: Reasoning for recommendation

    - name: red_flags
      type: array
      items: string
      description: Suspicious indicators noted

    - name: fraud_indicators
      type: boolean
      default: false
      description: Fraud indicators present

    - name: fraud_notes
      type: text
      description: Fraud-related observations

    - name: additional_investigation_needed
      type: boolean
      default: false
      description: Further investigation recommended

    - name: subrogation_potential
      type: boolean
      default: false
      description: Recovery opportunity exists

    - name: subrogation_details
      type: text
      description: Subrogation information

  report:
    - name: report_url
      type: string
      format: url
      description: Full report document

    - name: report_summary
      type: text
      description: Executive summary

    - name: draft_submitted_at
      type: datetime
      description: Draft submission date

    - name: finalized_at
      type: datetime
      description: Final submission date

    - name: revision_count
      type: integer
      default: 0
      description: Number of revisions

  fees:
    - name: survey_fee
      type: decimal
      precision: 2
      description: Survey fee amount

    - name: travel_expense
      type: decimal
      precision: 2
      description: Travel expenses

    - name: total_fee
      type: decimal
      precision: 2
      computed: true
      formula: "survey_fee + travel_expense"
      description: Total surveyor fee

    - name: fee_status
      type: enum
      values:
        - pending
        - invoiced
        - paid
      default: pending
      description: Fee payment status

  timestamps:
    - name: assigned_at
      type: datetime
      description: Assignment timestamp

    - name: accepted_at
      type: datetime
      description: Surveyor accepted

    - name: completed_at
      type: datetime
      description: Survey completed

    - name: created_at
      type: datetime
      auto: true
      description: Record created

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Record updated

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Associated claim

  - name: assessment
    type: belongs_to
    entity: assessment
    foreign_key: assessment_id
    description: Linked assessment

business_rules:
  - rule: BR-SRV-001
    name: Survey within SLA
    condition: "survey_date - assigned_at <= 3 days"
    warning_message: "Survey should be completed within 3 days"

  - rule: BR-SRV-002
    name: Photos required
    condition: "LENGTH(photographs) >= 5"
    error_message: "Minimum 5 photographs required"

  - rule: BR-SRV-003
    name: Valuation required
    condition: "assessed_loss IS NOT NULL"
    before: finalized
    error_message: "Loss valuation must be provided"

events:
  - name: survey.assigned
    description: Survey assigned to surveyor
    payload: [report_id, claim_id, surveyor_id]

  - name: survey.scheduled
    description: Survey date scheduled
    payload: [report_id, survey_date]

  - name: survey.completed
    description: Physical survey completed
    payload: [report_id, surveyor_id]

  - name: survey.submitted
    description: Report submitted
    payload: [report_id, recommendation, assessed_loss]

  - name: survey.finalized
    description: Report finalized
    payload: [report_id, recommended_settlement]

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/surveyor-reports
    description: Create survey request
    request_body: SurveyRequestCreate
    response: SurveyorReportResponse

  - method: GET
    path: /claims/{claim_id}/surveyor-reports
    description: List survey reports
    response: SurveyorReportListResponse

  - method: GET
    path: /claims/{claim_id}/surveyor-reports/{id}
    description: Get report details
    response: SurveyorReportResponse

  - method: PUT
    path: /claims/{claim_id}/surveyor-reports/{id}
    description: Update report
    request_body: SurveyorReportUpdateRequest
    response: SurveyorReportResponse

  - method: POST
    path: /claims/{claim_id}/surveyor-reports/{id}/submit
    description: Submit draft report
    response: SurveyorReportResponse

  - method: POST
    path: /claims/{claim_id}/surveyor-reports/{id}/finalize
    description: Finalize report
    response: SurveyorReportResponse

  - method: POST
    path: /claims/{claim_id}/surveyor-reports/{id}/request-revision
    description: Request revision
    request_body: RevisionRequest
    response: SurveyorReportResponse
