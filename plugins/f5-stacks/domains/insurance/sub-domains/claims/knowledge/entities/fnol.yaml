name: fnol
display_name: First Notice of Loss
description: |
  First Notice of Loss (FNOL) record capturing initial claim notification.
  Serves as the entry point for claims processing.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique FNOL identifier

    - name: fnol_number
      type: string
      format: "FNOL-{YYYYMMDD}-{NNNNNN}"
      unique: true
      description: Human-readable FNOL reference
      example: "FNOL-20241215-000001"

    - name: policy_id
      type: uuid
      foreign_key: policy.id
      description: Associated policy (if identified)

    - name: policy_number
      type: string
      description: Policy number provided by caller

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      description: Created claim (after conversion)

  status:
    - name: status
      type: enum
      values:
        - received
        - acknowledged
        - in_triage
        - policy_verified
        - converted_to_claim
        - rejected
        - duplicate
        - incomplete
      default: received
      description: FNOL processing status

    - name: rejection_reason
      type: string
      description: Reason if rejected

  channel:
    - name: channel
      type: enum
      values:
        - phone
        - email
        - web_portal
        - mobile_app
        - agent
        - walk_in
        - partner
        - hospital_direct
      required: true
      description: Notification channel

    - name: channel_reference
      type: string
      description: Reference from channel (call ID, email ID)

  reporter:
    - name: reporter_name
      type: string
      required: true
      description: Name of person reporting

    - name: reporter_phone
      type: string
      required: true
      description: Reporter contact number

    - name: reporter_email
      type: string
      format: email
      description: Reporter email

    - name: reporter_relationship
      type: enum
      values:
        - policyholder
        - insured
        - beneficiary
        - spouse
        - family_member
        - witness
        - third_party
        - agent
        - hospital
        - police
        - other
      required: true
      description: Reporter's relationship to claim

    - name: reporter_id_type
      type: string
      description: ID document type

    - name: reporter_id_number
      type: string
      description: ID document number

  incident:
    - name: incident_date
      type: date
      required: true
      description: Date of incident

    - name: incident_time
      type: time
      description: Time of incident

    - name: incident_type
      type: enum
      values:
        - death
        - hospitalization
        - accident
        - illness
        - theft
        - fire
        - natural_disaster
        - vehicle_accident
        - property_damage
        - travel_issue
        - other
      required: true
      description: Type of incident

    - name: incident_location
      type: object
      properties:
        description: string
        address: string
        city: string
        province: string
        country: string
        latitude: decimal
        longitude: decimal
      description: Location of incident

    - name: incident_description
      type: text
      required: true
      description: Description of what happened

    - name: police_report_number
      type: string
      description: Police report reference

    - name: police_station
      type: string
      description: Police station name

  affected_parties:
    - name: insured_name
      type: string
      description: Name of insured person

    - name: insured_condition
      type: enum
      values:
        - uninjured
        - minor_injury
        - hospitalized
        - critical
        - deceased
        - unknown
      description: Current condition of insured

    - name: current_hospital
      type: string
      description: Hospital name if admitted

    - name: hospital_contact
      type: string
      description: Hospital contact number

    - name: third_parties_involved
      type: boolean
      default: false
      description: Third parties involved

    - name: third_party_count
      type: integer
      description: Number of third parties

    - name: third_party_details
      type: text
      description: Third party information

  loss_estimate:
    - name: estimated_loss_amount
      type: decimal
      precision: 2
      description: Estimated claim amount

    - name: currency
      type: string
      default: VND
      description: Currency

    - name: loss_severity
      type: enum
      values:
        - minor
        - moderate
        - major
        - total_loss
        - unknown
      description: Estimated severity

  urgency:
    - name: is_emergency
      type: boolean
      default: false
      description: Emergency situation

    - name: immediate_assistance_needed
      type: boolean
      default: false
      description: Requires immediate help

    - name: assistance_type
      type: array
      items:
        type: enum
        values:
          - ambulance
          - hospital_admission
          - towing
          - temporary_accommodation
          - emergency_repair
          - legal_assistance
      description: Type of assistance needed

    - name: assistance_provided
      type: text
      description: Assistance already provided

  triage:
    - name: coverage_preliminary_check
      type: enum
      values:
        - likely_covered
        - needs_review
        - likely_not_covered
        - policy_not_found
      description: Initial coverage assessment

    - name: complexity
      type: enum
      values:
        - simple
        - moderate
        - complex
        - catastrophic
      description: Estimated complexity

    - name: priority
      type: enum
      values:
        - low
        - medium
        - high
        - urgent
      description: Processing priority

    - name: triage_notes
      type: text
      description: Triage assessment notes

    - name: triaged_by
      type: uuid
      foreign_key: user.id
      description: Person who triaged

    - name: triaged_at
      type: datetime
      description: Triage timestamp

  assignment:
    - name: assigned_to
      type: uuid
      foreign_key: user.id
      description: Assigned handler

    - name: assigned_team
      type: string
      description: Assigned claims team

    - name: assigned_at
      type: datetime
      description: Assignment timestamp

  recording:
    - name: call_recording_url
      type: string
      format: url
      description: Call recording link

    - name: call_duration_seconds
      type: integer
      description: Call duration

    - name: transcript_url
      type: string
      format: url
      description: Call transcript

  acknowledgment:
    - name: acknowledged
      type: boolean
      default: false
      description: Acknowledgment sent

    - name: acknowledgment_sent_at
      type: datetime
      description: When acknowledgment sent

    - name: acknowledgment_method
      type: enum
      values:
        - sms
        - email
        - both
      description: Acknowledgment channel

    - name: acknowledgment_reference
      type: string
      description: Acknowledgment reference number

  documents_advised:
    - name: documents_to_submit
      type: array
      items: string
      description: Documents advised to submit

    - name: submission_deadline
      type: date
      description: Document submission deadline

  timestamps:
    - name: received_at
      type: datetime
      auto: true
      description: When FNOL received

    - name: received_by
      type: uuid
      foreign_key: user.id
      description: Person who received

    - name: converted_at
      type: datetime
      description: When converted to claim

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Last update

relationships:
  - name: policy
    type: belongs_to
    entity: policy
    foreign_key: policy_id
    description: Associated policy

  - name: claim
    type: has_one
    entity: claim
    foreign_key: claim_id
    description: Resulting claim

  - name: handler
    type: belongs_to
    entity: user
    foreign_key: assigned_to
    description: Assigned handler

state_machine:
  initial_state: received

  states:
    - received:
        description: FNOL just received
        allowed_transitions: [acknowledged, in_triage]

    - acknowledged:
        description: Acknowledgment sent to reporter
        allowed_transitions: [in_triage]

    - in_triage:
        description: Being triaged
        allowed_transitions: [policy_verified, rejected, incomplete]

    - policy_verified:
        description: Policy found and verified
        allowed_transitions: [converted_to_claim, rejected]

    - converted_to_claim:
        description: Converted to formal claim
        final: true

    - rejected:
        description: FNOL rejected
        final: true

    - duplicate:
        description: Duplicate notification
        final: true

    - incomplete:
        description: Insufficient information
        allowed_transitions: [in_triage, rejected]

  transitions:
    - name: acknowledge
      from: received
      to: acknowledged
      action: send_acknowledgment

    - name: start_triage
      from: [received, acknowledged]
      to: in_triage
      action: begin_triage

    - name: verify_policy
      from: in_triage
      to: policy_verified
      condition: "policy_id IS NOT NULL"

    - name: convert
      from: policy_verified
      to: converted_to_claim
      action: create_claim_record

    - name: reject
      from: [in_triage, policy_verified]
      to: rejected
      action: send_rejection

    - name: mark_duplicate
      from: in_triage
      to: duplicate
      action: link_to_existing

    - name: mark_incomplete
      from: in_triage
      to: incomplete
      action: request_more_info

business_rules:
  - rule: BR-FNOL-001
    name: Acknowledge within SLA
    condition: "NOW() - received_at <= 24 hours"
    action: send_acknowledgment
    description: Send acknowledgment within 24 hours

  - rule: BR-FNOL-002
    name: Emergency priority
    condition: "is_emergency = true"
    action: set_priority('urgent')
    description: Set urgent priority for emergencies

  - rule: BR-FNOL-003
    name: Death claim escalation
    condition: "incident_type = 'death'"
    action: escalate_to_senior
    description: Escalate death claims immediately

  - rule: BR-FNOL-004
    name: Hospital admission notification
    condition: "insured_condition = 'hospitalized'"
    action: trigger_hospital_workflow
    description: Start hospital claim workflow

events:
  - name: fnol.received
    description: New FNOL received
    payload: [fnol_id, fnol_number, channel, incident_type]

  - name: fnol.acknowledged
    description: FNOL acknowledged
    payload: [fnol_id, acknowledgment_reference]

  - name: fnol.triaged
    description: FNOL triaged
    payload: [fnol_id, complexity, priority]

  - name: fnol.converted
    description: FNOL converted to claim
    payload: [fnol_id, claim_id, claim_number]

  - name: fnol.rejected
    description: FNOL rejected
    payload: [fnol_id, rejection_reason]

api_endpoints:
  - method: POST
    path: /fnol
    description: Create new FNOL
    request_body: FNOLCreateRequest
    response: FNOLResponse

  - method: GET
    path: /fnol
    description: List FNOLs
    query_params: [status, channel, from_date, to_date]
    response: FNOLListResponse

  - method: GET
    path: /fnol/{id}
    description: Get FNOL details
    response: FNOLResponse

  - method: PUT
    path: /fnol/{id}
    description: Update FNOL
    request_body: FNOLUpdateRequest
    response: FNOLResponse

  - method: POST
    path: /fnol/{id}/acknowledge
    description: Send acknowledgment
    response: FNOLResponse

  - method: POST
    path: /fnol/{id}/triage
    description: Triage FNOL
    request_body: TriageRequest
    response: FNOLResponse

  - method: POST
    path: /fnol/{id}/convert
    description: Convert to claim
    response: ClaimResponse

  - method: POST
    path: /fnol/{id}/reject
    description: Reject FNOL
    request_body: RejectRequest
    response: FNOLResponse
