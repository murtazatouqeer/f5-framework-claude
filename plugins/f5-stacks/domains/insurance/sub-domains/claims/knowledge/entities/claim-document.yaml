name: claim_document
display_name: Claim Document
description: |
  Documents associated with insurance claims including submissions,
  correspondence, reports, and generated documents.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique document identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Associated claim

    - name: claimant_id
      type: uuid
      foreign_key: claimant.id
      description: Associated claimant

    - name: document_number
      type: string
      format: "DOC-{claim_number}-{NNN}"
      description: Document reference

  classification:
    - name: document_type
      type: enum
      values:
        - claim_form
        - id_document
        - policy_document
        - medical_record
        - hospital_bill
        - prescription
        - diagnostic_report
        - discharge_summary
        - death_certificate
        - police_report
        - accident_report
        - surveyor_report
        - repair_estimate
        - repair_invoice
        - photograph
        - video
        - bank_statement
        - proof_of_ownership
        - witness_statement
        - legal_document
        - correspondence_inbound
        - correspondence_outbound
        - internal_note
        - settlement_letter
        - payment_receipt
        - release_form
        - other
      required: true
      description: Type of document

    - name: document_category
      type: enum
      values:
        - claim_submission
        - identity_verification
        - coverage_verification
        - loss_documentation
        - medical_documentation
        - legal_documentation
        - financial_documentation
        - assessment_documentation
        - settlement_documentation
        - correspondence
        - internal
      required: true
      description: Document category

    - name: sub_type
      type: string
      description: More specific document type

  document_details:
    - name: title
      type: string
      required: true
      description: Document title

    - name: description
      type: text
      description: Document description

    - name: file_name
      type: string
      required: true
      description: Original file name

    - name: file_type
      type: string
      description: File MIME type

    - name: file_extension
      type: string
      description: File extension

    - name: file_size
      type: integer
      description: File size in bytes

    - name: page_count
      type: integer
      description: Number of pages

    - name: language
      type: string
      default: vi
      description: Document language

  storage:
    - name: storage_url
      type: string
      format: url
      required: true
      description: Storage location URL

    - name: storage_provider
      type: enum
      values:
        - s3
        - azure_blob
        - gcs
        - local
      description: Storage provider

    - name: storage_bucket
      type: string
      description: Storage bucket/container

    - name: storage_path
      type: string
      description: Path within storage

    - name: thumbnail_url
      type: string
      format: url
      description: Thumbnail for images/PDFs

    - name: preview_url
      type: string
      format: url
      description: Preview URL

    - name: is_encrypted
      type: boolean
      default: true
      description: Document is encrypted

    - name: encryption_key_id
      type: string
      description: Encryption key reference

  source:
    - name: source
      type: enum
      values:
        - claimant_upload
        - agent_upload
        - hospital_direct
        - provider_api
        - surveyor_upload
        - handler_upload
        - system_generated
        - email_attachment
        - fax
        - mail_scan
        - mobile_app
      required: true
      description: Document source

    - name: submitted_by
      type: uuid
      description: Who submitted

    - name: submitted_by_name
      type: string
      description: Submitter name

    - name: submitted_at
      type: datetime
      description: Submission timestamp

    - name: channel
      type: enum
      values:
        - web_portal
        - mobile_app
        - email
        - fax
        - mail
        - in_person
        - api
      description: Submission channel

    - name: external_reference
      type: string
      description: External document reference

  document_dates:
    - name: document_date
      type: date
      description: Date on document

    - name: effective_date
      type: date
      description: Document effective date

    - name: expiry_date
      type: date
      description: Document expiry date

    - name: issue_date
      type: date
      description: When document was issued

  status:
    - name: status
      type: enum
      values:
        - pending
        - received
        - under_review
        - verified
        - rejected
        - requires_clarification
        - archived
      default: received
      description: Document status

    - name: rejection_reason
      type: text
      description: Reason if rejected

    - name: clarification_notes
      type: text
      description: Clarification needed

  verification:
    - name: verification_required
      type: boolean
      default: false
      description: Needs verification

    - name: verified
      type: boolean
      default: false
      description: Document verified

    - name: verified_by
      type: uuid
      foreign_key: user.id
      description: Who verified

    - name: verified_at
      type: datetime
      description: Verification timestamp

    - name: verification_method
      type: enum
      values:
        - manual_review
        - ocr_extraction
        - api_verification
        - cross_reference
        - third_party
      description: How verified

    - name: verification_notes
      type: text
      description: Verification notes

    - name: authenticity_score
      type: integer
      min: 0
      max: 100
      description: Document authenticity score

  extraction:
    - name: ocr_processed
      type: boolean
      default: false
      description: OCR processing done

    - name: ocr_text
      type: text
      description: Extracted text

    - name: ocr_confidence
      type: decimal
      precision: 2
      description: OCR confidence score

    - name: extracted_data
      type: object
      description: Structured data extracted

    - name: extraction_errors
      type: array
      items: string
      description: Extraction errors

  medical_specific:
    - name: hospital_name
      type: string
      description: Hospital name (medical docs)

    - name: doctor_name
      type: string
      description: Doctor name

    - name: diagnosis_codes
      type: array
      items: string
      description: ICD codes extracted

    - name: treatment_dates
      type: object
      properties:
        admission_date: date
        discharge_date: date
      description: Treatment period

    - name: total_amount
      type: decimal
      precision: 2
      description: Total amount on document

  correspondence:
    - name: correspondence_direction
      type: enum
      values:
        - inbound
        - outbound
      description: Correspondence direction

    - name: correspondent_name
      type: string
      description: Other party name

    - name: correspondent_role
      type: string
      description: Other party role

    - name: response_required
      type: boolean
      default: false
      description: Response needed

    - name: response_deadline
      type: date
      description: Response deadline

    - name: responded
      type: boolean
      default: false
      description: Response sent

  access_control:
    - name: confidentiality_level
      type: enum
      values:
        - public
        - internal
        - confidential
        - restricted
      default: internal
      description: Confidentiality level

    - name: restricted_to_roles
      type: array
      items: string
      description: Roles with access

    - name: share_with_claimant
      type: boolean
      default: false
      description: Visible to claimant

    - name: share_with_provider
      type: boolean
      default: false
      description: Share with provider

  version_control:
    - name: version
      type: integer
      default: 1
      description: Document version

    - name: is_latest
      type: boolean
      default: true
      description: Is latest version

    - name: previous_version_id
      type: uuid
      description: Previous version reference

    - name: version_notes
      type: text
      description: Version change notes

  audit:
    - name: uploaded_by
      type: uuid
      foreign_key: user.id
      required: true
      description: Who uploaded

    - name: created_at
      type: datetime
      auto: true
      description: Record creation

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Record update

    - name: last_accessed_at
      type: datetime
      description: Last access time

    - name: access_count
      type: integer
      default: 0
      description: Access count

    - name: archived_at
      type: datetime
      description: Archive timestamp

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Associated claim

  - name: claimant
    type: belongs_to
    entity: claimant
    foreign_key: claimant_id
    description: Associated claimant

  - name: uploader
    type: belongs_to
    entity: user
    foreign_key: uploaded_by
    description: Who uploaded

  - name: verifier
    type: belongs_to
    entity: user
    foreign_key: verified_by
    description: Who verified

  - name: previous_version
    type: belongs_to
    entity: claim_document
    foreign_key: previous_version_id
    description: Previous version

business_rules:
  - rule: BR-DOC-001
    name: ID verification required
    condition: "document_type = 'id_document' IMPLIES verification_required = true"
    description: ID documents must be verified

  - rule: BR-DOC-002
    name: Medical document extraction
    condition: "document_category = 'medical_documentation' IMPLIES ocr_processed = true"
    warning_message: "Medical documents should have OCR processing"

  - rule: BR-DOC-003
    name: Correspondence response tracking
    condition: "response_required = true AND NOW() > response_deadline IMPLIES responded = true"
    warning_message: "Response deadline passed"

  - rule: BR-DOC-004
    name: File size limit
    condition: "file_size <= 50000000"
    error_message: "Document exceeds 50MB limit"

events:
  - name: document.uploaded
    description: Document uploaded
    payload: [document_id, claim_id, document_type]

  - name: document.verified
    description: Document verified
    payload: [document_id, verified_by]

  - name: document.rejected
    description: Document rejected
    payload: [document_id, rejection_reason]

  - name: document.extracted
    description: Data extracted from document
    payload: [document_id, extracted_fields]

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/documents
    description: Upload document
    request_body: DocumentUploadRequest
    response: ClaimDocumentResponse

  - method: GET
    path: /claims/{claim_id}/documents
    description: List documents
    query_params: [document_type, category, status]
    response: ClaimDocumentListResponse

  - method: GET
    path: /claims/{claim_id}/documents/{id}
    description: Get document details
    response: ClaimDocumentResponse

  - method: GET
    path: /claims/{claim_id}/documents/{id}/download
    description: Download document
    response: Binary

  - method: PUT
    path: /claims/{claim_id}/documents/{id}
    description: Update document metadata
    request_body: DocumentUpdateRequest
    response: ClaimDocumentResponse

  - method: POST
    path: /claims/{claim_id}/documents/{id}/verify
    description: Verify document
    request_body: VerificationRequest
    response: ClaimDocumentResponse

  - method: POST
    path: /claims/{claim_id}/documents/{id}/extract
    description: Extract data from document
    response: ExtractionResponse

  - method: DELETE
    path: /claims/{claim_id}/documents/{id}
    description: Archive document
    response: ClaimDocumentResponse
