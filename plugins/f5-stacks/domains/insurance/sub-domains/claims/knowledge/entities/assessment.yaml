name: assessment
display_name: Claim Assessment
description: |
  Assessment record for insurance claims including coverage verification,
  quantum calculation, and recommendation.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique assessment identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Associated claim

    - name: assessment_number
      type: string
      format: "ASS-{claim_number}-{NN}"
      description: Assessment reference

  classification:
    - name: assessment_type
      type: enum
      values:
        - initial
        - detailed
        - medical
        - technical
        - legal
        - specialist
        - final
        - peer_review
      required: true
      description: Type of assessment

    - name: assessment_purpose
      type: enum
      values:
        - coverage_verification
        - quantum_calculation
        - liability_determination
        - fraud_review
        - appeal_review
      description: Purpose of assessment

  status:
    - name: status
      type: enum
      values:
        - pending
        - assigned
        - in_progress
        - awaiting_info
        - completed
        - peer_reviewed
        - superseded
      default: pending
      description: Assessment status

  assessor:
    - name: assessor_type
      type: enum
      values:
        - internal_handler
        - senior_handler
        - surveyor
        - medical_examiner
        - forensic_expert
        - legal_expert
        - actuary
      required: true
      description: Type of assessor

    - name: assessor_id
      type: uuid
      foreign_key: user.id
      description: Internal assessor ID

    - name: assessor_name
      type: string
      description: Assessor name

    - name: assessor_company
      type: string
      description: External assessor company

    - name: assessor_license
      type: string
      description: Professional license number

    - name: assigned_at
      type: datetime
      description: Assignment timestamp

    - name: started_at
      type: datetime
      description: When assessment started

    - name: completed_at
      type: datetime
      description: When assessment completed

  coverage_review:
    - name: policy_status_at_loss
      type: enum
      values:
        - active
        - grace_period
        - lapsed
        - cancelled
      description: Policy status at incident date

    - name: coverage_confirmed
      type: boolean
      description: Coverage applies to this loss

    - name: coverage_notes
      type: text
      description: Coverage analysis notes

    - name: applicable_coverages
      type: array
      items:
        type: object
        properties:
          coverage_id: uuid
          coverage_name: string
          limit: decimal
          deductible: decimal
          applies: boolean
      description: Coverage applicability

    - name: exclusions_applicable
      type: array
      items:
        type: object
        properties:
          exclusion_code: string
          exclusion_description: string
          applies: boolean
          notes: text
      description: Exclusion analysis

    - name: policy_conditions_met
      type: boolean
      description: All policy conditions satisfied

    - name: conditions_notes
      type: text
      description: Conditions analysis

    - name: waiting_period_check
      type: object
      properties:
        applicable: boolean
        waiting_period_days: integer
        policy_inception: date
        incident_date: date
        passed: boolean
      description: Waiting period verification

  quantum:
    - name: claimed_amount
      type: decimal
      precision: 2
      description: Total amount claimed

    - name: currency
      type: string
      default: VND
      description: Currency

    - name: assessed_amount
      type: decimal
      precision: 2
      description: Total assessed amount

    - name: item_breakdown
      type: array
      items:
        type: object
        properties:
          item_id: uuid
          description: string
          claimed: decimal
          assessed: decimal
          variance: decimal
          reason: string
      description: Item-by-item assessment

    - name: deductible_amount
      type: decimal
      precision: 2
      description: Deductible to apply

    - name: co_payment_amount
      type: decimal
      precision: 2
      description: Co-payment amount

    - name: policy_limit_applied
      type: boolean
      default: false
      description: Policy limit caps payment

    - name: net_payable
      type: decimal
      precision: 2
      computed: true
      formula: "assessed_amount - deductible_amount - co_payment_amount"
      description: Net amount payable

    - name: assessment_basis
      type: enum
      values:
        - replacement_cost
        - actual_cash_value
        - repair_cost
        - market_value
        - agreed_value
        - indemnity
      description: Basis for valuation

    - name: depreciation_applied
      type: decimal
      precision: 2
      description: Depreciation amount

  liability:
    - name: liability_applies
      type: boolean
      description: For liability claims

    - name: liability_assessment
      type: object
      properties:
        insured_liability_percentage: integer
        third_party_liability_percentage: integer
        contributory_negligence: boolean
        liability_notes: text
      description: Liability determination

  supporting_reports:
    - name: surveyor_report_id
      type: uuid
      foreign_key: surveyor_report.id
      description: Surveyor report reference

    - name: medical_report_id
      type: uuid
      foreign_key: medical_report.id
      description: Medical report reference

    - name: other_reports
      type: array
      items:
        type: object
        properties:
          report_type: string
          report_id: uuid
          report_date: date
          summary: text
      description: Other supporting reports

    - name: photographs
      type: array
      items: string
      description: Photo evidence URLs

    - name: videos
      type: array
      items: string
      description: Video evidence URLs

  recommendation:
    - name: recommendation
      type: enum
      values:
        - approve_full
        - approve_partial
        - deny
        - ex_gratia
        - refer_to_senior
        - refer_to_legal
        - refer_to_siu
        - more_info_needed
      required: true
      description: Assessment recommendation

    - name: recommended_amount
      type: decimal
      precision: 2
      description: Recommended payment amount

    - name: recommendation_reason
      type: text
      required: true
      description: Detailed reasoning

    - name: conditions
      type: array
      items: string
      description: Conditions for approval

    - name: denial_code
      type: string
      description: Denial reason code

    - name: denial_reason
      type: text
      description: Detailed denial reason

    - name: salvage_recommendation
      type: object
      properties:
        applicable: boolean
        estimated_value: decimal
        action_recommended: string
      description: Salvage recommendations

    - name: subrogation_recommendation
      type: object
      properties:
        applicable: boolean
        potential_recovery: decimal
        third_party_details: text
      description: Subrogation recommendations

  peer_review:
    - name: requires_peer_review
      type: boolean
      default: false
      description: Needs peer review

    - name: peer_reviewer_id
      type: uuid
      foreign_key: user.id
      description: Peer reviewer

    - name: peer_review_status
      type: enum
      values:
        - pending
        - in_review
        - approved
        - returned
      description: Peer review status

    - name: peer_review_notes
      type: text
      description: Peer review comments

    - name: peer_reviewed_at
      type: datetime
      description: Peer review date

  quality:
    - name: assessment_score
      type: integer
      min: 0
      max: 100
      description: Assessment quality score

    - name: completeness_check
      type: object
      properties:
        coverage_reviewed: boolean
        documents_reviewed: boolean
        quantum_calculated: boolean
        recommendation_made: boolean
      description: Completeness checklist

  timestamps:
    - name: created_at
      type: datetime
      auto: true
      description: Creation timestamp

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Update timestamp

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Parent claim

  - name: surveyor_report
    type: belongs_to
    entity: surveyor_report
    foreign_key: surveyor_report_id
    description: Surveyor report

  - name: medical_report
    type: belongs_to
    entity: medical_report
    foreign_key: medical_report_id
    description: Medical report

  - name: assessor
    type: belongs_to
    entity: user
    foreign_key: assessor_id
    description: Internal assessor

business_rules:
  - rule: BR-ASS-001
    name: Coverage must be checked
    condition: "coverage_confirmed IS NOT NULL"
    before: recommendation
    error_message: "Coverage must be verified"

  - rule: BR-ASS-002
    name: Quantum required for approval
    condition: "assessed_amount IS NOT NULL"
    when: "recommendation IN ['approve_full', 'approve_partial']"
    error_message: "Assessed amount required"

  - rule: BR-ASS-003
    name: Denial reason required
    condition: "denial_reason IS NOT NULL"
    when: "recommendation = 'deny'"
    error_message: "Denial reason required"

  - rule: BR-ASS-004
    name: Peer review for large claims
    condition: "recommended_amount > 500000000 IMPLIES requires_peer_review = true"
    error_message: "Large claims require peer review"

events:
  - name: assessment.created
    description: Assessment initiated
    payload: [assessment_id, claim_id, assessment_type]

  - name: assessment.assigned
    description: Assessor assigned
    payload: [assessment_id, assessor_id]

  - name: assessment.completed
    description: Assessment completed
    payload: [assessment_id, recommendation, recommended_amount]

  - name: assessment.peer_reviewed
    description: Peer review completed
    payload: [assessment_id, peer_reviewer_id, status]

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/assessments
    description: Create assessment
    request_body: AssessmentCreateRequest
    response: AssessmentResponse

  - method: GET
    path: /claims/{claim_id}/assessments
    description: List assessments
    response: AssessmentListResponse

  - method: GET
    path: /claims/{claim_id}/assessments/{id}
    description: Get assessment details
    response: AssessmentResponse

  - method: PUT
    path: /claims/{claim_id}/assessments/{id}
    description: Update assessment
    request_body: AssessmentUpdateRequest
    response: AssessmentResponse

  - method: POST
    path: /claims/{claim_id}/assessments/{id}/complete
    description: Complete assessment
    request_body: AssessmentCompleteRequest
    response: AssessmentResponse

  - method: POST
    path: /claims/{claim_id}/assessments/{id}/peer-review
    description: Submit for peer review
    response: AssessmentResponse

  - method: POST
    path: /claims/{claim_id}/assessments/{id}/approve-review
    description: Approve peer review
    request_body: PeerReviewRequest
    response: AssessmentResponse
