name: fraud_indicator
display_name: Fraud Indicator
description: |
  Fraud detection and investigation records for suspicious claims.
  Includes red flags, investigation findings, and SIU referrals.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique indicator identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Associated claim

    - name: indicator_number
      type: string
      format: "FRD-{YYYYMMDD}-{NNNN}"
      unique: true
      description: Fraud indicator reference

  detection:
    - name: detection_source
      type: enum
      values:
        - system_rules
        - ai_model
        - handler_observation
        - surveyor_report
        - medical_review
        - external_tip
        - cross_reference
        - pattern_analysis
        - social_media
        - data_analytics
      required: true
      description: How fraud was detected

    - name: detection_date
      type: datetime
      auto: true
      description: When detected

    - name: detected_by
      type: uuid
      foreign_key: user.id
      description: Who detected (if manual)

    - name: detection_rule_id
      type: string
      description: System rule that triggered

  scoring:
    - name: fraud_score
      type: integer
      min: 0
      max: 100
      required: true
      description: Overall fraud probability score

    - name: score_breakdown
      type: object
      properties:
        claim_pattern_score: integer
        timing_score: integer
        documentation_score: integer
        history_score: integer
        network_score: integer
        behavioral_score: integer
      description: Component scores

    - name: risk_level
      type: enum
      values:
        - low
        - medium
        - high
        - critical
      computed: true
      formula: |
        CASE
          WHEN fraud_score >= 80 THEN 'critical'
          WHEN fraud_score >= 60 THEN 'high'
          WHEN fraud_score >= 40 THEN 'medium'
          ELSE 'low'
        END
      description: Risk classification

    - name: confidence_level
      type: enum
      values:
        - high
        - medium
        - low
      description: Confidence in detection

  indicators:
    - name: red_flags
      type: array
      items:
        type: object
        properties:
          flag_code: string
          flag_description: string
          weight: integer
          evidence: text
          verified: boolean
      required: true
      description: Specific red flags identified

    - name: indicator_categories
      type: array
      items:
        type: enum
        values:
          - claim_timing
          - documentation_issues
          - prior_claims_history
          - policy_inception
          - coverage_switching
          - amount_inflation
          - staged_incident
          - identity_concerns
          - provider_collusion
          - organized_ring
          - inconsistent_statements
          - witness_issues
      description: Categories of fraud indicators

    - name: pattern_matches
      type: array
      items:
        type: object
        properties:
          pattern_id: string
          pattern_name: string
          match_score: integer
          description: text
      description: Known fraud patterns matched

  investigation:
    - name: status
      type: enum
      values:
        - flagged
        - under_review
        - referred_to_siu
        - siu_investigating
        - investigation_complete
        - confirmed_fraud
        - cleared
        - inconclusive
        - closed
      default: flagged
      description: Investigation status

    - name: investigation_type
      type: enum
      values:
        - desktop_review
        - field_investigation
        - surveillance
        - forensic_analysis
        - interview
        - comprehensive
      description: Type of investigation

    - name: investigation_priority
      type: enum
      values:
        - immediate
        - high
        - standard
        - low
      description: Investigation priority

  siu_referral:
    - name: referred_to_siu
      type: boolean
      default: false
      description: Referred to SIU

    - name: siu_referral_date
      type: datetime
      description: When referred

    - name: siu_case_number
      type: string
      description: SIU case reference

    - name: siu_investigator
      type: string
      description: Assigned SIU investigator

    - name: siu_status
      type: enum
      values:
        - pending_assignment
        - assigned
        - active
        - on_hold
        - complete
        - closed
      description: SIU case status

  findings:
    - name: investigation_findings
      type: text
      description: Summary of findings

    - name: evidence_collected
      type: array
      items:
        type: object
        properties:
          evidence_type: string
          description: string
          url: string
          collected_date: date
          collected_by: string
      description: Evidence collected

    - name: witness_statements
      type: array
      items:
        type: object
        properties:
          witness_name: string
          statement_date: date
          summary: text
          statement_url: string
      description: Witness statements

    - name: surveillance_reports
      type: array
      items:
        type: object
        properties:
          report_date: date
          findings: text
          report_url: string
      description: Surveillance reports

  outcome:
    - name: final_determination
      type: enum
      values:
        - fraud_confirmed
        - suspicious_unproven
        - cleared
        - inconclusive
      description: Final fraud determination

    - name: determination_date
      type: datetime
      description: When determined

    - name: determined_by
      type: uuid
      foreign_key: user.id
      description: Who made determination

    - name: outcome_notes
      type: text
      description: Outcome explanation

  actions_taken:
    - name: claim_action
      type: enum
      values:
        - proceed_with_caution
        - additional_verification
        - partial_denial
        - full_denial
        - void_policy
        - refer_to_legal
      description: Action on claim

    - name: policy_action
      type: enum
      values:
        - none
        - flag_for_renewal
        - non_renewal
        - cancellation
        - void_ab_initio
      description: Action on policy

    - name: recovery_action
      type: boolean
      default: false
      description: Recovery to be pursued

    - name: recovery_amount
      type: decimal
      precision: 2
      description: Amount to recover

    - name: legal_action
      type: boolean
      default: false
      description: Legal action taken

    - name: reported_to_authorities
      type: boolean
      default: false
      description: Reported to police/authorities

    - name: authority_report_date
      type: date
      description: When reported

    - name: authority_reference
      type: string
      description: Police/authority reference

  network_analysis:
    - name: linked_claims
      type: array
      items:
        type: object
        properties:
          claim_id: uuid
          relationship: string
          link_strength: integer
      description: Related suspicious claims

    - name: linked_persons
      type: array
      items:
        type: object
        properties:
          name: string
          role: string
          relationship: string
      description: Related individuals

    - name: linked_providers
      type: array
      items:
        type: object
        properties:
          provider_name: string
          provider_type: string
          relationship: string
      description: Related service providers

    - name: ring_identified
      type: boolean
      default: false
      description: Part of fraud ring

    - name: ring_reference
      type: string
      description: Fraud ring reference

  costs:
    - name: investigation_cost
      type: decimal
      precision: 2
      description: Cost of investigation

    - name: savings_achieved
      type: decimal
      precision: 2
      description: Fraud savings

    - name: roi
      type: decimal
      precision: 2
      computed: true
      formula: "savings_achieved / investigation_cost"
      description: Return on investigation

  timestamps:
    - name: created_at
      type: datetime
      auto: true
      description: Record creation

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Record update

    - name: closed_at
      type: datetime
      description: When closed

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Associated claim

  - name: detector
    type: belongs_to
    entity: user
    foreign_key: detected_by
    description: Who detected

state_machine:
  initial_state: flagged

  states:
    - flagged:
        description: Fraud indicators flagged
        allowed_transitions: [under_review, referred_to_siu, cleared]

    - under_review:
        description: Under internal review
        allowed_transitions: [referred_to_siu, cleared, inconclusive]

    - referred_to_siu:
        description: Referred to SIU
        allowed_transitions: [siu_investigating]

    - siu_investigating:
        description: SIU actively investigating
        allowed_transitions: [investigation_complete]

    - investigation_complete:
        description: Investigation finished
        allowed_transitions: [confirmed_fraud, cleared, inconclusive]

    - confirmed_fraud:
        description: Fraud confirmed
        allowed_transitions: [closed]

    - cleared:
        description: No fraud found
        allowed_transitions: [closed]

    - inconclusive:
        description: Inconclusive findings
        allowed_transitions: [closed]

    - closed:
        description: Case closed
        final: true

business_rules:
  - rule: BR-FRD-001
    name: High score SIU referral
    condition: "fraud_score >= 70 IMPLIES referred_to_siu = true"
    warning_message: "High fraud score should be referred to SIU"

  - rule: BR-FRD-002
    name: Red flags required
    condition: "LENGTH(red_flags) >= 1"
    error_message: "At least one red flag required"

  - rule: BR-FRD-003
    name: Evidence for confirmation
    condition: "final_determination = 'fraud_confirmed' IMPLIES LENGTH(evidence_collected) >= 1"
    error_message: "Evidence required to confirm fraud"

  - rule: BR-FRD-004
    name: Investigation findings required
    condition: "status IN ['confirmed_fraud', 'cleared', 'inconclusive'] IMPLIES investigation_findings IS NOT NULL"
    error_message: "Investigation findings required for determination"

events:
  - name: fraud.flagged
    description: Fraud indicators detected
    payload: [indicator_id, claim_id, fraud_score, risk_level]

  - name: fraud.referred_to_siu
    description: Referred to SIU
    payload: [indicator_id, claim_id, siu_case_number]

  - name: fraud.confirmed
    description: Fraud confirmed
    payload: [indicator_id, claim_id, claim_action]

  - name: fraud.cleared
    description: Claim cleared of fraud
    payload: [indicator_id, claim_id]

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/fraud-indicators
    description: Create fraud indicator
    request_body: FraudIndicatorCreateRequest
    response: FraudIndicatorResponse

  - method: GET
    path: /claims/{claim_id}/fraud-indicators
    description: List fraud indicators
    response: FraudIndicatorListResponse

  - method: GET
    path: /claims/{claim_id}/fraud-indicators/{id}
    description: Get indicator details
    response: FraudIndicatorResponse

  - method: PUT
    path: /claims/{claim_id}/fraud-indicators/{id}
    description: Update indicator
    request_body: FraudIndicatorUpdateRequest
    response: FraudIndicatorResponse

  - method: POST
    path: /claims/{claim_id}/fraud-indicators/{id}/refer-siu
    description: Refer to SIU
    request_body: SIUReferralRequest
    response: FraudIndicatorResponse

  - method: POST
    path: /claims/{claim_id}/fraud-indicators/{id}/determine
    description: Record final determination
    request_body: DeterminationRequest
    response: FraudIndicatorResponse
