name: medical_report
display_name: Medical Report
description: |
  Medical examination and treatment reports for health, life, and accident claims.
  Includes hospital records, doctor reports, and independent medical examinations.

domain: insurance
subdomain: claims
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique report identifier

    - name: claim_id
      type: uuid
      foreign_key: claim.id
      required: true
      description: Associated claim

    - name: assessment_id
      type: uuid
      foreign_key: assessment.id
      description: Linked assessment

    - name: report_number
      type: string
      format: "MED-{YYYYMMDD}-{NNNN}"
      description: Report reference number

  report_type:
    - name: report_type
      type: enum
      values:
        - hospital_discharge_summary
        - attending_physician_statement
        - specialist_report
        - independent_medical_exam
        - autopsy_report
        - disability_assessment
        - rehabilitation_report
        - psychological_evaluation
      required: true
      description: Type of medical report

    - name: purpose
      type: enum
      values:
        - treatment_documentation
        - disability_evaluation
        - cause_of_death
        - second_opinion
        - fraud_investigation
        - impairment_rating
      description: Purpose of report

  status:
    - name: status
      type: enum
      values:
        - requested
        - scheduled
        - in_progress
        - received
        - under_review
        - reviewed
        - clarification_needed
        - accepted
        - rejected
      default: requested
      description: Report status

  medical_provider:
    - name: provider_type
      type: enum
      values:
        - hospital
        - clinic
        - physician
        - specialist
        - panel_doctor
        - independent_examiner
      description: Type of provider

    - name: provider_name
      type: string
      required: true
      description: Hospital/clinic/doctor name

    - name: provider_license
      type: string
      description: License number

    - name: provider_address
      type: object
      properties:
        address: string
        city: string
        province: string
      description: Provider address

    - name: provider_contact
      type: object
      properties:
        phone: string
        email: string
      description: Provider contact

    - name: doctor_name
      type: string
      description: Treating/examining doctor

    - name: doctor_specialty
      type: string
      description: Doctor's specialty

    - name: doctor_license
      type: string
      description: Doctor's license number

  patient_information:
    - name: patient_name
      type: string
      required: true
      description: Patient full name

    - name: patient_id
      type: string
      description: Patient identification number

    - name: patient_dob
      type: date
      description: Patient date of birth

    - name: patient_gender
      type: enum
      values: [male, female, other]
      description: Patient gender

    - name: patient_relationship
      type: string
      description: Relationship to policyholder

  treatment_details:
    - name: admission_date
      type: datetime
      description: Hospital admission date/time

    - name: discharge_date
      type: datetime
      description: Hospital discharge date/time

    - name: length_of_stay
      type: integer
      computed: true
      formula: "DATEDIFF(discharge_date, admission_date)"
      description: Days hospitalized

    - name: admission_type
      type: enum
      values:
        - emergency
        - planned
        - transfer
        - outpatient
      description: Type of admission

    - name: ward_type
      type: enum
      values:
        - general
        - semi_private
        - private
        - icu
        - hdu
        - nicu
        - operation_theater
      description: Type of ward

    - name: chief_complaint
      type: text
      description: Main complaint on admission

    - name: history_of_present_illness
      type: text
      description: Illness history

  diagnosis:
    - name: primary_diagnosis
      type: object
      properties:
        code: string
        description: string
        code_system: string
      description: Primary diagnosis (ICD-10)

    - name: secondary_diagnoses
      type: array
      items:
        type: object
        properties:
          code: string
          description: string
          code_system: string
      description: Secondary diagnoses

    - name: diagnosis_date
      type: date
      description: Date of diagnosis

    - name: is_pre_existing
      type: boolean
      default: false
      description: Pre-existing condition

    - name: pre_existing_since
      type: date
      description: Pre-existing since date

    - name: cause_of_condition
      type: enum
      values:
        - illness
        - accident
        - congenital
        - pregnancy
        - unknown
      description: Cause of condition

  treatment:
    - name: treatment_summary
      type: text
      description: Summary of treatment provided

    - name: procedures
      type: array
      items:
        type: object
        properties:
          procedure_code: string
          procedure_name: string
          procedure_date: date
          surgeon: string
          anesthesia_type: string
          outcome: string
      description: Procedures performed

    - name: medications
      type: array
      items:
        type: object
        properties:
          medication_name: string
          dosage: string
          frequency: string
          duration: string
          purpose: string
      description: Medications prescribed

    - name: investigations
      type: array
      items:
        type: object
        properties:
          test_name: string
          test_date: date
          result: string
          normal_range: string
          interpretation: string
      description: Diagnostic tests

  outcome:
    - name: condition_at_discharge
      type: enum
      values:
        - recovered
        - improved
        - stable
        - worsened
        - deceased
      description: Condition at discharge

    - name: prognosis
      type: enum
      values:
        - excellent
        - good
        - fair
        - poor
        - uncertain
      description: Medical prognosis

    - name: follow_up_required
      type: boolean
      default: false
      description: Follow-up needed

    - name: follow_up_instructions
      type: text
      description: Follow-up plan

    - name: restrictions
      type: array
      items: string
      description: Activity restrictions

    - name: expected_recovery_period
      type: string
      description: Expected recovery timeframe

  disability_assessment:
    - name: disability_type
      type: enum
      values:
        - temporary_total
        - temporary_partial
        - permanent_total
        - permanent_partial
        - none
      description: Type of disability

    - name: disability_percentage
      type: integer
      min: 0
      max: 100
      description: Disability percentage

    - name: disability_duration
      type: string
      description: Expected disability duration

    - name: work_restrictions
      type: array
      items: string
      description: Work limitations

    - name: can_return_to_work
      type: boolean
      description: Can return to work

    - name: return_to_work_date
      type: date
      description: Expected return date

    - name: impairment_rating
      type: object
      properties:
        rating_system: string
        whole_person_impairment: integer
        body_part_impairments: array
      description: Impairment assessment

  death_certificate:
    - name: death_date
      type: datetime
      description: Date and time of death

    - name: cause_of_death
      type: text
      description: Immediate cause of death

    - name: underlying_cause
      type: text
      description: Underlying cause

    - name: contributing_factors
      type: array
      items: string
      description: Contributing factors

    - name: manner_of_death
      type: enum
      values:
        - natural
        - accident
        - suicide
        - homicide
        - undetermined
      description: Manner of death

    - name: autopsy_performed
      type: boolean
      default: false
      description: Autopsy performed

    - name: death_certificate_number
      type: string
      description: Official death certificate number

  costs:
    - name: hospital_charges
      type: decimal
      precision: 2
      description: Hospital room and board

    - name: doctor_fees
      type: decimal
      precision: 2
      description: Doctor/surgeon fees

    - name: investigation_costs
      type: decimal
      precision: 2
      description: Tests and investigations

    - name: medication_costs
      type: decimal
      precision: 2
      description: Medication costs

    - name: procedure_costs
      type: decimal
      precision: 2
      description: Procedure/surgery costs

    - name: other_costs
      type: decimal
      precision: 2
      description: Other medical costs

    - name: total_medical_cost
      type: decimal
      precision: 2
      computed: true
      formula: "hospital_charges + doctor_fees + investigation_costs + medication_costs + procedure_costs + other_costs"
      description: Total medical cost

  documents:
    - name: report_url
      type: string
      format: url
      description: Medical report document

    - name: discharge_summary_url
      type: string
      format: url
      description: Discharge summary

    - name: bills_receipts
      type: array
      items:
        type: object
        properties:
          document_type: string
          url: string
          amount: decimal
      description: Bills and receipts

    - name: investigation_reports
      type: array
      items:
        type: object
        properties:
          test_name: string
          url: string
      description: Investigation reports

    - name: prescription_copies
      type: array
      items: string
      description: Prescription document URLs

  review:
    - name: reviewed_by
      type: uuid
      foreign_key: user.id
      description: Reviewer

    - name: reviewed_at
      type: datetime
      description: Review date

    - name: review_notes
      type: text
      description: Reviewer notes

    - name: medical_opinion
      type: text
      description: Medical opinion for claim

    - name: claim_recommendation
      type: enum
      values:
        - payable
        - partially_payable
        - not_payable
        - needs_clarification
        - needs_ime
      description: Recommendation for claim

    - name: clarification_questions
      type: array
      items: string
      description: Questions for provider

  timestamps:
    - name: requested_at
      type: datetime
      description: When report requested

    - name: received_at
      type: datetime
      description: When report received

    - name: created_at
      type: datetime
      auto: true
      description: Record created

    - name: updated_at
      type: datetime
      auto: true
      on_update: true
      description: Record updated

relationships:
  - name: claim
    type: belongs_to
    entity: claim
    foreign_key: claim_id
    description: Associated claim

  - name: assessment
    type: belongs_to
    entity: assessment
    foreign_key: assessment_id
    description: Linked assessment

business_rules:
  - rule: BR-MED-001
    name: Diagnosis required
    condition: "primary_diagnosis IS NOT NULL"
    error_message: "Primary diagnosis required"

  - rule: BR-MED-002
    name: Pre-existing check
    condition: "is_pre_existing = true IMPLIES pre_existing_since IS NOT NULL"
    error_message: "Pre-existing date required"

  - rule: BR-MED-003
    name: Death claim requirements
    condition: "claim_type = 'death' IMPLIES death_certificate_number IS NOT NULL"
    error_message: "Death certificate required for death claims"

events:
  - name: medical_report.requested
    description: Medical report requested
    payload: [report_id, claim_id, provider_name]

  - name: medical_report.received
    description: Medical report received
    payload: [report_id, claim_id]

  - name: medical_report.reviewed
    description: Medical report reviewed
    payload: [report_id, claim_recommendation]

api_endpoints:
  - method: POST
    path: /claims/{claim_id}/medical-reports
    description: Request medical report
    request_body: MedicalReportRequest
    response: MedicalReportResponse

  - method: GET
    path: /claims/{claim_id}/medical-reports
    description: List medical reports
    response: MedicalReportListResponse

  - method: GET
    path: /claims/{claim_id}/medical-reports/{id}
    description: Get report details
    response: MedicalReportResponse

  - method: PUT
    path: /claims/{claim_id}/medical-reports/{id}
    description: Update report
    request_body: MedicalReportUpdateRequest
    response: MedicalReportResponse

  - method: POST
    path: /claims/{claim_id}/medical-reports/{id}/review
    description: Submit review
    request_body: MedicalReviewRequest
    response: MedicalReportResponse
