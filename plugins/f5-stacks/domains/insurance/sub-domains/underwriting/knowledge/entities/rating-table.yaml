name: rating_table
display_name: Rating Table
description: |
  Master data entity containing premium rate tables for insurance products,
  including age-based rates, adjustments, and calculation parameters.

domain: insurance
subdomain: underwriting
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique rating table identifier

    - name: table_code
      type: string
      required: true
      unique: true
      description: Unique table code

    - name: name
      type: string
      required: true
      description: Table name

    - name: description
      type: text
      description: Table description

    - name: product_id
      type: uuid
      foreign_key: products.id
      description: Associated product

    - name: coverage_code
      type: string
      description: Specific coverage if applicable

  status:
    - name: status
      type: enum
      values:
        - draft
        - pending_approval
        - active
        - archived
      default: draft
      description: Table status

    - name: effective_date
      type: date
      required: true
      description: Date table becomes effective

    - name: expiry_date
      type: date
      description: Date table expires

    - name: version
      type: string
      description: Version number

  structure:
    - name: rate_type
      type: enum
      values:
        - per_mille
        - per_cent
        - per_hundred
        - flat
      required: true
      description: Rate expression type

    - name: rate_basis
      type: enum
      values:
        - age_banded
        - attained_age
        - issue_age
        - single_rate
      required: true
      description: Rate determination basis

    - name: age_type
      type: enum
      values:
        - age_nearest_birthday
        - age_last_birthday
        - age_next_birthday
      default: age_nearest_birthday
      description: Age calculation method

    - name: gender_rated
      type: boolean
      default: true
      description: Whether rates vary by gender

    - name: smoker_rated
      type: boolean
      default: true
      description: Whether rates vary by smoker status

    - name: rate_frequency
      type: enum
      values:
        - annual
        - semi_annual
        - quarterly
        - monthly
      default: annual
      description: Premium frequency for rates

  rates:
    - name: rates
      type: array
      items:
        type: object
        properties:
          age_from:
            type: integer
          age_to:
            type: integer
          gender:
            type: enum
            values: [male, female, unisex]
          smoker_status:
            type: enum
            values: [non_smoker, smoker, any]
          rate:
            type: decimal
            precision: 10
            scale: 6
          rate_per:
            type: decimal
            description: "Rate per X sum insured"
      description: Rate table entries

    - name: rate_bands
      type: array
      items:
        type: object
        properties:
          sum_from:
            type: decimal
          sum_to:
            type: decimal
          discount_percent:
            type: decimal
          description:
            type: string
      description: Sum insured banding discounts

  adjustments:
    - name: occupation_adjustments
      type: array
      items:
        type: object
        properties:
          occupation_class:
            type: string
          loading_percent:
            type: decimal
          applies_to:
            type: array
      description: Occupation class rate adjustments

    - name: coverage_adjustments
      type: array
      items:
        type: object
        properties:
          coverage_code:
            type: string
          adjustment_type:
            type: enum
            values: [factor, flat, discount]
          adjustment_value:
            type: decimal
      description: Coverage-specific adjustments

    - name: modal_factors
      type: object
      properties:
        annual:
          type: decimal
          default: 1.0
        semi_annual:
          type: decimal
          default: 0.52
        quarterly:
          type: decimal
          default: 0.265
        monthly:
          type: decimal
          default: 0.09
      description: Payment frequency factors

    - name: policy_fee
      type: decimal
      precision: 10
      scale: 2
      description: Fixed policy fee

  minimum_maximum:
    - name: minimum_premium
      type: decimal
      precision: 10
      scale: 2
      description: Minimum premium amount

    - name: maximum_premium
      type: decimal
      precision: 10
      scale: 2
      description: Maximum premium amount

    - name: minimum_sum_insured
      type: decimal
      precision: 15
      scale: 2
      description: Minimum sum insured

    - name: maximum_sum_insured
      type: decimal
      precision: 15
      scale: 2
      description: Maximum sum insured

    - name: minimum_age
      type: integer
      description: Minimum issue age

    - name: maximum_age
      type: integer
      description: Maximum issue age

  calculation_rules:
    - name: rounding_rule
      type: enum
      values:
        - round_up
        - round_down
        - round_nearest
        - no_rounding
      default: round_nearest
      description: Premium rounding rule

    - name: rounding_precision
      type: integer
      default: 0
      description: Decimal places for rounding

    - name: loading_application
      type: enum
      values:
        - before_discounts
        - after_discounts
      default: before_discounts
      description: When to apply loadings

    - name: discount_stacking
      type: enum
      values:
        - additive
        - multiplicative
        - best_discount
      default: multiplicative
      description: How discounts combine

  reinsurance:
    - name: reinsurance_rate_table_id
      type: uuid
      foreign_key: rating_tables.id
      description: Corresponding RI rate table

    - name: retention_rate_table_id
      type: uuid
      foreign_key: rating_tables.id
      description: Retention rate table

  audit:
    - name: created_by
      type: uuid
      foreign_key: users.id
      description: Creator

    - name: approved_by
      type: uuid
      foreign_key: users.id
      description: Approver

    - name: approved_at
      type: timestamp
      description: Approval timestamp

    - name: created_at
      type: timestamp
      default: now()

    - name: updated_at
      type: timestamp

relationships:
  - name: product
    type: belongs_to
    entity: product
    foreign_key: product_id
    description: Associated product

  - name: loadings
    type: has_many
    entity: loading
    inverse: rating_table
    description: Applied loadings

example_rate_table:
  table_code: TERM-LIFE-2024
  name: Term Life Insurance Rates 2024
  rate_type: per_mille
  rate_basis: age_banded
  sample_rates:
    - age_from: 18
      age_to: 25
      gender: male
      smoker_status: non_smoker
      rate: 0.85
    - age_from: 18
      age_to: 25
      gender: female
      smoker_status: non_smoker
      rate: 0.65
    - age_from: 18
      age_to: 25
      gender: male
      smoker_status: smoker
      rate: 1.70
    - age_from: 26
      age_to: 30
      gender: male
      smoker_status: non_smoker
      rate: 0.95

indexes:
  - columns: [table_code]
    unique: true
  - columns: [product_id, status]
  - columns: [effective_date]
  - columns: [status]

business_rules:
  - rule: Only one active table per product/coverage
  - rule: Rate changes require actuarial approval
  - rule: Expired tables archived automatically
  - rule: Loading applied after base rate calculation
