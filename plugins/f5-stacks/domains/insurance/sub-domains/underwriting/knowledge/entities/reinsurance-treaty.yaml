name: reinsurance_treaty
display_name: Reinsurance Treaty
description: |
  Master data entity representing automatic reinsurance treaty arrangements
  defining capacity, terms, and conditions for risk cession to reinsurers.

domain: insurance
subdomain: underwriting
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique treaty identifier

    - name: treaty_code
      type: string
      required: true
      unique: true
      description: Treaty reference code

    - name: treaty_name
      type: string
      required: true
      description: Treaty name

    - name: description
      type: text
      description: Treaty description

  status:
    - name: status
      type: enum
      values:
        - draft
        - negotiating
        - active
        - expired
        - cancelled
      default: draft
      description: Treaty status

    - name: effective_date
      type: date
      required: true
      description: Treaty effective date

    - name: expiry_date
      type: date
      required: true
      description: Treaty expiry date

    - name: renewal_terms
      type: text
      description: Renewal terms and conditions

  type:
    - name: treaty_type
      type: enum
      values:
        - quota_share
        - surplus
        - excess_of_loss
        - stop_loss
        - facultative_obligatory
      required: true
      description: Type of reinsurance treaty

    - name: basis
      type: enum
      values:
        - risk_attaching
        - losses_occurring
        - claims_made
      description: Treaty basis

  scope:
    - name: covered_products
      type: array
      items:
        type: object
        properties:
          product_code:
            type: string
          product_name:
            type: string
          included:
            type: boolean
      description: Products covered by treaty

    - name: covered_classes
      type: array
      items:
        type: object
        properties:
          class_code:
            type: string
          class_name:
            type: string
      description: Insurance classes covered

    - name: geographic_scope
      type: array
      items:
        type: string
      description: Geographic territories covered

    - name: excluded_risks
      type: array
      items:
        type: string
      description: Risks excluded from treaty

  capacity:
    - name: retention
      type: decimal
      precision: 15
      scale: 2
      required: true
      description: Cedant retention amount

    - name: retention_currency
      type: string
      default: VND
      description: Retention currency

    - name: automatic_capacity
      type: decimal
      precision: 15
      scale: 2
      required: true
      description: Maximum automatic acceptance

    - name: treaty_capacity
      type: decimal
      precision: 15
      scale: 2
      required: true
      description: Total treaty capacity

    - name: maximum_per_life
      type: decimal
      precision: 15
      scale: 2
      description: Maximum per individual life

  quota_share_terms:
    - name: quota_share_percentage
      type: decimal
      precision: 5
      scale: 2
      description: Quota share percentage (if QS treaty)

    - name: commission_rate
      type: decimal
      precision: 5
      scale: 2
      description: Ceding commission rate

    - name: profit_commission
      type: object
      properties:
        applicable:
          type: boolean
        threshold:
          type: decimal
        rate:
          type: decimal
      description: Profit commission terms

  surplus_terms:
    - name: first_surplus_lines
      type: integer
      description: Number of lines in first surplus

    - name: second_surplus_lines
      type: integer
      description: Number of lines in second surplus

    - name: line_value
      type: decimal
      precision: 15
      scale: 2
      description: Value of one line

  excess_terms:
    - name: attachment_point
      type: decimal
      precision: 15
      scale: 2
      description: XOL attachment point

    - name: layer_limit
      type: decimal
      precision: 15
      scale: 2
      description: XOL layer limit

    - name: aggregate_limit
      type: decimal
      precision: 15
      scale: 2
      description: Aggregate limit

    - name: reinstatements
      type: integer
      description: Number of reinstatements

    - name: reinstatement_premium
      type: decimal
      precision: 5
      scale: 2
      description: Reinstatement premium percentage

  reinsurers:
    - name: reinsurer_shares
      type: array
      items:
        type: object
        properties:
          reinsurer_id:
            type: uuid
          reinsurer_name:
            type: string
          share_percentage:
            type: decimal
          share_amount:
            type: decimal
          rating:
            type: string
          security_rating:
            type: enum
            values: [AAA, AA, A, BBB, BB, B, NR]
      description: Reinsurer participations

    - name: lead_reinsurer_id
      type: uuid
      description: Lead reinsurer

    - name: broker_id
      type: uuid
      description: Reinsurance broker

  premium:
    - name: premium_basis
      type: enum
      values:
        - original_premium
        - sum_at_risk
        - gross_premium
        - net_premium
      description: Basis for premium calculation

    - name: minimum_premium
      type: decimal
      precision: 15
      scale: 2
      description: Minimum annual premium

    - name: deposit_premium
      type: decimal
      precision: 15
      scale: 2
      description: Deposit premium

    - name: adjustment_basis
      type: text
      description: Premium adjustment terms

  claims:
    - name: claims_cooperation
      type: text
      description: Claims cooperation clause

    - name: claims_notification_days
      type: integer
      description: Days for claims notification

    - name: ex_gratia_limit
      type: decimal
      precision: 15
      scale: 2
      description: Limit for ex-gratia without RI consent

  reporting:
    - name: bordereaux_frequency
      type: enum
      values:
        - monthly
        - quarterly
        - annually
      description: Bordereaux reporting frequency

    - name: statement_frequency
      type: enum
      values:
        - monthly
        - quarterly
        - annually
      description: Account statement frequency

    - name: settlement_frequency
      type: enum
      values:
        - monthly
        - quarterly
        - annually
      description: Settlement frequency

  special_conditions:
    - name: substandard_acceptance
      type: object
      properties:
        automatic_up_to_loading:
          type: decimal
          description: Auto accept up to this loading %
        referral_above:
          type: decimal
          description: Refer if loading above this %
      description: Substandard risk acceptance

    - name: age_limits
      type: object
      properties:
        minimum_age:
          type: integer
        maximum_age:
          type: integer
        maximum_expiry_age:
          type: integer
      description: Age limits for automatic acceptance

    - name: facultative_triggers
      type: array
      items:
        type: string
      description: Conditions requiring facultative

  documents:
    - name: treaty_document_url
      type: string
      format: url
      description: Treaty document

    - name: amendments
      type: array
      items:
        type: object
        properties:
          amendment_number:
            type: integer
          effective_date:
            type: date
          description:
            type: string
          document_url:
            type: string
      description: Treaty amendments

  audit:
    - name: negotiated_by
      type: uuid
      foreign_key: users.id
      description: Negotiating underwriter

    - name: approved_by
      type: uuid
      foreign_key: users.id
      description: Approving authority

    - name: approved_at
      type: timestamp
      description: Approval timestamp

    - name: created_at
      type: timestamp
      default: now()

    - name: updated_at
      type: timestamp

relationships:
  - name: facultative_cases
    type: has_many
    entity: facultative_case
    inverse: treaty
    description: Facultative cases under treaty

  - name: covered_products
    type: many_to_many
    entity: product
    through: treaty_products
    description: Products covered

indexes:
  - columns: [treaty_code]
    unique: true
  - columns: [status]
  - columns: [treaty_type]
  - columns: [effective_date, expiry_date]

business_rules:
  - rule: Treaty must have at least one reinsurer
  - rule: Reinsurer shares must total 100%
  - rule: Automatic capacity cannot exceed treaty capacity
  - rule: Treaty must be approved before activation
