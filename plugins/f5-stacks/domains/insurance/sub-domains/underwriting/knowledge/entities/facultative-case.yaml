name: facultative_case
display_name: Facultative Case
description: |
  Individual facultative reinsurance submission for risks that exceed
  automatic treaty limits or require special consideration.

domain: insurance
subdomain: underwriting
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique facultative case identifier

    - name: case_number
      type: string
      format: "FAC-{YYYYMMDD}-{NNNNNN}"
      unique: true
      generated: true
      description: Facultative case reference

    - name: underwriting_case_id
      type: uuid
      required: true
      foreign_key: underwriting_cases.id
      description: Reference to underwriting case

    - name: treaty_id
      type: uuid
      foreign_key: reinsurance_treaties.id
      description: Related treaty (if any)

  status:
    - name: status
      type: enum
      values:
        - draft
        - submitted
        - quoted
        - negotiating
        - accepted
        - declined
        - withdrawn
        - expired
      default: draft
      description: Facultative case status

    - name: urgency
      type: enum
      values:
        - standard
        - priority
        - urgent
      default: standard
      description: Case urgency level

  reason:
    - name: referral_reason
      type: enum
      values:
        - exceeds_automatic_limit
        - substandard_high_loading
        - hazardous_occupation
        - complex_medical
        - financial_concerns
        - unusual_coverage
        - reinsurer_requested
        - multiple_reasons
      required: true
      description: Reason for facultative referral

    - name: referral_details
      type: text
      description: Detailed explanation for referral

  risk_details:
    - name: applicant_name
      type: string
      description: Applicant name

    - name: applicant_age
      type: integer
      description: Applicant age

    - name: applicant_gender
      type: enum
      values: [male, female]
      description: Applicant gender

    - name: applicant_occupation
      type: string
      description: Applicant occupation

    - name: occupation_class
      type: string
      description: Occupation classification

    - name: sum_insured_requested
      type: decimal
      precision: 15
      scale: 2
      description: Total sum insured requested

    - name: coverages
      type: array
      items:
        type: object
        properties:
          coverage_code:
            type: string
          coverage_name:
            type: string
          sum_insured:
            type: decimal
          term_years:
            type: integer
      description: Coverages being reinsured

  retention_cession:
    - name: company_retention
      type: decimal
      precision: 15
      scale: 2
      description: Amount retained by cedant

    - name: automatic_cession
      type: decimal
      precision: 15
      scale: 2
      description: Amount ceded under treaty

    - name: facultative_amount
      type: decimal
      precision: 15
      scale: 2
      description: Amount for facultative placement

    - name: facultative_percentage
      type: decimal
      precision: 5
      scale: 2
      computed: true
      description: Percentage of risk being placed

    - name: currency
      type: string
      default: VND
      description: Currency

  underwriting_summary:
    - name: risk_classification
      type: string
      description: Risk classification

    - name: total_loading
      type: decimal
      precision: 5
      scale: 2
      description: Total loading percentage

    - name: loadings
      type: array
      items:
        type: object
        properties:
          reason:
            type: string
          loading_percent:
            type: decimal
      description: Loading breakdown

    - name: exclusions
      type: array
      items:
        type: object
        properties:
          exclusion_code:
            type: string
          exclusion_wording:
            type: string
      description: Proposed exclusions

    - name: medical_summary
      type: text
      description: Medical underwriting summary

    - name: financial_summary
      type: text
      description: Financial underwriting summary

  submission:
    - name: submitted_at
      type: timestamp
      description: Submission timestamp

    - name: submitted_by
      type: uuid
      foreign_key: users.id
      description: Submitting underwriter

    - name: submitted_to
      type: array
      items:
        type: object
        properties:
          reinsurer_id:
            type: uuid
          reinsurer_name:
            type: string
          submitted_at:
            type: timestamp
          method:
            type: enum
            values: [portal, email, fax]
      description: Reinsurers submitted to

    - name: submission_documents
      type: array
      items:
        type: object
        properties:
          document_type:
            type: string
          document_url:
            type: string
          uploaded_at:
            type: timestamp
      description: Submission documents

  quotes:
    - name: quotes_received
      type: array
      items:
        type: object
        properties:
          reinsurer_id:
            type: uuid
          reinsurer_name:
            type: string
          quoted_at:
            type: timestamp
          quote_status:
            type: enum
            values: [quoted, declined, pending]
          share_offered:
            type: decimal
          loading_quoted:
            type: decimal
          additional_exclusions:
            type: array
          premium_rate:
            type: decimal
          conditions:
            type: text
          valid_until:
            type: date
      description: Quotes from reinsurers

    - name: quote_response_deadline
      type: date
      description: Deadline for quote responses

  placement:
    - name: placement_result
      type: enum
      values:
        - fully_placed
        - partially_placed
        - not_placed
      description: Placement outcome

    - name: final_placement
      type: array
      items:
        type: object
        properties:
          reinsurer_id:
            type: uuid
          reinsurer_name:
            type: string
          share_percentage:
            type: decimal
          share_amount:
            type: decimal
          loading_accepted:
            type: decimal
          exclusions_applied:
            type: array
          premium_rate:
            type: decimal
          confirmed_at:
            type: timestamp
      description: Final placement details

    - name: total_placed_amount
      type: decimal
      precision: 15
      scale: 2
      computed: true
      description: Total amount placed

    - name: unplaced_amount
      type: decimal
      precision: 15
      scale: 2
      computed: true
      description: Amount not placed

  premium:
    - name: facultative_premium
      type: decimal
      precision: 15
      scale: 2
      description: Total facultative premium

    - name: premium_currency
      type: string
      default: VND
      description: Premium currency

    - name: commission_rate
      type: decimal
      precision: 5
      scale: 2
      description: Commission rate

  negotiation:
    - name: negotiation_notes
      type: array
      items:
        type: object
        properties:
          date:
            type: timestamp
          reinsurer:
            type: string
          notes:
            type: text
          recorded_by:
            type: uuid
      description: Negotiation history

  timeline:
    - name: sla_due_date
      type: date
      description: SLA deadline

    - name: created_at
      type: timestamp
      default: now()

    - name: completed_at
      type: timestamp
      description: Completion timestamp

    - name: turnaround_days
      type: integer
      computed: true
      description: Days from submission to completion

  audit:
    - name: updated_at
      type: timestamp

    - name: notes
      type: text
      description: General notes

relationships:
  - name: underwriting_case
    type: belongs_to
    entity: underwriting_case
    foreign_key: underwriting_case_id
    description: Parent underwriting case

  - name: treaty
    type: belongs_to
    entity: reinsurance_treaty
    foreign_key: treaty_id
    description: Related treaty

  - name: submitter
    type: belongs_to
    entity: user
    foreign_key: submitted_by
    description: Submitting underwriter

state_machine:
  initial: draft
  states:
    draft:
      description: Preparing submission
      allowed_transitions: [submitted, withdrawn]

    submitted:
      description: Sent to reinsurers
      allowed_transitions: [quoted, declined, withdrawn]

    quoted:
      description: Quotes received
      allowed_transitions: [negotiating, accepted, declined, withdrawn]

    negotiating:
      description: Negotiating terms
      allowed_transitions: [accepted, declined, withdrawn]

    accepted:
      description: Placement confirmed
      terminal: true

    declined:
      description: Reinsurers declined
      terminal: true

    withdrawn:
      description: Submission withdrawn
      terminal: true

    expired:
      description: Quotes expired
      terminal: true

indexes:
  - columns: [case_number]
    unique: true
  - columns: [underwriting_case_id]
  - columns: [status]
  - columns: [submitted_at]
  - columns: [sla_due_date]

business_rules:
  - rule: Must include all relevant medical reports
  - rule: Quote validity typically 30 days
  - rule: Placement confirmation within SLA
  - rule: Commission per treaty or market standard
