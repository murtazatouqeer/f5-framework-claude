name: risk_assessment
display_name: Risk Assessment
description: |
  Comprehensive risk assessment record containing all evaluated risk factors,
  scores, and the underwriter's recommendation for an underwriting case.

domain: insurance
subdomain: underwriting
category: entities
version: "1.0.0"
status: active

attributes:
  identification:
    - name: id
      type: uuid
      primary_key: true
      description: Unique assessment identifier

    - name: case_id
      type: uuid
      required: true
      foreign_key: underwriting_cases.id
      description: Reference to underwriting case

    - name: assessment_number
      type: string
      format: "RA-{case_number}-{NN}"
      unique: true
      generated: true
      description: Assessment reference number

  status:
    - name: assessment_type
      type: enum
      values:
        - initial
        - detailed
        - peer_review
        - chief_underwriter
        - committee
      default: initial
      description: Type/level of assessment

    - name: status
      type: enum
      values:
        - draft
        - completed
        - reviewed
        - approved
      default: draft
      description: Assessment status

  risk_factors:
    - name: risk_factors
      type: array
      items:
        type: object
        properties:
          factor_id:
            type: uuid
          factor_code:
            type: string
          category:
            type: string
          severity:
            type: string
          score_impact:
            type: integer
          loading_impact:
            type: decimal
          notes:
            type: string
      description: Array of identified risk factors

    - name: total_risk_score
      type: integer
      min: 0
      max: 100
      computed: true
      description: Aggregate risk score

    - name: risk_classification
      type: enum
      values:
        - preferred
        - standard
        - substandard_1
        - substandard_2
        - substandard_3
        - substandard_4
        - decline
        - postpone
      description: Final risk classification

  medical_risk:
    - name: medical_risk_factors
      type: array
      items:
        type: object
        properties:
          condition:
            type: string
          icd_code:
            type: string
          severity:
            type: enum
            values: [mild, moderate, severe]
          controlled:
            type: boolean
          score_impact:
            type: integer
          duration_years:
            type: integer
          treatment:
            type: string
      description: Medical conditions identified

    - name: medical_risk_score
      type: integer
      min: 0
      max: 100
      description: Medical risk subscore

    - name: medical_impairment_rating
      type: string
      description: Overall medical impairment rating

    - name: bmi_assessment
      type: object
      properties:
        height_cm:
          type: decimal
        weight_kg:
          type: decimal
        bmi_value:
          type: decimal
        bmi_category:
          type: enum
          values: [underweight, normal, overweight, obese_1, obese_2, obese_3]
        score_impact:
          type: integer
      description: BMI assessment details

    - name: blood_pressure_assessment
      type: object
      properties:
        systolic:
          type: integer
        diastolic:
          type: integer
        category:
          type: enum
          values: [normal, elevated, hypertension_stage_1, hypertension_stage_2, crisis]
        controlled:
          type: boolean
        score_impact:
          type: integer
      description: Blood pressure assessment

  lifestyle_risk:
    - name: smoker_status
      type: enum
      values:
        - never_smoked
        - ex_smoker_5_plus_years
        - ex_smoker_less_5_years
        - occasional_smoker
        - regular_smoker
        - heavy_smoker
      description: Smoking status classification

    - name: smoker_score_impact
      type: integer
      description: Score impact from smoking

    - name: alcohol_consumption
      type: enum
      values:
        - none
        - occasional
        - moderate
        - heavy
        - dependent
      description: Alcohol consumption level

    - name: alcohol_score_impact
      type: integer
      description: Score impact from alcohol

    - name: hazardous_activities
      type: array
      items:
        type: object
        properties:
          activity:
            type: string
          frequency:
            type: string
          score_impact:
            type: integer
          exclusion_recommended:
            type: boolean
      description: Hazardous activities identified

    - name: lifestyle_risk_score
      type: integer
      min: 0
      max: 100
      description: Lifestyle risk subscore

  occupation_risk:
    - name: occupation
      type: string
      description: Stated occupation

    - name: occupation_code
      type: string
      description: Occupation classification code

    - name: occupation_class
      type: enum
      values: ["1", "2", "3", "4", "declined"]
      description: Occupation class

    - name: occupation_risk_score
      type: integer
      min: 0
      max: 100
      description: Occupation risk subscore

    - name: occupation_notes
      type: text
      description: Occupation assessment notes

  financial_risk:
    - name: income_verified
      type: boolean
      description: Whether income has been verified

    - name: stated_annual_income
      type: decimal
      precision: 15
      scale: 2
      description: Applicant's stated income

    - name: verified_annual_income
      type: decimal
      precision: 15
      scale: 2
      description: Verified income amount

    - name: sum_insured_to_income_ratio
      type: decimal
      precision: 5
      scale: 2
      computed: true
      description: Ratio of coverage to income

    - name: financial_justification
      type: text
      description: Justification for sum insured

    - name: financial_justification_acceptable
      type: boolean
      description: Whether justification is acceptable

    - name: financial_risk_score
      type: integer
      min: 0
      max: 100
      description: Financial risk subscore

    - name: existing_coverage_total
      type: decimal
      precision: 15
      scale: 2
      description: Total existing life coverage

  family_history:
    - name: family_medical_history
      type: array
      items:
        type: object
        properties:
          relationship:
            type: enum
            values: [father, mother, sibling, grandparent]
          condition:
            type: string
          age_at_onset:
            type: integer
          age_at_death:
            type: integer
          cause_of_death:
            type: string
          score_impact:
            type: integer
      description: Family medical history details

    - name: hereditary_risk_score
      type: integer
      min: 0
      max: 100
      description: Hereditary risk subscore

  geographic_risk:
    - name: residence_country
      type: string
      description: Country of residence

    - name: travel_risk
      type: array
      items:
        type: object
        properties:
          destination:
            type: string
          frequency:
            type: string
          risk_level:
            type: enum
            values: [low, medium, high]
          score_impact:
            type: integer
      description: Travel-related risk

    - name: geographic_risk_score
      type: integer
      min: 0
      max: 100
      description: Geographic risk subscore

  recommendation:
    - name: recommended_decision
      type: enum
      values:
        - accept_standard
        - accept_preferred
        - accept_with_loading
        - accept_with_exclusion
        - accept_with_loading_and_exclusion
        - decline
        - postpone
        - counter_offer
        - refer_to_senior
      description: Underwriter's recommendation

    - name: recommended_loading_percent
      type: decimal
      precision: 5
      scale: 2
      description: Recommended loading percentage

    - name: recommended_loadings
      type: array
      items:
        type: object
        properties:
          reason_code:
            type: string
          loading_type:
            type: enum
            values: [percentage, flat_extra]
          loading_percent:
            type: decimal
          flat_extra_per_mille:
            type: decimal
          duration_years:
            type: integer
          applies_to_coverages:
            type: array
      description: Detailed loading recommendations

    - name: recommended_exclusions
      type: array
      items:
        type: object
        properties:
          exclusion_code:
            type: string
          exclusion_wording:
            type: string
          reason:
            type: string
          permanent:
            type: boolean
          review_years:
            type: integer
      description: Recommended exclusions

    - name: recommended_sum_insured
      type: decimal
      precision: 15
      scale: 2
      description: Recommended sum insured (if different)

    - name: recommendation_notes
      type: text
      description: Detailed recommendation notes

    - name: postpone_until
      type: date
      description: If postponed, review date

    - name: postpone_reason
      type: text
      description: Reason for postponement

  assessor:
    - name: assessed_by
      type: uuid
      foreign_key: users.id
      required: true
      description: Underwriter who performed assessment

    - name: assessed_at
      type: timestamp
      description: Assessment completion timestamp

    - name: peer_reviewed_by
      type: uuid
      foreign_key: users.id
      description: Peer reviewer (if applicable)

    - name: peer_reviewed_at
      type: timestamp
      description: Peer review timestamp

    - name: peer_review_notes
      type: text
      description: Peer review comments

  audit:
    - name: created_at
      type: timestamp
      default: now()

    - name: updated_at
      type: timestamp

relationships:
  - name: underwriting_case
    type: belongs_to
    entity: underwriting_case
    foreign_key: case_id
    description: Parent underwriting case

  - name: risk_factors
    type: has_many
    entity: risk_factor
    through: assessment_risk_factors
    description: Associated risk factors

  - name: assessor
    type: belongs_to
    entity: user
    foreign_key: assessed_by
    description: Assessing underwriter

  - name: peer_reviewer
    type: belongs_to
    entity: user
    foreign_key: peer_reviewed_by
    description: Peer reviewer

scoring_methodology:
  base_score: 0
  score_ranges:
    preferred: "0-10"
    standard: "11-30"
    substandard_1: "31-45"
    substandard_2: "46-60"
    substandard_3: "61-75"
    substandard_4: "76-85"
    decline: ">85"

  category_weights:
    medical: 40%
    lifestyle: 20%
    occupation: 15%
    financial: 10%
    family_history: 10%
    geographic: 5%

  combination_rules:
    synergistic:
      - "Diabetes + Hypertension: Compound effect"
      - "Smoking + Heart disease: Multiply loading"
    mitigating:
      - "Controlled condition with compliance: Reduce loading"

indexes:
  - columns: [case_id]
    unique: true
  - columns: [assessment_type, status]
  - columns: [risk_classification]
  - columns: [assessed_by]
  - columns: [created_at]

business_rules:
  - rule: Peer review required for substandard_3 and above
  - rule: Committee review for decline recommendations
  - rule: Maximum combined loading of 200%
  - rule: Postponement maximum 2 years
