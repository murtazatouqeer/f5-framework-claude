# Learner Entity
# F5 Framework v2.0 - Education/LMS
# Student/learner profile in the LMS

entity:
  id: learner
  name: Learner
  name_ja: 学習者
  description: User profile for learning activities
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    user_id:
      type: uuid
      references: user
      required: true
      unique: true
      
    learner_id:
      type: string
      max_length: 20
      unique: true
      pattern: "^LRN-[A-Z0-9]{6}$"
      auto_generate: true
      
    # Status
    status:
      type: enum
      values: [active, suspended, graduated, withdrawn]
      default: active
      
    # Profile Information
    first_name:
      type: string
      max_length: 100
      required: true
      
    last_name:
      type: string
      max_length: 100
      required: true
      
    display_name:
      type: string
      max_length: 100
      
    email:
      type: string
      format: email
      required: true
      
    phone:
      type: string
      max_length: 20
      
    avatar_url:
      type: string
      format: url
      
    bio:
      type: text
      max_length: 1000
      
    # Localization
    timezone:
      type: string
      format: timezone
      default: "UTC"
      
    preferred_language:
      type: string
      format: iso_639_1
      default: "en"
      
    # Learning Preferences
    preferred_content_type:
      type: enum
      values: [video, reading, interactive, mixed]
      default: mixed
      
    daily_learning_goal_minutes:
      type: integer
      min: 5
      max: 480
      default: 30
      
    notification_preferences:
      type: json
      default:
        email_course_updates: true
        email_reminders: true
        push_notifications: true
        weekly_digest: true
        
    # Organization (B2B)
    organization_id:
      type: uuid
      references: organization
      
    department:
      type: string
      max_length: 100
      
    job_title:
      type: string
      max_length: 100
      
    manager_id:
      type: uuid
      references: learner
      
    employee_id:
      type: string
      max_length: 50
      description: External employee ID
      
    # Learning Statistics
    total_courses_enrolled:
      type: integer
      default: 0
      computed: true
      
    total_courses_completed:
      type: integer
      default: 0
      computed: true
      
    total_courses_in_progress:
      type: integer
      default: 0
      computed: true
      
    total_learning_hours:
      type: decimal
      precision: 10
      scale: 2
      default: 0
      computed: true
      
    total_certificates_earned:
      type: integer
      default: 0
      computed: true
      
    average_quiz_score:
      type: decimal
      precision: 5
      scale: 2
      computed: true
      
    # Streaks
    current_streak_days:
      type: integer
      default: 0
      
    longest_streak_days:
      type: integer
      default: 0
      
    last_activity_date:
      type: date
      
    # Gamification
    xp_points:
      type: integer
      default: 0
      
    level:
      type: integer
      default: 1
      
    badges:
      type: array
      items: uuid
      references: badge
      
    achievements:
      type: array
      items:
        type: object
        properties:
          achievement_id: uuid
          earned_at: datetime
          
    # Leaderboard
    leaderboard_rank:
      type: integer
      computed: true
      
    leaderboard_opt_in:
      type: boolean
      default: true
      
    # Privacy
    profile_visibility:
      type: enum
      values: [public, organization, private]
      default: organization
      
    show_activity:
      type: boolean
      default: true
      
    # Interests
    interests:
      type: array
      items: string
      max_items: 20
      
    skill_levels:
      type: json
      description: Self-assessed skill levels by category
      
    # Onboarding
    onboarding_completed:
      type: boolean
      default: false
      
    onboarding_completed_at:
      type: datetime
      
    # Metadata
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update
      
    last_login_at:
      type: datetime

  state_machine:
    field: status
    initial: active
    transitions:
      - from: active
        to: suspended
        action: suspend
        triggers:
          - pause_all_enrollments
          - send_suspension_notification
          
      - from: suspended
        to: active
        action: reactivate
        triggers:
          - resume_enrollments
          
      - from: active
        to: graduated
        action: graduate
        triggers:
          - issue_graduation_certificate
          
      - from: active
        to: withdrawn
        action: withdraw
        triggers:
          - cancel_active_enrollments
          - process_refunds_if_applicable

  relationships:
    user:
      type: belongs_to
      entity: user
      foreign_key: user_id
      
    organization:
      type: belongs_to
      entity: organization
      foreign_key: organization_id
      
    manager:
      type: belongs_to
      entity: learner
      foreign_key: manager_id
      
    direct_reports:
      type: has_many
      entity: learner
      foreign_key: manager_id
      
    enrollments:
      type: has_many
      entity: enrollment
      foreign_key: learner_id
      
    progress_records:
      type: has_many
      entity: progress
      foreign_key: learner_id
      
    completions:
      type: has_many
      entity: completion
      foreign_key: learner_id
      
    certificates:
      type: has_many
      entity: certificate
      foreign_key: learner_id
      
    bookmarks:
      type: has_many
      entity: bookmark
      foreign_key: learner_id
      
    notes:
      type: has_many
      entity: note
      foreign_key: learner_id

  indexes:
    - columns: [learner_id]
      unique: true
    - columns: [user_id]
      unique: true
    - columns: [email]
    - columns: [organization_id, status]
    - columns: [status]
    - columns: [xp_points]
    - columns: [current_streak_days]

  audit:
    enabled: true
    track_changes: true
    pii_fields: [first_name, last_name, email, phone]
