# Progress Entity
# F5 Framework v2.0 - Education/LMS
# Learner progress tracking for lessons and modules

entity:
  id: progress
  name: Progress
  name_ja: 進捗
  description: Detailed progress tracking for each lesson/module
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    # Relationships
    enrollment_id:
      type: uuid
      references: enrollment
      required: true
      
    learner_id:
      type: uuid
      references: learner
      required: true
      
    course_id:
      type: uuid
      references: course
      required: true
      
    module_id:
      type: uuid
      references: module
      
    lesson_id:
      type: uuid
      references: lesson
      
    # Status
    status:
      type: enum
      values: [not_started, in_progress, completed]
      default: not_started
      
    # Timing
    started_at:
      type: datetime
      
    completed_at:
      type: datetime
      
    last_accessed_at:
      type: datetime
      
    # Time Tracking
    time_spent_seconds:
      type: integer
      default: 0
      
    session_count:
      type: integer
      default: 0
      
    # Video Progress
    video_watched_seconds:
      type: integer
      default: 0
      
    video_total_seconds:
      type: integer
      
    video_watch_percent:
      type: integer
      min: 0
      max: 100
      computed: true
      
    last_position_seconds:
      type: integer
      description: Resume position for video
      
    # Completion
    is_completed:
      type: boolean
      default: false
      
    completion_criteria_met:
      type: json
      description: Which criteria were satisfied
      
    # Quiz/Assessment Progress
    quiz_id:
      type: uuid
      references: quiz
      
    score:
      type: decimal
      precision: 5
      scale: 2
      
    max_score:
      type: decimal
      precision: 5
      scale: 2
      
    score_percent:
      type: decimal
      precision: 5
      scale: 2
      computed: true
      
    passed:
      type: boolean
      
    attempts:
      type: integer
      default: 0
      
    max_attempts:
      type: integer
      
    best_score:
      type: decimal
      precision: 5
      scale: 2
      
    # SCORM/xAPI Tracking
    scorm_data:
      type: json
      description: SCORM runtime data
      
    scorm_status:
      type: enum
      values: [not_attempted, incomplete, completed, passed, failed]
      
    xapi_statement_id:
      type: uuid
      
    # Bookmarks and Notes Count
    bookmarks_count:
      type: integer
      default: 0
      computed: true
      
    notes_count:
      type: integer
      default: 0
      computed: true
      
    # Metadata
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  relationships:
    enrollment:
      type: belongs_to
      entity: enrollment
      foreign_key: enrollment_id
      
    learner:
      type: belongs_to
      entity: learner
      foreign_key: learner_id
      
    course:
      type: belongs_to
      entity: course
      foreign_key: course_id
      
    module:
      type: belongs_to
      entity: module
      foreign_key: module_id
      
    lesson:
      type: belongs_to
      entity: lesson
      foreign_key: lesson_id

  indexes:
    - columns: [enrollment_id, lesson_id]
      unique: true
    - columns: [learner_id, course_id]
    - columns: [enrollment_id, module_id]
    - columns: [lesson_id, status]
    - columns: [is_completed]
    - columns: [last_accessed_at]

  audit:
    enabled: true
    track_changes: false
    retention_days: 2555
