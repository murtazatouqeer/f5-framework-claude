# Discussion Entity
# F5 Framework v2.0 - Education/LMS
# Discussion forums and threads

entity:
  id: discussion
  name: Discussion
  name_ja: ディスカッション
  description: Discussion threads and forums for social learning
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    # Context
    course_id:
      type: uuid
      references: course
      required: true
      
    module_id:
      type: uuid
      references: module
      
    lesson_id:
      type: uuid
      references: lesson
      
    # Discussion Type
    discussion_type:
      type: enum
      values:
        - general         # General course discussion
        - lesson_qa       # Q&A for specific lesson
        - assignment      # Assignment discussion
        - introduction    # Student introductions
        - peer_review     # Peer review discussions
        - announcement    # Instructor announcements with comments
      default: general
      
    # Basic Information
    title:
      type: string
      max_length: 300
      required: true
      
    content:
      type: text
      supports_markdown: true
      required: true
      
    # Author
    author_id:
      type: uuid
      references: user
      required: true
      
    author_type:
      type: enum
      values: [learner, instructor, admin]
      
    # Status
    status:
      type: enum
      values: [draft, published, hidden, locked, deleted]
      default: published
      
    is_pinned:
      type: boolean
      default: false
      
    is_answered:
      type: boolean
      default: false
      description: For Q&A type
      
    accepted_answer_id:
      type: uuid
      references: discussion_reply
      
    # Parent (for replies)
    parent_id:
      type: uuid
      references: discussion
      description: Null for top-level posts
      
    thread_id:
      type: uuid
      references: discussion
      description: Root discussion for all replies
      
    depth:
      type: integer
      default: 0
      description: Nesting level
      
    # Engagement
    replies_count:
      type: integer
      default: 0
      
    views_count:
      type: integer
      default: 0
      
    likes_count:
      type: integer
      default: 0
      
    # Participants
    participants_count:
      type: integer
      default: 1
      computed: true
      
    last_reply_at:
      type: datetime
      
    last_reply_by:
      type: uuid
      references: user
      
    # Attachments
    attachments:
      type: array
      items:
        type: object
        properties:
          file_url: string
          file_name: string
          file_type: string
          file_size: integer
          
    # Moderation
    is_flagged:
      type: boolean
      default: false
      
    flag_count:
      type: integer
      default: 0
      
    moderation_status:
      type: enum
      values: [pending, approved, rejected]
      default: approved
      
    moderated_by:
      type: uuid
      references: user
      
    moderated_at:
      type: datetime
      
    # Notifications
    subscribers:
      type: array
      items: uuid
      description: Users subscribed to updates
      
    # Metadata
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update
      
    edited_at:
      type: datetime
      
    deleted_at:
      type: datetime

  relationships:
    course:
      type: belongs_to
      entity: course
      foreign_key: course_id
      
    module:
      type: belongs_to
      entity: module
      foreign_key: module_id
      
    lesson:
      type: belongs_to
      entity: lesson
      foreign_key: lesson_id
      
    author:
      type: belongs_to
      entity: user
      foreign_key: author_id
      
    parent:
      type: belongs_to
      entity: discussion
      foreign_key: parent_id
      
    thread:
      type: belongs_to
      entity: discussion
      foreign_key: thread_id
      
    replies:
      type: has_many
      entity: discussion
      foreign_key: parent_id
      
    likes:
      type: has_many
      entity: discussion_like
      foreign_key: discussion_id

  indexes:
    - columns: [course_id, status]
    - columns: [course_id, is_pinned, created_at]
    - columns: [lesson_id]
    - columns: [thread_id, created_at]
    - columns: [author_id]
    - columns: [status, is_flagged]

  audit:
    enabled: true
    track_changes: true
