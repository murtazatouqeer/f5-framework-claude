# Note Entity
# F5 Framework v2.0 - Education/LMS
# Learner notes on lessons

entity:
  id: note
  name: Note
  name_ja: ノート
  description: Learner personal notes on course content
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    # Owner
    learner_id:
      type: uuid
      references: learner
      required: true
      
    # Context
    course_id:
      type: uuid
      references: course
      required: true
      
    lesson_id:
      type: uuid
      references: lesson
      required: true
      
    content_item_id:
      type: uuid
      references: content_item
      description: Specific content item if applicable
      
    # Note Content
    content:
      type: text
      required: true
      supports_markdown: true
      max_length: 10000
      
    # Position Reference
    timestamp_seconds:
      type: integer
      description: Video timestamp
      
    text_selection:
      type: text
      max_length: 1000
      description: Selected/highlighted text
      
    text_position:
      type: json
      description: Position in text content
      
    # Organization
    title:
      type: string
      max_length: 200
      description: Optional note title
      
    folder:
      type: string
      max_length: 100
      
    tags:
      type: array
      items: string
      max_items: 20
      
    color:
      type: string
      max_length: 7
      description: Highlight color
      
    # Status
    is_pinned:
      type: boolean
      default: false
      
    is_archived:
      type: boolean
      default: false
      
    # Sharing (future feature)
    is_shared:
      type: boolean
      default: false
      
    shared_with:
      type: array
      items: uuid
      description: Learner IDs if shared
      
    # Review
    marked_for_review:
      type: boolean
      default: false
      description: Flag for spaced repetition
      
    last_reviewed_at:
      type: datetime
      
    review_count:
      type: integer
      default: 0
      
    # Metadata
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  relationships:
    learner:
      type: belongs_to
      entity: learner
      foreign_key: learner_id
      
    course:
      type: belongs_to
      entity: course
      foreign_key: course_id
      
    lesson:
      type: belongs_to
      entity: lesson
      foreign_key: lesson_id
      
    content_item:
      type: belongs_to
      entity: content_item
      foreign_key: content_item_id

  indexes:
    - columns: [learner_id, course_id]
    - columns: [learner_id, lesson_id]
    - columns: [learner_id, is_pinned]
    - columns: [learner_id, folder]
    - columns: [learner_id, marked_for_review]
    - columns: [created_at]

  audit:
    enabled: false
