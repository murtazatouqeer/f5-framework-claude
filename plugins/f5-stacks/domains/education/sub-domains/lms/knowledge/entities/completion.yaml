# Completion Entity
# F5 Framework v2.0 - Education/LMS
# Course completion records and certificates

entity:
  id: completion
  name: Completion
  name_ja: 修了
  description: Course completion record with achievement details
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    # Relationships
    enrollment_id:
      type: uuid
      references: enrollment
      required: true
      unique: true
      
    learner_id:
      type: uuid
      references: learner
      required: true
      
    course_id:
      type: uuid
      references: course
      required: true
      
    # Completion Details
    completed_at:
      type: datetime
      required: true
      
    # Statistics
    total_time_spent_minutes:
      type: integer
      
    lessons_completed:
      type: integer
      
    total_lessons:
      type: integer
      
    modules_completed:
      type: integer
      
    total_modules:
      type: integer
      
    completion_percent:
      type: integer
      min: 0
      max: 100
      
    # Grades
    quizzes_taken:
      type: integer
      default: 0
      
    quizzes_passed:
      type: integer
      default: 0
      
    average_quiz_score:
      type: decimal
      precision: 5
      scale: 2
      
    assignments_submitted:
      type: integer
      default: 0
      
    assignments_graded:
      type: integer
      default: 0
      
    average_assignment_score:
      type: decimal
      precision: 5
      scale: 2
      
    final_grade:
      type: decimal
      precision: 5
      scale: 2
      
    grade_letter:
      type: string
      max_length: 2
      description: A, B, C, D, F, Pass, Fail
      
    # Certificate
    certificate_issued:
      type: boolean
      default: false
      
    certificate_id:
      type: uuid
      references: certificate
      
    certificate_url:
      type: string
      format: url
      
    certificate_issued_at:
      type: datetime
      
    certificate_number:
      type: string
      max_length: 50
      unique: true
      
    # Credits
    credits_earned:
      type: decimal
      precision: 5
      scale: 2
      
    ceu_earned:
      type: decimal
      precision: 4
      scale: 2
      
    cpd_earned:
      type: decimal
      precision: 4
      scale: 2
      
    # Feedback
    rating:
      type: integer
      min: 1
      max: 5
      
    review_text:
      type: text
      max_length: 5000
      
    review_submitted_at:
      type: datetime
      
    would_recommend:
      type: boolean
      
    # NPS
    nps_score:
      type: integer
      min: 0
      max: 10
      
    # Achievements
    badges_earned:
      type: array
      items: uuid
      references: badge
      
    xp_earned:
      type: integer
      default: 0
      
    # Verification
    verified:
      type: boolean
      default: true
      description: Completion legitimately earned
      
    verification_method:
      type: enum
      values: [automatic, proctored, manual_review]
      default: automatic
      
    # Metadata
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  relationships:
    enrollment:
      type: belongs_to
      entity: enrollment
      foreign_key: enrollment_id
      
    learner:
      type: belongs_to
      entity: learner
      foreign_key: learner_id
      
    course:
      type: belongs_to
      entity: course
      foreign_key: course_id
      
    certificate:
      type: belongs_to
      entity: certificate
      foreign_key: certificate_id

  indexes:
    - columns: [enrollment_id]
      unique: true
    - columns: [learner_id, course_id]
      unique: true
    - columns: [certificate_number]
      unique: true
    - columns: [completed_at]
    - columns: [course_id]
    - columns: [rating]

  audit:
    enabled: true
    track_changes: true
    retention_days: 3650
