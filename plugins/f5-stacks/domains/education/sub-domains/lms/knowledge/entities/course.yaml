# Course Entity
# F5 Framework v2.0 - Education/LMS
# Core entity for online courses

entity:
  id: course
  name: Course
  name_ja: コース
  description: Online course containing structured learning content
  domain: education
  subdomain: lms
  version: "1.0.0"

  attributes:
    # Identification
    id:
      type: uuid
      primary_key: true
      
    course_code:
      type: string
      max_length: 50
      unique: true
      pattern: "^[A-Z]{2,4}-[A-Z0-9-]+$"
      examples: ["CS101", "MBA-FIN-201", "DEV-REACT-ADV"]
      
    # Basic Information
    title:
      type: string
      max_length: 200
      required: true
      searchable: true
      
    subtitle:
      type: string
      max_length: 300
      
    description:
      type: text
      max_length: 10000
      supports_markdown: true
      
    slug:
      type: string
      max_length: 200
      unique: true
      description: URL-friendly identifier
      
    # Status
    status:
      type: enum
      values: [draft, pending_review, published, archived, retired]
      default: draft
      
    visibility:
      type: enum
      values: [public, private, unlisted, organization_only]
      default: private
      
    # Classification
    category_id:
      type: uuid
      references: category
      required: true
      
    subcategory_id:
      type: uuid
      references: category
      
    tags:
      type: array
      items: string
      max_items: 20
      
    difficulty_level:
      type: enum
      values: [beginner, intermediate, advanced, expert]
      default: beginner
      
    # Language
    language:
      type: string
      format: iso_639_1
      default: "en"
      
    subtitles_available:
      type: array
      items: string
      description: Available subtitle languages
      
    # Media
    course_image_url:
      type: string
      format: url
      
    promo_video_url:
      type: string
      format: url
      
    # Content Description
    syllabus:
      type: text
      supports_markdown: true
      
    learning_objectives:
      type: array
      items: string
      max_items: 20
      description: What learners will achieve
      
    prerequisites:
      type: array
      items: uuid
      description: Required course IDs before enrollment
      
    target_audience:
      type: text
      max_length: 2000
      
    # Structure
    modules:
      type: array
      items: uuid
      description: Ordered list of module IDs
      
    total_modules:
      type: integer
      min: 0
      computed: true
      
    total_lessons:
      type: integer
      min: 0
      computed: true
      
    total_duration_minutes:
      type: integer
      min: 0
      computed: true
      
    estimated_completion_hours:
      type: decimal
      precision: 5
      scale: 1
      
    # Delivery
    delivery_mode:
      type: enum
      values: [self_paced, instructor_led, blended, cohort_based]
      default: self_paced
      
    start_date:
      type: date
      description: For scheduled courses
      
    end_date:
      type: date
      
    enrollment_start:
      type: datetime
      
    enrollment_end:
      type: datetime
      
    max_enrollments:
      type: integer
      description: Null for unlimited
      
    # Pricing
    is_free:
      type: boolean
      default: true
      
    price:
      type: decimal
      precision: 10
      scale: 2
      
    currency:
      type: string
      format: iso_4217
      default: "USD"
      
    discount_price:
      type: decimal
      precision: 10
      scale: 2
      
    discount_end_date:
      type: datetime
      
    # Certification
    certificate_enabled:
      type: boolean
      default: true
      
    certificate_template_id:
      type: uuid
      references: certificate_template
      
    completion_threshold_percent:
      type: integer
      min: 0
      max: 100
      default: 80
      
    ceu_credits:
      type: decimal
      precision: 4
      scale: 2
      description: Continuing Education Units
      
    cpd_points:
      type: decimal
      precision: 4
      scale: 2
      description: Continuing Professional Development points
      
    # Instructors
    primary_instructor_id:
      type: uuid
      references: instructor
      required: true
      
    instructor_ids:
      type: array
      items: uuid
      description: Co-instructors
      
    # Engagement Features
    discussion_enabled:
      type: boolean
      default: true
      
    qa_enabled:
      type: boolean
      default: true
      
    peer_review_enabled:
      type: boolean
      default: false
      
    # SEO
    meta_title:
      type: string
      max_length: 70
      
    meta_description:
      type: string
      max_length: 160
      
    # Statistics (computed)
    total_enrollments:
      type: integer
      default: 0
      computed: true
      
    active_enrollments:
      type: integer
      default: 0
      computed: true
      
    completion_count:
      type: integer
      default: 0
      computed: true
      
    average_rating:
      type: decimal
      precision: 3
      scale: 2
      computed: true
      
    total_reviews:
      type: integer
      default: 0
      computed: true
      
    # Metadata
    created_by:
      type: uuid
      references: user
      
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update
      
    published_at:
      type: datetime
      
    last_content_update:
      type: datetime
      
    version:
      type: integer
      default: 1

  state_machine:
    field: status
    initial: draft
    transitions:
      - from: draft
        to: pending_review
        action: submit_for_review
        conditions:
          - has_at_least_one_lesson
          - primary_instructor_set
          
      - from: pending_review
        to: published
        action: approve_and_publish
        triggers:
          - set_published_at
          - notify_instructor
          - index_for_search
          
      - from: pending_review
        to: draft
        action: request_changes
        triggers:
          - notify_instructor_changes_needed
          
      - from: published
        to: archived
        action: archive
        conditions:
          - no_active_cohorts
        triggers:
          - hide_from_catalog
          - notify_enrolled_learners
          
      - from: published
        to: retired
        action: retire
        triggers:
          - close_enrollments
          - convert_existing_to_lifetime
          
      - from: archived
        to: published
        action: republish
        triggers:
          - show_in_catalog
          - reindex_for_search

  relationships:
    category:
      type: belongs_to
      entity: category
      foreign_key: category_id
      
    modules:
      type: has_many
      entity: module
      foreign_key: course_id
      order_by: sequence_order
      
    primary_instructor:
      type: belongs_to
      entity: instructor
      foreign_key: primary_instructor_id
      
    instructors:
      type: many_to_many
      entity: instructor
      through: course_instructor
      
    enrollments:
      type: has_many
      entity: enrollment
      foreign_key: course_id
      
    reviews:
      type: has_many
      entity: review
      foreign_key: course_id
      
    learning_paths:
      type: many_to_many
      entity: learning_path
      through: learning_path_course
      
    announcements:
      type: has_many
      entity: announcement
      foreign_key: course_id
      
    discussions:
      type: has_many
      entity: discussion
      foreign_key: course_id

  indexes:
    - columns: [course_code]
      unique: true
    - columns: [slug]
      unique: true
    - columns: [status, visibility]
    - columns: [category_id, status]
    - columns: [primary_instructor_id]
    - columns: [delivery_mode, status]
    - columns: [is_free, status]
    - columns: [created_at]
    - columns: [published_at]

  validations:
    - name: price_required_if_not_free
      condition: "is_free == false"
      validation: "price IS NOT NULL AND price > 0"
      message: "Price is required for paid courses"
      
    - name: discount_price_less_than_price
      condition: "discount_price IS NOT NULL"
      validation: "discount_price < price"
      message: "Discount price must be less than regular price"
      
    - name: dates_valid
      condition: "start_date IS NOT NULL AND end_date IS NOT NULL"
      validation: "end_date > start_date"
      message: "End date must be after start date"
      
    - name: enrollment_dates_valid
      condition: "enrollment_start IS NOT NULL AND enrollment_end IS NOT NULL"
      validation: "enrollment_end > enrollment_start"
      message: "Enrollment end must be after enrollment start"

  audit:
    enabled: true
    track_changes: true
    retention_days: 2555
