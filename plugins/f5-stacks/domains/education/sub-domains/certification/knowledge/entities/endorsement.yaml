# Endorsement Entity
# F5 Framework v2.0 - Education/Certification
# Third-party endorsements of credentials

entity:
  id: endorsement
  name: Endorsement
  name_ja: æ¨è–¦
  domain: education
  subdomain: certification
  version: "1.0.0"
  
  description: |
    A third-party attestation or endorsement of a credential holder's
    skills or certification. Can come from employers, colleagues, or
    other organizations.

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true
      
    - name: endorsement_id
      type: string
      format: "END-{XXXXXXXX}"
      unique: true
      indexed: true

    # Credential Reference
    - name: credential_type
      type: enum
      values: [certificate, badge, skill, holder_profile]
      required: true
      
    - name: certificate_id
      type: uuid
      foreign_key: certificate.id
      indexed: true
      
    - name: badge_id
      type: uuid
      foreign_key: badge.id
      indexed: true
      
    - name: skill_id
      type: uuid
      foreign_key: skill.id
      indexed: true
      
    - name: holder_id
      type: uuid
      foreign_key: credential_holder.id
      required: true
      indexed: true

    # Status
    - name: status
      type: enum
      values: [pending, active, revoked, expired]
      default: pending
      indexed: true

    # Endorser
    - name: endorser_type
      type: enum
      values: [individual, organization, verified_employer, colleague, client]
      required: true
      
    - name: endorser_user_id
      type: uuid
      foreign_key: user.id
      description: If endorser has account
      
    - name: endorser_organization_id
      type: uuid
      foreign_key: organization.id
      
    - name: endorser_name
      type: string
      max_length: 200
      required: true
      
    - name: endorser_title
      type: string
      max_length: 200
      
    - name: endorser_organization
      type: string
      max_length: 200
      
    - name: endorser_email
      type: string
      max_length: 255
      
    - name: endorser_linkedin_url
      type: string
      max_length: 500

    # Verification
    - name: endorser_verified
      type: boolean
      default: false
      description: Endorser identity verified
      
    - name: verification_method
      type: enum
      values: [email, linkedin, organization, manual]
      
    - name: verified_at
      type: timestamp

    # Relationship
    - name: relationship_to_holder
      type: enum
      values: [employer, manager, colleague, client, instructor, mentor, other]
      
    - name: relationship_description
      type: string
      max_length: 500
      
    - name: known_since
      type: date
      description: How long endorser has known holder
      
    - name: worked_together_months
      type: integer

    # Content
    - name: endorsement_text
      type: text
      required: true
      description: Written endorsement
      
    - name: skills_endorsed
      type: array
      items: string
      description: Specific skills being endorsed
      
    - name: rating
      type: integer
      min: 1
      max: 5
      description: Overall rating if applicable

    # Request
    - name: was_requested
      type: boolean
      default: false
      description: Holder requested this endorsement
      
    - name: requested_at
      type: timestamp
      
    - name: request_message
      type: text

    # Dates
    - name: endorsed_at
      type: timestamp
      indexed: true
      
    - name: expires_at
      type: timestamp
      description: Endorsement expiration

    # Visibility
    - name: is_public
      type: boolean
      default: true
      
    - name: display_on_certificate
      type: boolean
      default: false
      description: Show on public certificate view
      
    - name: display_on_portfolio
      type: boolean
      default: true

    # Metadata
    - name: source
      type: enum
      values: [direct, linkedin_import, api, manual]
      default: direct
      
    - name: external_id
      type: string
      max_length: 100
      description: ID from external system
      
    - name: created_at
      type: timestamp
      auto: true
      
    - name: updated_at
      type: timestamp
      auto: true

  relationships:
    - name: certificate
      type: belongs_to
      entity: certificate
      foreign_key: certificate_id
      
    - name: badge
      type: belongs_to
      entity: badge
      foreign_key: badge_id
      
    - name: skill
      type: belongs_to
      entity: skill
      foreign_key: skill_id
      
    - name: holder
      type: belongs_to
      entity: credential_holder
      foreign_key: holder_id
      
    - name: endorser_user
      type: belongs_to
      entity: user
      foreign_key: endorser_user_id
      
    - name: endorser_org
      type: belongs_to
      entity: organization
      foreign_key: endorser_organization_id

  indexes:
    - fields: [holder_id, status]
      name: idx_holder_status
      
    - fields: [endorser_email, holder_id]
      name: idx_endorser_holder

  validations:
    - rule: "certificate_id IS NOT NULL OR badge_id IS NOT NULL OR skill_id IS NOT NULL"
      message: Must endorse a certificate, badge, or skill
      
    - field: endorsement_text
      rule: "LENGTH(endorsement_text) >= 20"
      message: Endorsement text must be at least 20 characters
