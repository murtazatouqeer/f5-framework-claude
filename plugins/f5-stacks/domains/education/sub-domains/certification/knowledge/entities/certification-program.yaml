# Certification Program Entity
# F5 Framework v2.0 - Education/Certification
# Defines certification programs and their requirements

entity:
  id: certification_program
  name: Certification Program
  name_ja: 認定プログラム
  domain: education
  subdomain: certification
  version: "1.0.0"
  
  description: |
    A structured certification program that defines requirements,
    validity periods, renewal criteria, and governance for issuing
    professional or academic credentials.

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true
      
    - name: program_code
      type: string
      max_length: 50
      unique: true
      indexed: true
      example: "AWS-SAA"
      description: Unique program code
      
    - name: name
      type: string
      max_length: 200
      required: true
      description: Program name
      
    - name: name_ja
      type: string
      max_length: 200
      description: Japanese program name
      
    - name: description
      type: text
      description: Detailed program description
      
    - name: short_description
      type: string
      max_length: 500
      description: Brief description for listings

    # Status
    - name: status
      type: enum
      values: [draft, active, deprecated, retired]
      default: draft
      indexed: true
      
    - name: deprecated_at
      type: date
      description: When program was deprecated
      
    - name: retired_at
      type: date
      description: When program was fully retired
      
    - name: replacement_program_id
      type: uuid
      foreign_key: certification_program.id
      description: Successor program if deprecated

    # Classification
    - name: program_type
      type: enum
      values: [professional, academic, skill_based, compliance, micro_credential, vendor]
      required: true
      indexed: true
      
    - name: category_id
      type: uuid
      foreign_key: category.id
      indexed: true
      description: Program category
      
    - name: level
      type: enum
      values: [foundation, associate, professional, expert, master]
      indexed: true
      description: Certification level
      
    - name: industries
      type: array
      items: string
      description: Target industries
      
    - name: skills
      type: array
      items: uuid
      description: Associated skill IDs

    # Requirements
    - name: eligibility_criteria
      type: text
      description: Who can pursue this certification
      
    - name: prerequisites
      type: array
      items: uuid
      description: Required prior certifications
      
    - name: required_courses
      type: array
      items: uuid
      description: Courses that must be completed
      
    - name: required_assessments
      type: array
      items: uuid
      description: Exams/assessments required
      
    - name: min_score
      type: decimal
      precision: 5
      scale: 2
      description: Minimum passing score
      
    - name: min_grade
      type: string
      max_length: 10
      description: Minimum passing grade
      
    - name: experience_required_months
      type: integer
      description: Required work experience in months
      
    - name: additional_requirements
      type: jsonb
      description: Other requirements (documents, references, etc.)

    # Validity
    - name: certificate_validity_months
      type: integer
      description: How long certificates are valid
      
    - name: is_lifetime
      type: boolean
      default: false
      description: Certificates never expire
      
    - name: validity_calculation
      type: enum
      values: [from_issue, from_achievement, calendar_year]
      default: from_issue

    # Renewal
    - name: renewal_required
      type: boolean
      default: true
      description: Must renew to maintain credential
      
    - name: renewal_period_months
      type: integer
      description: Renewal cycle length
      
    - name: renewal_window_months
      type: integer
      default: 3
      description: Months before expiry to start renewal
      
    - name: grace_period_days
      type: integer
      default: 30
      description: Days after expiry to still renew
      
    - name: ceu_required_per_period
      type: decimal
      precision: 5
      scale: 2
      description: CEUs needed per renewal period
      
    - name: renewal_exam_required
      type: boolean
      default: false
      description: Must pass exam to renew
      
    - name: max_renewals
      type: integer
      description: Maximum number of renewals allowed

    # Pricing
    - name: exam_fee
      type: decimal
      precision: 10
      scale: 2
      description: Exam fee amount
      
    - name: certification_fee
      type: decimal
      precision: 10
      scale: 2
      description: Initial certification fee
      
    - name: renewal_fee
      type: decimal
      precision: 10
      scale: 2
      description: Renewal fee
      
    - name: late_renewal_fee
      type: decimal
      precision: 10
      scale: 2
      description: Late renewal penalty
      
    - name: currency
      type: string
      length: 3
      default: "USD"

    # Governance
    - name: accrediting_body
      type: string
      max_length: 200
      description: Accreditation organization
      
    - name: accreditation_id
      type: string
      max_length: 100
      description: Accreditation number
      
    - name: accreditation_valid_until
      type: date
      description: Accreditation expiry
      
    - name: governing_standards
      type: array
      items: string
      description: Standards compliance (ISO 17024, etc.)
      
    - name: next_review_date
      type: date
      description: Next program review

    # Content
    - name: logo_url
      type: string
      max_length: 500
      description: Program logo
      
    - name: badge_image_url
      type: string
      max_length: 500
      description: Digital badge image
      
    - name: syllabus_url
      type: string
      max_length: 500
      description: Program syllabus
      
    - name: handbook_url
      type: string
      max_length: 500
      description: Candidate handbook

    # Settings
    - name: auto_issue
      type: boolean
      default: true
      description: Automatically issue on completion
      
    - name: blockchain_enabled
      type: boolean
      default: false
      description: Anchor to blockchain
      
    - name: public_registry
      type: boolean
      default: true
      description: Include in public credential registry
      
    - name: template_id
      type: uuid
      foreign_key: certificate_template.id
      description: Default certificate template

    # Metadata
    - name: metadata
      type: jsonb
      description: Additional metadata
      
    - name: created_at
      type: timestamp
      auto: true
      
    - name: updated_at
      type: timestamp
      auto: true

  computed_fields:
    - name: total_certificates_issued
      formula: "COUNT(certificates WHERE status IN ('active', 'expired', 'renewed'))"
      
    - name: active_holders
      formula: "COUNT(DISTINCT holder_id FROM certificates WHERE status = 'active')"
      
    - name: completion_rate
      formula: "certificates_issued / enrollments * 100"

  relationships:
    - name: certificates
      type: has_many
      entity: certificate
      foreign_key: program_id
      
    - name: holders
      type: has_many
      entity: credential_holder
      through: certificates
      
    - name: default_template
      type: belongs_to
      entity: certificate_template
      foreign_key: template_id
      
    - name: ceu_records
      type: has_many
      entity: ceu_record
      foreign_key: program_id
      
    - name: replacement_program
      type: belongs_to
      entity: certification_program
      foreign_key: replacement_program_id

  validations:
    - field: certificate_validity_months
      rule: "certificate_validity_months > 0"
      when: "NOT is_lifetime"
      message: Validity period required if not lifetime
      
    - field: renewal_period_months
      rule: "renewal_period_months <= certificate_validity_months"
      when: "renewal_required AND NOT is_lifetime"
      message: Renewal period cannot exceed validity

  audit:
    enabled: true
    track_changes: true
