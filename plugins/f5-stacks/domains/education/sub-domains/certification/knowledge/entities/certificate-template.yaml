# Certificate Template Entity
# F5 Framework v2.0 - Education/Certification
# Design template for certificate rendering

entity:
  id: certificate_template
  name: Certificate Template
  name_ja: 証明書テンプレート
  domain: education
  subdomain: certification
  version: "1.0.0"
  
  description: |
    A design template that defines the visual layout, styling, and
    dynamic fields for rendering certificates. Supports multiple
    output formats and customization options.

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true
      
    - name: template_code
      type: string
      max_length: 50
      unique: true
      indexed: true
      
    - name: name
      type: string
      max_length: 200
      required: true
      
    - name: description
      type: text

    # Status
    - name: status
      type: enum
      values: [draft, active, archived]
      default: draft
      indexed: true
      
    - name: template_type
      type: enum
      values: [standard, custom, third_party, imported]
      default: standard

    # Association
    - name: program_id
      type: uuid
      foreign_key: certification_program.id
      indexed: true
      description: Specific program (null = shared)
      
    - name: organization_id
      type: uuid
      foreign_key: organization.id
      indexed: true
      description: Owning organization

    # Dimensions
    - name: orientation
      type: enum
      values: [landscape, portrait]
      default: landscape
      
    - name: size
      type: enum
      values: [a4, letter, legal, a3, custom]
      default: a4
      
    - name: width_mm
      type: decimal
      precision: 6
      scale: 2
      description: Custom width in millimeters
      
    - name: height_mm
      type: decimal
      precision: 6
      scale: 2
      description: Custom height in millimeters
      
    - name: width_px
      type: integer
      description: Rendered width in pixels
      
    - name: height_px
      type: integer
      description: Rendered height in pixels

    # Background
    - name: background_image_url
      type: string
      max_length: 500
      description: Background image URL
      
    - name: background_color
      type: string
      max_length: 7
      default: "#FFFFFF"
      description: Background color (hex)
      
    - name: border_style
      type: jsonb
      description: Border configuration
      schema:
        enabled: boolean
        width: integer
        color: string
        style: string

    # Layout
    - name: layout_json
      type: jsonb
      required: true
      description: Complete layout definition
      schema:
        version: string
        grid: object
        margins: object
        elements: array
        
    - name: layout_version
      type: string
      max_length: 20
      default: "1.0"

    # Dynamic Fields
    - name: fields
      type: jsonb
      required: true
      description: Dynamic field definitions
      schema:
        - field_name: string
          field_type: enum[text, image, date, qr_code, barcode, signature]
          label: string
          required: boolean
          default_value: string
          position:
            x: number
            y: number
            width: number
            height: number
          style:
            font_family: string
            font_size: number
            font_weight: string
            color: string
            alignment: enum[left, center, right]
            line_height: number
          format:
            date_format: string
            text_transform: enum[none, uppercase, lowercase, capitalize]
            max_length: integer

    # Standard Elements
    - name: logo_url
      type: string
      max_length: 500
      description: Organization logo
      
    - name: logo_position
      type: jsonb
      description: Logo placement coordinates
      
    - name: signature_url
      type: string
      max_length: 500
      description: Authorized signature image
      
    - name: signature_position
      type: jsonb
      
    - name: issuer_name
      type: string
      max_length: 200
      description: Name below signature
      
    - name: issuer_title
      type: string
      max_length: 200
      description: Title below signature
      
    - name: watermark_url
      type: string
      max_length: 500
      description: Watermark image
      
    - name: watermark_opacity
      type: decimal
      precision: 3
      scale: 2
      default: 0.1

    # QR/Verification
    - name: qr_code_enabled
      type: boolean
      default: true
      
    - name: qr_code_position
      type: jsonb
      
    - name: qr_code_size
      type: integer
      default: 80
      description: QR code size in pixels
      
    - name: verification_text
      type: string
      max_length: 500
      description: Text near QR code

    # Output Settings
    - name: output_format
      type: enum
      values: [pdf, png, svg, jpg]
      default: pdf
      
    - name: dpi
      type: integer
      default: 300
      description: Output resolution
      
    - name: compression_quality
      type: integer
      default: 90
      description: Image compression (1-100)

    # Fonts
    - name: fonts
      type: jsonb
      description: Custom fonts configuration
      schema:
        - name: string
          url: string
          format: string
          weight: string
          style: string
          
    - name: default_font
      type: string
      default: "Arial"

    # Localization
    - name: supported_languages
      type: array
      items: string
      default: ["en"]
      
    - name: localized_content
      type: jsonb
      description: Language-specific text

    # Preview
    - name: preview_url
      type: string
      max_length: 500
      description: Sample preview image
      
    - name: sample_data
      type: jsonb
      description: Sample data for preview

    # Metadata
    - name: version
      type: integer
      default: 1
      description: Template version number
      
    - name: created_by
      type: uuid
      foreign_key: user.id
      
    - name: created_at
      type: timestamp
      auto: true
      
    - name: updated_at
      type: timestamp
      auto: true

  computed_fields:
    - name: certificates_using
      formula: "COUNT(certificates WHERE template_id = id)"

  relationships:
    - name: program
      type: belongs_to
      entity: certification_program
      foreign_key: program_id
      
    - name: organization
      type: belongs_to
      entity: organization
      foreign_key: organization_id
      
    - name: certificates
      type: has_many
      entity: certificate
      foreign_key: template_id
      
    - name: creator
      type: belongs_to
      entity: user
      foreign_key: created_by

  validations:
    - field: width_mm
      rule: required
      when: "size = 'custom'"
      
    - field: height_mm
      rule: required
      when: "size = 'custom'"
      
    - field: dpi
      rule: "dpi IN (72, 150, 300)"
      message: DPI must be 72, 150, or 300

  standard_fields:
    - name: recipient_name
      required: true
      description: Certificate holder name
      
    - name: program_name
      required: true
      description: Certification program name
      
    - name: certificate_number
      required: true
      description: Unique certificate number
      
    - name: issue_date
      required: true
      description: Date of issuance
      
    - name: expiry_date
      required: false
      description: Expiration date
      
    - name: verification_code
      required: true
      description: Verification code
      
    - name: qr_code
      required: false
      description: QR code for verification
