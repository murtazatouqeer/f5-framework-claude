# Question Category Entity
# F5 Framework v2.0 - Education/Assessment
# Hierarchical categorization for questions

entity:
  id: question_category
  name: Question Category
  name_ja: 問題カテゴリ
  description: Hierarchical categorization system for organizing questions
  domain: education
  subdomain: assessment
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    # Basic Information
    name:
      type: string
      max_length: 200
      required: true
      
    description:
      type: text
      
    code:
      type: string
      max_length: 50
      unique: true
      
    # Hierarchy
    parent_id:
      type: uuid
      references: question_category
      description: Parent category for hierarchy
      
    question_bank_id:
      type: uuid
      references: question_bank
      required: true
      
    # Ordering
    display_order:
      type: integer
      default: 0
      
    depth:
      type: integer
      default: 0
      computed: true
      
    path:
      type: string
      max_length: 1000
      description: Full path from root (e.g., "Math/Algebra/Linear Equations")
      
    # Statistics
    question_count:
      type: integer
      default: 0
      computed: true
      
    total_question_count:
      type: integer
      default: 0
      computed: true
      description: Including all descendants
      
    # Status
    is_active:
      type: boolean
      default: true
      
    # Learning Objectives
    learning_objectives:
      type: array
      items:
        type: object
        properties:
          id: uuid
          description: text
          
    # Metadata
    color:
      type: string
      max_length: 7
      description: Display color (hex)
      
    icon:
      type: string
      max_length: 50
      
    # Timestamps
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  relationships:
    parent:
      type: belongs_to
      entity: question_category
      foreign_key: parent_id
      
    children:
      type: has_many
      entity: question_category
      foreign_key: parent_id
      
    question_bank:
      type: belongs_to
      entity: question_bank
      foreign_key: question_bank_id
      
    questions:
      type: has_many
      entity: question
      foreign_key: category_id

  indexes:
    - columns: [code]
      unique: true
    - columns: [question_bank_id, parent_id]
    - columns: [question_bank_id, display_order]
    - columns: [parent_id]

  validations:
    - name: no_self_reference
      condition: "id != parent_id"
      message: "Category cannot be its own parent"
      
    - name: max_depth
      condition: "depth <= 5"
      message: "Maximum category depth is 5 levels"

  audit:
    enabled: true
    track_changes: true
