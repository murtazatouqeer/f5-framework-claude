# Question Bank Entity
# F5 Framework v2.0 - Education/Assessment
# Repository for organizing and managing questions

entity:
  id: question_bank
  name: Question Bank
  name_ja: 問題バンク
  description: Repository for organizing, storing, and managing assessment questions
  domain: education
  subdomain: assessment
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    bank_code:
      type: string
      max_length: 50
      unique: true
      pattern: "^QB-[A-Z]{3}-[0-9]{4}$"
      
    # Basic Information
    name:
      type: string
      max_length: 200
      required: true
      
    description:
      type: text
      
    # Status
    status:
      type: enum
      values: [active, archived]
      default: active
      
    # Visibility
    visibility:
      type: enum
      values:
        - private       # Only owner can access
        - shared        # Shared with specific users/orgs
        - public        # Available to all
      default: private
      
    # Ownership
    owner_id:
      type: uuid
      required: true
      
    owner_type:
      type: enum
      values: [user, organization]
      required: true
      
    organization_id:
      type: uuid
      references: organization
      
    # Content Statistics
    total_questions:
      type: integer
      default: 0
      computed: true
      
    active_questions:
      type: integer
      default: 0
      computed: true
      
    questions_by_type:
      type: json
      description: Count of questions by type
      example:
        multiple_choice: 150
        essay: 25
        matching: 30
        
    questions_by_difficulty:
      type: json
      description: Count by difficulty level
      example:
        very_easy: 20
        easy: 50
        medium: 100
        hard: 40
        very_hard: 10
        
    # Categories
    categories:
      type: array
      items: uuid
      description: Associated category IDs
      
    root_category_id:
      type: uuid
      references: question_category
      
    # Sharing
    shared_with:
      type: array
      items:
        type: object
        properties:
          entity_type:
            type: enum
            values: [user, organization, course]
          entity_id: uuid
          permission:
            type: enum
            values: [view, use, edit, admin]
            
    # Settings
    allow_duplicates:
      type: boolean
      default: false
      
    enforce_review:
      type: boolean
      default: false
      description: Questions require review before activation
      
    # QTI Import/Export
    qti_package_url:
      type: string
      format: url
      description: Last exported QTI package
      
    last_export_at:
      type: datetime
      
    # Metadata
    tags:
      type: array
      items: string
      
    subject_area:
      type: string
      max_length: 100
      
    grade_level:
      type: string
      max_length: 50
      
    # Timestamps
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  relationships:
    questions:
      type: has_many
      entity: question
      foreign_key: question_bank_id
      
    categories:
      type: has_many
      entity: question_category
      foreign_key: question_bank_id
      
    root_category:
      type: belongs_to
      entity: question_category
      foreign_key: root_category_id
      
    organization:
      type: belongs_to
      entity: organization
      foreign_key: organization_id
      
    exam_pools:
      type: has_many
      entity: exam_pool
      foreign_key: question_bank_id

  indexes:
    - columns: [bank_code]
      unique: true
    - columns: [owner_id, owner_type]
    - columns: [organization_id, status]
    - columns: [visibility, status]
    - columns: [status]

  audit:
    enabled: true
    track_changes: true
