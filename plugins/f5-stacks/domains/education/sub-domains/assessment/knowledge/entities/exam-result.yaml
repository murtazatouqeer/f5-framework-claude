# Exam Result Entity
# F5 Framework v2.0 - Education/Assessment
# Final exam results and analytics

entity:
  id: exam_result
  name: Exam Result
  name_ja: 試験結果
  description: Final exam results with comprehensive scoring and analytics
  domain: education
  subdomain: assessment
  version: "1.0.0"

  attributes:
    id:
      type: uuid
      primary_key: true
      
    result_code:
      type: string
      max_length: 50
      unique: true
      pattern: "^RES-[0-9]{8}-[A-Z0-9]{6}$"
      
    # References
    attempt_id:
      type: uuid
      references: exam_attempt
      required: true
      unique: true
      
    exam_id:
      type: uuid
      references: exam
      required: true
      
    candidate_id:
      type: uuid
      references: user
      required: true
      
    # Overall Scores
    raw_score:
      type: decimal
      precision: 10
      scale: 2
      description: Sum of points earned
      
    total_possible:
      type: decimal
      precision: 10
      scale: 2
      description: Sum of points possible
      
    percentage_score:
      type: decimal
      precision: 5
      scale: 2
      
    scaled_score:
      type: decimal
      precision: 10
      scale: 2
      description: Standardized/normalized score
      
    percentile_rank:
      type: decimal
      precision: 5
      scale: 2
      
    # Grade
    grade:
      type: string
      max_length: 10
      
    grade_points:
      type: decimal
      precision: 3
      scale: 2
      description: GPA points if applicable
      
    # Pass/Fail
    passed:
      type: boolean
      
    passing_score:
      type: decimal
      precision: 10
      scale: 2
      
    margin:
      type: decimal
      precision: 10
      scale: 2
      description: Points above/below passing score
      
    # Score Breakdown
    section_scores:
      type: array
      items:
        type: object
        properties:
          section_id: uuid
          section_name: string
          raw_score: decimal
          total_possible: decimal
          percentage: decimal
          
    category_scores:
      type: array
      items:
        type: object
        properties:
          category_id: uuid
          category_name: string
          raw_score: decimal
          total_possible: decimal
          percentage: decimal
          
    # Question Type Breakdown
    scores_by_question_type:
      type: json
      example:
        multiple_choice:
          correct: 15
          total: 20
          percentage: 75
        essay:
          points: 18
          total: 25
          percentage: 72
          
    # Difficulty Analysis
    scores_by_difficulty:
      type: json
      example:
        easy:
          correct: 10
          total: 10
        medium:
          correct: 12
          total: 15
        hard:
          correct: 5
          total: 10
          
    # Bloom's Taxonomy Analysis
    scores_by_bloom_level:
      type: json
      example:
        remember: 95
        understand: 85
        apply: 70
        analyze: 65
        evaluate: 55
        create: 50
        
    # Timing Analysis
    total_time_seconds:
      type: integer
      
    average_time_per_question_seconds:
      type: integer
      
    time_analysis:
      type: json
      description: Time spent analysis
      example:
        by_section: {}
        by_difficulty: {}
        by_question_type: {}
        
    # Question Analysis
    questions_attempted:
      type: integer
      
    questions_correct:
      type: integer
      
    questions_incorrect:
      type: integer
      
    questions_partial:
      type: integer
      
    questions_skipped:
      type: integer
      
    # Learning Objectives
    learning_objective_scores:
      type: array
      items:
        type: object
        properties:
          objective_id: uuid
          objective_name: string
          score: decimal
          mastery_level: enum[not_achieved, developing, proficient, mastered]
          
    # Competencies
    competency_scores:
      type: array
      items:
        type: object
        properties:
          competency_id: uuid
          competency_name: string
          score: decimal
          
    # Strengths and Weaknesses
    strengths:
      type: array
      items: string
      description: Areas of strong performance
      
    weaknesses:
      type: array
      items: string
      description: Areas needing improvement
      
    recommendations:
      type: array
      items: string
      description: Study recommendations
      
    # Comparison (if available)
    cohort_average:
      type: decimal
      precision: 5
      scale: 2
      
    cohort_median:
      type: decimal
      precision: 5
      scale: 2
      
    cohort_std_dev:
      type: decimal
      precision: 5
      scale: 2
      
    rank_in_cohort:
      type: integer
      
    total_in_cohort:
      type: integer
      
    # Certification (if applicable)
    certification_earned:
      type: boolean
      default: false
      
    certification_id:
      type: uuid
      
    certificate_number:
      type: string
      max_length: 100
      
    certificate_url:
      type: string
      format: url
      
    certificate_issued_at:
      type: datetime
      
    certificate_expires_at:
      type: datetime
      
    # Publication
    released:
      type: boolean
      default: false
      
    released_at:
      type: datetime
      
    released_by:
      type: uuid
      references: user
      
    # Candidate Review
    candidate_viewed:
      type: boolean
      default: false
      
    candidate_viewed_at:
      type: datetime
      
    # Appeals
    appeal_status:
      type: enum
      values: [none, pending, under_review, approved, denied]
      default: none
      
    appeal_deadline:
      type: datetime
      
    # Report Generation
    report_url:
      type: string
      format: url
      
    detailed_report_url:
      type: string
      format: url
      
    # Metadata
    calculated_at:
      type: datetime
      
    recalculated_at:
      type: datetime
      
    notes:
      type: text
      
    # Timestamps
    created_at:
      type: datetime
      auto_set: create
      
    updated_at:
      type: datetime
      auto_set: update

  computed_fields:
    accuracy_rate:
      formula: "questions_correct / questions_attempted * 100"
      type: decimal
      
    completion_rate:
      formula: "questions_attempted / (questions_attempted + questions_skipped) * 100"
      type: decimal
      
    is_above_average:
      formula: "percentage_score > cohort_average"
      type: boolean

  relationships:
    attempt:
      type: belongs_to
      entity: exam_attempt
      foreign_key: attempt_id
      
    exam:
      type: belongs_to
      entity: exam
      foreign_key: exam_id
      
    candidate:
      type: belongs_to
      entity: user
      foreign_key: candidate_id
      
    releaser:
      type: belongs_to
      entity: user
      foreign_key: released_by

  indexes:
    - columns: [result_code]
      unique: true
    - columns: [attempt_id]
      unique: true
    - columns: [exam_id, candidate_id]
    - columns: [candidate_id, created_at]
    - columns: [exam_id, percentage_score]
    - columns: [released, exam_id]

  audit:
    enabled: true
    track_changes: true
