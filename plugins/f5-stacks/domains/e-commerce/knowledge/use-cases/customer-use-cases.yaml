name: Customer Use Cases
display_name: Customer Use Cases / Ca sử dụng khách hàng
description: |
  Use cases for e-commerce customers including shopping, ordering,
  account management, and post-purchase interactions.

domain: e-commerce
actor: Customer
version: "1.0"

use_cases:
  # Account Management
  - id: UC-CUS-001
    name: Register Account
    name_vi: Đăng ký tài khoản
    description: Customer creates a new account
    actor: Guest
    preconditions:
      - User is not logged in
      - Valid email not already registered
    main_flow:
      1: User navigates to registration page
      2: User enters email, password, and basic info
      3: System validates email format and uniqueness
      4: System sends verification email
      5: User clicks verification link
      6: System activates account
      7: User is redirected to homepage
    alternative_flows:
      - id: 2a
        condition: User chooses social login
        steps:
          1: Redirect to social provider
          2: User authorizes access
          3: System creates account with social data
          4: Account activated immediately
    postconditions:
      - Account created with status 'active'
      - Customer receives welcome email
      - Customer can log in
    business_rules: [BR-CUS-001, BR-CUS-002, BR-CUS-004]
    related_entities: [Customer]

  - id: UC-CUS-002
    name: Login
    name_vi: Đăng nhập
    description: Customer logs into existing account
    actor: Customer
    preconditions:
      - Account exists
      - Account is active (not suspended/banned)
    main_flow:
      1: User navigates to login page
      2: User enters email and password
      3: System validates credentials
      4: System checks account status
      5: System creates session
      6: User is redirected to intended page or homepage
    alternative_flows:
      - id: 3a
        condition: Invalid credentials
        steps:
          1: Display error message
          2: Increment failed attempt counter
          3: Lock account if threshold reached (BR-CUS-005)
      - id: 2b
        condition: Social login
        steps:
          1: Redirect to social provider
          2: User authorizes
          3: System matches account
          4: Create session
    postconditions:
      - Session created
      - last_login_at updated
      - Cart merged if applicable
    business_rules: [BR-CUS-005, BR-CUS-009]
    related_entities: [Customer, Cart]

  - id: UC-CUS-003
    name: Manage Profile
    name_vi: Quản lý hồ sơ
    description: Customer updates profile information
    actor: Customer
    preconditions:
      - Customer is logged in
    main_flow:
      1: Customer navigates to profile settings
      2: System displays current profile data
      3: Customer modifies desired fields
      4: Customer submits changes
      5: System validates input
      6: System saves changes
      7: Confirmation displayed
    alternative_flows:
      - id: 3a
        condition: Email change
        steps:
          1: System sends verification to new email
          2: Customer verifies new email
          3: Email updated after verification
      - id: 3b
        condition: Password change
        steps:
          1: Customer enters current password
          2: Customer enters new password twice
          3: System validates current password
          4: System updates password hash
    postconditions:
      - Profile updated
      - updated_at timestamp set
    related_entities: [Customer]

  - id: UC-CUS-004
    name: Manage Addresses
    name_vi: Quản lý địa chỉ
    description: Customer manages shipping/billing addresses
    actor: Customer
    preconditions:
      - Customer is logged in
    main_flow:
      1: Customer navigates to address book
      2: System displays saved addresses
      3: Customer selects action (add/edit/delete/set default)
      4: Customer completes action
      5: System validates and saves
    alternative_flows:
      - id: 3a
        condition: Add new address
        steps:
          1: Customer enters address details
          2: System validates address format
          3: System saves address
          4: If first address, set as default
      - id: 3b
        condition: Set as default
        steps:
          1: System removes default from other addresses
          2: System sets selected as default
      - id: 3c
        condition: Delete address
        steps:
          1: Check if used in pending orders
          2: Archive if used, delete if not
          3: Promote next address to default if deleting default
    postconditions:
      - Address book updated
      - One default shipping, one default billing maintained
    business_rules: [BR-ADR-001, BR-ADR-002, BR-ADR-003, BR-ADR-004, BR-ADR-008]
    related_entities: [Address, Customer]

  # Shopping
  - id: UC-CUS-010
    name: Browse Products
    name_vi: Duyệt sản phẩm
    description: Customer browses product catalog
    actor: Customer/Guest
    preconditions:
      - None
    main_flow:
      1: User navigates to catalog/category
      2: System displays product listing
      3: User applies filters (price, brand, etc.)
      4: System updates product list
      5: User sorts results (price, popularity, etc.)
      6: User views product details by clicking
    alternative_flows:
      - id: 1a
        condition: Search
        steps:
          1: User enters search query
          2: System returns matching products
          3: User refines with filters
    postconditions:
      - Products displayed based on criteria
    related_entities: [Product, Category, ProductVariant]

  - id: UC-CUS-011
    name: View Product Details
    name_vi: Xem chi tiết sản phẩm
    description: Customer views detailed product information
    actor: Customer/Guest
    preconditions:
      - Product exists and is active
    main_flow:
      1: User clicks on product
      2: System displays product page
      3: User views images, description, specs
      4: User selects variant (if applicable)
      5: System updates price and availability
      6: User reads reviews
    alternative_flows:
      - id: 4a
        condition: Out of stock
        steps:
          1: Display out of stock message
          2: Offer notify when available option
          3: Show similar products
    postconditions:
      - Product view recorded for analytics
    related_entities: [Product, ProductVariant, Review, Inventory]

  - id: UC-CUS-012
    name: Add to Cart
    name_vi: Thêm vào giỏ hàng
    description: Customer adds product to shopping cart
    actor: Customer/Guest
    preconditions:
      - Product is active and in stock
    main_flow:
      1: User selects variant and quantity
      2: User clicks "Add to Cart"
      3: System validates stock availability
      4: System adds item to cart
      5: System displays confirmation
      6: User continues shopping or proceeds to checkout
    alternative_flows:
      - id: 3a
        condition: Insufficient stock
        steps:
          1: Display available quantity
          2: Offer to add available amount
      - id: 4a
        condition: Item already in cart
        steps:
          1: Increment quantity instead of new line
    postconditions:
      - Item added to cart
      - Cart totals updated
    business_rules: [BR-CTI-001, BR-CTI-002, BR-CTI-004, BR-CTI-005]
    related_entities: [Cart, CartItem, Product, Inventory]

  - id: UC-CUS-013
    name: Manage Cart
    name_vi: Quản lý giỏ hàng
    description: Customer views and modifies shopping cart
    actor: Customer/Guest
    preconditions:
      - Cart has items
    main_flow:
      1: User navigates to cart
      2: System displays cart items with details
      3: User modifies quantities
      4: System validates and updates totals
      5: User removes unwanted items
      6: System recalculates totals
    alternative_flows:
      - id: 3a
        condition: Price changed since adding
        steps:
          1: Display price change notice
          2: Show new price
          3: User confirms or removes
      - id: 3b
        condition: Item now out of stock
        steps:
          1: Display out of stock notice
          2: Remove or move to wishlist
    postconditions:
      - Cart updated
      - Totals recalculated
    business_rules: [BR-CTI-003, BR-CTI-006]
    related_entities: [Cart, CartItem]

  # Checkout
  - id: UC-CUS-020
    name: Checkout
    name_vi: Thanh toán
    description: Customer completes purchase checkout
    actor: Customer
    preconditions:
      - Cart has valid items
      - Items in stock
    main_flow:
      1: User initiates checkout
      2: System reserves inventory
      3: User enters/selects shipping address
      4: User selects shipping method
      5: User applies coupon (optional)
      6: User reviews order summary
      7: User selects payment method
      8: User submits order
      9: System processes payment
      10: System creates order
      11: User sees confirmation
    alternative_flows:
      - id: 3a
        condition: Guest checkout
        steps:
          1: User enters email
          2: User enters shipping info
          3: Offer to create account
      - id: 9a
        condition: Payment fails
        steps:
          1: Display error message
          2: Allow retry or different method
    postconditions:
      - Order created
      - Payment captured or authorized
      - Confirmation email sent
      - Cart cleared
    business_rules: [BR-ORD-001 through BR-ORD-014]
    related_entities: [Order, OrderItem, Payment, Cart, Address]
    related_workflows: [checkout-workflow, payment-workflow]

  - id: UC-CUS-021
    name: Apply Coupon
    name_vi: Áp dụng mã giảm giá
    description: Customer applies discount coupon
    actor: Customer
    preconditions:
      - Active checkout or cart
      - Valid coupon code
    main_flow:
      1: User enters coupon code
      2: System validates coupon
      3: System checks eligibility
      4: System applies discount
      5: Totals updated
    alternative_flows:
      - id: 2a
        condition: Invalid/expired coupon
        steps:
          1: Display error message
          2: Coupon not applied
      - id: 3a
        condition: Not eligible
        steps:
          1: Display eligibility requirements
          2: Coupon not applied
    postconditions:
      - Discount applied to order
      - Coupon usage recorded
    business_rules: [BR-PRO-001 through BR-PRO-023]
    related_entities: [Coupon, Order]

  # Order Management
  - id: UC-CUS-030
    name: View Orders
    name_vi: Xem đơn hàng
    description: Customer views order history
    actor: Customer
    preconditions:
      - Customer is logged in
    main_flow:
      1: User navigates to orders
      2: System displays order list
      3: User selects order
      4: System displays order details
    postconditions:
      - Order details displayed
    related_entities: [Order, OrderItem]

  - id: UC-CUS-031
    name: Track Order
    name_vi: Theo dõi đơn hàng
    description: Customer tracks order shipment
    actor: Customer
    preconditions:
      - Order exists
      - Order has been shipped
    main_flow:
      1: User navigates to order details
      2: User clicks track shipment
      3: System displays tracking info
      4: User views delivery status and history
    alternative_flows:
      - id: 3a
        condition: External tracking
        steps:
          1: Redirect to carrier tracking page
    postconditions:
      - Tracking information displayed
    related_entities: [Order, Shipment]

  - id: UC-CUS-032
    name: Cancel Order
    name_vi: Hủy đơn hàng
    description: Customer cancels an order
    actor: Customer
    preconditions:
      - Order in cancellable state
      - Order not yet shipped
    main_flow:
      1: User navigates to order
      2: User clicks cancel order
      3: User selects cancellation reason
      4: User confirms cancellation
      5: System cancels order
      6: System initiates refund if paid
    postconditions:
      - Order cancelled
      - Inventory released
      - Refund initiated if applicable
    business_rules: [BR-ORD-030, BR-ORD-031, BR-ORD-032, BR-ORD-033]
    related_entities: [Order, Inventory, Refund]

  - id: UC-CUS-033
    name: Request Return
    name_vi: Yêu cầu đổi trả
    description: Customer requests product return
    actor: Customer
    preconditions:
      - Order delivered
      - Within return window
      - Product is returnable
    main_flow:
      1: User navigates to order
      2: User selects items to return
      3: User chooses return reason
      4: User uploads photos (if required)
      5: User submits return request
      6: System validates eligibility
      7: System approves/queues for review
      8: User receives return instructions
    postconditions:
      - Return request created
      - Customer notified of next steps
    business_rules: [BR-RET-001 through BR-RET-013]
    related_entities: [Return, ReturnItem, Order]
    related_workflows: [return-refund-workflow]

  # Reviews and Wishlist
  - id: UC-CUS-040
    name: Write Review
    name_vi: Viết đánh giá
    description: Customer writes product review
    actor: Customer
    preconditions:
      - Customer logged in
      - Customer purchased product (for verified review)
    main_flow:
      1: User navigates to product or order
      2: User clicks write review
      3: User selects star rating
      4: User writes review text
      5: User adds photos/videos (optional)
      6: User submits review
      7: System validates and queues for moderation
    postconditions:
      - Review created in pending status
      - Notification to moderation queue
    business_rules: [BR-REV-001 through BR-REV-011]
    related_entities: [Review, Product, Order]

  - id: UC-CUS-041
    name: Manage Wishlist
    name_vi: Quản lý danh sách yêu thích
    description: Customer manages product wishlist
    actor: Customer
    preconditions:
      - Customer is logged in
    main_flow:
      1: User navigates to wishlist
      2: System displays wishlist items
      3: User performs action (add/remove/move to cart)
    alternative_flows:
      - id: 3a
        condition: Add from product page
        steps:
          1: Click wishlist icon
          2: Select wishlist or create new
          3: Item added to wishlist
      - id: 3b
        condition: Move to cart
        steps:
          1: Select items
          2: Click move to cart
          3: Items added to cart, optional remove from wishlist
    postconditions:
      - Wishlist updated
    business_rules: [BR-WIS-001 through BR-WIS-010]
    related_entities: [Wishlist, WishlistItem, Product, Cart]

  # Loyalty
  - id: UC-CUS-050
    name: View Loyalty Status
    name_vi: Xem trạng thái thành viên
    description: Customer views loyalty program status
    actor: Customer
    preconditions:
      - Customer is logged in
    main_flow:
      1: User navigates to loyalty page
      2: System displays current tier and points
      3: System shows progress to next tier
      4: System displays available rewards
      5: User views points history
    postconditions:
      - Loyalty information displayed
    related_entities: [Customer]

  - id: UC-CUS-051
    name: Redeem Points
    name_vi: Đổi điểm thưởng
    description: Customer redeems loyalty points
    actor: Customer
    preconditions:
      - Customer has points to redeem
      - Active checkout
    main_flow:
      1: During checkout, user sees points balance
      2: User enters points to redeem
      3: System validates available points
      4: System calculates discount
      5: Discount applied to order
    postconditions:
      - Points deducted
      - Discount applied
    business_rules: [BR-PRO-070, BR-PRO-071, BR-PRO-072]
    related_entities: [Customer, Order]

non_functional_requirements:
  - Page load time < 2 seconds
  - Checkout process < 3 minutes
  - Mobile responsive design
  - WCAG 2.1 AA accessibility
  - PCI DSS compliance for payments
