# B2C Retail E-Commerce Domain Entities

entities:
  # Product Management
  - name: Product
    description: Core product entity representing items for sale
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: sku
        type: string
        required: true
        unique: true
        description: Stock Keeping Unit
      - name: name
        type: string
        required: true
        max_length: 255
      - name: slug
        type: string
        required: true
        unique: true
        description: URL-friendly identifier
      - name: description
        type: text
        description: Full product description
      - name: short_description
        type: string
        max_length: 500
      - name: base_price
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: sale_price
        type: decimal
        precision: 10
        scale: 2
        nullable: true
      - name: cost_price
        type: decimal
        precision: 10
        scale: 2
        description: Cost for margin calculation
      - name: currency
        type: string
        length: 3
        default: "USD"
      - name: status
        type: enum
        values: [draft, active, inactive, archived]
        default: draft
      - name: visibility
        type: enum
        values: [visible, hidden, catalog_only, search_only]
        default: visible
      - name: tax_class
        type: string
        default: "standard"
      - name: weight
        type: decimal
        description: Weight in grams
      - name: dimensions
        type: json
        description: "{ length, width, height, unit }"
      - name: meta_title
        type: string
        max_length: 70
      - name: meta_description
        type: string
        max_length: 160
      - name: featured
        type: boolean
        default: false
      - name: sort_order
        type: integer
        default: 0
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: Brand
        foreign_key: brand_id
      - type: belongs_to_many
        entity: Category
        pivot_table: product_categories
      - type: has_many
        entity: ProductVariant
      - type: has_many
        entity: ProductImage
      - type: has_many
        entity: ProductReview
      - type: belongs_to_many
        entity: Tag
        pivot_table: product_tags
    indexes:
      - columns: [sku]
        unique: true
      - columns: [slug]
        unique: true
      - columns: [status, visibility]
      - columns: [created_at]
      - columns: [base_price]

  - name: ProductVariant
    description: Product variations (size, color, etc.)
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: product_id
        type: uuid
        required: true
      - name: sku
        type: string
        required: true
        unique: true
      - name: name
        type: string
        max_length: 255
      - name: price_adjustment
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: stock_quantity
        type: integer
        default: 0
      - name: low_stock_threshold
        type: integer
        default: 5
      - name: weight_adjustment
        type: decimal
        default: 0
      - name: status
        type: enum
        values: [active, inactive]
        default: active
      - name: options
        type: json
        description: "{ color: 'Red', size: 'XL' }"
    relationships:
      - type: belongs_to
        entity: Product
      - type: has_many
        entity: CartItem
      - type: has_many
        entity: OrderItem
    indexes:
      - columns: [product_id, sku]
        unique: true

  - name: Category
    description: Product categorization hierarchy
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: parent_id
        type: uuid
        nullable: true
      - name: name
        type: string
        required: true
        max_length: 100
      - name: slug
        type: string
        required: true
        unique: true
      - name: description
        type: text
      - name: image_url
        type: string
      - name: level
        type: integer
        default: 0
      - name: path
        type: string
        description: Materialized path for hierarchy
      - name: sort_order
        type: integer
        default: 0
      - name: is_active
        type: boolean
        default: true
      - name: meta_title
        type: string
        max_length: 70
      - name: meta_description
        type: string
        max_length: 160
    relationships:
      - type: belongs_to
        entity: Category
        self_referencing: true
        foreign_key: parent_id
      - type: has_many
        entity: Category
        self_referencing: true
      - type: belongs_to_many
        entity: Product
        pivot_table: product_categories

  # Customer Management
  - name: Customer
    description: Registered customer account
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: email
        type: string
        required: true
        unique: true
      - name: password_hash
        type: string
        required: true
      - name: first_name
        type: string
        max_length: 100
      - name: last_name
        type: string
        max_length: 100
      - name: phone
        type: string
        max_length: 20
      - name: date_of_birth
        type: date
        nullable: true
      - name: gender
        type: enum
        values: [male, female, other, prefer_not_to_say]
        nullable: true
      - name: status
        type: enum
        values: [active, suspended, pending_verification]
        default: pending_verification
      - name: email_verified_at
        type: timestamp
        nullable: true
      - name: accepts_marketing
        type: boolean
        default: false
      - name: locale
        type: string
        length: 5
        default: "en-US"
      - name: currency
        type: string
        length: 3
        default: "USD"
      - name: last_login_at
        type: timestamp
        nullable: true
      - name: total_orders
        type: integer
        default: 0
      - name: total_spent
        type: decimal
        precision: 12
        scale: 2
        default: 0
      - name: loyalty_points
        type: integer
        default: 0
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: has_many
        entity: Address
      - type: has_many
        entity: Order
      - type: has_one
        entity: Cart
      - type: has_many
        entity: Wishlist
      - type: has_many
        entity: ProductReview
      - type: belongs_to
        entity: CustomerGroup
        nullable: true
    indexes:
      - columns: [email]
        unique: true
      - columns: [phone]
      - columns: [status]

  - name: Address
    description: Customer shipping/billing addresses
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: customer_id
        type: uuid
        required: true
      - name: type
        type: enum
        values: [shipping, billing, both]
        default: both
      - name: is_default
        type: boolean
        default: false
      - name: first_name
        type: string
        max_length: 100
        required: true
      - name: last_name
        type: string
        max_length: 100
        required: true
      - name: company
        type: string
        max_length: 200
        nullable: true
      - name: address_line_1
        type: string
        max_length: 255
        required: true
      - name: address_line_2
        type: string
        max_length: 255
        nullable: true
      - name: city
        type: string
        max_length: 100
        required: true
      - name: state
        type: string
        max_length: 100
      - name: postal_code
        type: string
        max_length: 20
        required: true
      - name: country_code
        type: string
        length: 2
        required: true
      - name: phone
        type: string
        max_length: 20
    relationships:
      - type: belongs_to
        entity: Customer

  # Order Management
  - name: Order
    description: Customer order record
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: order_number
        type: string
        required: true
        unique: true
        description: Human-readable order identifier
      - name: customer_id
        type: uuid
        nullable: true
        description: Null for guest checkout
      - name: customer_email
        type: string
        required: true
      - name: status
        type: enum
        values: [pending, confirmed, processing, shipped, delivered, cancelled, refunded]
        default: pending
      - name: payment_status
        type: enum
        values: [pending, authorized, paid, partially_refunded, refunded, failed]
        default: pending
      - name: fulfillment_status
        type: enum
        values: [unfulfilled, partially_fulfilled, fulfilled, shipped, delivered]
        default: unfulfilled
      - name: subtotal
        type: decimal
        precision: 12
        scale: 2
        required: true
      - name: discount_total
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: shipping_total
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: tax_total
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: grand_total
        type: decimal
        precision: 12
        scale: 2
        required: true
      - name: currency
        type: string
        length: 3
        required: true
      - name: shipping_address
        type: json
        required: true
      - name: billing_address
        type: json
        required: true
      - name: shipping_method
        type: string
      - name: shipping_carrier
        type: string
        nullable: true
      - name: tracking_number
        type: string
        nullable: true
      - name: notes
        type: text
        nullable: true
      - name: customer_notes
        type: text
        nullable: true
      - name: ip_address
        type: string
      - name: user_agent
        type: string
      - name: placed_at
        type: timestamp
        required: true
      - name: confirmed_at
        type: timestamp
        nullable: true
      - name: shipped_at
        type: timestamp
        nullable: true
      - name: delivered_at
        type: timestamp
        nullable: true
      - name: cancelled_at
        type: timestamp
        nullable: true
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: Customer
        nullable: true
      - type: has_many
        entity: OrderItem
      - type: has_many
        entity: Payment
      - type: has_many
        entity: Shipment
      - type: has_many
        entity: OrderNote
      - type: belongs_to_many
        entity: Coupon
        pivot_table: order_coupons
    indexes:
      - columns: [order_number]
        unique: true
      - columns: [customer_id]
      - columns: [customer_email]
      - columns: [status]
      - columns: [payment_status]
      - columns: [placed_at]

  - name: OrderItem
    description: Individual items within an order
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: order_id
        type: uuid
        required: true
      - name: product_id
        type: uuid
        required: true
      - name: variant_id
        type: uuid
        nullable: true
      - name: sku
        type: string
        required: true
      - name: name
        type: string
        required: true
      - name: options
        type: json
        description: Variant options at time of purchase
      - name: quantity
        type: integer
        required: true
        min: 1
      - name: unit_price
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: subtotal
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: discount_amount
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: tax_amount
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: total
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: fulfilled_quantity
        type: integer
        default: 0
      - name: refunded_quantity
        type: integer
        default: 0
    relationships:
      - type: belongs_to
        entity: Order
      - type: belongs_to
        entity: Product
      - type: belongs_to
        entity: ProductVariant
        nullable: true

  # Cart & Checkout
  - name: Cart
    description: Shopping cart for active sessions
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: customer_id
        type: uuid
        nullable: true
      - name: session_id
        type: string
        description: For guest carts
      - name: status
        type: enum
        values: [active, abandoned, converted, merged]
        default: active
      - name: currency
        type: string
        length: 3
        default: "USD"
      - name: subtotal
        type: decimal
        precision: 12
        scale: 2
        default: 0
      - name: discount_total
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: tax_total
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: grand_total
        type: decimal
        precision: 12
        scale: 2
        default: 0
      - name: item_count
        type: integer
        default: 0
      - name: coupon_code
        type: string
        nullable: true
      - name: notes
        type: text
        nullable: true
      - name: expires_at
        type: timestamp
        nullable: true
      - name: converted_at
        type: timestamp
        nullable: true
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: Customer
        nullable: true
      - type: has_many
        entity: CartItem
      - type: belongs_to
        entity: Coupon
        nullable: true
    indexes:
      - columns: [customer_id]
      - columns: [session_id]
      - columns: [status]
      - columns: [expires_at]

  - name: CartItem
    description: Individual items in shopping cart
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: cart_id
        type: uuid
        required: true
      - name: product_id
        type: uuid
        required: true
      - name: variant_id
        type: uuid
        nullable: true
      - name: quantity
        type: integer
        required: true
        min: 1
      - name: unit_price
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: subtotal
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: custom_options
        type: json
        nullable: true
      - name: added_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: Cart
      - type: belongs_to
        entity: Product
      - type: belongs_to
        entity: ProductVariant
        nullable: true

  # Payments
  - name: Payment
    description: Payment transactions for orders
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: order_id
        type: uuid
        required: true
      - name: payment_method
        type: string
        required: true
        description: "stripe, paypal, cod, bank_transfer"
      - name: transaction_id
        type: string
        nullable: true
        description: External payment gateway transaction ID
      - name: status
        type: enum
        values: [pending, processing, completed, failed, cancelled, refunded]
        default: pending
      - name: amount
        type: decimal
        precision: 12
        scale: 2
        required: true
      - name: currency
        type: string
        length: 3
        required: true
      - name: fee_amount
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: refund_amount
        type: decimal
        precision: 10
        scale: 2
        default: 0
      - name: gateway_response
        type: json
        nullable: true
      - name: error_message
        type: string
        nullable: true
      - name: paid_at
        type: timestamp
        nullable: true
      - name: refunded_at
        type: timestamp
        nullable: true
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: Order
      - type: has_many
        entity: Refund
    indexes:
      - columns: [order_id]
      - columns: [transaction_id]
      - columns: [status]

  # Promotions & Coupons
  - name: Coupon
    description: Discount coupon codes
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: code
        type: string
        required: true
        unique: true
      - name: name
        type: string
        max_length: 200
      - name: description
        type: text
      - name: type
        type: enum
        values: [percentage, fixed_amount, free_shipping, buy_x_get_y]
        required: true
      - name: value
        type: decimal
        precision: 10
        scale: 2
        required: true
      - name: minimum_order_amount
        type: decimal
        precision: 10
        scale: 2
        nullable: true
      - name: maximum_discount_amount
        type: decimal
        precision: 10
        scale: 2
        nullable: true
      - name: usage_limit
        type: integer
        nullable: true
      - name: usage_limit_per_customer
        type: integer
        default: 1
      - name: usage_count
        type: integer
        default: 0
      - name: is_active
        type: boolean
        default: true
      - name: applies_to
        type: enum
        values: [all, specific_products, specific_categories]
        default: all
      - name: applicable_ids
        type: json
        description: Product or category IDs when not "all"
      - name: starts_at
        type: timestamp
        required: true
      - name: expires_at
        type: timestamp
        nullable: true
      - name: created_at
        type: timestamp
        required: true
      - name: updated_at
        type: timestamp
        required: true
    indexes:
      - columns: [code]
        unique: true
      - columns: [is_active, starts_at, expires_at]

  # Inventory
  - name: Inventory
    description: Product stock levels by location
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: variant_id
        type: uuid
        required: true
      - name: location_id
        type: uuid
        required: true
      - name: quantity
        type: integer
        default: 0
      - name: reserved_quantity
        type: integer
        default: 0
        description: Quantity reserved for pending orders
      - name: available_quantity
        type: integer
        computed: true
        description: quantity - reserved_quantity
      - name: low_stock_threshold
        type: integer
        default: 10
      - name: updated_at
        type: timestamp
        required: true
    relationships:
      - type: belongs_to
        entity: ProductVariant
      - type: belongs_to
        entity: InventoryLocation
    indexes:
      - columns: [variant_id, location_id]
        unique: true

  - name: InventoryLocation
    description: Warehouse or store locations
    attributes:
      - name: id
        type: uuid
        primary_key: true
      - name: name
        type: string
        required: true
      - name: code
        type: string
        unique: true
      - name: type
        type: enum
        values: [warehouse, store, dropship]
        default: warehouse
      - name: address
        type: json
      - name: is_active
        type: boolean
        default: true
      - name: priority
        type: integer
        default: 0
        description: Order fulfillment priority

# Indexes optimization hints
global_indexes:
  - table: products
    name: idx_products_search
    type: fulltext
    columns: [name, description]

  - table: orders
    name: idx_orders_date_status
    columns: [placed_at, status]

  - table: customers
    name: idx_customers_email_status
    columns: [email, status]

# Audit columns (applied to all entities)
audit_columns:
  - name: created_at
    type: timestamp
    auto: insert
  - name: updated_at
    type: timestamp
    auto: update
  - name: deleted_at
    type: timestamp
    nullable: true
    soft_delete: true
