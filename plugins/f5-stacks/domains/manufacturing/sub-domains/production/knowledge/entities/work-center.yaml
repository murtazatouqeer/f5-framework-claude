name: work-center
display_name: Work Center
display_name_vi: Trung tâm làm việc
version: "1.0"
domain: manufacturing
subdomain: production
type: entity

description: |
  Work center represents a logical grouping of machines or resources
  where production operations are performed. Used for scheduling and costing.

description_vi: |
  Trung tâm làm việc đại diện cho nhóm logic các máy móc hoặc tài nguyên
  nơi các công đoạn sản xuất được thực hiện. Dùng cho lập lịch và tính chi phí.

attributes:
  identification:
    - name: id
      type: uuid
      required: true

    - name: work_center_code
      type: string
      required: true
      unique: true
      pattern: "^WC-[A-Z0-9-]+$"
      description: Work center code
      description_vi: Mã trung tâm làm việc

    - name: name
      type: string
      required: true
      description: Work center name
      description_vi: Tên trung tâm làm việc

    - name: description
      type: text
      description: Description
      description_vi: Mô tả

    - name: status
      type: enum
      required: true
      default: active
      values:
        - active: Operational
        - inactive: Not in use
        - maintenance: Under maintenance
      description_vi: Trạng thái

    - name: work_center_type
      type: enum
      required: true
      values:
        - machine: Machine-based
        - assembly: Assembly line
        - manual: Manual operations
        - inspection: Quality inspection
        - packaging: Packaging
        - subcontract: External subcontract
      description_vi: Loại trung tâm

  location:
    - name: plant_id
      type: uuid
      required: true
      description: Manufacturing plant
      description_vi: Nhà máy

    - name: building
      type: string
      description: Building name/number
      description_vi: Tòa nhà

    - name: area
      type: string
      description: Production area
      description_vi: Khu vực

    - name: line
      type: string
      description: Production line
      description_vi: Dây chuyền

  capacity:
    - name: capacity_per_day
      type: decimal
      required: true
      description: Standard capacity per day
      description_vi: Công suất mỗi ngày

    - name: capacity_unit
      type: string
      required: true
      description: Capacity unit of measure
      description_vi: Đơn vị công suất

    - name: available_hours_per_day
      type: decimal
      required: true
      default: 8
      description: Available hours per day
      description_vi: Giờ khả dụng mỗi ngày

    - name: shifts_per_day
      type: integer
      default: 1
      description: Number of shifts
      description_vi: Số ca mỗi ngày

    - name: efficiency_percent
      type: decimal
      default: 100
      min: 0
      max: 150
      description: Efficiency factor
      description_vi: Hệ số hiệu suất

    - name: utilization_percent
      type: decimal
      default: 85
      description: Target utilization
      description_vi: Mục tiêu sử dụng

  scheduling:
    - name: calendar_id
      type: uuid
      description: Working calendar
      description_vi: Lịch làm việc

    - name: scheduling_method
      type: enum
      default: finite
      values:
        - finite: Respect capacity limits
        - infinite: Unlimited capacity
        - bottleneck: Bottleneck scheduling
      description_vi: Phương pháp lập lịch

    - name: queue_time_default
      type: decimal
      default: 0
      description: Default queue time (minutes)
      description_vi: Thời gian chờ mặc định

    - name: move_time_default
      type: decimal
      default: 0
      description: Default move time (minutes)

    - name: batch_overlap_allowed
      type: boolean
      default: false
      description: Allow batch overlap

  costing:
    - name: hourly_rate
      type: decimal
      precision: 10
      scale: 4
      description: Hourly labor rate
      description_vi: Chi phí nhân công/giờ

    - name: setup_rate
      type: decimal
      precision: 10
      scale: 4
      description: Setup/changeover rate
      description_vi: Chi phí cài đặt/giờ

    - name: machine_rate
      type: decimal
      precision: 10
      scale: 4
      description: Machine running rate
      description_vi: Chi phí máy/giờ

    - name: overhead_rate
      type: decimal
      precision: 10
      scale: 4
      description: Overhead rate
      description_vi: Chi phí chung/giờ

    - name: cost_center_id
      type: string
      description: GL cost center

  resources:
    - name: machine_count
      type: integer
      default: 1
      description: Number of machines
      description_vi: Số máy

    - name: operator_count
      type: integer
      default: 1
      description: Operators required
      description_vi: Số công nhân cần

    - name: tool_groups
      type: array
      item_type: string
      description: Required tool groups

  performance:
    - name: oee_target
      type: decimal
      default: 85
      min: 0
      max: 100
      description: OEE target percentage
      description_vi: Mục tiêu OEE

    - name: current_oee
      type: decimal
      description: Current OEE
      description_vi: OEE hiện tại

    - name: mtbf_hours
      type: decimal
      description: Mean time between failures
      description_vi: Thời gian trung bình giữa hỏng hóc

    - name: mttr_hours
      type: decimal
      description: Mean time to repair
      description_vi: Thời gian trung bình sửa chữa

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: created_by
      type: uuid

    - name: updated_at
      type: timestamp
      auto: true

    - name: updated_by
      type: uuid

relationships:
  - name: machines
    type: has_many
    entity: machine
    foreign_key: work_center_id
    description: Machines in this work center

  - name: operations
    type: has_many
    entity: operation
    foreign_key: work_center_id
    description: Operations at this work center

  - name: schedules
    type: has_many
    entity: production_schedule
    foreign_key: work_center_id
    description: Production schedules

  - name: shifts
    type: has_many
    entity: shift
    foreign_key: work_center_id
    description: Shifts assigned

indexes:
  - columns: [work_center_code]
    unique: true
  - columns: [plant_id, status]
  - columns: [work_center_type]

validation_rules:
  - rule: "capacity_per_day > 0"
    message: "Capacity must be positive"

  - rule: "available_hours_per_day > 0 AND available_hours_per_day <= 24"
    message: "Available hours must be between 0 and 24"

  - rule: "efficiency_percent > 0"
    message: "Efficiency must be positive"

computed_fields:
  - name: effective_capacity
    formula: "capacity_per_day * efficiency_percent / 100"
    description: Effective capacity after efficiency

  - name: total_hourly_rate
    formula: "hourly_rate + machine_rate + overhead_rate"
    description: Total hourly cost
