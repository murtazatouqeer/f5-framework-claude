name: operator
display_name: Machine Operator
display_name_vi: Công nhân vận hành
version: "1.0"
domain: manufacturing
subdomain: production
type: entity

description: |
  Production floor worker who operates machines and records production data.
  Tracks skills, certifications, and work assignments.

description_vi: |
  Công nhân sản xuất vận hành máy móc và ghi nhận dữ liệu sản xuất.
  Theo dõi kỹ năng, chứng chỉ và phân công công việc.

attributes:
  identification:
    - name: id
      type: uuid
      required: true

    - name: operator_code
      type: string
      required: true
      unique: true
      pattern: "^OPR-[0-9]+$"
      description: Operator code/badge number
      description_vi: Mã công nhân

    - name: employee_id
      type: string
      unique: true
      description: HR employee ID
      description_vi: Mã nhân viên HR

    - name: first_name
      type: string
      required: true
      description: First name
      description_vi: Tên

    - name: last_name
      type: string
      required: true
      description: Last name
      description_vi: Họ

    - name: full_name
      type: string
      description: Full name
      description_vi: Họ tên

    - name: status
      type: enum
      default: active
      values:
        - active: Currently employed
        - inactive: Not active
        - on_leave: On leave
        - terminated: Employment ended
      description_vi: Trạng thái

  contact:
    - name: email
      type: string
      format: email
      description: Email address

    - name: phone
      type: string
      description: Phone number

  assignment:
    - name: primary_work_center_id
      type: uuid
      description: Primary work center
      description_vi: Trung tâm làm việc chính

    - name: primary_shift_id
      type: uuid
      description: Primary shift
      description_vi: Ca chính

    - name: supervisor_id
      type: uuid
      description: Direct supervisor
      description_vi: Người quản lý trực tiếp

    - name: department
      type: string
      description: Department
      description_vi: Bộ phận

  skills:
    - name: skill_level
      type: enum
      default: standard
      values:
        - trainee: In training
        - entry: Entry level
        - standard: Standard operator
        - skilled: Skilled operator
        - expert: Expert/trainer
        - lead: Team lead
      description_vi: Cấp độ kỹ năng

    - name: certifications
      type: array
      item_type: object
      properties:
        name:
          type: string
        certification_number:
          type: string
        issued_date:
          type: date
        expiry_date:
          type: date
        issuing_authority:
          type: string
      description: Certifications held
      description_vi: Chứng chỉ

    - name: qualified_machines
      type: array
      item_type: object
      properties:
        machine_id:
          type: uuid
        machine_code:
          type: string
        qualification_date:
          type: date
        qualification_level:
          type: string
      description: Machines qualified to operate
      description_vi: Máy được phép vận hành

    - name: qualified_operations
      type: array
      item_type: uuid
      description: Operations qualified to perform

  training:
    - name: hire_date
      type: date
      description: Employment start date
      description_vi: Ngày vào làm

    - name: training_completed
      type: array
      item_type: object
      properties:
        course_name:
          type: string
        completion_date:
          type: date
        score:
          type: decimal
        trainer:
          type: string
      description: Completed training
      description_vi: Đào tạo đã hoàn thành

    - name: training_due
      type: array
      item_type: object
      properties:
        course_name:
          type: string
        due_date:
          type: date
        mandatory:
          type: boolean
      description: Training due/required

  performance:
    - name: efficiency_rating
      type: decimal
      description: Efficiency rating (%)
      description_vi: Đánh giá hiệu suất

    - name: quality_rating
      type: decimal
      description: Quality rating (%)
      description_vi: Đánh giá chất lượng

    - name: safety_incidents
      type: integer
      default: 0
      description: Safety incident count
      description_vi: Số sự cố an toàn

    - name: attendance_rating
      type: decimal
      description: Attendance rating (%)

  current_status:
    - name: current_status
      type: enum
      default: off_shift
      values:
        - working: Currently working
        - break: On break
        - off_shift: Not on shift
        - on_leave: On approved leave
      description_vi: Trạng thái hiện tại

    - name: current_machine_id
      type: uuid
      description: Current machine working on

    - name: current_work_order_id
      type: uuid
      description: Current work order

    - name: clock_in_time
      type: datetime
      description: Last clock in time
      description_vi: Giờ vào

    - name: clock_out_time
      type: datetime
      description: Last clock out time
      description_vi: Giờ ra

  costing:
    - name: hourly_rate
      type: decimal
      precision: 10
      scale: 4
      description: Standard hourly rate
      description_vi: Lương giờ

    - name: overtime_rate
      type: decimal
      description: Overtime rate
      description_vi: Lương làm thêm

  safety:
    - name: ppe_required
      type: array
      item_type: string
      description: Required PPE items
      description_vi: Trang bị bảo hộ yêu cầu

    - name: medical_clearance_date
      type: date
      description: Last medical clearance

    - name: restrictions
      type: text
      description: Work restrictions if any

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: created_by
      type: uuid

    - name: updated_at
      type: timestamp
      auto: true

relationships:
  - name: primary_work_center
    type: belongs_to
    entity: work_center
    foreign_key: primary_work_center_id

  - name: primary_shift
    type: belongs_to
    entity: shift
    foreign_key: primary_shift_id

  - name: supervisor
    type: belongs_to
    entity: operator
    foreign_key: supervisor_id

  - name: current_machine
    type: belongs_to
    entity: machine
    foreign_key: current_machine_id

  - name: current_work_order
    type: belongs_to
    entity: work_order
    foreign_key: current_work_order_id

  - name: production_outputs
    type: has_many
    entity: production_output
    foreign_key: operator_id

  - name: material_consumptions
    type: has_many
    entity: material_consumption
    foreign_key: operator_id

indexes:
  - columns: [operator_code]
    unique: true
  - columns: [employee_id]
    unique: true
    where: "employee_id IS NOT NULL"
  - columns: [status]
  - columns: [primary_work_center_id]
  - columns: [skill_level]

validation_rules:
  - rule: "hourly_rate > 0"
    message: "Hourly rate must be positive"

  - rule: "efficiency_rating IS NULL OR (efficiency_rating >= 0 AND efficiency_rating <= 150)"
    message: "Efficiency rating must be between 0 and 150"

computed_fields:
  - name: full_name_calc
    formula: "CONCAT(first_name, ' ', last_name)"
    description: Calculated full name

  - name: years_of_service
    formula: "TIMESTAMPDIFF(YEAR, hire_date, CURRENT_DATE)"
    description: Years of service
