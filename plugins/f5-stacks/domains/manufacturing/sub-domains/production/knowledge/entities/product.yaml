name: product
display_name: Product
display_name_vi: Sản phẩm
version: "1.0"
domain: manufacturing
subdomain: production
type: entity

description: |
  Master data entity for manufactured products including finished goods,
  semi-finished products, and raw materials used in production.

description_vi: |
  Dữ liệu chủ cho sản phẩm sản xuất bao gồm thành phẩm, bán thành phẩm
  và nguyên vật liệu sử dụng trong sản xuất.

attributes:
  identification:
    - name: id
      type: uuid
      required: true
      description: Unique identifier

    - name: product_code
      type: string
      required: true
      unique: true
      pattern: "^[A-Z0-9-]{3,20}$"
      description: SKU or item number
      description_vi: Mã sản phẩm

    - name: name
      type: string
      required: true
      max_length: 200
      description: Product name
      description_vi: Tên sản phẩm

    - name: description
      type: text
      description: Detailed description
      description_vi: Mô tả chi tiết

    - name: status
      type: enum
      required: true
      default: active
      values:
        - active: Available for production
        - inactive: Not currently used
        - obsolete: Phased out
        - prototype: Development stage
      description_vi: Trạng thái

    - name: product_type
      type: enum
      required: true
      values:
        - finished_good: Saleable end product
        - semi_finished: Intermediate product
        - raw_material: Input material
        - packaging: Packaging material
        - consumable: Production consumables
      description_vi: Loại sản phẩm

  classification:
    - name: category_id
      type: uuid
      description: Product category reference

    - name: product_family
      type: string
      description: Product family grouping
      description_vi: Nhóm sản phẩm

    - name: product_line
      type: string
      description: Product line
      description_vi: Dòng sản phẩm

    - name: brand
      type: string
      description: Brand name

  specifications:
    - name: unit_of_measure
      type: string
      required: true
      examples: [PC, KG, M, L, BOX]
      description: Base UOM
      description_vi: Đơn vị tính

    - name: weight_kg
      type: decimal
      precision: 10
      scale: 4
      description: Weight in kilograms
      description_vi: Trọng lượng (kg)

    - name: volume_cbm
      type: decimal
      precision: 10
      scale: 6
      description: Volume in cubic meters

    - name: dimensions
      type: object
      properties:
        length_cm:
          type: decimal
        width_cm:
          type: decimal
        height_cm:
          type: decimal
      description_vi: Kích thước

  manufacturing:
    - name: make_or_buy
      type: enum
      required: true
      default: make
      values:
        - make: Manufactured in-house
        - buy: Purchased externally
        - both: Can be made or bought
      description_vi: Tự sản xuất hoặc mua

    - name: default_bom_id
      type: uuid
      description: Default bill of materials
      description_vi: Định mức vật tư mặc định

    - name: default_routing_id
      type: uuid
      description: Default production routing
      description_vi: Quy trình sản xuất mặc định

    - name: lead_time_days
      type: integer
      default: 1
      description: Manufacturing lead time
      description_vi: Thời gian sản xuất (ngày)

    - name: min_order_quantity
      type: decimal
      default: 1
      description: Minimum production quantity
      description_vi: Số lượng sản xuất tối thiểu

    - name: order_multiple
      type: decimal
      default: 1
      description: Order in multiples of
      description_vi: Bội số đặt hàng

    - name: phantom
      type: boolean
      default: false
      description: Phantom/kit item (BOM explodes, no WO)
      description_vi: Sản phẩm ảo

  quality:
    - name: inspection_required
      type: boolean
      default: false
      description: Requires quality inspection
      description_vi: Yêu cầu kiểm tra chất lượng

    - name: inspection_plan_id
      type: uuid
      description: Quality inspection plan

    - name: shelf_life_days
      type: integer
      description: Shelf life in days
      description_vi: Thời hạn sử dụng (ngày)

    - name: storage_conditions
      type: string
      description: Storage requirements
      description_vi: Điều kiện bảo quản

  traceability:
    - name: lot_controlled
      type: boolean
      default: false
      description: Requires lot tracking
      description_vi: Theo dõi theo lô

    - name: serial_controlled
      type: boolean
      default: false
      description: Requires serial number tracking
      description_vi: Theo dõi theo số serial

    - name: batch_size
      type: decimal
      description: Standard batch/lot size
      description_vi: Kích thước lô tiêu chuẩn

  costing:
    - name: standard_cost
      type: decimal
      precision: 15
      scale: 4
      description: Standard cost per unit
      description_vi: Giá thành tiêu chuẩn

    - name: material_cost
      type: decimal
      precision: 15
      scale: 4
      description: Material cost component
      description_vi: Chi phí nguyên vật liệu

    - name: labor_cost
      type: decimal
      precision: 15
      scale: 4
      description: Labor cost component
      description_vi: Chi phí nhân công

    - name: overhead_cost
      type: decimal
      precision: 15
      scale: 4
      description: Overhead cost component
      description_vi: Chi phí chung

    - name: cost_method
      type: enum
      default: standard
      values: [standard, average, fifo, actual]
      description_vi: Phương pháp tính giá

  inventory:
    - name: safety_stock
      type: decimal
      default: 0
      description: Safety stock level
      description_vi: Tồn kho an toàn

    - name: reorder_point
      type: decimal
      description: Reorder trigger level
      description_vi: Điểm đặt hàng lại

    - name: max_stock
      type: decimal
      description: Maximum stock level
      description_vi: Tồn kho tối đa

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: created_by
      type: uuid

    - name: updated_at
      type: timestamp
      auto: true

    - name: updated_by
      type: uuid

relationships:
  - name: default_bom
    type: belongs_to
    entity: bom
    foreign_key: default_bom_id
    description: Default bill of materials

  - name: default_routing
    type: belongs_to
    entity: routing
    foreign_key: default_routing_id
    description: Default production routing

  - name: boms
    type: has_many
    entity: bom
    foreign_key: product_id
    description: All BOMs for this product

  - name: routings
    type: has_many
    entity: routing
    foreign_key: product_id
    description: All routings for this product

  - name: work_orders
    type: has_many
    entity: work_order
    foreign_key: product_id
    description: Work orders for this product

  - name: production_lots
    type: has_many
    entity: production_lot
    foreign_key: product_id
    description: Production lots

indexes:
  - columns: [product_code]
    unique: true
  - columns: [status, product_type]
  - columns: [product_family]

validation_rules:
  - rule: "standard_cost >= 0"
    message: "Standard cost cannot be negative"

  - rule: "lead_time_days > 0"
    message: "Lead time must be positive"

  - rule: "lot_controlled OR NOT serial_controlled"
    message: "Serial control requires lot control"
