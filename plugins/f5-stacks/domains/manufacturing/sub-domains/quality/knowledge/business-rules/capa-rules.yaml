name: capa-rules
display_name: CAPA Business Rules
display_name_vi: Quy tắc kinh doanh CAPA
version: "1.0"
domain: manufacturing
subdomain: quality
type: business-rules

description: |
  Business rules governing Corrective and Preventive Action (CAPA)
  management including initiation, investigation, implementation, and effectiveness.

description_vi: |
  Quy tắc kinh doanh quản lý Hành động khắc phục và phòng ngừa (CAPA)
  bao gồm khởi tạo, điều tra, thực hiện và hiệu quả.

rule_categories:
  - capa_initiation
  - root_cause_analysis
  - action_planning
  - implementation
  - effectiveness
  - documentation

rules:
  # CAPA Initiation Rules
  - id: CAPA-RULE-001
    name: capa_trigger_criteria
    name_vi: Tiêu chí kích hoạt CAPA
    category: capa_initiation
    priority: critical
    description: CAPA must be initiated for defined trigger conditions
    description_vi: CAPA phải được khởi tạo cho các điều kiện kích hoạt đã định
    condition: |
      CAPA required for:
        - Critical NCRs
        - Recurring NCRs (same root cause > 1 time)
        - Customer complaints (product or quality related)
        - Audit findings (major or critical)
        - Management review action items
        - Regulatory observations
        - Field failures
        - Process deviations with impact
    action: |
      AUTO-CREATE CAPA for mandatory triggers
      PROMPT CAPA creation for recommended triggers
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-002
    name: capa_ownership
    name_vi: Quyền sở hữu CAPA
    category: capa_initiation
    priority: high
    description: Every CAPA must have a qualified owner
    description_vi: Mỗi CAPA phải có chủ sở hữu đủ điều kiện
    condition: |
      owner_id REQUIRED
      owner.authority_level >= capa.priority
      owner NOT from affected_area (independence)
    action: |
      REQUIRE owner assignment
      VALIDATE owner qualifications
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-003
    name: problem_statement_quality
    name_vi: Chất lượng phát biểu vấn đề
    category: capa_initiation
    priority: high
    description: Problem statement must be clear and measurable
    description_vi: Phát biểu vấn đề phải rõ ràng và đo lường được
    condition: |
      problem_statement MUST include:
        - What: Clear description of the issue
        - Where: Location/product/process affected
        - When: Timeframe and frequency
        - Extent: Magnitude of impact
        - Impact: Consequences if not addressed
    action: |
      VALIDATE problem statement completeness
      GUIDE user with template
    enforcement: procedural
    exception_allowed: false

  # Root Cause Analysis Rules
  - id: CAPA-RULE-010
    name: rca_methodology_required
    name_vi: Yêu cầu phương pháp RCA
    category: root_cause_analysis
    priority: critical
    description: Documented root cause analysis methodology required
    description_vi: Yêu cầu phương pháp phân tích nguyên nhân gốc được ghi nhận
    condition: |
      FOR CAPA completion:
        root_cause_method IN ('five_why', 'fishbone', 'eight_d', 'fmea', 'fault_tree')
        root_cause_analysis documented with evidence
    action: |
      REQUIRE methodology selection
      VALIDATE analysis depth
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-011
    name: five_why_depth
    name_vi: Độ sâu 5 tại sao
    category: root_cause_analysis
    priority: high
    description: 5-Why analysis must reach systemic root cause
    description_vi: Phân tích 5 Tại sao phải đạt đến nguyên nhân gốc hệ thống
    condition: |
      WHEN root_cause_method = 'five_why'
      THEN:
        - Minimum 5 levels of "why"
        - Final why addresses system/process/policy
        - Not stopped at human error level
    action: |
      GUIDE through 5-why levels
      WARN if stopped at human error
    enforcement: procedural
    exception_allowed: true
    exception_approver: quality_manager

  - id: CAPA-RULE-012
    name: eight_d_compliance
    name_vi: Tuân thủ 8D
    category: root_cause_analysis
    priority: critical
    description: 8D methodology required for customer complaints
    description_vi: Phương pháp 8D được yêu cầu cho khiếu nại khách hàng
    condition: |
      WHEN capa.source_type = 'customer_complaint'
      THEN root_cause_method = 'eight_d'
      WITH all 8 disciplines documented:
        D1: Team formation
        D2: Problem description
        D3: Containment actions
        D4: Root cause analysis
        D5: Permanent corrective actions
        D6: Implementation
        D7: Prevention
        D8: Recognition
    action: |
      ENFORCE 8D structure
      VALIDATE each discipline complete
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-013
    name: verify_root_cause
    name_vi: Xác minh nguyên nhân gốc
    category: root_cause_analysis
    priority: high
    description: Root cause must be verified before action planning
    description_vi: Nguyên nhân gốc phải được xác minh trước khi lập kế hoạch hành động
    condition: |
      Root cause verification:
        - Can explain ALL instances of the problem
        - Removing it would prevent recurrence
        - Evidence supports the conclusion
        - Stakeholders agree
    action: |
      REQUIRE RCA approval before action planning
      DOCUMENT verification evidence
    enforcement: procedural
    exception_allowed: false

  # Action Planning Rules
  - id: CAPA-RULE-020
    name: action_requirements
    name_vi: Yêu cầu hành động
    category: action_planning
    priority: high
    description: Actions must be specific, measurable, and assigned
    description_vi: Hành động phải cụ thể, đo lường được và được giao
    condition: |
      Each action MUST have:
        - Specific description (what exactly to do)
        - Owner (single accountable person)
        - Due date (realistic timeline)
        - Success criteria (measurable)
        - Link to root cause (addresses cause)
    action: |
      VALIDATE action completeness
      BLOCK incomplete actions
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-021
    name: corrective_vs_preventive
    name_vi: Khắc phục so với phòng ngừa
    category: action_planning
    priority: high
    description: Must differentiate corrective and preventive actions
    description_vi: Phải phân biệt hành động khắc phục và phòng ngừa
    condition: |
      CAPA must include:
        - Corrective action: Eliminates root cause of existing NC
        - Preventive action: Prevents occurrence in similar situations

      Both types required for critical/major CAPAs
    action: |
      CLASSIFY each action type
      REQUIRE both types for critical CAPAs
    enforcement: procedural
    exception_allowed: false

  - id: CAPA-RULE-022
    name: action_plan_approval
    name_vi: Phê duyệt kế hoạch hành động
    category: action_planning
    priority: high
    description: Action plan requires approval before implementation
    description_vi: Kế hoạch hành động yêu cầu phê duyệt trước khi thực hiện
    condition: |
      action_plan_approved = true
      action_plan_approved_by = quality_manager (critical)
                              = quality_engineer (major/minor)
      BEFORE implementation can start
    action: |
      ROUTE for approval
      BLOCK implementation without approval
    enforcement: automatic
    exception_allowed: false

  # Implementation Rules
  - id: CAPA-RULE-030
    name: implementation_timeline
    name_vi: Thời gian thực hiện
    category: implementation
    priority: high
    description: Actions must be implemented within target timeline
    description_vi: Hành động phải được thực hiện trong thời gian mục tiêu
    condition: |
      Implementation timelines by priority:
        critical: 30 days
        high: 45 days
        medium: 60 days
        low: 90 days
    action: |
      TRACK action due dates
      ALERT at 75% of timeline
      ESCALATE overdue actions
    enforcement: automatic
    exception_allowed: true
    exception_approver: quality_manager

  - id: CAPA-RULE-031
    name: action_evidence_required
    name_vi: Yêu cầu bằng chứng hành động
    category: implementation
    priority: high
    description: Implementation must be documented with evidence
    description_vi: Thực hiện phải được ghi nhận với bằng chứng
    condition: |
      FOR each completed action:
        evidence.type IN ('document', 'photo', 'record', 'test_result')
        evidence.description provided
        evidence.date provided
    action: |
      REQUIRE evidence upload
      VALIDATE evidence presence
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-032
    name: document_updates
    name_vi: Cập nhật tài liệu
    category: implementation
    priority: high
    description: Related documents must be updated as part of CAPA
    description_vi: Tài liệu liên quan phải được cập nhật như một phần của CAPA
    condition: |
      IF action affects:
        - Procedures
        - Work instructions
        - Training materials
        - Control plans
        - Inspection plans
      THEN document_updates must be tracked and verified
    action: |
      IDENTIFY affected documents
      TRACK document updates
      VERIFY updates complete
    enforcement: procedural
    exception_allowed: false

  # Effectiveness Rules
  - id: CAPA-RULE-040
    name: effectiveness_verification_required
    name_vi: Yêu cầu xác minh hiệu quả
    category: effectiveness
    priority: critical
    description: Effectiveness verification required before closure
    description_vi: Xác minh hiệu quả được yêu cầu trước khi đóng
    condition: |
      effectiveness_check_required = true (default)
      verification_method defined
      verification_criteria established
      verification performed and documented
    action: |
      REQUIRE effectiveness verification
      BLOCK closure without verification
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-041
    name: effectiveness_monitoring_period
    name_vi: Giai đoạn giám sát hiệu quả
    category: effectiveness
    priority: high
    description: Monitor for recurrence during defined period
    description_vi: Giám sát tái phát trong giai đoạn đã định
    condition: |
      Monitoring periods by priority:
        critical: 90 days
        high: 60 days
        medium: 30 days
        low: 30 days

      No recurrence during period = effective
    action: |
      SET monitoring period
      TRACK for recurrence
      ALERT if recurrence detected
    enforcement: automatic
    exception_allowed: true
    exception_approver: quality_manager

  - id: CAPA-RULE-042
    name: ineffective_capa_handling
    name_vi: Xử lý CAPA không hiệu quả
    category: effectiveness
    priority: critical
    description: Ineffective CAPAs must be reopened and reanalyzed
    description_vi: CAPA không hiệu quả phải được mở lại và phân tích lại
    condition: |
      WHEN effectiveness_result IN ('not_effective', 'partially_effective')
      OR recurrence detected during monitoring
      THEN:
        - Reopen CAPA
        - Re-analyze root cause
        - Define additional actions
    action: |
      AUTO-REOPEN CAPA
      NOTIFY owner and quality_manager
      RESET timeline
    enforcement: automatic
    exception_allowed: false

  # Documentation Rules
  - id: CAPA-RULE-050
    name: training_records
    name_vi: Hồ sơ đào tạo
    category: documentation
    priority: high
    description: Training must be documented when required by CAPA
    description_vi: Đào tạo phải được ghi nhận khi được yêu cầu bởi CAPA
    condition: |
      WHEN training_required = true
      THEN training_records MUST include:
        - Personnel trained
        - Training content
        - Training date
        - Trainer qualification
        - Competency verification
    action: |
      TRACK training completion
      VALIDATE records present
    enforcement: automatic
    exception_allowed: false

  - id: CAPA-RULE-051
    name: horizontal_deployment
    name_vi: Triển khai ngang
    category: documentation
    priority: high
    description: Consider extending actions to similar products/processes
    description_vi: Xem xét mở rộng hành động cho sản phẩm/quy trình tương tự
    condition: |
      FOR critical and high priority CAPAs:
        horizontal_deployment assessment REQUIRED
        Document similar areas evaluated
        Justify deployment or non-deployment
    action: |
      PROMPT horizontal deployment assessment
      DOCUMENT decision and rationale
    enforcement: procedural
    exception_allowed: false

  - id: CAPA-RULE-052
    name: lessons_learned
    name_vi: Bài học kinh nghiệm
    category: documentation
    priority: medium
    description: Lessons learned documented for knowledge sharing
    description_vi: Bài học kinh nghiệm được ghi nhận để chia sẻ kiến thức
    condition: |
      FOR all closed CAPAs:
        lessons_learned documented
        Shared with relevant stakeholders
        Added to knowledge base
    action: |
      PROMPT lessons learned entry
      DISTRIBUTE to stakeholders
    enforcement: procedural
    exception_allowed: true
    exception_approver: quality_engineer

escalation_matrix:
  critical_capa:
    day_1: quality_manager
    day_7: plant_manager
    day_14: director
    day_30: vp_quality

  high_capa:
    day_7: quality_manager
    day_14: plant_manager
    day_30: director

  overdue_action:
    day_1: action_owner + capa_owner
    day_3: quality_manager
    day_7: plant_manager

metrics:
  kpis:
    - capa_on_time_completion_rate
    - capa_effectiveness_rate
    - average_days_to_close
    - recurrence_rate_post_capa
    - action_on_time_rate
  targets:
    on_time_completion: "> 90%"
    effectiveness: "> 90%"
    recurrence: "< 5%"
