name: calibration
display_name: Equipment Calibration
display_name_vi: Hiệu chuẩn thiết bị
version: "1.0"
domain: manufacturing
subdomain: quality
type: entity

description: |
  Calibration record for measuring and test equipment ensuring
  traceability to national/international standards and measurement accuracy.

description_vi: |
  Bản ghi hiệu chuẩn cho thiết bị đo lường và thử nghiệm đảm bảo
  truy xuất nguồn gốc đến tiêu chuẩn quốc gia/quốc tế và độ chính xác đo lường.

attributes:
  - name: calibration_id
    type: string
    format: "CAL-YYYY-XXXX"
    primary_key: true
    description: Unique calibration record identifier

  - name: calibration_number
    type: string
    required: true
    unique: true
    description: Human-readable calibration number

  - name: status
    type: enum
    values:
      - scheduled
      - in_progress
      - completed
      - failed
      - cancelled
      - overdue
    required: true
    default: scheduled
    description: Calibration status

  - name: equipment_id
    type: reference
    references: equipment
    required: true
    description: Equipment being calibrated

  - name: equipment_name
    type: string
    required: true
    description: Equipment name

  - name: equipment_type
    type: string
    description: Type of equipment

  - name: manufacturer
    type: string
    description: Equipment manufacturer

  - name: model_number
    type: string
    description: Equipment model number

  - name: serial_number
    type: string
    required: true
    description: Equipment serial number

  - name: asset_number
    type: string
    description: Internal asset number

  - name: location
    type: string
    description: Equipment location

  - name: department
    type: string
    description: Owning department

  - name: calibration_type
    type: enum
    values:
      - initial
      - periodic
      - after_repair
      - after_adjustment
      - verification
      - special
    required: true
    description: Type of calibration

  - name: calibration_method
    type: enum
    values:
      - internal
      - external
      - vendor
    required: true
    description: Who performs calibration

  - name: calibration_procedure
    type: string
    description: Procedure document reference

  - name: calibration_standard
    type: string
    description: Standard reference (e.g., ISO 17025)

  - name: scheduled_date
    type: date
    required: true
    description: Scheduled calibration date

  - name: due_date
    type: date
    required: true
    description: Calibration due date

  - name: performed_date
    type: date
    description: Actual calibration date

  - name: performed_by
    type: reference
    references: employee
    description: Technician who performed calibration

  - name: external_lab
    type: string
    description: External calibration laboratory

  - name: lab_accreditation
    type: string
    description: Lab accreditation number

  - name: traceability_standard
    type: string
    description: Reference standard used

  - name: traceability_certificate
    type: string
    description: Traceability certificate number

  - name: nist_traceable
    type: boolean
    default: true
    description: Traceable to NIST or equivalent

  - name: measurement_range
    type: string
    description: Measurement range of equipment

  - name: accuracy_specification
    type: string
    description: Required accuracy specification

  - name: calibration_points
    type: json
    description: Calibration test points
    # [{point, nominal, tolerance_plus, tolerance_minus, measured, deviation, status}]

  - name: as_found_data
    type: json
    description: As-found measurement data

  - name: as_left_data
    type: json
    description: As-left measurement data (after adjustment)

  - name: adjustment_made
    type: boolean
    default: false
    description: Whether adjustment was needed

  - name: adjustment_details
    type: text
    description: Details of adjustment made

  - name: result
    type: enum
    values:
      - pass
      - fail
      - pass_with_limitation
      - adjusted_pass
    description: Calibration result

  - name: pass_criteria
    type: text
    description: Criteria for passing calibration

  - name: out_of_tolerance_action
    type: enum
    values:
      - none
      - adjusted
      - repaired
      - replaced
      - limited_use
      - retired
    description: Action taken if out of tolerance

  - name: impact_assessment
    type: text
    description: Impact if found out of tolerance

  - name: affected_measurements
    type: json
    description: Measurements potentially affected

  - name: uncertainty
    type: decimal
    precision: 15
    scale: 6
    description: Measurement uncertainty

  - name: uncertainty_unit
    type: string
    description: Uncertainty unit of measure

  - name: confidence_level
    type: decimal
    precision: 5
    scale: 2
    description: Confidence level percentage

  - name: environmental_conditions
    type: json
    description: Temperature, humidity during calibration

  - name: temperature
    type: decimal
    precision: 6
    scale: 2
    description: Temperature during calibration

  - name: humidity
    type: decimal
    precision: 5
    scale: 2
    description: Humidity during calibration

  - name: calibration_interval
    type: integer
    description: Calibration interval in days

  - name: next_calibration_date
    type: date
    description: Next calibration due date

  - name: calibration_cost
    type: decimal
    precision: 10
    scale: 2
    description: Cost of calibration

  - name: certificate_number
    type: string
    description: Calibration certificate number

  - name: certificate_path
    type: string
    description: Path to certificate document

  - name: certificate_expiry
    type: date
    description: Certificate expiry date

  - name: sticker_applied
    type: boolean
    default: false
    description: Calibration sticker applied

  - name: sticker_id
    type: string
    description: Calibration sticker ID

  - name: equipment_condition
    type: enum
    values:
      - good
      - fair
      - poor
      - damaged
    description: Physical condition of equipment

  - name: condition_notes
    type: text
    description: Notes on equipment condition

  - name: maintenance_required
    type: boolean
    default: false
    description: Maintenance needed

  - name: maintenance_notes
    type: text
    description: Maintenance recommendations

  - name: recall_required
    type: boolean
    default: false
    description: Product recall consideration needed

  - name: recall_assessment
    type: text
    description: Recall assessment details

  - name: reviewed_by
    type: reference
    references: employee
    description: Quality reviewer

  - name: reviewed_at
    type: datetime
    description: Review timestamp

  - name: approved_by
    type: reference
    references: employee
    description: Manager approval

  - name: approved_at
    type: datetime
    description: Approval timestamp

  - name: attachments
    type: json
    description: Certificates, data sheets

  - name: notes
    type: text
    description: General notes

  - name: created_at
    type: datetime
    auto: true
    description: Record creation timestamp

  - name: updated_at
    type: datetime
    auto: true
    description: Last update timestamp

relationships:
  - name: equipment
    type: many_to_one
    target: equipment
    foreign_key: equipment_id
    description: Calibrated equipment

  - name: technician
    type: many_to_one
    target: employee
    foreign_key: performed_by
    description: Calibration technician

  - name: reviewer
    type: many_to_one
    target: employee
    foreign_key: reviewed_by
    description: Quality reviewer

  - name: previous_calibration
    type: many_to_one
    target: calibration
    description: Previous calibration record

state_machine:
  initial: scheduled
  states:
    scheduled:
      description: Calibration scheduled
      transitions:
        - to: in_progress
          trigger: start
          conditions:
            - equipment_available
        - to: overdue
          trigger: mark_overdue
          conditions:
            - past_due_date
        - to: cancelled
          trigger: cancel
          conditions:
            - cancellation_approved

    overdue:
      description: Calibration past due
      transitions:
        - to: in_progress
          trigger: start
        - to: cancelled
          trigger: cancel

    in_progress:
      description: Calibration being performed
      transitions:
        - to: completed
          trigger: complete
          conditions:
            - all_points_tested
            - result_determined
        - to: failed
          trigger: fail
          conditions:
            - cannot_complete

    completed:
      description: Calibration completed
      final: true

    failed:
      description: Calibration could not be completed
      final: true

    cancelled:
      description: Calibration cancelled
      final: true

business_rules:
  - rule: traceability_required
    description: Calibration must be traceable to standards
    validation: traceability_certificate or nist_traceable required

  - rule: interval_compliance
    description: Equipment must be calibrated within interval
    validation: performed_date <= due_date for compliance

  - rule: out_of_tolerance_impact
    description: Out of tolerance requires impact assessment
    validation: If result = fail then impact_assessment required

  - rule: accredited_lab
    description: External calibration from accredited labs
    validation: If calibration_method = external then lab_accreditation required

  - rule: certificate_retention
    description: Certificates must be retained
    validation: certificate_path stored for completed calibrations

indexes:
  - columns: [calibration_number]
    unique: true
  - columns: [equipment_id, performed_date]
  - columns: [serial_number]
  - columns: [status]
  - columns: [due_date]
  - columns: [next_calibration_date]
  - columns: [result]
  - columns: [department]

audit:
  enabled: true
  retention_years: 10
  track_fields:
    - status
    - result
    - adjustment_made
    - calibration_points
