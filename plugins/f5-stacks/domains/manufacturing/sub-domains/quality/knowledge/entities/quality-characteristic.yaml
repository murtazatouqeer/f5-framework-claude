name: quality-characteristic
display_name: Quality Characteristic
display_name_vi: Đặc tính chất lượng
version: "1.0"
domain: manufacturing
subdomain: quality
type: entity

description: |
  Quality characteristic definition specifying what to measure,
  how to measure, and acceptance criteria for quality inspection.

description_vi: |
  Định nghĩa đặc tính chất lượng xác định cần đo gì,
  cách đo và tiêu chí chấp nhận cho kiểm tra chất lượng.

attributes:
  - name: characteristic_id
    type: string
    format: "QC-XXXX"
    primary_key: true
    description: Unique characteristic identifier

  - name: characteristic_code
    type: string
    required: true
    description: Short code for the characteristic

  - name: name
    type: string
    required: true
    description: Characteristic name

  - name: name_vi
    type: string
    description: Vietnamese name

  - name: inspection_plan_id
    type: reference
    references: inspection-plan
    required: true
    description: Parent inspection plan

  - name: sequence
    type: integer
    default: 0
    description: Order in inspection sequence

  - name: characteristic_type
    type: enum
    values:
      - dimensional
      - visual
      - functional
      - material
      - cosmetic
      - electrical
      - chemical
      - mechanical
      - documentation
    required: true
    description: Type of characteristic

  - name: data_type
    type: enum
    values:
      - variable
      - attribute
    required: true
    description: Variable (measured) or attribute (pass/fail)

  - name: criticality
    type: enum
    values:
      - critical
      - major
      - minor
    required: true
    default: major
    description: Defect severity classification

  - name: description
    type: text
    description: Detailed characteristic description

  - name: description_vi
    type: text
    description: Vietnamese description

  - name: specification
    type: string
    description: Specification reference

  - name: drawing_reference
    type: string
    description: Drawing number and revision

  - name: nominal_value
    type: decimal
    precision: 15
    scale: 6
    description: Target/nominal value for variable data

  - name: unit_of_measure
    type: string
    description: Measurement unit

  - name: upper_spec_limit
    type: decimal
    precision: 15
    scale: 6
    description: Upper specification limit (USL)

  - name: lower_spec_limit
    type: decimal
    precision: 15
    scale: 6
    description: Lower specification limit (LSL)

  - name: upper_control_limit
    type: decimal
    precision: 15
    scale: 6
    description: Upper control limit (UCL) for SPC

  - name: lower_control_limit
    type: decimal
    precision: 15
    scale: 6
    description: Lower control limit (LCL) for SPC

  - name: tolerance_type
    type: enum
    values:
      - bilateral
      - unilateral_upper
      - unilateral_lower
      - none
    default: bilateral
    description: Type of tolerance

  - name: tolerance_plus
    type: decimal
    precision: 15
    scale: 6
    description: Plus tolerance for bilateral

  - name: tolerance_minus
    type: decimal
    precision: 15
    scale: 6
    description: Minus tolerance for bilateral

  - name: attribute_criteria
    type: text
    description: Pass/fail criteria for attribute data

  - name: accept_value
    type: string
    description: Value indicating acceptance

  - name: reject_value
    type: string
    description: Value indicating rejection

  - name: measurement_method
    type: text
    description: How to perform measurement

  - name: measurement_equipment
    type: string
    description: Required measurement equipment

  - name: equipment_accuracy
    type: decimal
    precision: 10
    scale: 6
    description: Required equipment accuracy

  - name: gauge_rr_required
    type: boolean
    default: false
    description: Gauge R&R study required

  - name: sample_size
    type: integer
    default: 1
    description: Number of measurements per sample

  - name: sampling_frequency
    type: string
    description: How often to sample

  - name: spc_enabled
    type: boolean
    default: false
    description: Statistical process control enabled

  - name: control_chart_type
    type: enum
    values:
      - xbar_r
      - xbar_s
      - p_chart
      - np_chart
      - c_chart
      - u_chart
      - individual_mr
    description: Type of control chart if SPC enabled

  - name: subgroup_size
    type: integer
    description: Subgroup size for control charts

  - name: cp_target
    type: decimal
    precision: 4
    scale: 2
    description: Target process capability (Cp)

  - name: cpk_target
    type: decimal
    precision: 4
    scale: 2
    description: Target process capability index (Cpk)

  - name: visual_reference
    type: string
    description: Path to visual standard/reference

  - name: workmanship_standard
    type: string
    description: IPC or workmanship standard reference

  - name: test_procedure
    type: string
    description: Test procedure document reference

  - name: special_instructions
    type: text
    description: Special measurement instructions

  - name: reaction_plan
    type: text
    description: What to do if out of specification

  - name: is_required
    type: boolean
    default: true
    description: Whether this check is mandatory

  - name: is_active
    type: boolean
    default: true
    description: Whether characteristic is active

  - name: created_at
    type: datetime
    auto: true
    description: Creation timestamp

  - name: updated_at
    type: datetime
    auto: true
    description: Last update timestamp

relationships:
  - name: inspection_plan
    type: many_to_one
    target: inspection-plan
    foreign_key: inspection_plan_id
    description: Parent inspection plan

  - name: measurements
    type: one_to_many
    target: measurement
    inverse: characteristic_id
    description: Measurements for this characteristic

  - name: control_charts
    type: one_to_many
    target: control-chart
    inverse: characteristic_id
    description: SPC control charts

business_rules:
  - rule: variable_requires_limits
    description: Variable data requires specification limits
    validation: If data_type = variable then USL or LSL required

  - rule: attribute_requires_criteria
    description: Attribute data requires pass/fail criteria
    validation: If data_type = attribute then attribute_criteria required

  - rule: spc_requires_limits
    description: SPC requires control limits
    validation: If spc_enabled then control limits required

  - rule: criticality_drives_aql
    description: Criticality determines applicable AQL
    validation: Criticality maps to plan AQL values

  - rule: equipment_must_be_calibrated
    description: Measurement equipment must be calibrated
    validation: equipment in calibrated_equipment list

indexes:
  - columns: [inspection_plan_id, sequence]
  - columns: [characteristic_type]
  - columns: [criticality]
  - columns: [spc_enabled]

audit:
  enabled: true
  retention_years: 7
  track_fields:
    - nominal_value
    - upper_spec_limit
    - lower_spec_limit
    - criticality
