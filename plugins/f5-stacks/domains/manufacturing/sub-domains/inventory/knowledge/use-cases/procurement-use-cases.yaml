name: procurement-use-cases
display_name: Procurement Use Cases
display_name_vi: Các ca sử dụng mua hàng
version: "1.0"
domain: manufacturing
subdomain: inventory

description: |
  Use cases for procurement activities including requisitioning,
  sourcing, purchasing, and supplier management.

actors:
  - id: requester
    name: Requester
    name_vi: Người yêu cầu
    description: Any user creating purchase requisitions

  - id: buyer
    name: Buyer
    name_vi: Nhân viên mua hàng
    description: Procurement specialist handling purchases

  - id: senior_buyer
    name: Senior Buyer
    name_vi: Nhân viên mua hàng cao cấp
    description: Handles complex purchases and negotiations

  - id: procurement_manager
    name: Procurement Manager
    name_vi: Trưởng phòng mua hàng
    description: Manages procurement team and approvals

  - id: supplier_quality
    name: Supplier Quality Engineer
    name_vi: Kỹ sư chất lượng nhà cung cấp
    description: Manages supplier qualification and performance

use_cases:
  # ============================================
  # REQUISITION USE CASES
  # ============================================
  - id: UC-PR-001
    name: Create Purchase Requisition
    name_vi: Tạo yêu cầu mua hàng
    actor: requester
    priority: high

    description: |
      Create a request to purchase materials or services that
      will be routed for approval and converted to PO.

    preconditions:
      - User has requisition authority
      - Material exists in master data (or free text)
      - Budget available (if budget control active)

    main_flow:
      - step: 1
        action: Initiate requisition
        system_action: Open requisition form
      - step: 2
        action: Select or enter material
        system_action: Auto-fill material details
      - step: 3
        action: Enter quantity and required date
        system_action: Calculate default delivery date
      - step: 4
        action: Specify cost center/project
        system_action: Validate account assignment
      - step: 5
        action: Add justification
        system_action: Store justification text
      - step: 6
        action: Submit for approval
        system_action: Route per approval workflow

    alternative_flows:
      - id: AF1
        name: Free Text Requisition
        trigger: Material not in master data
        steps:
          - Enter description, specifications
          - Flag as non-catalog item
          - Attach specifications/drawings
          - Require buyer review

    postconditions:
      - Requisition created
      - Routed for approval
      - Requester notified

  - id: UC-PR-002
    name: Approve Purchase Requisition
    name_vi: Phê duyệt yêu cầu mua hàng
    actor: procurement_manager
    priority: high

    description: |
      Review and approve/reject purchase requisition based on
      business need, budget, and authority matrix.

    preconditions:
      - Requisition submitted for approval
      - Approver has authority for value/type

    main_flow:
      - step: 1
        action: View approval queue
        system_action: Display pending requisitions
      - step: 2
        action: Open requisition details
        system_action: Show line items, justification, history
      - step: 3
        action: Review business need
        system_action: Display related info (budget, previous orders)
      - step: 4
        action: Check budget availability
        system_action: Show budget status
      - step: 5
        action: Make decision
        system_action: Accept approve/reject/modify
      - step: 6
        action: Submit decision
        system_action: Update status, notify stakeholders

    alternative_flows:
      - id: AF1
        name: Request Information
        trigger: Insufficient detail to decide
        steps:
          - Send back to requester
          - Request clarification
          - Pause approval timer

      - id: AF2
        name: Partial Approval
        trigger: Some lines approved, others not
        steps:
          - Approve valid lines
          - Reject/hold other lines
          - Split requisition if needed

    postconditions:
      - Decision recorded
      - Requisition status updated
      - Next action triggered

  # ============================================
  # SOURCING USE CASES
  # ============================================
  - id: UC-PR-003
    name: Create Request for Quotation
    name_vi: Tạo yêu cầu báo giá
    actor: buyer
    priority: high

    description: |
      Create and send RFQ to multiple suppliers to obtain
      competitive quotes for purchasing decision.

    preconditions:
      - Approved requisition exists
      - Approved supplier list available
      - RFQ template configured

    main_flow:
      - step: 1
        action: Select requisition for sourcing
        system_action: Load requisition details
      - step: 2
        action: Select suppliers to invite
        system_action: Filter by commodity, qualification
      - step: 3
        action: Set RFQ parameters
        system_action: Configure deadline, terms, quantities
      - step: 4
        action: Add specifications/attachments
        system_action: Attach technical documents
      - step: 5
        action: Review and send RFQ
        system_action: Send to selected suppliers
      - step: 6
        action: Monitor responses
        system_action: Track response status

    postconditions:
      - RFQ sent to suppliers
      - Deadline tracking active
      - Response collection enabled

  - id: UC-PR-004
    name: Evaluate Supplier Quotations
    name_vi: Đánh giá báo giá nhà cung cấp
    actor: buyer
    priority: high

    description: |
      Compare received quotations and select best supplier
      based on price, quality, delivery, and other criteria.

    preconditions:
      - Quotations received from suppliers
      - RFQ deadline reached or sufficient responses

    main_flow:
      - step: 1
        action: Review received quotations
        system_action: Display quote comparison matrix
      - step: 2
        action: Normalize pricing
        system_action: Calculate total cost including freight, duties
      - step: 3
        action: Score non-price factors
        system_action: Apply weighted scoring
      - step: 4
        action: Review supplier history
        system_action: Display performance metrics
      - step: 5
        action: Rank suppliers
        system_action: Calculate overall score
      - step: 6
        action: Select recommended supplier
        system_action: Document selection rationale

    alternative_flows:
      - id: AF1
        name: Negotiation Required
        trigger: Best quote exceeds budget or benchmark
        steps:
          - Initiate negotiation with top suppliers
          - Request revised quotations
          - Document negotiation results

      - id: AF2
        name: Technical Review Required
        trigger: Complex technical specifications
        steps:
          - Route to technical evaluator
          - Score technical compliance
          - Combine with commercial evaluation

    postconditions:
      - Supplier selected
      - Selection documented
      - Ready for PO creation

  # ============================================
  # PURCHASE ORDER USE CASES
  # ============================================
  - id: UC-PR-005
    name: Create Purchase Order
    name_vi: Tạo đơn đặt hàng
    actor: buyer
    priority: high

    description: |
      Create purchase order from approved requisition or
      selected quotation with complete terms and conditions.

    preconditions:
      - Approved requisition or quotation exists
      - Supplier selected and qualified
      - Terms negotiated

    main_flow:
      - step: 1
        action: Initiate PO from source
        system_action: Copy details from requisition/quotation
      - step: 2
        action: Verify/update supplier info
        system_action: Pull current supplier master data
      - step: 3
        action: Confirm pricing and terms
        system_action: Apply contract pricing if applicable
      - step: 4
        action: Set delivery schedule
        system_action: Calculate required dates
      - step: 5
        action: Add special instructions
        system_action: Include packaging, shipping requirements
      - step: 6
        action: Submit for approval (if required)
        system_action: Route per approval matrix
      - step: 7
        action: Transmit to supplier
        system_action: Send via email/EDI/portal

    postconditions:
      - PO created and approved
      - Sent to supplier
      - Budget committed

  - id: UC-PR-006
    name: Change Purchase Order
    name_vi: Thay đổi đơn đặt hàng
    actor: buyer
    priority: medium

    description: |
      Modify existing purchase order for quantity, date,
      price, or other terms changes.

    preconditions:
      - PO exists and not closed
      - Change is warranted and approved

    main_flow:
      - step: 1
        action: Open PO for change
        system_action: Display current PO details
      - step: 2
        action: Make required changes
        system_action: Track all modifications
      - step: 3
        action: Document change reason
        system_action: Require reason code and notes
      - step: 4
        action: Submit change for approval
        system_action: Route if value increase
      - step: 5
        action: Notify supplier of change
        system_action: Send PO amendment

    alternative_flows:
      - id: AF1
        name: Supplier-Initiated Change
        trigger: Supplier requests change
        steps:
          - Review supplier request
          - Evaluate impact
          - Negotiate if needed
          - Process accepted changes

    postconditions:
      - PO updated
      - Change history recorded
      - Supplier notified

  - id: UC-PR-007
    name: Expedite Purchase Order
    name_vi: Đẩy nhanh đơn đặt hàng
    actor: buyer
    priority: high

    description: |
      Follow up on late or at-risk purchase orders to
      ensure timely delivery.

    preconditions:
      - PO is open
      - Delivery at risk or late

    main_flow:
      - step: 1
        action: Identify at-risk orders
        system_action: Generate expedite report
      - step: 2
        action: Contact supplier
        system_action: Log contact attempt
      - step: 3
        action: Obtain delivery commitment
        system_action: Update expected date
      - step: 4
        action: Assess alternatives if needed
        system_action: Identify backup sources
      - step: 5
        action: Communicate to stakeholders
        system_action: Notify requesters of status

    postconditions:
      - Delivery status updated
      - Stakeholders informed
      - Actions documented

  # ============================================
  # SUPPLIER MANAGEMENT USE CASES
  # ============================================
  - id: UC-PR-008
    name: Qualify New Supplier
    name_vi: Đánh giá nhà cung cấp mới
    actor: supplier_quality
    priority: medium

    description: |
      Evaluate and approve new supplier for inclusion in
      approved supplier list.

    preconditions:
      - New supplier identified
      - Qualification request submitted

    main_flow:
      - step: 1
        action: Initiate qualification
        system_action: Create supplier assessment record
      - step: 2
        action: Send qualification questionnaire
        system_action: Generate and send SQ
      - step: 3
        action: Review questionnaire responses
        system_action: Score responses
      - step: 4
        action: Conduct supplier audit (if required)
        system_action: Schedule and document audit
      - step: 5
        action: Evaluate sample parts (if required)
        system_action: Record PPAP/FAI results
      - step: 6
        action: Make qualification decision
        system_action: Approve/reject/conditional
      - step: 7
        action: Set up supplier master
        system_action: Create/update supplier record

    alternative_flows:
      - id: AF1
        name: Conditional Approval
        trigger: Minor gaps in qualification
        steps:
          - Approve with conditions
          - Set improvement timeline
          - Schedule follow-up review

    postconditions:
      - Supplier qualified or rejected
      - Documentation complete
      - Master data updated

  - id: UC-PR-009
    name: Evaluate Supplier Performance
    name_vi: Đánh giá hiệu suất nhà cung cấp
    actor: supplier_quality
    priority: medium

    description: |
      Periodic assessment of supplier performance against
      key metrics for continuous improvement.

    preconditions:
      - Supplier has delivery history
      - Review period complete

    main_flow:
      - step: 1
        action: Generate performance report
        system_action: Calculate metrics (OTD, quality, cost)
      - step: 2
        action: Review delivery performance
        system_action: Display on-time delivery %
      - step: 3
        action: Review quality performance
        system_action: Display defect rate, NCRs
      - step: 4
        action: Review cost performance
        system_action: Display price variance, value add
      - step: 5
        action: Calculate overall score
        system_action: Apply weighted scorecard
      - step: 6
        action: Determine actions
        system_action: Flag for development, maintain, exit
      - step: 7
        action: Communicate to supplier
        system_action: Generate and send scorecard

    postconditions:
      - Performance documented
      - Scorecard shared
      - Actions identified

  - id: UC-PR-010
    name: Manage Supplier Contract
    name_vi: Quản lý hợp đồng nhà cung cấp
    actor: senior_buyer
    priority: medium

    description: |
      Create and manage supplier contracts including
      pricing agreements, terms, and renewals.

    preconditions:
      - Supplier qualified
      - Contract need identified

    main_flow:
      - step: 1
        action: Draft contract terms
        system_action: Use contract template
      - step: 2
        action: Negotiate with supplier
        system_action: Track negotiation history
      - step: 3
        action: Route for internal approval
        system_action: Legal, finance, management review
      - step: 4
        action: Execute contract
        system_action: Record signatures, effective date
      - step: 5
        action: Set up pricing in system
        system_action: Create info records, scheduling agreements
      - step: 6
        action: Monitor contract utilization
        system_action: Track spend against contract

    postconditions:
      - Contract executed
      - Pricing activated
      - Monitoring enabled

  # ============================================
  # INVOICE PROCESSING USE CASES
  # ============================================
  - id: UC-PR-011
    name: Process Supplier Invoice
    name_vi: Xử lý hóa đơn nhà cung cấp
    actor: buyer
    priority: high

    description: |
      Verify and approve supplier invoice for payment
      through three-way matching process.

    preconditions:
      - Invoice received from supplier
      - Related PO exists
      - Goods receipt posted

    main_flow:
      - step: 1
        action: Receive and log invoice
        system_action: Capture invoice details
      - step: 2
        action: Match to PO
        system_action: Auto-match based on PO number
      - step: 3
        action: Match to goods receipt
        system_action: Verify quantities received
      - step: 4
        action: Verify pricing
        system_action: Compare to PO pricing
      - step: 5
        action: Check three-way match
        system_action: Calculate variances
      - step: 6
        action: Approve for payment
        system_action: Route to AP for payment

    alternative_flows:
      - id: AF1
        name: Price Variance
        trigger: Invoice price differs from PO
        steps:
          - Investigate variance
          - Contact supplier if error
          - Approve with justification or reject

      - id: AF2
        name: Quantity Variance
        trigger: Invoice quantity differs from receipt
        steps:
          - Verify receipt quantities
          - Contact warehouse if needed
          - Adjust or dispute

    postconditions:
      - Invoice verified
      - Approved for payment
      - Variance resolved

  # ============================================
  # REPORTING USE CASES
  # ============================================
  - id: UC-PR-012
    name: Analyze Spend
    name_vi: Phân tích chi tiêu
    actor: procurement_manager
    priority: medium

    description: |
      Analyze purchasing spend by category, supplier, and
      period for strategic sourcing decisions.

    preconditions:
      - Transaction history available
      - Reporting period defined

    main_flow:
      - step: 1
        action: Select analysis parameters
        system_action: Set date range, categories, suppliers
      - step: 2
        action: Generate spend report
        system_action: Aggregate PO and invoice data
      - step: 3
        action: View by category
        system_action: Display category breakdown
      - step: 4
        action: View by supplier
        system_action: Display supplier concentration
      - step: 5
        action: Identify opportunities
        system_action: Highlight consolidation potential
      - step: 6
        action: Export for further analysis
        system_action: Generate Excel/CSV export

    postconditions:
      - Spend analysis complete
      - Opportunities identified

compliance_mapping:
  - standard: SOX
    use_cases:
      - UC-PR-002
      - UC-PR-005
      - UC-PR-011
    requirements:
      - Segregation of duties
      - Approval documentation
      - Three-way match

  - standard: ISO 9001
    use_cases:
      - UC-PR-008
      - UC-PR-009
    requirements:
      - Supplier evaluation
      - Performance monitoring
      - Documentation control

integration_points:
  - system: ERP
    use_cases: all
    features:
      - PO management
      - Invoice processing
      - Budget control

  - system: Supplier Portal
    use_cases:
      - UC-PR-003
      - UC-PR-005
      - UC-PR-006
    features:
      - RFQ distribution
      - PO transmission
      - ASN receipt
