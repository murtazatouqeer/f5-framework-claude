name: Supplier
display_name: Supplier / Nhà cung cấp
description: |
  Master data for suppliers/vendors providing materials and services.
  Includes qualification status, performance metrics, payment terms,
  and compliance documentation.

domain: manufacturing
subdomain: inventory
category: master_data

attributes:
  # Identification
  - name: id
    type: uuid
    required: true
    description: Unique identifier

  - name: supplier_code
    type: string
    required: true
    description: System-generated supplier code
    validation:
      pattern: "^SUP-[0-9]{6}$"
    example: "SUP-000123"

  - name: status
    type: enum
    required: true
    description: Supplier status
    validation:
      values: [prospect, pending_approval, approved, blocked, inactive]
    default: prospect

  - name: supplier_type
    type: enum
    required: true
    description: Type of supplier
    validation:
      values: [manufacturer, distributor, wholesaler, trader, service_provider, subcontractor]

  # Company information
  - name: company_name
    type: string
    required: true
    description: Legal company name
    validation:
      max_length: 200

  - name: trade_name
    type: string
    required: false
    description: Trading name / DBA
    validation:
      max_length: 100

  - name: tax_id
    type: string
    required: true
    description: Tax identification number
    validation:
      max_length: 20

  - name: business_registration
    type: string
    required: false
    description: Business registration number
    validation:
      max_length: 30

  - name: duns_number
    type: string
    required: false
    description: D-U-N-S number
    validation:
      pattern: "^[0-9]{9}$"

  - name: industry
    type: string
    required: false
    description: Industry classification
    validation:
      max_length: 100

  - name: company_size
    type: enum
    required: false
    description: Company size category
    validation:
      values: [micro, small, medium, large, enterprise]

  - name: year_established
    type: integer
    required: false
    description: Year company was established
    validation:
      min: 1800
      max: 2100

  # Address
  - name: primary_address
    type: object
    required: true
    description: Main business address
    example:
      street: "456 Industrial Park"
      city: "Binh Duong"
      province: "Binh Duong"
      postal_code: "820000"
      country: "VN"

  - name: shipping_address
    type: object
    required: false
    description: Default shipping address

  - name: billing_address
    type: object
    required: false
    description: Invoicing address

  # Contact
  - name: primary_contact_name
    type: string
    required: true
    description: Main contact person
    validation:
      max_length: 100

  - name: primary_phone
    type: string
    required: true
    description: Main phone number
    validation:
      max_length: 20

  - name: primary_email
    type: string
    required: true
    description: Main email address
    validation:
      format: email
      max_length: 100

  - name: website
    type: string
    required: false
    description: Company website
    validation:
      format: url
      max_length: 200

  - name: fax
    type: string
    required: false
    description: Fax number
    validation:
      max_length: 20

  # Payment
  - name: payment_terms
    type: string
    required: true
    description: Default payment terms
    validation:
      max_length: 20
    default: "NET30"

  - name: payment_method
    type: enum
    required: true
    description: Preferred payment method
    validation:
      values: [bank_transfer, check, cash, letter_of_credit, credit_card]
    default: bank_transfer

  - name: currency
    type: string
    required: true
    description: Transaction currency
    validation:
      pattern: "^[A-Z]{3}$"
    default: "VND"

  - name: credit_limit
    type: decimal
    required: false
    description: Credit limit amount
    validation:
      min: 0
      precision: 2

  - name: credit_balance
    type: decimal
    required: false
    description: Current outstanding balance
    validation:
      precision: 2
    default: 0

  # Bank details
  - name: bank_name
    type: string
    required: false
    description: Bank name
    validation:
      max_length: 100

  - name: bank_account
    type: string
    required: false
    description: Bank account number
    validation:
      max_length: 30

  - name: bank_branch
    type: string
    required: false
    description: Bank branch
    validation:
      max_length: 100

  - name: swift_code
    type: string
    required: false
    description: SWIFT/BIC code
    validation:
      pattern: "^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$"

  # Qualification
  - name: qualification_status
    type: enum
    required: false
    description: Vendor qualification status
    validation:
      values: [not_started, in_progress, qualified, conditionally_qualified, disqualified]
    default: not_started

  - name: qualification_date
    type: date
    required: false
    description: Last qualification date

  - name: qualification_expiry
    type: date
    required: false
    description: Qualification expiry date

  - name: audited
    type: boolean
    required: false
    description: Supplier audit completed
    default: false

  - name: last_audit_date
    type: date
    required: false
    description: Last audit date

  - name: audit_score
    type: decimal
    required: false
    description: Audit score (0-100)
    validation:
      min: 0
      max: 100

  # Certifications
  - name: certifications
    type: array
    required: false
    description: List of certifications
    items:
      type: object
      properties:
        name: string
        number: string
        issued_by: string
        valid_from: date
        valid_to: date
    example:
      - name: "ISO 9001:2015"
        number: "ISO-12345"
        issued_by: "Bureau Veritas"
        valid_from: "2023-01-01"
        valid_to: "2026-01-01"

  - name: iso_9001
    type: boolean
    required: false
    description: Has ISO 9001 certification
    default: false

  - name: iso_14001
    type: boolean
    required: false
    description: Has ISO 14001 certification
    default: false

  - name: iso_45001
    type: boolean
    required: false
    description: Has ISO 45001 certification
    default: false

  # Performance metrics
  - name: overall_rating
    type: decimal
    required: false
    description: Overall performance rating (1-5)
    validation:
      min: 1
      max: 5
      precision: 2

  - name: quality_rating
    type: decimal
    required: false
    description: Quality performance rating
    validation:
      min: 1
      max: 5
      precision: 2

  - name: delivery_rating
    type: decimal
    required: false
    description: Delivery performance rating
    validation:
      min: 1
      max: 5
      precision: 2

  - name: price_rating
    type: decimal
    required: false
    description: Price competitiveness rating
    validation:
      min: 1
      max: 5
      precision: 2

  - name: service_rating
    type: decimal
    required: false
    description: Service/support rating
    validation:
      min: 1
      max: 5
      precision: 2

  - name: on_time_delivery_rate
    type: decimal
    required: false
    description: On-time delivery percentage
    validation:
      min: 0
      max: 100
    computed: true

  - name: quality_acceptance_rate
    type: decimal
    required: false
    description: Quality acceptance percentage
    validation:
      min: 0
      max: 100
    computed: true

  - name: defect_rate
    type: decimal
    required: false
    description: Defect rate (PPM)
    validation:
      min: 0

  - name: total_orders
    type: integer
    required: false
    description: Total orders placed
    default: 0

  - name: total_spend
    type: decimal
    required: false
    description: Total spend amount
    validation:
      precision: 2
    default: 0

  # Classification
  - name: strategic_importance
    type: enum
    required: false
    description: Strategic importance level
    validation:
      values: [strategic, preferred, approved, transactional]
    default: approved

  - name: risk_level
    type: enum
    required: false
    description: Supply risk level
    validation:
      values: [low, medium, high, critical]
    default: medium

  - name: sole_source
    type: boolean
    required: false
    description: Is sole source supplier
    default: false

  - name: minority_owned
    type: boolean
    required: false
    description: Minority-owned business
    default: false

  - name: local_supplier
    type: boolean
    required: false
    description: Local/domestic supplier
    default: false

  # Capabilities
  - name: capabilities
    type: array
    required: false
    description: Supplier capabilities
    items:
      type: string
    example: ["CNC machining", "Injection molding", "Surface treatment"]

  - name: material_groups
    type: array
    required: false
    description: Material groups supplied
    items:
      type: string

  - name: min_order_value
    type: decimal
    required: false
    description: Minimum order value
    validation:
      min: 0

  - name: lead_time_days
    type: integer
    required: false
    description: Standard lead time
    validation:
      min: 0

  # Notes and documents
  - name: notes
    type: string
    required: false
    description: Internal notes
    validation:
      max_length: 2000

  - name: documents
    type: array
    required: false
    description: Related documents
    items:
      type: object
      properties:
        name: string
        type: string
        url: string
        uploaded_at: timestamp

  # Blocking
  - name: blocked
    type: boolean
    required: true
    description: Supplier is blocked
    default: false

  - name: blocked_reason
    type: string
    required: false
    description: Reason for blocking
    validation:
      max_length: 500

  - name: blocked_at
    type: timestamp
    required: false
    description: Block timestamp

  - name: blocked_by
    type: uuid
    required: false
    description: User who blocked

  # Audit
  - name: created_by
    type: uuid
    required: true
    description: User who created

  - name: created_at
    type: timestamp
    required: true
    description: Creation timestamp

  - name: updated_by
    type: uuid
    required: false
    description: Last updated by

  - name: updated_at
    type: timestamp
    required: true
    description: Last update timestamp

  - name: approved_by
    type: uuid
    required: false
    description: User who approved

  - name: approved_at
    type: timestamp
    required: false
    description: Approval timestamp

relationships:
  - name: contacts
    type: has_many
    entity: SupplierContact
    description: Contact persons

  - name: materials
    type: many_to_many
    entity: Material
    through: MaterialSupplier
    description: Materials supplied

  - name: purchase_orders
    type: has_many
    entity: PurchaseOrder
    description: Purchase orders

  - name: quotes
    type: has_many
    entity: SupplierQuote
    description: Quotations provided

  - name: goods_receipts
    type: has_many
    entity: GoodsReceipt
    description: Deliveries received

  - name: contracts
    type: has_many
    entity: FrameworkContract
    description: Framework agreements

  - name: evaluations
    type: has_many
    entity: SupplierEvaluation
    description: Performance evaluations

indexes:
  - [supplier_code]
  - [company_name]
  - [tax_id]
  - [status]
  - [qualification_status]
  - [strategic_importance]
  - [overall_rating]

state_machine:
  initial: prospect
  states:
    prospect:
      description: Potential supplier
      transitions:
        - to: pending_approval
          trigger: submit_for_approval
          condition: has_required_info
    pending_approval:
      description: Awaiting approval
      transitions:
        - to: approved
          trigger: approve
          action: set_approved_timestamp
        - to: prospect
          trigger: reject
    approved:
      description: Approved for use
      transitions:
        - to: blocked
          trigger: block
          action: set_blocked_info
        - to: inactive
          trigger: deactivate
    blocked:
      description: Temporarily blocked
      transitions:
        - to: approved
          trigger: unblock
          action: clear_blocked_info
        - to: inactive
          trigger: deactivate
    inactive:
      description: No longer active
      transitions:
        - to: approved
          trigger: reactivate

business_rules:
  - BR-SUP-001: Supplier code auto-generated as SUP-NNNNNN
  - BR-SUP-002: Tax ID required and must be unique
  - BR-SUP-003: Cannot order from unapproved suppliers
  - BR-SUP-004: Cannot order from blocked suppliers
  - BR-SUP-005: Qualification required for strategic suppliers
  - BR-SUP-006: Payment terms must be configured
  - BR-SUP-007: Bank details required for payment method = bank_transfer
  - BR-SUP-008: Blocked reason required when blocking
  - BR-SUP-009: Performance metrics recalculated monthly
  - BR-SUP-010: Qualification expiry triggers review workflow

events:
  - name: supplier.created
    payload: [id, supplier_code, company_name]
    description: Supplier created

  - name: supplier.approved
    payload: [id, supplier_code, approved_by]
    description: Supplier approved

  - name: supplier.blocked
    payload: [id, supplier_code, reason]
    description: Supplier blocked

  - name: supplier.unblocked
    payload: [id, supplier_code]
    description: Supplier unblocked

  - name: supplier.qualification_expired
    payload: [id, supplier_code, qualification_expiry]
    description: Qualification expired

  - name: supplier.rating_changed
    payload: [id, supplier_code, overall_rating, previous_rating]
    description: Rating changed significantly
