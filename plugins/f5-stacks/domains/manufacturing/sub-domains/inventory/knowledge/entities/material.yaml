name: Material
display_name: Material / Vật tư
description: |
  Master data for all materials used in manufacturing operations.
  Includes raw materials, components, semi-finished goods, finished goods,
  consumables, spare parts, and packaging materials.

domain: manufacturing
subdomain: inventory
category: master_data

attributes:
  # Identification
  - name: id
    type: uuid
    required: true
    description: Unique identifier

  - name: material_code
    type: string
    required: true
    description: System-generated material code
    validation:
      pattern: "^MAT-[A-Z0-9]{8}$"
    example: "MAT-RM001234"

  - name: material_number
    type: string
    required: true
    description: SKU or part number
    validation:
      max_length: 40
    example: "STEEL-PLATE-5MM"

  - name: status
    type: enum
    required: true
    description: Material status
    validation:
      values: [active, obsolete, blocked, pending_approval]
    default: pending_approval

  - name: material_type
    type: enum
    required: true
    description: Type of material
    validation:
      values: [raw_material, component, semi_finished, finished_goods, consumable, spare_part, packaging, trading_goods]

  # Description
  - name: name
    type: string
    required: true
    description: Material name
    validation:
      max_length: 100

  - name: description
    type: string
    required: false
    description: Detailed description
    validation:
      max_length: 1000

  - name: material_group
    type: string
    required: true
    description: Material group code for classification
    validation:
      max_length: 20
    example: "RAW-METAL"

  - name: material_category
    type: string
    required: false
    description: Sub-category within group
    validation:
      max_length: 50

  # Specifications
  - name: unit_of_measure
    type: enum
    required: true
    description: Base unit of measure
    validation:
      values: [piece, kg, gram, liter, ml, meter, cm, sqm, cbm, box, pallet, roll, sheet, set]
    default: piece

  - name: weight_kg
    type: decimal
    required: false
    description: Weight per unit in kilograms
    validation:
      min: 0
      precision: 6

  - name: volume_cbm
    type: decimal
    required: false
    description: Volume per unit in cubic meters
    validation:
      min: 0
      precision: 6

  - name: dimensions
    type: object
    required: false
    description: Physical dimensions
    example:
      length_cm: 100
      width_cm: 50
      height_cm: 10

  - name: shelf_life_days
    type: integer
    required: false
    description: Shelf life in days (null = unlimited)
    validation:
      min: 1

  # Procurement
  - name: procurement_type
    type: enum
    required: true
    description: How material is procured
    validation:
      values: [in_house, external, both]
    default: external

  - name: default_supplier_id
    type: uuid
    required: false
    description: Default supplier for procurement

  - name: lead_time_days
    type: integer
    required: true
    description: Standard procurement lead time
    validation:
      min: 0
    default: 7

  - name: minimum_order_qty
    type: decimal
    required: false
    description: Minimum order quantity
    validation:
      min: 0
    default: 1

  - name: order_multiple
    type: decimal
    required: false
    description: Order quantity must be multiple of this
    validation:
      min: 0
    default: 1

  - name: maximum_order_qty
    type: decimal
    required: false
    description: Maximum order quantity per order
    validation:
      min: 0

  # Planning (MRP)
  - name: mrp_type
    type: enum
    required: true
    description: MRP planning type
    validation:
      values: [pd, nd, vb, vm, v1, v2]
    default: pd
    note: |
      pd = MRP planned
      nd = No planning
      vb = Manual reorder point
      vm = Automatic reorder point
      v1 = Manual reorder with forecast
      v2 = Automatic reorder with forecast

  - name: mrp_controller
    type: string
    required: false
    description: MRP controller group
    validation:
      max_length: 10

  - name: safety_stock
    type: decimal
    required: false
    description: Safety stock quantity
    validation:
      min: 0
    default: 0

  - name: reorder_point
    type: decimal
    required: false
    description: Reorder point quantity
    validation:
      min: 0

  - name: max_stock_level
    type: decimal
    required: false
    description: Maximum stock level
    validation:
      min: 0

  - name: lot_size_type
    type: enum
    required: false
    description: Lot sizing procedure
    validation:
      values: [fixed, eoq, lot_for_lot, period_lot, replenish_to_max]
    default: fixed

  - name: fixed_lot_size
    type: decimal
    required: false
    description: Fixed lot size if lot_size_type = fixed
    validation:
      min: 0

  - name: rounding_value
    type: decimal
    required: false
    description: Round order quantity to this value
    validation:
      min: 0

  # Costing
  - name: standard_cost
    type: decimal
    required: false
    description: Standard cost per unit
    validation:
      min: 0
      precision: 4

  - name: moving_average_price
    type: decimal
    required: false
    description: Moving average price per unit
    validation:
      min: 0
      precision: 4

  - name: last_purchase_price
    type: decimal
    required: false
    description: Last purchase price
    validation:
      min: 0
      precision: 4

  - name: currency
    type: string
    required: true
    description: Price currency
    validation:
      pattern: "^[A-Z]{3}$"
    default: "VND"

  - name: price_unit
    type: integer
    required: true
    description: Price per X units
    default: 1
    example: "100 means price is per 100 units"

  - name: valuation_class
    type: string
    required: false
    description: GL account determination class
    validation:
      max_length: 10

  - name: costing_method
    type: enum
    required: true
    description: Inventory costing method
    validation:
      values: [standard, moving_average, fifo, lifo, specific_identification]
    default: moving_average

  # Quality
  - name: inspection_required
    type: boolean
    required: true
    description: Quality inspection required on receipt
    default: false

  - name: quality_inspection_type
    type: string
    required: false
    description: Type of quality inspection
    validation:
      max_length: 20

  - name: shelf_life_required
    type: boolean
    required: true
    description: Material has expiry date tracking
    default: false

  - name: certificate_required
    type: boolean
    required: false
    description: Certificate of analysis required
    default: false

  # Storage
  - name: storage_conditions
    type: enum
    required: true
    description: Required storage conditions
    validation:
      values: [ambient, temperature_controlled, cold, frozen, hazardous, clean_room]
    default: ambient

  - name: storage_temperature_min
    type: decimal
    required: false
    description: Minimum storage temperature (Celsius)

  - name: storage_temperature_max
    type: decimal
    required: false
    description: Maximum storage temperature (Celsius)

  - name: batch_managed
    type: boolean
    required: true
    description: Track inventory by batch/lot
    default: false

  - name: serial_managed
    type: boolean
    required: true
    description: Track inventory by serial number
    default: false

  - name: default_storage_location_id
    type: uuid
    required: false
    description: Default storage location

  # Classification
  - name: abc_class
    type: enum
    required: false
    description: ABC classification
    validation:
      values: [A, B, C]
    note: "A = High value, B = Medium value, C = Low value"

  - name: xyz_class
    type: enum
    required: false
    description: XYZ classification by consumption variability
    validation:
      values: [X, Y, Z]
    note: "X = Stable, Y = Variable, Z = Erratic"

  - name: criticality
    type: enum
    required: false
    description: Criticality for production
    validation:
      values: [critical, important, standard]

  - name: hazardous
    type: boolean
    required: false
    description: Is hazardous material
    default: false

  - name: hazard_class
    type: string
    required: false
    description: UN hazard classification
    validation:
      max_length: 20

  # Documents
  - name: drawing_number
    type: string
    required: false
    description: Engineering drawing reference
    validation:
      max_length: 50

  - name: specification_url
    type: string
    required: false
    description: Link to specification document

  - name: image_url
    type: string
    required: false
    description: Material image

  # Audit
  - name: created_by
    type: uuid
    required: true
    description: User who created

  - name: created_at
    type: timestamp
    required: true
    description: Creation timestamp

  - name: updated_by
    type: uuid
    required: false
    description: Last updated by

  - name: updated_at
    type: timestamp
    required: true
    description: Last update timestamp

  - name: approved_by
    type: uuid
    required: false
    description: User who approved (if pending_approval)

  - name: approved_at
    type: timestamp
    required: false
    description: Approval timestamp

relationships:
  - name: default_supplier
    type: belongs_to
    entity: Supplier
    required: false
    description: Default supplier for this material

  - name: approved_suppliers
    type: many_to_many
    entity: Supplier
    through: MaterialSupplier
    description: List of approved suppliers

  - name: inventory_records
    type: has_many
    entity: Inventory
    description: Inventory records across locations

  - name: purchase_order_lines
    type: has_many
    entity: PurchaseOrderLine
    description: Purchase order lines for this material

  - name: material_requirements
    type: has_many
    entity: MaterialRequirement
    description: MRP requirements

  - name: reorder_points
    type: has_many
    entity: ReorderPoint
    description: Reorder point configurations by location

  - name: default_storage_location
    type: belongs_to
    entity: StockLocation
    required: false
    description: Default storage location

indexes:
  - [material_code]
  - [material_number]
  - [status]
  - [material_type]
  - [material_group]
  - [default_supplier_id]
  - [abc_class]
  - [mrp_type]

business_rules:
  - BR-MAT-001: Material code auto-generated in format MAT-XXXXXXXX
  - BR-MAT-002: Material number must be unique within organization
  - BR-MAT-003: New materials require approval before use
  - BR-MAT-004: Batch management mandatory for shelf life materials
  - BR-MAT-005: Safety stock >= 0 for all materials
  - BR-MAT-006: Lead time mandatory for external procurement
  - BR-MAT-007: Inspection required for critical materials
  - BR-MAT-008: Standard cost required for standard costing method
  - BR-MAT-009: Hazardous materials require hazard class
  - BR-MAT-010: Obsolete materials cannot be used in new orders

events:
  - name: material.created
    payload: [id, material_code, material_type]
    description: New material created

  - name: material.approved
    payload: [id, material_code, approved_by]
    description: Material approved for use

  - name: material.updated
    payload: [id, material_code, changed_fields]
    description: Material master updated

  - name: material.blocked
    payload: [id, material_code, reason]
    description: Material blocked

  - name: material.obsoleted
    payload: [id, material_code]
    description: Material marked obsolete
