name: player
display_name: Player
description: |
  Core entity representing a gaming platform user.
  Contains account info, stats, social features, and economy data.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique player identifier
    example: "plr_550e8400-e29b-41d4-a716-446655440000"

  - name: player_id
    type: string
    required: true
    unique: true
    pattern: "^PLR-[A-Z0-9]{8}$"
    description: Public player ID
    example: "PLR-A1B2C3D4"

  - name: username
    type: string
    required: true
    unique: true
    min_length: 3
    max_length: 20
    pattern: "^[a-zA-Z0-9_-]+$"
    description: Unique login username

  - name: display_name
    type: string
    required: true
    max_length: 30
    description: Displayed name (can have special chars)

  - name: email
    type: email
    required: true
    unique: true
    description: Account email

  # Status
  - name: status
    type: enum
    values: [active, suspended, banned, inactive, deleted]
    required: true
    default: active
    description: Account status

  - name: account_type
    type: enum
    values: [free, premium, vip, creator, staff]
    required: true
    default: free
    description: Account tier

  - name: verified
    type: boolean
    required: true
    default: false
    description: Email/identity verified

  # Profile
  - name: avatar_url
    type: url
    required: false
    description: Profile picture URL

  - name: avatar_frame_id
    type: string
    required: false
    description: Equipped avatar frame

  - name: banner_url
    type: url
    required: false
    description: Profile banner image

  - name: bio
    type: string
    required: false
    max_length: 500
    description: Profile bio text

  - name: country
    type: string
    required: false
    description: Player's country code
    example: "US"

  - name: timezone
    type: string
    required: false
    description: Player's timezone
    example: "America/New_York"

  - name: language
    type: string
    required: true
    default: "en"
    description: Preferred language

  - name: privacy_level
    type: enum
    values: [public, friends_only, private]
    required: true
    default: public
    description: Profile visibility

  # Platform Stats
  - name: level
    type: integer
    required: true
    default: 1
    min: 1
    description: Platform level

  - name: xp
    type: integer
    required: true
    default: 0
    description: Current XP in level

  - name: total_xp
    type: bigint
    required: true
    default: 0
    description: Lifetime XP earned

  - name: playtime_hours
    type: decimal
    required: true
    default: 0
    description: Total playtime across all games

  - name: games_owned
    type: integer
    required: true
    default: 0
    description: Number of games owned

  - name: achievements_unlocked
    type: integer
    required: true
    default: 0
    description: Total achievements unlocked

  # Social
  - name: friends_count
    type: integer
    required: true
    default: 0
    description: Number of friends

  - name: guild_id
    type: uuid
    required: false
    description: Primary guild membership

  - name: online_status
    type: enum
    values: [online, offline, away, in_game, do_not_disturb, invisible]
    required: true
    default: offline
    description: Current online status

  - name: last_online_at
    type: datetime
    required: false
    description: Last seen timestamp

  - name: currently_playing
    type: uuid
    required: false
    description: Currently playing game ID

  # Reputation
  - name: reputation_score
    type: integer
    required: true
    default: 100
    description: Community reputation score

  - name: reports_received
    type: integer
    required: true
    default: 0
    description: Times reported by others

  - name: reports_filed
    type: integer
    required: true
    default: 0
    description: Reports submitted

  - name: warnings_count
    type: integer
    required: true
    default: 0
    description: Active warnings

  - name: muted_until
    type: datetime
    required: false
    description: Chat mute expiry

  - name: banned_until
    type: datetime
    required: false
    description: Temp ban expiry

  - name: ban_reason
    type: string
    required: false
    description: Reason for current ban

  # Economy
  - name: premium_currency
    type: bigint
    required: true
    default: 0
    description: Premium (paid) currency balance

  - name: soft_currency
    type: bigint
    required: true
    default: 0
    description: Soft (earned) currency balance

  - name: vip_status
    type: boolean
    required: true
    default: false
    description: VIP subscription active

  - name: vip_tier
    type: integer
    required: false
    description: VIP tier level

  - name: vip_expiry
    type: datetime
    required: false
    description: VIP subscription expiry

  - name: total_spent
    type: decimal
    required: true
    default: 0
    description: Lifetime spending (USD)

  # Security
  - name: two_factor_enabled
    type: boolean
    required: true
    default: false
    description: 2FA enabled

  - name: linked_accounts
    type: json
    required: false
    description: Linked social accounts

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true
    description: Account creation timestamp

  - name: updated_at
    type: datetime
    required: true
    auto: true
    description: Last update timestamp

  - name: last_login_at
    type: datetime
    required: false
    description: Last login timestamp

  - name: registered_ip
    type: string
    required: false
    description: Registration IP (hashed)

relationships:
  - name: game_profiles
    type: has_many
    target: player_profile
    foreign_key: player_id
    description: Game-specific profiles

  - name: sessions
    type: has_many
    target: game_session
    foreign_key: player_id
    description: Game sessions

  - name: inventory
    type: has_many
    target: inventory
    foreign_key: player_id
    description: Owned items

  - name: friends
    type: has_many
    target: friend
    foreign_key: player_id
    description: Friend relationships

  - name: guild_membership
    type: belongs_to
    target: guild
    foreign_key: guild_id
    description: Primary guild

  - name: transactions
    type: has_many
    target: transaction
    foreign_key: player_id
    description: Purchase history

  - name: save_data
    type: has_many
    target: save_data
    foreign_key: player_id
    description: Game saves

state_machine:
  initial: active
  states:
    - name: active
      description: Normal active account
      allowed_transitions: [suspended, banned, inactive]

    - name: suspended
      description: Temporarily restricted
      allowed_transitions: [active, banned]

    - name: banned
      description: Permanently banned
      allowed_transitions: [active]
      requires_role: admin

    - name: inactive
      description: Dormant account
      allowed_transitions: [active, deleted]

    - name: deleted
      description: Account deleted
      allowed_transitions: []
      terminal: true

indexes:
  - name: idx_player_username
    fields: [username]
    type: unique

  - name: idx_player_email
    fields: [email]
    type: unique

  - name: idx_player_id
    fields: [player_id]
    type: unique

  - name: idx_player_status
    fields: [status]
    type: btree

  - name: idx_player_guild
    fields: [guild_id]
    type: btree

  - name: idx_player_online
    fields: [online_status, last_online_at]
    type: btree

validations:
  - name: valid_username
    condition: "username ~ '^[a-zA-Z0-9_-]+$'"
    message: "Username can only contain letters, numbers, underscore, hyphen"

  - name: valid_reputation
    condition: "reputation_score >= 0 AND reputation_score <= 1000"
    message: "Reputation must be between 0 and 1000"

business_rules:
  - rule: moderation-rules
    description: Player conduct and moderation
  - rule: progression-rules
    description: Level and XP progression
