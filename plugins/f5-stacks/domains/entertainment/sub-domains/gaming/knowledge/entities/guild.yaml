name: guild
display_name: Guild
description: |
  Represents a player organization (clan, guild, team).
  Manages membership, hierarchy, and guild resources.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique guild identifier

  - name: guild_id
    type: string
    required: true
    unique: true
    description: Public guild ID
    example: "GLD-DRAGONS-001"

  - name: tag
    type: string
    required: true
    unique: true
    min_length: 2
    max_length: 6
    description: Short clan tag
    example: "DRG"

  # Display
  - name: name
    type: string
    required: true
    max_length: 50
    description: Guild name
    example: "Dragon Warriors"

  - name: description
    type: string
    required: false
    max_length: 1000
    description: Guild description

  - name: motto
    type: string
    required: false
    max_length: 100
    description: Guild motto/slogan

  - name: emblem_url
    type: url
    required: false
    description: Guild emblem/logo

  - name: banner_url
    type: url
    required: false
    description: Guild banner

  - name: primary_color
    type: string
    required: false
    description: Guild primary color
    example: "#FF0000"

  - name: secondary_color
    type: string
    required: false

  # Status
  - name: status
    type: enum
    values: [active, inactive, suspended, disbanded]
    required: true
    default: active

  - name: visibility
    type: enum
    values: [public, private, invite_only]
    required: true
    default: public

  # Game Context
  - name: game_id
    type: uuid
    required: false
    description: Game-specific guild (null = platform-wide)

  - name: region
    type: string
    required: false
    description: Guild region/server

  # Membership
  - name: leader_id
    type: uuid
    required: true
    description: Guild leader player ID

  - name: member_count
    type: integer
    required: true
    default: 1

  - name: max_members
    type: integer
    required: true
    default: 50

  - name: min_level_requirement
    type: integer
    required: false
    description: Minimum level to join

  - name: min_rank_requirement
    type: string
    required: false
    description: Minimum competitive rank

  - name: application_required
    type: boolean
    required: true
    default: false

  # Progression
  - name: level
    type: integer
    required: true
    default: 1
    description: Guild level

  - name: xp
    type: bigint
    required: true
    default: 0
    description: Guild XP

  - name: xp_to_next_level
    type: bigint
    required: true
    default: 1000

  # Statistics
  - name: total_xp_earned
    type: bigint
    required: true
    default: 0

  - name: weekly_xp
    type: integer
    required: true
    default: 0

  - name: matches_played
    type: integer
    required: true
    default: 0

  - name: matches_won
    type: integer
    required: true
    default: 0

  - name: tournaments_won
    type: integer
    required: true
    default: 0

  - name: achievements_unlocked
    type: integer
    required: true
    default: 0

  # Resources
  - name: guild_bank
    type: bigint
    required: true
    default: 0
    description: Guild currency balance

  - name: perks_unlocked
    type: array
    items: string
    required: false
    description: Unlocked guild perks

  # Settings
  - name: settings
    type: json
    required: false
    description: |
      Guild settings:
      - auto_accept_applications: false
      - require_discord: false
      - activity_requirement: "weekly"
      - language: "en"

  - name: recruitment_message
    type: string
    required: false
    max_length: 500
    description: Public recruitment message

  # Social
  - name: discord_url
    type: url
    required: false

  - name: website_url
    type: url
    required: false

  # Ranking
  - name: rank
    type: integer
    required: false
    description: Global guild ranking

  - name: rating
    type: integer
    required: false
    description: Guild rating points

  # Timestamps
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

  - name: last_active_at
    type: datetime
    required: false

relationships:
  - name: leader
    type: belongs_to
    target: player
    foreign_key: leader_id

  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: members
    type: has_many
    target: guild_member
    foreign_key: guild_id

  - name: applications
    type: has_many
    target: guild_application
    foreign_key: guild_id

indexes:
  - name: idx_guild_tag
    fields: [tag]
    type: unique

  - name: idx_guild_name
    fields: [name]
    type: btree

  - name: idx_guild_game
    fields: [game_id]
    type: btree

  - name: idx_guild_status
    fields: [status]
    type: btree

  - name: idx_guild_level
    fields: [level]
    type: btree

# Embedded entities
embedded_entities:
  - name: guild_member
    attributes:
      - name: id
        type: uuid
        required: true

      - name: guild_id
        type: uuid
        required: true

      - name: player_id
        type: uuid
        required: true

      - name: role
        type: enum
        values: [leader, officer, veteran, member, recruit]
        required: true
        default: member

      - name: rank_title
        type: string
        required: false
        description: Custom rank title

      - name: permissions
        type: array
        items: string
        required: false
        description: Specific permissions

      - name: contribution_xp
        type: bigint
        required: true
        default: 0

      - name: contribution_currency
        type: bigint
        required: true
        default: 0

      - name: joined_at
        type: datetime
        required: true

      - name: last_active_at
        type: datetime
        required: false

      - name: notes
        type: string
        required: false
        max_length: 500
        description: Officer notes about member

    indexes:
      - name: idx_member_guild
        fields: [guild_id]
        type: btree

      - name: idx_member_player
        fields: [player_id]
        type: btree

      - name: idx_member_unique
        fields: [guild_id, player_id]
        type: unique

  - name: guild_application
    attributes:
      - name: id
        type: uuid
        required: true

      - name: guild_id
        type: uuid
        required: true

      - name: player_id
        type: uuid
        required: true

      - name: status
        type: enum
        values: [pending, accepted, rejected, withdrawn]
        required: true
        default: pending

      - name: message
        type: string
        required: false
        max_length: 500

      - name: reviewed_by
        type: uuid
        required: false

      - name: review_notes
        type: string
        required: false

      - name: created_at
        type: datetime
        required: true

      - name: reviewed_at
        type: datetime
        required: false

state_machine:
  initial: active
  states:
    - name: active
      allowed_transitions: [inactive, suspended, disbanded]

    - name: inactive
      allowed_transitions: [active, disbanded]

    - name: suspended
      allowed_transitions: [active, disbanded]
      requires_role: admin

    - name: disbanded
      allowed_transitions: []
      terminal: true

business_rules:
  - rule: moderation-rules
    description: Guild conduct and moderation
