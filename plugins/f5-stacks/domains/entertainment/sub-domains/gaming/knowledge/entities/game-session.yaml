name: game_session
display_name: Game Session
description: |
  Represents a single play session for a player in a game.
  Tracks duration, performance, and session metadata.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique session identifier

  - name: session_id
    type: string
    required: true
    unique: true
    description: Public session ID
    example: "SES-20240115-ABC123"

  - name: player_id
    type: uuid
    required: true
    description: Player who played

  - name: profile_id
    type: uuid
    required: false
    description: Game-specific profile

  - name: game_id
    type: uuid
    required: true
    description: Game played

  # Status
  - name: status
    type: enum
    values: [initializing, loading, active, paused, completed, crashed, abandoned, disconnected]
    required: true
    default: initializing
    description: Session status

  - name: session_type
    type: enum
    values: [single_player, multiplayer, ranked, casual, tutorial, practice, custom, spectator]
    required: true
    description: Type of session

  # Match Association
  - name: match_id
    type: uuid
    required: false
    description: Associated match (if multiplayer)

  - name: team_id
    type: string
    required: false
    description: Team assignment

  - name: party_id
    type: uuid
    required: false
    description: Party/squad ID

  # Timing
  - name: started_at
    type: datetime
    required: true
    description: Session start time

  - name: ended_at
    type: datetime
    required: false
    description: Session end time

  - name: duration_seconds
    type: integer
    required: false
    description: Total session duration

  - name: active_play_seconds
    type: integer
    required: false
    description: Active play time (excluding pauses)

  - name: pause_time_seconds
    type: integer
    required: false
    default: 0
    description: Total time paused

  - name: loading_time_seconds
    type: integer
    required: false
    description: Time spent loading

  # Performance
  - name: score
    type: bigint
    required: false
    description: Session score

  - name: high_score_achieved
    type: boolean
    required: false
    default: false
    description: New personal best

  - name: level_reached
    type: integer
    required: false
    description: Level/stage reached

  - name: checkpoints_reached
    type: integer
    required: false
    description: Checkpoints passed

  # Match Results (multiplayer)
  - name: result
    type: enum
    values: [win, loss, draw, incomplete, forfeit]
    required: false
    description: Match result

  - name: placement
    type: integer
    required: false
    description: Final placement (battle royale)

  - name: kills
    type: integer
    required: false
    default: 0
    description: Kills in session

  - name: deaths
    type: integer
    required: false
    default: 0
    description: Deaths in session

  - name: assists
    type: integer
    required: false
    default: 0
    description: Assists in session

  - name: damage_dealt
    type: integer
    required: false
    description: Damage dealt

  - name: damage_taken
    type: integer
    required: false
    description: Damage received

  - name: healing_done
    type: integer
    required: false
    description: Healing performed

  # Progress
  - name: xp_earned
    type: integer
    required: false
    default: 0
    description: XP gained this session

  - name: currency_earned
    type: json
    required: false
    description: Currencies earned

  - name: items_collected
    type: array
    items: uuid
    required: false
    description: Items found/earned

  - name: achievements_unlocked
    type: array
    items: uuid
    required: false
    description: Achievements unlocked

  # Game State
  - name: game_mode
    type: string
    required: false
    description: Game mode played

  - name: map_id
    type: string
    required: false
    description: Map/level played

  - name: difficulty
    type: enum
    values: [easy, normal, hard, expert, nightmare]
    required: false
    description: Difficulty setting

  - name: character_used
    type: string
    required: false
    description: Character/class played

  - name: loadout_used
    type: json
    required: false
    description: Equipment/loadout

  # Technical
  - name: platform
    type: enum
    values: [pc, ps5, ps4, xbox_series, xbox_one, switch, mobile_ios, mobile_android, web]
    required: true
    description: Platform played on

  - name: device_info
    type: json
    required: false
    description: Device specifications

  - name: client_version
    type: string
    required: true
    description: Game client version

  - name: server_region
    type: string
    required: false
    description: Server region
    example: "us-west-2"

  - name: ping_average_ms
    type: integer
    required: false
    description: Average latency

  - name: fps_average
    type: integer
    required: false
    description: Average frame rate

  # Exit
  - name: exit_reason
    type: enum
    values: [completed, quit, disconnect, crash, timeout, kicked, banned]
    required: false
    description: Why session ended

  - name: crash_report_id
    type: string
    required: false
    description: Crash report reference

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: player
    type: belongs_to
    target: player
    foreign_key: player_id

  - name: profile
    type: belongs_to
    target: player_profile
    foreign_key: profile_id

  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: match
    type: belongs_to
    target: match
    foreign_key: match_id

indexes:
  - name: idx_session_player
    fields: [player_id]
    type: btree

  - name: idx_session_game
    fields: [game_id]
    type: btree

  - name: idx_session_match
    fields: [match_id]
    type: btree

  - name: idx_session_started
    fields: [started_at]
    type: btree

  - name: idx_session_status
    fields: [status]
    type: btree

business_rules:
  - rule: progression-rules
    description: XP and rewards calculation
