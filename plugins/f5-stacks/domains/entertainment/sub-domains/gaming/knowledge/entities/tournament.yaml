name: tournament
display_name: Tournament
description: |
  Competitive tournament/event for organized play.
  Supports various formats, brackets, and prize distributions.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique tournament identifier

  - name: tournament_id
    type: string
    required: true
    unique: true
    description: Public tournament ID
    example: "TRN-2024-SPRING-001"

  - name: game_id
    type: uuid
    required: true
    description: Game this tournament is for

  # Display
  - name: name
    type: string
    required: true
    max_length: 200
    description: Tournament name
    example: "Spring Championship 2024"

  - name: description
    type: text
    required: false
    max_length: 5000
    description: Tournament details

  - name: banner_url
    type: url
    required: false
    description: Tournament banner image

  - name: logo_url
    type: url
    required: false
    description: Tournament logo

  - name: rules_url
    type: url
    required: false
    description: Link to full rules

  # Status
  - name: status
    type: enum
    values: [draft, announced, registration_open, registration_closed, check_in, in_progress, completed, cancelled]
    required: true
    default: draft

  - name: visibility
    type: enum
    values: [public, invite_only, private]
    required: true
    default: public

  # Format
  - name: tournament_type
    type: enum
    values: [single_elimination, double_elimination, round_robin, swiss, ladder, league]
    required: true

  - name: team_based
    type: boolean
    required: true
    default: false
    description: Teams vs individual players

  - name: team_size
    type: integer
    required: false
    description: Players per team (if team-based)

  - name: best_of
    type: integer
    required: true
    default: 1
    description: Best of X matches per round

  # Game Settings
  - name: game_mode
    type: string
    required: true
    description: Game mode for matches

  - name: map_pool
    type: array
    items: string
    required: false
    description: Allowed maps

  - name: match_settings
    type: json
    required: false
    description: Standard match configuration

  # Schedule
  - name: registration_start
    type: datetime
    required: true

  - name: registration_end
    type: datetime
    required: true

  - name: check_in_start
    type: datetime
    required: false

  - name: check_in_end
    type: datetime
    required: false

  - name: start_date
    type: datetime
    required: true

  - name: end_date
    type: datetime
    required: false

  # Participation
  - name: min_participants
    type: integer
    required: true
    default: 4

  - name: max_participants
    type: integer
    required: true
    default: 64

  - name: registered_count
    type: integer
    required: true
    default: 0

  - name: checked_in_count
    type: integer
    required: false
    default: 0

  # Eligibility
  - name: min_level
    type: integer
    required: false
    description: Minimum player level

  - name: min_rank
    type: string
    required: false
    description: Minimum competitive rank

  - name: region_restriction
    type: array
    items: string
    required: false
    description: Allowed regions

  - name: age_requirement
    type: integer
    required: false
    description: Minimum age

  - name: account_age_days
    type: integer
    required: false
    description: Minimum account age

  # Entry
  - name: entry_fee
    type: decimal
    required: false
    default: 0

  - name: entry_fee_currency
    type: string
    required: false
    default: "USD"

  - name: entry_fee_type
    type: enum
    values: [free, premium_currency, real_money]
    required: true
    default: free

  # Prizes
  - name: prize_pool
    type: decimal
    required: false
    default: 0

  - name: prize_currency
    type: string
    required: false
    default: "USD"

  - name: prizes
    type: json
    required: false
    description: |
      Prize distribution:
      - rank_from: 1, rank_to: 1, prize: {type: "cash", amount: 1000}
      - rank_from: 2, rank_to: 2, prize: {type: "cash", amount: 500}
      - rank_from: 3, rank_to: 4, prize: {type: "item", item_id: "..."}

  - name: participation_rewards
    type: json
    required: false
    description: Rewards for all participants

  # Bracket
  - name: bracket_generated
    type: boolean
    required: true
    default: false

  - name: rounds
    type: json
    required: false
    description: Bracket structure

  - name: current_round
    type: integer
    required: false

  - name: total_rounds
    type: integer
    required: false

  # Seeding
  - name: seeding_method
    type: enum
    values: [random, mmr, manual, registration_order]
    required: true
    default: random

  - name: seeds
    type: json
    required: false
    description: Seed assignments

  # Administration
  - name: organizer_id
    type: uuid
    required: true
    description: Tournament organizer

  - name: admins
    type: array
    items: uuid
    required: false
    description: Tournament admin IDs

  - name: moderators
    type: array
    items: uuid
    required: false
    description: Tournament moderator IDs

  # Results
  - name: winner_id
    type: uuid
    required: false
    description: Winner player/team ID

  - name: runner_up_id
    type: uuid
    required: false

  - name: final_standings
    type: json
    required: false
    description: Final rankings

  # Communication
  - name: discord_url
    type: url
    required: false

  - name: stream_url
    type: url
    required: false

  - name: announcements
    type: json
    required: false

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

  - name: created_by
    type: uuid
    required: true

relationships:
  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: matches
    type: has_many
    target: match
    foreign_key: tournament_id

  - name: participants
    type: has_many
    target: tournament_participant
    foreign_key: tournament_id

state_machine:
  initial: draft
  states:
    - name: draft
      allowed_transitions: [announced]

    - name: announced
      allowed_transitions: [registration_open, cancelled]

    - name: registration_open
      allowed_transitions: [registration_closed, cancelled]

    - name: registration_closed
      allowed_transitions: [check_in, in_progress, cancelled]

    - name: check_in
      allowed_transitions: [in_progress, cancelled]

    - name: in_progress
      allowed_transitions: [completed, cancelled]

    - name: completed
      allowed_transitions: []
      terminal: true

    - name: cancelled
      allowed_transitions: []
      terminal: true

indexes:
  - name: idx_tournament_game
    fields: [game_id]
    type: btree

  - name: idx_tournament_status
    fields: [status]
    type: btree

  - name: idx_tournament_dates
    fields: [start_date, end_date]
    type: btree

business_rules:
  - rule: tournament-rules
    description: Tournament eligibility and format
