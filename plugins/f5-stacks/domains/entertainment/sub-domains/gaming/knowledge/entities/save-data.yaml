name: save_data
display_name: Save Data
description: |
  Represents game progress saves for a player.
  Supports cloud sync, multiple slots, and versioning.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique save identifier

  - name: save_id
    type: string
    required: true
    unique: true
    description: Public save ID
    example: "SAV-ABC123XYZ"

  - name: player_id
    type: uuid
    required: true
    description: Player who owns this save

  - name: game_id
    type: uuid
    required: true
    description: Game this save belongs to

  - name: profile_id
    type: uuid
    required: false
    description: Game-specific profile

  # Slot Management
  - name: slot_number
    type: integer
    required: true
    description: Save slot (1-10 typically)

  - name: slot_name
    type: string
    required: false
    max_length: 50
    description: Custom slot name
    example: "Main Story"

  - name: is_autosave
    type: boolean
    required: true
    default: false
    description: Autosave slot

  - name: is_quicksave
    type: boolean
    required: true
    default: false
    description: Quicksave slot

  # Status
  - name: status
    type: enum
    values: [active, archived, corrupted, deleted]
    required: true
    default: active

  # Game Progress
  - name: playtime_seconds
    type: integer
    required: true
    default: 0
    description: Time played on this save

  - name: completion_percent
    type: decimal
    required: false
    description: Story/game completion percentage

  - name: chapter
    type: string
    required: false
    description: Current chapter/act

  - name: level
    type: integer
    required: false
    description: Current level/stage

  - name: checkpoint
    type: string
    required: false
    description: Last checkpoint ID

  - name: location
    type: string
    required: false
    description: Current in-game location
    example: "Forest Temple - Floor 3"

  - name: difficulty
    type: enum
    values: [easy, normal, hard, expert, nightmare, custom]
    required: false
    description: Selected difficulty

  # Character State
  - name: character_name
    type: string
    required: false
    description: Player character name

  - name: character_class
    type: string
    required: false
    description: Character class/type

  - name: character_level
    type: integer
    required: false

  # Save Data
  - name: save_data
    type: json
    required: true
    description: |
      Game state data (varies by game):
      - inventory: [...]
      - quests: [...]
      - stats: {...}
      - flags: {...}
      - position: {x, y, z}

  - name: save_data_compressed
    type: binary
    required: false
    description: Compressed save data blob

  - name: save_size_bytes
    type: integer
    required: true
    description: Save file size

  # Versioning
  - name: game_version
    type: string
    required: true
    description: Game version when saved

  - name: save_format_version
    type: integer
    required: true
    default: 1
    description: Save format version

  - name: compatible_versions
    type: array
    items: string
    required: false
    description: Compatible game versions

  # Cloud Sync
  - name: cloud_synced
    type: boolean
    required: true
    default: false

  - name: cloud_sync_at
    type: datetime
    required: false

  - name: cloud_version
    type: integer
    required: false
    description: Cloud sync version number

  - name: local_version
    type: integer
    required: true
    default: 1
    description: Local save version

  - name: sync_conflict
    type: boolean
    required: true
    default: false
    description: Has unresolved sync conflict

  # Preview Data
  - name: thumbnail_url
    type: url
    required: false
    description: Screenshot/thumbnail

  - name: preview_data
    type: json
    required: false
    description: |
      Data for save preview UI:
      - character_name: "Hero"
      - level: 25
      - gold: 5000
      - playtime: "12h 34m"

  # Platform
  - name: platform
    type: enum
    values: [pc, ps5, ps4, xbox_series, xbox_one, switch, mobile_ios, mobile_android, cloud]
    required: true
    description: Platform save was created on

  - name: device_id
    type: string
    required: false
    description: Device identifier

  # Integrity
  - name: checksum
    type: string
    required: true
    description: Save data checksum for integrity

  - name: encrypted
    type: boolean
    required: true
    default: true
    description: Save data is encrypted

  - name: tamper_detected
    type: boolean
    required: true
    default: false
    description: Modification detected

  # Timestamps
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

  - name: last_loaded_at
    type: datetime
    required: false
    description: When save was last loaded

relationships:
  - name: player
    type: belongs_to
    target: player
    foreign_key: player_id

  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: profile
    type: belongs_to
    target: player_profile
    foreign_key: profile_id

indexes:
  - name: idx_save_player
    fields: [player_id]
    type: btree

  - name: idx_save_game
    fields: [game_id]
    type: btree

  - name: idx_save_player_game
    fields: [player_id, game_id]
    type: btree

  - name: idx_save_slot
    fields: [player_id, game_id, slot_number]
    type: unique

  - name: idx_save_updated
    fields: [updated_at]
    type: btree

validations:
  - name: valid_slot
    condition: "slot_number >= 1 AND slot_number <= 100"
    message: "Slot number must be between 1 and 100"

  - name: valid_checksum
    condition: "checksum IS NOT NULL"
    message: "Checksum required for save integrity"

state_machine:
  initial: active
  states:
    - name: active
      allowed_transitions: [archived, deleted]

    - name: archived
      allowed_transitions: [active, deleted]

    - name: corrupted
      allowed_transitions: [deleted]
      description: Detected data corruption

    - name: deleted
      allowed_transitions: []
      terminal: true
