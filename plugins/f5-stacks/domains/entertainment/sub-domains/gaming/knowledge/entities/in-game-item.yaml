name: in_game_item
display_name: In-Game Item
description: |
  Represents purchasable or earnable items within a game.
  Includes cosmetics, consumables, equipment, and currencies.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique item identifier

  - name: item_code
    type: string
    required: true
    unique: true
    description: Unique item code
    example: "SKIN_DRAGON_001"

  - name: game_id
    type: uuid
    required: true
    description: Game this item belongs to

  - name: sku
    type: string
    required: false
    description: Store SKU for purchases

  # Display
  - name: name
    type: string
    required: true
    max_length: 100
    description: Item name
    example: "Dragon Warrior Skin"

  - name: description
    type: string
    required: false
    max_length: 1000
    description: Item description

  - name: short_description
    type: string
    required: false
    max_length: 200

  # Status
  - name: status
    type: enum
    values: [active, limited, coming_soon, retired, removed]
    required: true
    default: active

  - name: visibility
    type: enum
    values: [visible, hidden, store_only]
    required: true
    default: visible

  # Classification
  - name: item_type
    type: enum
    values: [cosmetic, consumable, equipment, currency, loot_box, bundle, pass, boost, emote, avatar, frame, title, pet]
    required: true

  - name: sub_type
    type: string
    required: false
    description: More specific category
    example: "weapon_skin"

  - name: rarity
    type: enum
    values: [common, uncommon, rare, epic, legendary, mythic, unique]
    required: true

  - name: collection_id
    type: string
    required: false
    description: Item set/collection

  - name: tags
    type: array
    items: string
    required: false
    description: Searchable tags

  # Visual
  - name: icon_url
    type: url
    required: true
    description: Item icon

  - name: preview_url
    type: url
    required: false
    description: Preview image/video

  - name: model_url
    type: url
    required: false
    description: 3D model URL (if applicable)

  # Acquisition
  - name: obtainable_via
    type: array
    items: enum
    values: [purchase, drop, achievement, event, craft, trade, battle_pass, gift, promo]
    required: true

  - name: drop_rate
    type: decimal
    required: false
    description: Drop probability (0-1)

  # Trading
  - name: tradeable
    type: boolean
    required: true
    default: false

  - name: giftable
    type: boolean
    required: true
    default: false

  - name: sellable
    type: boolean
    required: true
    default: false

  - name: trade_restriction_days
    type: integer
    required: false
    description: Days before tradeable after acquisition

  # Pricing - Premium Currency
  - name: premium_currency_price
    type: integer
    required: false
    description: Price in premium (paid) currency

  - name: premium_currency_sale_price
    type: integer
    required: false
    description: Discounted price

  # Pricing - Soft Currency
  - name: soft_currency_price
    type: integer
    required: false
    description: Price in soft (earned) currency

  - name: soft_currency_sale_price
    type: integer
    required: false

  # Pricing - Real Money
  - name: real_money_price
    type: decimal
    required: false
    description: Direct purchase price

  - name: currency
    type: string
    required: false
    default: "USD"

  - name: real_money_sale_price
    type: decimal
    required: false

  # Sale
  - name: on_sale
    type: boolean
    required: true
    default: false

  - name: sale_start
    type: datetime
    required: false

  - name: sale_end
    type: datetime
    required: false

  - name: discount_percent
    type: integer
    required: false

  # Availability
  - name: limited_time
    type: boolean
    required: true
    default: false

  - name: available_from
    type: datetime
    required: false

  - name: available_until
    type: datetime
    required: false

  - name: season_id
    type: string
    required: false

  - name: event_id
    type: string
    required: false

  # Quantity/Stack
  - name: stackable
    type: boolean
    required: true
    default: false

  - name: max_stack
    type: integer
    required: false
    default: 1

  - name: max_owned
    type: integer
    required: false
    description: Max a player can own

  # Equipment Stats (if applicable)
  - name: stats_bonus
    type: json
    required: false
    description: |
      Stat modifications:
      - attack: +10
      - defense: +5
      - speed: +2%

  - name: abilities
    type: json
    required: false
    description: Special abilities granted

  - name: slot
    type: string
    required: false
    description: Equipment slot
    example: "weapon"

  - name: level_requirement
    type: integer
    required: false
    description: Min level to use

  - name: class_restriction
    type: array
    items: string
    required: false
    description: Restricted to classes

  # Consumable (if applicable)
  - name: effect
    type: json
    required: false
    description: Effect when used

  - name: duration_seconds
    type: integer
    required: false
    description: Effect duration

  - name: cooldown_seconds
    type: integer
    required: false

  # Loot Box (if applicable)
  - name: loot_table
    type: json
    required: false
    description: |
      Drop table with odds:
      - item_id: "...", weight: 70, rarity: "common"
      - item_id: "...", weight: 25, rarity: "rare"
      - item_id: "...", weight: 5, rarity: "legendary"

  - name: guaranteed_rarity
    type: string
    required: false
    description: Minimum guaranteed rarity

  # Bundle (if applicable)
  - name: bundle_contents
    type: json
    required: false
    description: Items included in bundle

  - name: bundle_value
    type: integer
    required: false
    description: Value if bought separately

  # Statistics
  - name: total_owned
    type: integer
    required: false
    default: 0

  - name: total_purchased
    type: integer
    required: false
    default: 0

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: inventory_items
    type: has_many
    target: inventory
    foreign_key: item_id

indexes:
  - name: idx_item_game
    fields: [game_id]
    type: btree

  - name: idx_item_code
    fields: [item_code]
    type: unique

  - name: idx_item_type
    fields: [game_id, item_type]
    type: btree

  - name: idx_item_rarity
    fields: [game_id, rarity]
    type: btree

  - name: idx_item_status
    fields: [status]
    type: btree

validations:
  - name: valid_pricing
    condition: "premium_currency_price IS NOT NULL OR soft_currency_price IS NOT NULL OR real_money_price IS NOT NULL OR 'purchase' NOT IN obtainable_via"
    message: "Purchasable items need at least one price"

  - name: loot_box_odds
    condition: "item_type != 'loot_box' OR loot_table IS NOT NULL"
    message: "Loot boxes must have loot table defined"

business_rules:
  - rule: economy-rules
    description: Pricing and purchase rules
