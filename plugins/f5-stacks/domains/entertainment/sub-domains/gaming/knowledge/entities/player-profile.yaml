name: player_profile
display_name: Player Profile
description: |
  Game-specific player profile containing stats, progression,
  and settings for each game a player plays.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique profile identifier

  - name: player_id
    type: uuid
    required: true
    description: Reference to player account

  - name: game_id
    type: uuid
    required: true
    description: Reference to game

  - name: in_game_name
    type: string
    required: false
    max_length: 30
    description: Game-specific display name

  # Status
  - name: status
    type: enum
    values: [active, inactive, banned]
    required: true
    default: active
    description: Profile status in this game

  # Progression
  - name: level
    type: integer
    required: true
    default: 1
    description: In-game level

  - name: xp
    type: bigint
    required: true
    default: 0
    description: Current XP

  - name: xp_to_next_level
    type: bigint
    required: true
    description: XP needed for next level

  - name: prestige
    type: integer
    required: true
    default: 0
    description: Prestige/reset count

  - name: season_level
    type: integer
    required: false
    description: Current season level

  - name: battle_pass_tier
    type: integer
    required: false
    description: Battle pass progress

  - name: battle_pass_premium
    type: boolean
    required: false
    default: false
    description: Premium battle pass owned

  # Rank/Competitive
  - name: rank_tier
    type: enum
    values: [unranked, bronze, silver, gold, platinum, diamond, master, grandmaster, champion]
    required: false
    default: unranked
    description: Competitive rank tier

  - name: rank_division
    type: integer
    required: false
    min: 1
    max: 4
    description: Division within tier

  - name: mmr
    type: integer
    required: false
    description: Matchmaking rating (hidden)

  - name: elo
    type: integer
    required: false
    description: ELO rating (visible)

  - name: rank_points
    type: integer
    required: false
    default: 0
    description: Points in current rank

  - name: peak_rank
    type: string
    required: false
    description: Highest rank achieved

  - name: ranked_wins
    type: integer
    required: true
    default: 0
    description: Ranked match wins

  - name: ranked_losses
    type: integer
    required: true
    default: 0
    description: Ranked match losses

  # Statistics
  - name: playtime_minutes
    type: bigint
    required: true
    default: 0
    description: Total time played

  - name: matches_played
    type: integer
    required: true
    default: 0
    description: Total matches

  - name: matches_won
    type: integer
    required: true
    default: 0
    description: Matches won

  - name: win_rate
    type: decimal
    required: false
    description: Win percentage
    computed: "matches_won / NULLIF(matches_played, 0) * 100"

  - name: kills
    type: integer
    required: false
    default: 0
    description: Total kills (if applicable)

  - name: deaths
    type: integer
    required: false
    default: 0
    description: Total deaths

  - name: assists
    type: integer
    required: false
    default: 0
    description: Total assists

  - name: kda_ratio
    type: decimal
    required: false
    description: Kill/Death/Assist ratio
    computed: "(kills + assists) / NULLIF(deaths, 0)"

  - name: highest_score
    type: bigint
    required: false
    description: Personal best score

  - name: highest_streak
    type: integer
    required: false
    description: Best win streak

  - name: current_streak
    type: integer
    required: true
    default: 0
    description: Current win/loss streak

  # Game-Specific Stats (JSON for flexibility)
  - name: custom_stats
    type: json
    required: false
    description: Game-specific statistics

  # Achievements
  - name: achievements_unlocked
    type: integer
    required: true
    default: 0
    description: Achievements unlocked in this game

  - name: achievement_points
    type: integer
    required: true
    default: 0
    description: Total achievement points

  - name: completion_percentage
    type: decimal
    required: false
    description: Achievement completion %

  # Settings
  - name: settings
    type: json
    required: false
    description: Game-specific settings

  - name: loadouts
    type: json
    required: false
    description: Saved loadouts/builds

  - name: preferred_mode
    type: string
    required: false
    description: Preferred game mode

  - name: preferred_character
    type: string
    required: false
    description: Main character/class

  # Dates
  - name: first_played_at
    type: datetime
    required: true
    auto: true
    description: First time played

  - name: last_played_at
    type: datetime
    required: false
    description: Last session timestamp

  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: player
    type: belongs_to
    target: player
    foreign_key: player_id
    description: Parent player account

  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id
    description: Associated game

  - name: sessions
    type: has_many
    target: game_session
    foreign_key: profile_id
    description: Game sessions

  - name: achievements
    type: has_many
    target: player_achievement
    foreign_key: profile_id
    description: Unlocked achievements

  - name: inventory
    type: has_many
    target: inventory
    foreign_key: profile_id
    description: Game-specific inventory

indexes:
  - name: idx_profile_player_game
    fields: [player_id, game_id]
    type: unique

  - name: idx_profile_game
    fields: [game_id]
    type: btree

  - name: idx_profile_rank
    fields: [game_id, rank_tier, mmr]
    type: btree

  - name: idx_profile_last_played
    fields: [last_played_at]
    type: btree

validations:
  - name: unique_profile
    condition: "UNIQUE(player_id, game_id)"
    message: "Player can have only one profile per game"

business_rules:
  - rule: progression-rules
    description: Level and rank progression
  - rule: matchmaking-rules
    description: MMR calculations
