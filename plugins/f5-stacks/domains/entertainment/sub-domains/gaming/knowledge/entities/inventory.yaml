name: inventory
display_name: Inventory
description: |
  Represents items owned by a player in their inventory.
  Tracks ownership, quantities, and item state.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique inventory entry identifier

  - name: player_id
    type: uuid
    required: true
    description: Owner player

  - name: game_id
    type: uuid
    required: true
    description: Game this inventory belongs to

  - name: profile_id
    type: uuid
    required: false
    description: Game-specific profile

  - name: item_id
    type: uuid
    required: true
    description: Reference to in_game_item

  # Ownership
  - name: quantity
    type: integer
    required: true
    default: 1
    min: 0
    description: Quantity owned

  - name: acquisition_method
    type: enum
    values: [purchase, drop, achievement, event, craft, trade, gift, promo, refund, admin]
    required: true
    description: How item was obtained

  - name: acquisition_source
    type: string
    required: false
    description: Specific source reference
    example: "LootBox-ABC123"

  - name: acquisition_price
    type: json
    required: false
    description: |
      Price paid:
      - currency: "premium"
      - amount: 500

  # Status
  - name: status
    type: enum
    values: [owned, equipped, consumed, traded, expired, revoked]
    required: true
    default: owned

  - name: equipped
    type: boolean
    required: true
    default: false

  - name: equipped_slot
    type: string
    required: false
    description: Which slot it's equipped in

  - name: favorite
    type: boolean
    required: true
    default: false

  # Trading
  - name: tradeable
    type: boolean
    required: true
    default: false

  - name: tradeable_after
    type: datetime
    required: false
    description: When trade restriction lifts

  - name: trade_locked
    type: boolean
    required: true
    default: false
    description: Manually locked from trading

  - name: listed_for_trade
    type: boolean
    required: true
    default: false

  - name: listing_price
    type: integer
    required: false
    description: Market listing price

  # Instance Data (for unique items)
  - name: instance_id
    type: string
    required: false
    description: Unique instance identifier

  - name: instance_data
    type: json
    required: false
    description: |
      Instance-specific data:
      - level: 5
      - enchantments: ["fire", "speed"]
      - durability: 85
      - custom_name: "Excalibur"

  # Expiration
  - name: expires_at
    type: datetime
    required: false
    description: When item expires

  - name: uses_remaining
    type: integer
    required: false
    description: Uses left (for consumables)

  # Gift/Trade History
  - name: original_owner_id
    type: uuid
    required: false
    description: First owner (if traded/gifted)

  - name: received_from_id
    type: uuid
    required: false
    description: Previous owner

  - name: gift_message
    type: string
    required: false
    max_length: 500

  # Timestamps
  - name: acquired_at
    type: datetime
    required: true
    auto: true
    description: When item was obtained

  - name: last_used_at
    type: datetime
    required: false
    description: Last time item was used

  - name: equipped_at
    type: datetime
    required: false

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: player
    type: belongs_to
    target: player
    foreign_key: player_id

  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: profile
    type: belongs_to
    target: player_profile
    foreign_key: profile_id

  - name: item
    type: belongs_to
    target: in_game_item
    foreign_key: item_id

indexes:
  - name: idx_inventory_player
    fields: [player_id]
    type: btree

  - name: idx_inventory_game
    fields: [game_id]
    type: btree

  - name: idx_inventory_player_game
    fields: [player_id, game_id]
    type: btree

  - name: idx_inventory_item
    fields: [item_id]
    type: btree

  - name: idx_inventory_status
    fields: [status]
    type: btree

  - name: idx_inventory_tradeable
    fields: [tradeable, listed_for_trade]
    type: btree

validations:
  - name: valid_quantity
    condition: "quantity >= 0"
    message: "Quantity cannot be negative"

  - name: equipped_status
    condition: "equipped = false OR status = 'owned'"
    message: "Only owned items can be equipped"

business_rules:
  - rule: economy-rules
    description: Trading and ownership rules
