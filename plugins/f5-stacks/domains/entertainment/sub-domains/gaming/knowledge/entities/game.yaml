name: game
display_name: Game
description: |
  Core entity representing a video game on the platform.
  Contains metadata, classification, technical requirements, and monetization settings.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique game identifier
    example: "gme_550e8400-e29b-41d4-a716-446655440000"

  - name: game_code
    type: string
    required: true
    unique: true
    pattern: "^[A-Z0-9]{3,10}$"
    description: Short unique game code
    example: "APEX2024"

  - name: title
    type: string
    required: true
    max_length: 200
    description: Game title
    example: "Apex Legends"

  - name: slug
    type: string
    required: true
    unique: true
    description: URL-friendly identifier
    example: "apex-legends"

  - name: subtitle
    type: string
    required: false
    description: Tagline or subtitle
    example: "The Ultimate Battle Royale"

  # Status & Type
  - name: status
    type: enum
    values: [development, alpha, beta, early_access, released, maintenance, sunset]
    required: true
    default: development
    description: Game lifecycle status

  - name: game_type
    type: enum
    values: [single_player, multiplayer, mmo, battle_royale, moba, fps, rpg, strategy, puzzle, casual, simulation, sports, racing]
    required: true
    description: Primary game type

  # Classification
  - name: genres
    type: array
    items: string
    required: true
    description: Game genres
    example: ["Action", "Shooter", "Battle Royale"]

  - name: tags
    type: array
    items: string
    required: false
    description: Searchable tags
    example: ["free-to-play", "competitive", "squad-based"]

  - name: platforms
    type: array
    items: enum
    values: [pc, ps5, ps4, xbox_series, xbox_one, switch, mobile_ios, mobile_android, web, vr]
    required: true
    description: Supported platforms

  - name: age_rating
    type: enum
    values: [ESRB_E, ESRB_E10, ESRB_T, ESRB_M, ESRB_AO, PEGI_3, PEGI_7, PEGI_12, PEGI_16, PEGI_18]
    required: true
    description: Official age rating

  - name: content_descriptors
    type: array
    items: string
    required: false
    description: Content warning descriptors
    example: ["Violence", "Blood", "In-Game Purchases"]

  # Description
  - name: description
    type: text
    required: true
    max_length: 5000
    description: Full game description

  - name: short_description
    type: string
    required: true
    max_length: 500
    description: Brief description for listings

  - name: features
    type: array
    items: string
    required: false
    description: Key features list

  # Technical
  - name: version
    type: string
    required: true
    description: Current game version
    example: "2.5.1"

  - name: build_number
    type: integer
    required: true
    description: Internal build number

  - name: min_players
    type: integer
    required: true
    default: 1
    description: Minimum players required

  - name: max_players
    type: integer
    required: true
    default: 1
    description: Maximum concurrent players

  - name: cross_platform
    type: boolean
    required: true
    default: false
    description: Cross-platform play supported

  - name: cloud_save
    type: boolean
    required: true
    default: true
    description: Cloud save supported

  - name: controller_support
    type: enum
    values: [none, partial, full]
    required: false
    default: partial
    description: Controller support level

  # Media Assets
  - name: icon_url
    type: url
    required: true
    description: Game icon image

  - name: banner_url
    type: url
    required: true
    description: Banner/header image

  - name: logo_url
    type: url
    required: false
    description: Game logo image

  - name: screenshots
    type: array
    items: url
    required: true
    min_items: 3
    description: Screenshot gallery

  - name: trailer_url
    type: url
    required: false
    description: Main trailer video URL

  - name: trailers
    type: array
    items: object
    required: false
    description: Additional trailers

  # Monetization
  - name: monetization_type
    type: enum
    values: [free_to_play, premium, subscription, freemium, demo]
    required: true
    description: Business model

  - name: base_price
    type: decimal
    required: false
    description: Base purchase price (if premium)

  - name: currency
    type: string
    required: false
    default: USD
    description: Price currency

  - name: has_in_app_purchases
    type: boolean
    required: true
    default: false
    description: Contains microtransactions

  - name: has_loot_boxes
    type: boolean
    required: true
    default: false
    description: Contains randomized purchases

  - name: has_ads
    type: boolean
    required: true
    default: false
    description: Contains advertisements

  - name: has_subscription
    type: boolean
    required: true
    default: false
    description: Has premium subscription option

  # Developer Info
  - name: developer
    type: string
    required: true
    description: Development studio

  - name: publisher
    type: string
    required: true
    description: Publishing company

  - name: release_date
    type: date
    required: false
    description: Official release date

  # Statistics
  - name: total_players
    type: integer
    required: false
    default: 0
    description: Total registered players

  - name: daily_active_users
    type: integer
    required: false
    default: 0
    description: DAU count

  - name: peak_concurrent_players
    type: integer
    required: false
    default: 0
    description: Peak CCU record

  - name: average_session_minutes
    type: decimal
    required: false
    description: Average play session length

  - name: total_matches_played
    type: bigint
    required: false
    default: 0
    description: Total matches played

  - name: average_rating
    type: decimal
    required: false
    min: 0
    max: 5
    description: User rating average

  - name: total_ratings
    type: integer
    required: false
    default: 0
    description: Number of ratings

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true
    description: Record creation timestamp

  - name: updated_at
    type: datetime
    required: true
    auto: true
    description: Last update timestamp

  - name: created_by
    type: uuid
    required: true
    description: Creator user ID

relationships:
  - name: player_profiles
    type: has_many
    target: player_profile
    foreign_key: game_id
    description: Player game-specific profiles

  - name: achievements
    type: has_many
    target: achievement
    foreign_key: game_id
    description: Game achievements

  - name: leaderboards
    type: has_many
    target: leaderboard
    foreign_key: game_id
    description: Game leaderboards

  - name: items
    type: has_many
    target: in_game_item
    foreign_key: game_id
    description: In-game items catalog

  - name: matches
    type: has_many
    target: match
    foreign_key: game_id
    description: Game matches

  - name: tournaments
    type: has_many
    target: tournament
    foreign_key: game_id
    description: Game tournaments

state_machine:
  initial: development
  states:
    - name: development
      description: In active development
      allowed_transitions: [alpha]

    - name: alpha
      description: Internal testing phase
      allowed_transitions: [beta, development]

    - name: beta
      description: Public beta testing
      allowed_transitions: [early_access, released, development]

    - name: early_access
      description: Early access release
      allowed_transitions: [released, maintenance]

    - name: released
      description: Fully released
      allowed_transitions: [maintenance]

    - name: maintenance
      description: Maintenance mode
      allowed_transitions: [released, sunset]

    - name: sunset
      description: End of life
      allowed_transitions: []
      terminal: true

indexes:
  - name: idx_game_slug
    fields: [slug]
    type: unique

  - name: idx_game_code
    fields: [game_code]
    type: unique

  - name: idx_game_status
    fields: [status]
    type: btree

  - name: idx_game_type
    fields: [game_type]
    type: btree

  - name: idx_game_search
    fields: [title, description]
    type: fulltext

validations:
  - name: valid_price
    condition: "monetization_type != 'premium' OR base_price IS NOT NULL"
    message: "Base price required for premium games"

  - name: valid_players
    condition: "max_players >= min_players"
    message: "Max players must be >= min players"

business_rules:
  - rule: matchmaking-rules
    description: Rules for player matching
  - rule: economy-rules
    description: In-game economy rules
