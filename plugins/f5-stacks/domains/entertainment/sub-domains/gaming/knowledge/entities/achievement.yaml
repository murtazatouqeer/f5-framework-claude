name: achievement
display_name: Achievement
description: |
  Represents an unlockable achievement/trophy in a game.
  Tracks criteria, rewards, and unlock statistics.

domain: entertainment
subdomain: gaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique achievement identifier

  - name: achievement_code
    type: string
    required: true
    unique: true
    description: Unique code within game
    example: "FIRST_WIN"

  - name: game_id
    type: uuid
    required: true
    description: Game this achievement belongs to

  - name: category_id
    type: string
    required: false
    description: Achievement category/group

  # Display
  - name: name
    type: string
    required: true
    max_length: 100
    description: Achievement name
    example: "First Blood"

  - name: description
    type: string
    required: true
    max_length: 500
    description: How to unlock
    example: "Win your first match"

  - name: locked_description
    type: string
    required: false
    max_length: 500
    description: Description when locked (for secrets)

  - name: icon_url
    type: url
    required: true
    description: Achievement icon

  - name: locked_icon_url
    type: url
    required: false
    description: Icon when locked

  # Status & Classification
  - name: status
    type: enum
    values: [active, hidden, retired, coming_soon]
    required: true
    default: active
    description: Achievement availability

  - name: rarity
    type: enum
    values: [common, uncommon, rare, epic, legendary]
    required: true
    description: Achievement rarity

  - name: is_secret
    type: boolean
    required: true
    default: false
    description: Hidden until unlocked

  - name: is_hidden
    type: boolean
    required: true
    default: false
    description: Not shown in lists

  - name: is_missable
    type: boolean
    required: true
    default: false
    description: Can be permanently missed

  # Criteria
  - name: criteria_type
    type: enum
    values: [stat_threshold, action_count, collection, story_progress, time_based, challenge, combo, exploration, social]
    required: true
    description: How achievement is earned

  - name: criteria_data
    type: json
    required: true
    description: |
      Criteria configuration:
      - stat_threshold: {stat: "kills", threshold: 1000}
      - action_count: {action: "headshot", count: 50}
      - collection: {items: ["item1", "item2"], all: true}
      - time_based: {action: "complete_level", within_seconds: 60}
      - combo: {achievements: ["ach1", "ach2"]}

  # Progress Tracking
  - name: trackable
    type: boolean
    required: true
    default: true
    description: Shows progress indicator

  - name: max_progress
    type: integer
    required: false
    description: Max progress value (for trackable)
    example: 100

  - name: progress_format
    type: string
    required: false
    description: Progress display format
    example: "{current}/{max}"

  # Rewards
  - name: points
    type: integer
    required: true
    default: 10
    description: Achievement points/gamerscore

  - name: xp_reward
    type: integer
    required: false
    default: 0
    description: XP rewarded

  - name: currency_reward
    type: json
    required: false
    description: Currency rewards

  - name: item_rewards
    type: array
    items: uuid
    required: false
    description: Item IDs rewarded

  - name: title_reward
    type: string
    required: false
    description: Title/badge rewarded

  # Tiers (for progressive achievements)
  - name: tier
    type: integer
    required: false
    description: Tier in progressive series

  - name: parent_achievement_id
    type: uuid
    required: false
    description: Previous tier achievement

  - name: next_achievement_id
    type: uuid
    required: false
    description: Next tier achievement

  # Time Constraints
  - name: available_from
    type: datetime
    required: false
    description: Start availability

  - name: available_until
    type: datetime
    required: false
    description: End availability (limited time)

  - name: season_id
    type: string
    required: false
    description: Season this belongs to

  # Statistics
  - name: total_unlocked
    type: integer
    required: true
    default: 0
    description: Times unlocked globally

  - name: unlock_rate_percent
    type: decimal
    required: false
    description: Percentage of players unlocked
    example: 15.5

  - name: first_unlocked_at
    type: datetime
    required: false
    description: When first ever unlocked

  - name: first_unlocked_by
    type: uuid
    required: false
    description: First player to unlock

  # Ordering
  - name: sort_order
    type: integer
    required: false
    default: 0
    description: Display order

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: game
    type: belongs_to
    target: game
    foreign_key: game_id

  - name: player_achievements
    type: has_many
    target: player_achievement
    foreign_key: achievement_id
    description: Player unlock records

  - name: parent_achievement
    type: belongs_to
    target: achievement
    foreign_key: parent_achievement_id
    description: Previous tier

  - name: next_achievement
    type: has_one
    target: achievement
    foreign_key: next_achievement_id
    description: Next tier

indexes:
  - name: idx_achievement_game
    fields: [game_id]
    type: btree

  - name: idx_achievement_code
    fields: [game_id, achievement_code]
    type: unique

  - name: idx_achievement_rarity
    fields: [game_id, rarity]
    type: btree

  - name: idx_achievement_category
    fields: [game_id, category_id]
    type: btree

validations:
  - name: valid_progress
    condition: "trackable = false OR max_progress IS NOT NULL"
    message: "Trackable achievements need max_progress"

business_rules:
  - rule: progression-rules
    description: Achievement unlock logic
