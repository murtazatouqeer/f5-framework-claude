name: season
display_name: Season
description: |
  Season entity for TV series content organization.
  Groups episodes and manages season-level metadata.

domain: entertainment
subdomain: streaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique season identifier

  - name: content_id
    type: uuid
    required: true
    description: Parent series content ID

  - name: season_number
    type: integer
    required: true
    min: 0
    description: Season number (0 for specials)

  # Details
  - name: name
    type: string
    required: false
    max_length: 200
    description: Season name/title
    example: "Season 1: Origins"

  - name: description
    type: text
    required: false
    max_length: 2000
    description: Season synopsis

  - name: tagline
    type: string
    required: false
    max_length: 200
    description: Season tagline

  # Release Info
  - name: release_date
    type: date
    required: false
    description: Season premiere date

  - name: end_date
    type: date
    required: false
    description: Season finale date

  - name: release_year
    type: integer
    required: false
    description: Release year

  - name: release_type
    type: enum
    values: [all_at_once, weekly, daily, irregular]
    required: true
    default: weekly
    description: Episode release pattern

  # Episode Info
  - name: episode_count
    type: integer
    required: false
    description: Total episodes in season

  - name: total_runtime_minutes
    type: integer
    required: false
    description: Combined episode runtime

  - name: average_episode_duration
    type: integer
    required: false
    description: Average episode length

  # Media Assets
  - name: poster_url
    type: url
    required: false
    description: Season-specific poster

  - name: backdrop_url
    type: url
    required: false
    description: Season backdrop image

  - name: trailer_url
    type: url
    required: false
    description: Season trailer

  # Ratings
  - name: average_rating
    type: decimal
    required: false
    min: 0
    max: 10
    description: Average user rating

  - name: total_ratings
    type: integer
    required: false
    default: 0
    description: Number of ratings

  - name: popularity_score
    type: decimal
    required: false
    description: Calculated popularity

  # Status
  - name: status
    type: enum
    values: [announced, upcoming, airing, completed, cancelled]
    required: true
    default: announced
    description: Season status

  - name: is_available
    type: boolean
    required: true
    default: false
    description: Available for streaming

  - name: available_from
    type: datetime
    required: false
    description: Availability start

  - name: available_until
    type: datetime
    required: false
    description: Availability end

  # External IDs
  - name: tmdb_id
    type: integer
    required: false
    description: TMDB season ID

  - name: tvdb_id
    type: integer
    required: false
    description: TVDB season ID

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

relationships:
  - name: content
    type: belongs_to
    target: content
    foreign_key: content_id
    description: Parent series

  - name: episodes
    type: has_many
    target: episode
    foreign_key: season_id
    order_by: episode_number
    description: Season episodes

  - name: licenses
    type: has_many
    target: content_license
    foreign_key: season_id
    description: Season-specific licenses

state_machine:
  initial: announced
  states:
    - name: announced
      description: Season announced
      allowed_transitions: [upcoming, cancelled]

    - name: upcoming
      description: Coming soon
      allowed_transitions: [airing, cancelled]

    - name: airing
      description: Currently releasing
      allowed_transitions: [completed, cancelled]

    - name: completed
      description: All episodes released
      allowed_transitions: []
      terminal: true

    - name: cancelled
      description: Season cancelled
      allowed_transitions: []
      terminal: true

indexes:
  - name: idx_season_content
    fields: [content_id, season_number]
    type: unique

  - name: idx_season_status
    fields: [status]
    type: btree

  - name: idx_season_release
    fields: [release_date]
    type: btree

validations:
  - name: valid_season_number
    condition: "season_number >= 0"
    message: "Season number must be non-negative"

  - name: valid_availability
    condition: "available_until IS NULL OR available_until > available_from"
    message: "End date must be after start date"
