name: content_license
display_name: Content License
description: |
  Content licensing agreements and rights management.
  Tracks territorial rights, windows, and restrictions.

domain: entertainment
subdomain: streaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique license identifier

  - name: license_number
    type: string
    required: true
    unique: true
    description: License reference number
    example: "LIC-2024-001234"

  - name: content_id
    type: uuid
    required: true
    description: Licensed content

  - name: season_id
    type: uuid
    required: false
    description: Specific season (if applicable)

  # Licensor
  - name: licensor_id
    type: uuid
    required: true
    description: Content owner/distributor

  - name: licensor_name
    type: string
    required: true
    description: Licensor company name

  - name: licensor_contact
    type: object
    required: false
    properties:
      name: string
      email: string
      phone: string
    description: Licensor contact info

  # License Type
  - name: license_type
    type: enum
    values: [exclusive, non_exclusive, first_run, second_run, output_deal, co_production]
    required: true
    description: Type of license agreement

  - name: rights_type
    type: enum
    values: [svod, tvod, avod, est, linear, all_vod]
    required: true
    description: Rights category

  - name: content_scope
    type: enum
    values: [all, movie, series, season, episodes]
    required: true
    description: What content is covered

  # Territory
  - name: territories
    type: array
    items: string
    required: true
    description: Licensed countries/regions
    example: ["US", "CA", "GB"]

  - name: excluded_territories
    type: array
    items: string
    required: false
    description: Excluded regions

  - name: territory_type
    type: enum
    values: [worldwide, regional, national, custom]
    required: true
    description: Territory scope

  # License Window
  - name: license_start
    type: datetime
    required: true
    description: License effective date

  - name: license_end
    type: datetime
    required: true
    description: License expiration

  - name: holdback_start
    type: datetime
    required: false
    description: Holdback period start

  - name: holdback_end
    type: datetime
    required: false
    description: Holdback period end

  - name: is_perpetual
    type: boolean
    required: false
    default: false
    description: No expiration date

  # Windows
  - name: premiere_window
    type: object
    required: false
    properties:
      start: datetime
      end: datetime
      is_exclusive: boolean
    description: Premiere/first-run window

  - name: availability_windows
    type: array
    items:
      type: object
      properties:
        territory: string
        start: datetime
        end: datetime
        rights_type: string
    required: false
    description: Territory-specific windows

  # Restrictions
  - name: platform_restrictions
    type: array
    items: enum
    values: [web, mobile, smart_tv, gaming_console, streaming_device]
    required: false
    description: Restricted platforms

  - name: quality_cap
    type: enum
    values: [SD, HD, FHD, 4K]
    required: false
    description: Maximum quality allowed

  - name: download_allowed
    type: boolean
    required: true
    default: false
    description: Offline download permitted

  - name: download_limit
    type: integer
    required: false
    description: Max simultaneous downloads

  - name: download_retention_days
    type: integer
    required: false
    description: Download expiry days

  - name: concurrent_streams
    type: integer
    required: false
    description: Max concurrent plays

  - name: drm_required
    type: boolean
    required: true
    default: true
    description: DRM protection required

  - name: drm_level
    type: enum
    values: [L1, L2, L3]
    required: false
    description: Minimum DRM security level

  - name: hdcp_required
    type: boolean
    required: false
    default: false
    description: HDCP protection required

  # Financial
  - name: fee_type
    type: enum
    values: [flat_fee, minimum_guarantee, revenue_share, cost_plus, hybrid]
    required: true
    description: Payment structure

  - name: license_fee
    type: decimal
    required: false
    precision: 12
    scale: 2
    description: License fee amount

  - name: fee_currency
    type: string
    required: false
    default: "USD"
    description: Fee currency

  - name: minimum_guarantee
    type: decimal
    required: false
    precision: 12
    scale: 2
    description: Minimum guarantee amount

  - name: revenue_share_percent
    type: decimal
    required: false
    description: Revenue share percentage

  - name: payment_terms
    type: string
    required: false
    description: Payment schedule

  - name: payment_schedule
    type: array
    items:
      type: object
      properties:
        due_date: date
        amount: decimal
        status: enum
    required: false
    description: Payment milestones

  # Reporting
  - name: reporting_frequency
    type: enum
    values: [monthly, quarterly, semi_annual, annual]
    required: false
    description: Required reporting frequency

  - name: reporting_requirements
    type: array
    items: string
    required: false
    description: Reporting obligations

  - name: last_report_date
    type: date
    required: false
    description: Last report submitted

  - name: next_report_due
    type: date
    required: false
    description: Next report due date

  # Status
  - name: status
    type: enum
    values: [draft, pending_approval, active, expiring_soon, expired, terminated, renewed]
    required: true
    default: draft
    description: License status

  - name: renewal_option
    type: boolean
    required: false
    default: false
    description: Has renewal option

  - name: renewal_deadline
    type: date
    required: false
    description: Renewal decision deadline

  - name: auto_renew
    type: boolean
    required: false
    default: false
    description: Auto-renewal enabled

  - name: termination_notice_days
    type: integer
    required: false
    description: Required termination notice

  # Documents
  - name: contract_url
    type: url
    required: false
    description: Contract document

  - name: amendments
    type: array
    items:
      type: object
      properties:
        date: date
        description: string
        document_url: url
    required: false
    description: Contract amendments

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true

  - name: updated_at
    type: datetime
    required: true
    auto: true

  - name: created_by
    type: uuid
    required: true

  - name: approved_by
    type: uuid
    required: false

  - name: approved_at
    type: datetime
    required: false

relationships:
  - name: content
    type: belongs_to
    target: content
    foreign_key: content_id
    description: Licensed content

  - name: season
    type: belongs_to
    target: season
    foreign_key: season_id
    description: Licensed season

  - name: licensor
    type: belongs_to
    target: licensor
    foreign_key: licensor_id
    description: Content licensor

state_machine:
  initial: draft
  states:
    - name: draft
      description: License being negotiated
      allowed_transitions: [pending_approval]

    - name: pending_approval
      description: Awaiting internal approval
      allowed_transitions: [active, draft]

    - name: active
      description: License in effect
      allowed_transitions: [expiring_soon, terminated, renewed]

    - name: expiring_soon
      description: Approaching expiration
      allowed_transitions: [expired, renewed]

    - name: expired
      description: License has ended
      allowed_transitions: [renewed]

    - name: terminated
      description: Early termination
      allowed_transitions: []
      terminal: true

    - name: renewed
      description: License renewed
      allowed_transitions: [active]

indexes:
  - name: idx_license_content
    fields: [content_id]
    type: btree

  - name: idx_license_number
    fields: [license_number]
    type: unique

  - name: idx_license_dates
    fields: [license_start, license_end]
    type: btree

  - name: idx_license_status
    fields: [status]
    type: btree

  - name: idx_license_territory
    fields: [territories]
    type: gin

  - name: idx_license_expiring
    fields: [license_end, status]
    type: btree

validations:
  - name: valid_dates
    condition: "license_end > license_start"
    message: "End date must be after start date"

  - name: valid_territories
    condition: "array_length(territories, 1) > 0"
    message: "At least one territory required"

  - name: valid_holdback
    condition: "holdback_end IS NULL OR holdback_end > holdback_start"
    message: "Holdback end must be after start"

business_rules:
  - rule: content-licensing-rules
    description: Rules for content licensing and availability
