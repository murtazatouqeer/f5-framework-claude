name: content
display_name: Content
description: |
  Core entity representing streaming content (movies, series, shows).
  Contains metadata, licensing, and playback information.

domain: entertainment
subdomain: streaming
category: entities
version: "1.0.0"
status: active

attributes:
  # Identity
  - name: id
    type: uuid
    required: true
    description: Unique content identifier
    example: "cnt_550e8400-e29b-41d4-a716-446655440000"

  - name: content_type
    type: enum
    values: [movie, series, documentary, show, live_event, short]
    required: true
    description: Type of content
    example: "movie"

  - name: title
    type: string
    required: true
    max_length: 500
    description: Primary title
    example: "The Matrix"

  - name: original_title
    type: string
    required: false
    description: Original language title
    example: "The Matrix"

  - name: slug
    type: string
    required: true
    unique: true
    description: URL-friendly identifier
    example: "the-matrix-1999"

  # Content Details
  - name: description
    type: text
    required: true
    max_length: 5000
    description: Synopsis or description
    example: "A computer programmer discovers..."

  - name: tagline
    type: string
    required: false
    max_length: 200
    description: Marketing tagline

  - name: release_date
    type: date
    required: false
    description: Original release date

  - name: release_year
    type: integer
    required: true
    description: Release year
    example: 1999

  - name: duration_minutes
    type: integer
    required: false
    description: Runtime in minutes (for movies)
    example: 136

  - name: total_seasons
    type: integer
    required: false
    description: Number of seasons (for series)

  - name: total_episodes
    type: integer
    required: false
    description: Total episode count (for series)

  # Classification
  - name: genres
    type: array
    items: string
    required: true
    description: Genre classifications
    example: ["Action", "Sci-Fi"]

  - name: age_rating
    type: enum
    values: [G, PG, PG-13, R, NC-17, TV-Y, TV-G, TV-PG, TV-14, TV-MA]
    required: true
    description: Content age rating

  - name: content_rating
    type: string
    required: false
    description: Specific content warnings
    example: "Violence, Language"

  - name: languages
    type: array
    items: string
    required: true
    description: Available audio languages
    example: ["en", "es", "fr"]

  - name: subtitles
    type: array
    items: string
    required: false
    description: Available subtitle languages

  - name: country_of_origin
    type: string
    required: false
    description: Production country
    example: "US"

  # Media Assets
  - name: poster_url
    type: url
    required: true
    description: Poster image URL

  - name: backdrop_url
    type: url
    required: false
    description: Backdrop/banner image URL

  - name: trailer_url
    type: url
    required: false
    description: Trailer video URL

  - name: logo_url
    type: url
    required: false
    description: Title logo image URL

  # Streaming Details
  - name: quality_options
    type: array
    items: enum
    values: [SD, HD, FHD, 4K, HDR, DOLBY_VISION]
    required: true
    description: Available quality levels

  - name: audio_formats
    type: array
    items: enum
    values: [STEREO, DOLBY_5_1, DOLBY_ATMOS, DTS]
    required: false
    description: Available audio formats

  - name: is_downloadable
    type: boolean
    required: true
    default: false
    description: Offline download allowed

  # Metadata
  - name: imdb_id
    type: string
    required: false
    description: IMDB identifier

  - name: tmdb_id
    type: integer
    required: false
    description: TMDB identifier

  - name: popularity_score
    type: decimal
    required: false
    description: Calculated popularity score
    example: 85.5

  - name: average_rating
    type: decimal
    required: false
    min: 0
    max: 10
    description: Average user rating

  - name: total_ratings
    type: integer
    required: false
    default: 0
    description: Total number of ratings

  - name: view_count
    type: integer
    required: false
    default: 0
    description: Total view count

  # Status
  - name: status
    type: enum
    values: [draft, pending_review, approved, published, archived, removed]
    required: true
    default: draft
    description: Content publication status

  - name: visibility
    type: enum
    values: [public, subscribers_only, premium_only, private]
    required: true
    default: public
    description: Content visibility level

  - name: available_from
    type: datetime
    required: false
    description: Availability start date

  - name: available_until
    type: datetime
    required: false
    description: Availability end date

  # Audit
  - name: created_at
    type: datetime
    required: true
    auto: true
    description: Record creation timestamp

  - name: updated_at
    type: datetime
    required: true
    auto: true
    description: Last update timestamp

  - name: created_by
    type: uuid
    required: true
    description: Creator user ID

  - name: updated_by
    type: uuid
    required: false
    description: Last updater user ID

relationships:
  - name: metadata
    type: has_one
    target: content_metadata
    foreign_key: content_id
    description: Detailed metadata

  - name: catalog_items
    type: has_many
    target: catalog
    foreign_key: content_id
    description: Catalog placements

  - name: seasons
    type: has_many
    target: season
    foreign_key: content_id
    condition: content_type = 'series'
    description: Series seasons

  - name: licenses
    type: has_many
    target: content_license
    foreign_key: content_id
    description: Licensing agreements

  - name: watch_history
    type: has_many
    target: watch_history
    foreign_key: content_id
    description: User watch records

  - name: ratings
    type: has_many
    target: rating_review
    foreign_key: content_id
    description: User ratings and reviews

state_machine:
  initial: draft
  states:
    - name: draft
      description: Content being prepared
      allowed_transitions: [pending_review]

    - name: pending_review
      description: Awaiting content review
      allowed_transitions: [approved, draft]

    - name: approved
      description: Approved for publication
      allowed_transitions: [published, draft]

    - name: published
      description: Live and accessible
      allowed_transitions: [archived, removed]

    - name: archived
      description: Removed from active catalog
      allowed_transitions: [published, removed]

    - name: removed
      description: Permanently removed
      allowed_transitions: []
      terminal: true

  transitions:
    - name: submit_for_review
      from: draft
      to: pending_review
      requires: [title, description, poster_url, content_type]

    - name: approve
      from: pending_review
      to: approved
      requires_role: content_reviewer

    - name: reject
      from: pending_review
      to: draft
      requires_role: content_reviewer

    - name: publish
      from: approved
      to: published
      triggers:
        - invalidate_catalog_cache
        - notify_subscribers

    - name: archive
      from: published
      to: archived
      triggers:
        - remove_from_recommendations

    - name: remove
      from: [published, archived]
      to: removed
      requires_role: content_admin

indexes:
  - name: idx_content_type
    fields: [content_type]
    type: btree

  - name: idx_content_status
    fields: [status]
    type: btree

  - name: idx_content_release
    fields: [release_year, release_date]
    type: btree

  - name: idx_content_popularity
    fields: [popularity_score]
    type: btree

  - name: idx_content_slug
    fields: [slug]
    type: unique

  - name: idx_content_search
    fields: [title, original_title, description]
    type: fulltext

validations:
  - name: valid_duration
    condition: "content_type != 'series' IMPLIES duration_minutes IS NOT NULL"
    message: "Duration required for non-series content"

  - name: valid_seasons
    condition: "content_type = 'series' IMPLIES total_seasons IS NOT NULL"
    message: "Season count required for series"

  - name: valid_availability
    condition: "available_until IS NULL OR available_until > available_from"
    message: "End date must be after start date"

business_rules:
  - rule: content-publishing-rules
    description: Rules for content lifecycle management
