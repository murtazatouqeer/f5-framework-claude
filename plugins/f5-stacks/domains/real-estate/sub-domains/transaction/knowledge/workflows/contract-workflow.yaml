# Contract Workflow
# F5 Framework v2.0 - Real Estate/Transaction
# Complete contract preparation and execution process

workflow:
  name: ContractWorkflow
  name_vi: Quy tr√¨nh h·ª£p ƒë·ªìng
  name_ja: Â•ëÁ¥Ñ„ÉØ„Éº„ÇØ„Éï„É≠„Éº
  domain: real-estate
  subdomain: transaction
  version: "1.0.0"

  description: |
    End-to-end workflow for purchase contract preparation,
    review, notarization, and execution in Vietnamese real estate.

  # Workflow Metadata
  metadata:
    owner: legal_team
    estimated_duration: 7-21_days
    complexity: high
    automation_level: semi_automated
    requires_human_approval: true
    legal_compliance: required

  # Actors
  actors:
    buyer:
      role: Purchaser
      responsibilities:
        - Review contract
        - Provide required documents
        - Sign contract
        - Pay deposit
    seller:
      role: Property owner
      responsibilities:
        - Provide property documents
        - Review contract
        - Sign contract
        - Clear encumbrances
    buyer_agent:
      role: Buyer's representative
      responsibilities:
        - Coordinate document collection
        - Review contract terms
        - Schedule appointments
    listing_agent:
      role: Seller's representative
      responsibilities:
        - Coordinate seller documents
        - Facilitate contract review
    attorney:
      role: Legal advisor
      responsibilities:
        - Draft contract
        - Review legal compliance
        - Advise parties
    notary:
      role: C√¥ng ch·ª©ng vi√™n
      responsibilities:
        - Verify documents
        - Authenticate contract
        - Witness signatures
        - Issue notarized contract
    escrow_officer:
      role: Fund custodian
      responsibilities:
        - Hold deposit
        - Issue receipts
        - Track fund flow

  # Workflow States
  states:
    contract_initiation:
      name: Contract Initiation
      name_vi: Kh·ªüi t·∫°o h·ª£p ƒë·ªìng
      description: Post-acceptance, contract preparation begins
      entry_actions:
        - create_contract_record
        - collect_accepted_terms
        - identify_required_documents
      timeout: 3_days
      timeout_action: escalate_to_agents

    document_collection:
      name: Document Collection
      name_vi: Thu th·∫≠p t√†i li·ªáu
      description: Gathering required documents from parties
      entry_actions:
        - send_document_requests
        - create_checklist
      parallel_activities:
        - seller_documents
        - buyer_documents

    document_verification:
      name: Document Verification
      name_vi: X√°c minh t√†i li·ªáu
      description: Verifying authenticity and completeness
      entry_actions:
        - start_verification_process
      verification_items:
        - property_certificate
        - identity_documents
        - ownership_chain
        - encumbrance_check

    contract_drafting:
      name: Contract Drafting
      name_vi: So·∫°n th·∫£o h·ª£p ƒë·ªìng
      description: Attorney prepares contract document
      entry_actions:
        - assign_to_attorney
        - provide_terms_and_documents
      outputs:
        - draft_contract

    contract_review:
      name: Contract Review
      name_vi: Xem x√©t h·ª£p ƒë·ªìng
      description: Parties review draft contract
      entry_actions:
        - distribute_draft
        - request_feedback
      parallel_activities:
        - buyer_review
        - seller_review
        - agent_review

    contract_revision:
      name: Contract Revision
      name_vi: S·ª≠a ƒë·ªïi h·ª£p ƒë·ªìng
      description: Incorporating requested changes
      entry_actions:
        - collect_revision_requests
        - assign_to_attorney
      max_revisions: 3

    contract_approved:
      name: Contract Approved
      name_vi: H·ª£p ƒë·ªìng ƒë∆∞·ª£c ph√™ duy·ªát
      description: All parties approve final version
      entry_actions:
        - lock_contract_version
        - schedule_signing

    deposit_pending:
      name: Deposit Pending
      name_vi: Ch·ªù ƒë·∫∑t c·ªçc
      description: Waiting for earnest money deposit
      entry_actions:
        - send_deposit_instructions
        - create_escrow_account
      timeout: 3_days
      timeout_action: reminder_then_escalate

    deposit_received:
      name: Deposit Received
      name_vi: ƒê√£ nh·∫≠n ƒë·∫∑t c·ªçc
      description: Deposit confirmed in escrow
      entry_actions:
        - issue_receipt
        - notify_all_parties
        - update_transaction_record

    notary_scheduling:
      name: Notary Scheduling
      name_vi: L√™n l·ªãch c√¥ng ch·ª©ng
      description: Scheduling notarization appointment
      entry_actions:
        - identify_available_notaries
        - propose_dates
        - confirm_all_parties_availability

    notary_verification:
      name: Notary Verification
      name_vi: X√°c minh c√¥ng ch·ª©ng
      description: Notary verifying documents
      entry_actions:
        - submit_documents_to_notary
        - pay_verification_fee
      duration: 2-5_business_days
      outputs:
        - verification_result

    notarization:
      name: Notarization
      name_vi: C√¥ng ch·ª©ng
      description: Contract signing at notary office
      entry_actions:
        - confirm_appointment
        - prepare_final_documents
      required_attendance:
        - buyer
        - seller
        - witnesses

    contract_executed:
      name: Contract Executed
      name_vi: H·ª£p ƒë·ªìng ƒë√£ k√Ω k·∫øt
      description: Contract fully signed and notarized
      entry_actions:
        - distribute_copies
        - update_transaction_status
        - initiate_due_diligence
      terminal: false
      next_workflow: due_diligence_workflow

    contract_canceled:
      name: Contract Canceled
      name_vi: H·ª£p ƒë·ªìng ƒë√£ h·ªßy
      description: Contract terminated before execution
      entry_actions:
        - record_cancellation_reason
        - process_deposit_per_agreement
        - notify_all_parties
      terminal: true

  # Transitions
  transitions:
    - from: contract_initiation
      to: document_collection
      trigger: start_document_collection
      actions:
        - create_document_requests
        - set_deadlines

    - from: document_collection
      to: document_verification
      trigger: all_documents_received
      conditions:
        - seller_documents_complete
        - buyer_documents_complete
      actions:
        - compile_document_package

    - from: document_collection
      to: document_collection
      trigger: request_missing_document
      actions:
        - send_reminder
        - update_checklist

    - from: document_verification
      to: contract_drafting
      trigger: verification_passed
      conditions:
        - all_documents_verified
        - no_critical_issues
      actions:
        - create_drafting_assignment

    - from: document_verification
      to: document_collection
      trigger: verification_failed
      conditions:
        - documents_invalid_or_missing
      actions:
        - notify_issue
        - request_replacement

    - from: contract_drafting
      to: contract_review
      trigger: draft_complete
      actions:
        - distribute_to_parties
        - set_review_deadline

    - from: contract_review
      to: contract_revision
      trigger: changes_requested
      conditions:
        - revision_requests_submitted
      actions:
        - compile_change_requests

    - from: contract_review
      to: contract_approved
      trigger: all_parties_approve
      conditions:
        - buyer_approved
        - seller_approved
      actions:
        - lock_version
        - prepare_for_signing

    - from: contract_revision
      to: contract_review
      trigger: revision_complete
      actions:
        - redistribute_revised_draft
        - increment_version

    - from: contract_approved
      to: deposit_pending
      trigger: request_deposit
      actions:
        - send_wire_instructions
        - set_deposit_deadline

    - from: deposit_pending
      to: deposit_received
      trigger: deposit_confirmed
      conditions:
        - funds_cleared
        - amount_matches
      actions:
        - issue_receipt
        - notify_parties

    - from: deposit_received
      to: notary_scheduling
      trigger: schedule_notarization
      actions:
        - identify_notary
        - propose_dates

    - from: notary_scheduling
      to: notary_verification
      trigger: notary_appointment_confirmed
      actions:
        - submit_documents
        - pay_fees

    - from: notary_verification
      to: notarization
      trigger: verification_complete
      conditions:
        - notary_approved_documents
      actions:
        - confirm_appointment
        - prepare_signing_room

    - from: notary_verification
      to: document_collection
      trigger: notary_issues_found
      actions:
        - notify_issue
        - request_correction

    - from: notarization
      to: contract_executed
      trigger: signing_complete
      conditions:
        - all_signatures_obtained
        - notary_seal_applied
      actions:
        - issue_certified_copies
        - update_status

    - from: [contract_review, contract_approved, deposit_pending]
      to: contract_canceled
      trigger: cancel_contract
      conditions:
        - valid_cancellation_reason
      actions:
        - record_cancellation
        - process_deposit_return

  # Activities
  activities:
    collect_seller_documents:
      name: Collect Seller Documents
      name_vi: Thu th·∫≠p t√†i li·ªáu ng∆∞·ªùi b√°n
      actor: listing_agent
      documents:
        - property_certificate_original:
            name: Gi·∫•y ch·ª©ng nh·∫≠n QSDƒê
            required: true
        - seller_id:
            name: CMND/CCCD
            required: true
        - household_registration:
            name: S·ªï h·ªô kh·∫©u
            required: true
        - marriage_certificate:
            name: Gi·∫•y ƒëƒÉng k√Ω k·∫øt h√¥n
            required: if_married
        - spouse_consent:
            name: ƒê·ªìng √Ω c·ªßa v·ª£/ch·ªìng
            required: if_married
        - mortgage_release:
            name: Gi·∫•y gi·∫£i ch·∫•p
            required: if_mortgaged
        - tax_clearance:
            name: X√°c nh·∫≠n kh√¥ng n·ª£ thu·∫ø
            required: true

    collect_buyer_documents:
      name: Collect Buyer Documents
      name_vi: Thu th·∫≠p t√†i li·ªáu ng∆∞·ªùi mua
      actor: buyer_agent
      documents:
        - buyer_id:
            name: CMND/CCCD/Passport
            required: true
        - household_registration:
            name: S·ªï h·ªô kh·∫©u
            required: true
        - marriage_certificate:
            name: Gi·∫•y ƒëƒÉng k√Ω k·∫øt h√¥n
            required: if_married
        - proof_of_funds:
            name: Ch·ª©ng minh t√†i ch√≠nh
            required: true
        - loan_approval:
            name: Ph√™ duy·ªát vay
            required: if_financed

    draft_contract:
      name: Draft Purchase Contract
      name_vi: So·∫°n h·ª£p ƒë·ªìng mua b√°n
      actor: attorney
      steps:
        - step: 1
          name: Review accepted terms
          inputs:
            - accepted_offer
            - any_amendments
        - step: 2
          name: Verify property details
          inputs:
            - property_certificate
            - survey_if_available
        - step: 3
          name: Draft contract clauses
          sections:
            - parties
            - property_description
            - purchase_price
            - payment_terms
            - contingencies
            - representations
            - closing_terms
            - default_remedies
        - step: 4
          name: Include standard clauses
          clauses:
            - property_as_is_or_warranties
            - risk_of_loss
            - prorations
            - dispute_resolution
            - governing_law
        - step: 5
          name: Review for compliance
          checks:
            - civil_code_compliance
            - land_law_compliance
            - real_estate_law_compliance
        - step: 6
          name: Finalize draft
          outputs:
            - draft_contract_v1

    notarization_process:
      name: Notarization Process
      name_vi: Quy tr√¨nh c√¥ng ch·ª©ng
      actor: notary
      location: notary_office
      steps:
        - step: 1
          name: Identity verification
          actions:
            - verify_all_party_identities
            - check_id_authenticity
            - confirm_authority_to_sign
        - step: 2
          name: Document review
          actions:
            - review_contract_terms
            - verify_property_ownership
            - check_for_encumbrances
        - step: 3
          name: Reading and explanation
          actions:
            - read_contract_aloud
            - explain_key_terms
            - confirm_understanding
        - step: 4
          name: Signature collection
          order:
            - seller_signature
            - buyer_signature
            - witness_signatures
            - notary_signature
        - step: 5
          name: Notary certification
          actions:
            - apply_notary_seal
            - register_in_notary_book
            - issue_registration_number
        - step: 6
          name: Document distribution
          copies:
            - original_for_land_registration
            - certified_copy_for_buyer
            - certified_copy_for_seller
            - notary_office_file

  # Business Rules Integration
  business_rules:
    - rule_ref: BR-CON-001  # Required contract elements
    - rule_ref: BR-CON-010  # Mandatory notarization
    - rule_ref: BR-CON-012  # Notarization documents
    - rule_ref: BR-DEP-010  # Third-party custody
    - rule_ref: BR-DEP-011  # Deposit receipt

  # Notifications
  notifications:
    document_request:
      recipients: [buyer, seller]
      template: document_request
      channels: [email, app]
      content:
        subject: "Documents Required for Contract"
        body: |
          Please provide the following documents:
          {document_list}
          Deadline: {deadline}

    draft_ready_for_review:
      recipients: [buyer, seller, buyer_agent, listing_agent]
      template: contract_draft_ready
      channels: [email, app]
      content:
        subject: "Contract Draft Ready for Review"
        body: |
          The purchase contract draft is ready for your review.
          Please review and submit any change requests by {deadline}.

    deposit_instructions:
      recipients: [buyer, buyer_agent]
      template: deposit_instructions
      channels: [email]
      priority: high
      content:
        subject: "Deposit Payment Instructions"
        body: |
          Please wire the earnest money deposit:
          Amount: {deposit_amount}
          Account: {escrow_account}
          Reference: {transaction_id}
          Deadline: {deadline}

    deposit_confirmed:
      recipients: [all_parties]
      template: deposit_confirmation
      channels: [email, sms, app]

    notary_appointment:
      recipients: [buyer, seller, agents]
      template: notary_appointment
      channels: [email, sms]
      content:
        subject: "Notarization Appointment Confirmed"
        body: |
          Your notarization appointment is scheduled:
          Date: {date}
          Time: {time}
          Location: {notary_address}
          Please bring original ID documents.

    contract_executed:
      recipients: [all_parties]
      template: contract_executed
      channels: [email, sms, app]
      priority: high
      content:
        subject: "üéâ Contract Signed and Notarized"
        body: |
          The purchase contract has been successfully
          executed and notarized.
          Next: Due diligence period begins.

  # Documents
  documents:
    purchase_contract:
      template: purchase_contract_template_vi
      language: vietnamese
      required_elements:
        - preamble
        - party_details
        - property_description
        - purchase_price
        - payment_schedule
        - contingencies
        - representations
        - closing_conditions
        - default_provisions
        - dispute_resolution
        - signatures
      certification: notarized

    deposit_receipt:
      template: deposit_receipt_template
      issued_by: escrow_holder
      required_elements:
        - receipt_number
        - date_received
        - amount
        - payer
        - transaction_reference

    notarized_contract:
      template: notarized_contract_certificate
      issued_by: notary
      elements:
        - contract_text
        - notary_certification
        - registration_number
        - seal

  # Metrics
  metrics:
    - name: contract_preparation_time
      description: Days from acceptance to contract draft
      target: "< 5 days"
    - name: review_cycle_time
      description: Days per review cycle
      target: "< 3 days"
    - name: notarization_success_rate
      description: First-attempt notarization success
      target: "> 90%"
    - name: document_completeness_rate
      description: Documents complete on first submission
      target: "> 80%"

  # Error Handling
  error_handling:
    document_verification_failed:
      action: notify_and_request_correction
      escalation: after_2_attempts
    notary_rejection:
      action: identify_issue_and_correct
      notification: all_parties
    deposit_not_received:
      action: reminder_sequence
      escalation: after_deadline

  # Audit Trail
  audit:
    tracked_events:
      - contract_initiated
      - document_submitted
      - document_verified
      - draft_created
      - draft_distributed
      - review_submitted
      - revision_requested
      - contract_approved
      - deposit_received
      - notary_scheduled
      - contract_executed
      - contract_canceled
    retention: 10_years
