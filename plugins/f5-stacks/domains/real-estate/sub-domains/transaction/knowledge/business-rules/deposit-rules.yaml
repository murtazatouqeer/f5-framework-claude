# Deposit Business Rules
# F5 Framework v2.0 - Real Estate/Transaction
# Rules governing earnest money deposits and escrow

business_rules:
  name: DepositRules
  name_vi: Quy tắc đặt cọc
  name_ja: 手付金規則
  domain: real-estate
  subdomain: transaction
  version: "1.0.0"

  description: |
    Business rules governing earnest money deposits, including
    custody requirements, release conditions, and forfeiture scenarios.

  # Deposit Amount Rules
  deposit_amount:
    - rule_id: BR-DEP-001
      name: Minimum Deposit Amount
      name_vi: Số tiền đặt cọc tối thiểu
      description: |
        Earnest money deposit must be at least 1% of the purchase price
        to demonstrate serious buyer intent.
      calculation: deposit_amount >= purchase_price * 0.01
      enforcement: required
      severity: error
      message: "Deposit must be at least 1% of purchase price"

    - rule_id: BR-DEP-002
      name: Maximum Deposit Protection
      name_vi: Bảo vệ tiền cọc tối đa
      description: |
        Under Vietnam Civil Code, deposits exceeding 30% of contract
        value may face scrutiny. Recommend capping at 20%.
      legal_reference: Vietnam Civil Code Article 328
      recommended_max: 0.20
      absolute_max: 0.30
      warning_threshold: 0.20
      message: "Deposits over 20% require additional justification"

    - rule_id: BR-DEP-003
      name: Deposit Increments
      name_vi: Các đợt đặt cọc
      description: |
        Large transactions may have multiple deposit increments
        tied to milestones.
      typical_structure:
        initial_deposit:
          timing: with_accepted_offer
          percentage: 1-3%
        additional_deposit:
          timing: end_of_due_diligence
          percentage: 5-10%
      total_before_closing: typically 10-20%

  # Custody Rules
  custody:
    - rule_id: BR-DEP-010
      name: Third-Party Custody Required
      name_vi: Yêu cầu lưu ký bên thứ ba
      description: |
        Deposits must be held by neutral third party: licensed
        escrow company, attorney trust account, or title company.
      allowed_custodians:
        - licensed_escrow_company
        - attorney_trust_account
        - title_company
        - bank_escrow_service
      prohibited_custodians:
        - seller_directly
        - listing_agent_personal_account
        - buyer_directly_to_seller
      enforcement: required
      severity: error
      message: "Deposit must be held by authorized third-party custodian"

    - rule_id: BR-DEP-011
      name: Deposit Receipt Required
      name_vi: Yêu cầu biên nhận đặt cọc
      description: |
        Custodian must issue official receipt within 24 hours of
        receiving deposit funds.
      receipt_requirements:
        - unique_receipt_number
        - transaction_reference
        - amount_received
        - date_and_time
        - custodian_details
        - bank_reference_if_applicable
      timing: within_24_hours
      notification: buyer_and_seller

    - rule_id: BR-DEP-012
      name: Segregated Account
      name_vi: Tài khoản riêng biệt
      description: |
        Deposit funds must be held in segregated trust account,
        not commingled with custodian's operating funds.
      account_type: trust_account
      commingling: prohibited
      interest_handling:
        earned_by: as_per_agreement
        default: buyer
      audit_requirement: annual

    - rule_id: BR-DEP-013
      name: Insurance Requirement
      name_vi: Yêu cầu bảo hiểm
      description: |
        Escrow accounts holding deposits must be insured up to
        coverage limits. Large deposits may require additional coverage.
      coverage_requirement: full_deposit_amount
      insurance_types:
        - fidelity_bond
        - errors_omissions
        - deposit_insurance

  # Release Conditions
  release_conditions:
    - rule_id: BR-DEP-020
      name: Mutual Release
      name_vi: Giải phóng theo thỏa thuận
      description: |
        Deposit can be released when both buyer and seller agree
        in writing to release terms and recipient.
      requirements:
        - written_release_agreement
        - signatures_from_both_parties
        - notarization_if_disputed
      processing_time: 3-5_business_days

    - rule_id: BR-DEP-021
      name: Successful Closing Release
      name_vi: Giải phóng khi đóng giao dịch thành công
      description: |
        Upon successful closing, deposit is credited toward
        purchase price or released per closing instructions.
      trigger: closing_completed
      application: credit_to_purchase_price
      timing: at_closing

    - rule_id: BR-DEP-022
      name: Contingency Failure Release
      name_vi: Giải phóng khi điều kiện không đáp ứng
      description: |
        If buyer cancels within contingency period due to failed
        contingency, deposit is returned to buyer.
      valid_contingencies:
        financing_denied:
          documentation: lender_denial_letter
          refund: full_deposit
        inspection_issues:
          documentation: inspection_report
          timing: within_contingency_period
          refund: full_deposit
        appraisal_shortfall:
          documentation: appraisal_report
          refund: full_deposit
        title_defects:
          documentation: title_report
          refund: full_deposit
      enforcement: required

    - rule_id: BR-DEP-023
      name: Contract Termination by Agreement
      name_vi: Chấm dứt hợp đồng theo thỏa thuận
      description: |
        If parties mutually agree to terminate contract,
        deposit allocation follows termination agreement.
      requirements:
        - signed_termination_agreement
        - deposit_allocation_specified
        - both_parties_consent
      allocation_options:
        - return_to_buyer
        - release_to_seller
        - split_per_agreement

  # Forfeiture Rules
  forfeiture:
    - rule_id: BR-DEP-030
      name: Buyer Default Forfeiture
      name_vi: Tịch thu khi người mua vi phạm
      description: |
        If buyer defaults without valid contingency protection,
        seller may claim deposit as liquidated damages.
      default_conditions:
        - failure_to_close_without_cause
        - missed_deadlines_without_extension
        - financing_contingency_waived_then_failed
        - walked_away_after_contingencies_expired
      forfeiture_limit:
        legal_reference: Vietnam Civil Code
        max_forfeiture: deposit_amount
        excess_damages: may_be_pursued_separately

    - rule_id: BR-DEP-031
      name: Seller Default Consequences
      name_vi: Hậu quả khi người bán vi phạm
      description: |
        If seller defaults, buyer receives deposit return
        plus may be entitled to double deposit under Civil Code.
      seller_defaults:
        - refusal_to_close
        - title_defects_not_disclosed
        - material_misrepresentation
        - property_condition_fraud
      buyer_remedies:
        - full_deposit_return
        - double_deposit_penalty  # Article 328 Civil Code
        - actual_damages_if_proven
        - specific_performance_if_applicable

    - rule_id: BR-DEP-032
      name: Forfeiture Notice Requirement
      name_vi: Yêu cầu thông báo tịch thu
      description: |
        Party claiming forfeiture must provide written notice
        specifying breach and give cure period if applicable.
      notice_requirements:
        - written_notice
        - specification_of_breach
        - cure_period: 5_business_days  # unless waived
        - delivery_confirmation
      cure_right: |
        Non-breaching party must allow cure opportunity
        unless breach is incurable (e.g., missed closing)

    - rule_id: BR-DEP-033
      name: Disputed Forfeiture Procedure
      name_vi: Thủ tục tịch thu tranh chấp
      description: |
        If parties dispute forfeiture, escrow holder retains
        deposit until resolution through agreed mechanism.
      dispute_resolution:
        - mediation_first: recommended
        - arbitration: if_agreed
        - court_litigation: last_resort
      escrow_holder_action:
        - hold_funds_pending_resolution
        - no_release_without_agreement_or_court_order
        - may_interplead_to_court

  # Refund Rules
  refund:
    - rule_id: BR-DEP-040
      name: Refund Processing Time
      name_vi: Thời gian xử lý hoàn trả
      description: |
        Refunds must be processed within specified timeframes
        based on release type.
      processing_times:
        mutual_release: 5_business_days
        contingency_failure: 3_business_days
        court_ordered: per_court_order
        closing_canceled: 5_business_days

    - rule_id: BR-DEP-041
      name: Refund Method
      name_vi: Phương thức hoàn trả
      description: |
        Refunds returned via same method as original payment
        unless parties agree otherwise.
      default_method: same_as_payment
      alternatives:
        - bank_transfer
        - check
        - cash_if_original_was_cash  # documentation required

    - rule_id: BR-DEP-042
      name: Interest on Refund
      name_vi: Lãi suất hoàn trả
      description: |
        Interest earned on deposit during escrow period
        allocated per escrow agreement terms.
      default_allocation: buyer
      calculation: actual_interest_earned
      documentation: interest_statement_required

  # Documentation Requirements
  documentation:
    - rule_id: BR-DEP-050
      name: Deposit Agreement Required
      name_vi: Yêu cầu thỏa thuận đặt cọc
      description: |
        Written deposit/escrow agreement must be signed before
        or concurrent with deposit submission.
      required_elements:
        - deposit_amount
        - custodian_information
        - release_conditions
        - forfeiture_conditions
        - interest_allocation
        - dispute_resolution_mechanism
        - signatures_of_all_parties

    - rule_id: BR-DEP-051
      name: Payment Documentation
      name_vi: Tài liệu thanh toán
      description: |
        All deposit payments must be documented with
        traceable payment records.
      required_records:
        bank_transfer:
          - transfer_receipt
          - bank_statement
          - reference_number
        check:
          - check_copy
          - deposit_confirmation
          - clearance_confirmation
        cash:
          - receipt_with_witness
          - photo_documentation
          - counting_verification

  # Notification Rules
  notifications:
    - rule_id: BR-DEP-060
      name: Deposit Received Notification
      name_vi: Thông báo nhận tiền cọc
      description: |
        All parties notified within 24 hours of deposit receipt.
      recipients:
        - buyer
        - seller
        - buyer_agent
        - seller_agent
      content:
        - deposit_amount
        - date_received
        - receipt_number
        - custodian_details

    - rule_id: BR-DEP-061
      name: Release Request Notification
      name_vi: Thông báo yêu cầu giải phóng
      description: |
        Any release request triggers notification to all parties.
      recipients: all_transaction_parties
      response_period: 3_business_days
      objection_process: written_objection_required

  # Compliance
  compliance:
    - rule_id: BR-DEP-070
      name: Anti-Money Laundering
      name_vi: Chống rửa tiền
      description: |
        Deposits over 300 million VND require enhanced due diligence
        per anti-money laundering regulations.
      threshold: 300000000  # VND
      requirements:
        - source_of_funds_verification
        - identity_verification
        - suspicious_activity_reporting
        - record_keeping: 5_years

    - rule_id: BR-DEP-071
      name: Tax Reporting
      name_vi: Báo cáo thuế
      description: |
        Deposit handling must comply with tax reporting
        requirements for real estate transactions.
      reporting:
        - large_cash_transactions
        - interest_earned
        - transaction_completion

  # Calculation Functions
  calculation_functions:
    minimum_deposit:
      input: [purchase_price]
      output: min_deposit
      formula: purchase_price * 0.01

    recommended_deposit:
      input: [purchase_price]
      output: recommended
      formula: purchase_price * 0.10

    forfeiture_limit:
      input: [deposit_amount, actual_damages]
      output: max_forfeiture
      formula: MIN(deposit_amount, actual_damages + deposit_amount)

    refund_with_interest:
      input: [deposit_amount, interest_rate, days_held]
      output: refund_total
      formula: deposit_amount + (deposit_amount * interest_rate * days_held / 365)

  # Audit Trail
  audit:
    - All deposits tracked from receipt to disbursement
    - Release authorizations logged with approver and timestamp
    - Dispute filings and resolutions documented
    - Interest calculations auditable
    - Compliance checks recorded
