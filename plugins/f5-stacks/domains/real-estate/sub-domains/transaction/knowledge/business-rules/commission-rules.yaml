# Commission Business Rules
# F5 Framework v2.0 - Real Estate/Transaction
# Rules governing agent commissions and splits

business_rules:
  name: CommissionRules
  name_vi: Quy tắc hoa hồng
  name_ja: 手数料規則
  domain: real-estate
  subdomain: transaction
  version: "1.0.0"

  description: |
    Business rules governing real estate agent commissions,
    including rates, splits, payment timing, and forfeiture
    conditions in the Vietnamese market.

  # Commission Rates
  commission_rates:
    - rule_id: BR-COM-001
      name: Standard Commission Rates
      name_vi: Tỷ lệ hoa hồng tiêu chuẩn
      description: |
        Standard commission rates for different transaction types
        in Vietnamese real estate market.
      rates:
        residential_sale:
          typical_range: 1-3%
          standard: 2%
          high_value_threshold: 10000000000  # 10 billion VND
          high_value_rate: 1-1.5%
        commercial_sale:
          typical_range: 1-2%
          standard: 1.5%
        land_sale:
          typical_range: 1-3%
          standard: 2%
        rental:
          typical: one_month_rent
          range: 0.5-1_month
          annual_lease_minimum: true
        project_sales:
          developer_rate: 1-3%
          depends_on: volume_and_exclusivity
      negotiability: rates_are_negotiable
      market_context: Vietnam_specific

    - rule_id: BR-COM-002
      name: Commission Calculation Basis
      name_vi: Cơ sở tính hoa hồng
      description: |
        Commission calculated on final sale price,
        not listing price or offer price.
      calculation_basis: final_sale_price
      inclusions:
        - base_purchase_price
        - included_personal_property_value
      exclusions:
        - transfer_taxes
        - closing_costs
        - repair_credits
        - seller_concessions
      example:
        sale_price: 5000000000
        commission_rate: 2%
        commission: 100000000

    - rule_id: BR-COM-003
      name: Minimum Commission
      name_vi: Hoa hồng tối thiểu
      description: |
        Minimum commission amounts may apply for
        low-value transactions.
      minimum_amounts:
        residential: 10000000  # 10 million VND
        commercial: 20000000  # 20 million VND
        rental: 5000000  # 5 million VND
      application: higher_of_percentage_or_minimum
      disclosure: in_listing_agreement

  # Commission Splits
  commission_splits:
    - rule_id: BR-COM-010
      name: Listing/Buyer Agent Split
      name_vi: Phân chia môi giới bán/mua
      description: |
        Total commission typically split between listing
        side and buyer side.
      standard_splits:
        equal_split: 50/50
        listing_heavy: 60/40
        buyer_heavy: 40/60
      determination:
        - per_mls_offering
        - per_listing_agreement
        - per_cooperation_agreement
      default: 50/50

    - rule_id: BR-COM-011
      name: Agent-Agency Split
      name_vi: Phân chia môi giới-công ty
      description: |
        Agent's share of commission split with their
        brokerage/agency.
      typical_splits:
        new_agent: 50/50
        experienced_agent: 60/40_to_70/30
        top_producer: 80/20_to_90/10
        team_lead: varies
      factors:
        - experience_level
        - production_volume
        - desk_fees
        - cap_structure
        - team_arrangements
      documentation: agent_agreement

    - rule_id: BR-COM-012
      name: Team Splits
      name_vi: Phân chia đội nhóm
      description: |
        Commission splits within agent teams.
      team_structures:
        lead_agent:
          role: primary_client_contact
          typical_share: 50-70%
        buyer_agent:
          role: shows_properties
          typical_share: 30-50%
        transaction_coordinator:
          role: administrative
          typical_share: fixed_fee_or_5-10%
        showing_assistant:
          role: property_access
          typical_share: per_showing_fee
      documentation: team_agreement

    - rule_id: BR-COM-013
      name: Referral Fees
      name_vi: Phí giới thiệu
      description: |
        Referral fees paid for client introductions.
      typical_rates:
        agent_to_agent: 20-35%_of_referring_side
        relocation_company: 30-40%
        online_lead: varies_by_source
      caps:
        typical_maximum: 35%
        exceptional: up_to_50%
      requirements:
        - written_referral_agreement
        - licensed_recipient
        - disclosed_to_parties
      payment_timing: at_closing

  # Payment Rules
  payment_timing:
    - rule_id: BR-COM-020
      name: Commission Payment Timing
      name_vi: Thời điểm thanh toán hoa hồng
      description: |
        Commission payable upon successful closing
        and fund disbursement.
      standard_timing: at_closing
      payment_methods:
        - wire_transfer
        - check
        - escrow_disbursement
      conditions_for_payment:
        - transaction_closed
        - funds_disbursed
        - no_pending_disputes
        - invoice_submitted

    - rule_id: BR-COM-021
      name: Delayed Payment Scenarios
      name_vi: Các trường hợp thanh toán chậm
      description: |
        Circumstances where commission payment may be delayed.
      delay_scenarios:
        financing_delay:
          description: Lender delays closing
          commission: paid_when_closes
        title_issues:
          description: Title problems being resolved
          commission: paid_when_resolved
        post_closing_escrow:
          description: Funds held for repairs
          commission: paid_from_available_funds
        dispute:
          description: Commission dispute
          commission: held_pending_resolution
      interest_on_delayed: per_agreement

    - rule_id: BR-COM-022
      name: Installment Sales Commission
      name_vi: Hoa hồng bán trả góp
      description: |
        Commission on installment/seller-financed sales.
      options:
        full_at_closing:
          description: Full commission at initial closing
          risk: agent_bears_buyer_default_risk
          discount: possible_reduced_rate
        installment_matching:
          description: Commission paid as payments received
          schedule: matches_payment_schedule
          risk: seller_bears_default_risk
        hybrid:
          description: Partial at closing, balance over time
          typical: 50%_at_closing_balance_installments
      default: full_at_closing
      documentation: commission_agreement

  # Forfeiture Rules
  forfeiture:
    - rule_id: BR-COM-030
      name: Transaction Failure - No Commission
      name_vi: Giao dịch thất bại - Không có hoa hồng
      description: |
        No commission earned if transaction fails to close
        through no fault of agent.
      no_commission_scenarios:
        - buyer_cannot_obtain_financing
        - buyer_defaults
        - seller_defaults
        - mutual_termination
        - failed_contingencies
        - force_majeure
      exception: seller_breach_may_still_owe
      documentation: listing_agreement_terms

    - rule_id: BR-COM-031
      name: Procuring Cause
      name_vi: Nguyên nhân đạt được giao dịch
      description: |
        Agent must be procuring cause of sale to earn
        commission.
      procuring_cause_factors:
        - introduced_buyer_to_property
        - continuous_involvement
        - no_abandonment
        - no_buyer_replacement
      disputes:
        - resolved_per_agreement
        - arbitration_if_needed
      documentation: showing_records_required

    - rule_id: BR-COM-032
      name: Commission After Listing Expiration
      name_vi: Hoa hồng sau khi hết hạn niêm yết
      description: |
        Protection period after listing expires.
      protection_period:
        typical: 90-180_days
        applies_to: registered_prospects
        requirement: prospect_list_submitted
      conditions:
        - buyer_was_introduced_during_listing
        - buyer_on_protection_list
        - no_new_listing_with_another_agent
      waiver: new_listing_agreement_supersedes

    - rule_id: BR-COM-033
      name: Agent Misconduct Forfeiture
      name_vi: Tịch thu do môi giới vi phạm
      description: |
        Agent forfeits commission for serious misconduct.
      forfeiture_causes:
        - undisclosed_dual_agency
        - fraud_or_misrepresentation
        - breach_of_fiduciary_duty
        - license_violation
        - failure_to_disclose_material_facts
        - conflicts_of_interest_undisclosed
      process:
        - written_complaint
        - investigation
        - determination
        - forfeiture_or_claim_against_bond

  # Documentation Requirements
  documentation:
    - rule_id: BR-COM-040
      name: Listing Agreement Requirements
      name_vi: Yêu cầu thỏa thuận niêm yết
      description: |
        Written listing agreement required for commission.
      required_elements:
        - property_description
        - listing_price
        - commission_rate
        - listing_period
        - protection_period
        - cooperation_with_other_agents
        - seller_signatures
      types:
        exclusive_right_to_sell:
          commission_owed: regardless_of_who_sells
          most_common: true
        exclusive_agency:
          commission_owed: unless_seller_finds_buyer
        open_listing:
          commission_owed: only_if_agent_finds_buyer

    - rule_id: BR-COM-041
      name: Buyer Representation Agreement
      name_vi: Thỏa thuận đại diện người mua
      description: |
        Agreement establishing buyer-agent relationship.
      types:
        exclusive:
          commission_owed: for_any_purchase
          duration: specified_period
        non_exclusive:
          commission_owed: for_properties_shown
      requirements:
        - scope_of_representation
        - commission_responsibility
        - duration
        - buyer_signatures

    - rule_id: BR-COM-042
      name: Commission Invoice
      name_vi: Hóa đơn hoa hồng
      description: |
        Proper invoice required for commission payment.
      invoice_elements:
        - agent_license_number
        - agency_information
        - transaction_details
        - commission_calculation
        - tax_information
        - payment_instructions
      timing: submitted_before_closing

  # Tax Implications
  tax:
    - rule_id: BR-COM-050
      name: Commission Tax Treatment
      name_vi: Xử lý thuế hoa hồng
      description: |
        Tax obligations on commission income.
      tax_types:
        personal_income_tax:
          for: individual_agents
          rate: progressive_rates
          deductions: business_expenses
        corporate_income_tax:
          for: agency_companies
          rate: standard_corporate_rate
        vat:
          rate: 10%
          applies_to: agency_services
      withholding:
        when: paid_to_individual
        rate: per_tax_regulations
      reporting: annual_tax_filing

    - rule_id: BR-COM-051
      name: Commission Payment Documentation
      name_vi: Tài liệu thanh toán hoa hồng
      description: |
        Documentation required for tax compliance.
      required_documents:
        - vat_invoice
        - payment_receipt
        - commission_statement
        - withholding_certificate_if_applicable
      retention: 5_years_minimum

  # Dispute Resolution
  disputes:
    - rule_id: BR-COM-060
      name: Commission Dispute Resolution
      name_vi: Giải quyết tranh chấp hoa hồng
      description: |
        Process for resolving commission disputes.
      dispute_types:
        - procuring_cause
        - split_disagreements
        - referral_fee_disputes
        - amount_calculations
        - forfeiture_claims
      resolution_process:
        step_1_negotiation:
          duration: 10_business_days
          parties: involved_agents_and_brokers
        step_2_mediation:
          duration: 30_days
          mediator: association_or_agreed
        step_3_arbitration:
          binding: per_agreement
          provider: real_estate_association
        step_4_litigation:
          court: civil_court
          last_resort: true

    - rule_id: BR-COM-061
      name: Hold Harmless During Dispute
      name_vi: Giữ tiền trong tranh chấp
      description: |
        Disputed commission held by closing agent/escrow
        until resolution.
      holding_party:
        - escrow_company
        - closing_attorney
        - brokerage_trust_account
      release_conditions:
        - written_agreement
        - court_order
        - arbitration_decision
      interest: per_escrow_agreement

  # Special Situations
  special_situations:
    - rule_id: BR-COM-070
      name: Dual Agency Commission
      name_vi: Hoa hồng đại diện kép
      description: |
        Commission handling when agent represents both parties.
      requirements:
        - written_disclosure
        - both_party_consent
        - reduced_services_disclosure
      commission:
        total: full_commission
        handling: retained_by_one_agent
        disclosure: required

    - rule_id: BR-COM-071
      name: In-House Transaction
      name_vi: Giao dịch nội bộ
      description: |
        Both agents from same brokerage.
      commission:
        total: full_commission
        split: per_office_policy
        agency_share: may_differ_from_external

    - rule_id: BR-COM-072
      name: New Development Sales
      name_vi: Bán dự án mới
      description: |
        Commission on developer sales.
      typical_arrangements:
        exclusive_sales:
          commission: 2-3%
          bonuses: volume_based
        non_exclusive:
          commission: 1-2%
        co_broke:
          commission: shared_with_buyer_agent
      payment:
        timing: per_developer_agreement
        often: milestone_based

  # Calculation Functions
  calculation_functions:
    calculate_gross_commission:
      input: [sale_price, commission_rate]
      output: gross_commission
      formula: sale_price * commission_rate

    calculate_side_split:
      input: [gross_commission, split_percentage]
      output: side_commission
      formula: gross_commission * split_percentage

    calculate_agent_net:
      input: [side_commission, agent_split, fees]
      output: agent_net
      formula: (side_commission * agent_split) - fees

    calculate_referral_fee:
      input: [side_commission, referral_percentage]
      output: referral_fee
      formula: side_commission * referral_percentage

  # Audit Trail
  audit:
    - All commission agreements documented
    - Split calculations recorded
    - Payment authorizations logged
    - Dispute filings and resolutions tracked
    - Tax withholding documented
    - Invoice and receipt matching verified
