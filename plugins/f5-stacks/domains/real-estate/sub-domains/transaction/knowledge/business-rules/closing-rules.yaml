# Closing Business Rules
# F5 Framework v2.0 - Real Estate/Transaction
# Rules governing transaction closing process

business_rules:
  name: ClosingRules
  name_vi: Quy tắc đóng giao dịch
  name_ja: 決済規則
  domain: real-estate
  subdomain: transaction
  version: "1.0.0"

  description: |
    Business rules governing the closing process for real estate
    transactions, including prerequisites, fund verification,
    title transfer, and possession procedures.

  # Closing Prerequisites
  prerequisites:
    - rule_id: BR-CLO-001
      name: Pre-Closing Checklist Completion
      name_vi: Hoàn thành danh sách kiểm tra trước đóng
      description: |
        All pre-closing requirements must be satisfied before
        scheduling closing date.
      required_items:
        contract:
          - notarized_purchase_agreement
          - all_amendments_signed
          - contingencies_satisfied_or_waived
        due_diligence:
          - title_search_complete
          - title_clear_or_exceptions_accepted
          - inspections_complete
          - issues_resolved_or_accepted
        financing:
          - loan_approval_received  # if applicable
          - mortgage_commitment_letter
          - loan_documents_prepared
        documents:
          - all_required_documents_collected
          - documents_verified
          - closing_documents_prepared
        funds:
          - buyer_funds_verified
          - closing_costs_calculated
          - wire_instructions_confirmed
      enforcement: required
      severity: critical
      message: "Cannot proceed to closing with incomplete prerequisites"

    - rule_id: BR-CLO-002
      name: Title Clearance
      name_vi: Xác nhận quyền sở hữu rõ ràng
      description: |
        Title must be clear or buyer must accept known exceptions
        before closing can proceed.
      requirements:
        - title_search_completed
        - no_undisclosed_liens
        - no_unresolved_encumbrances
        - seller_ownership_verified
        - existing_mortgages_payoff_arranged
      exceptions_handling:
        - disclosed_in_contract
        - buyer_acceptance_in_writing
        - title_insurance_coverage
      enforcement: required
      severity: critical

    - rule_id: BR-CLO-003
      name: Final Walk-Through
      name_vi: Kiểm tra lần cuối
      description: |
        Buyer entitled to final walk-through within 24-48 hours
        before closing to verify property condition.
      timing: 24-48_hours_before_closing
      purpose:
        - verify_property_condition
        - confirm_agreed_repairs_completed
        - ensure_seller_belongings_removed
        - verify_fixtures_included
        - check_for_new_damage
      issues_found:
        minor: proceed_with_credit
        major: delay_closing_for_resolution
        critical: may_cancel_closing

  # Fund Verification
  fund_verification:
    - rule_id: BR-CLO-010
      name: Buyer Funds Verification
      name_vi: Xác minh tiền của người mua
      description: |
        Buyer must demonstrate available funds before closing.
      verification_timing: 2-3_days_before_closing
      verification_methods:
        cash_purchase:
          - bank_statement_showing_balance
          - proof_of_wire_capability
          - source_of_funds_declaration
        financed_purchase:
          - lender_commitment_letter
          - down_payment_verification
          - closing_costs_availability
      amount_required:
        - purchase_price
        - minus: deposit_credited
        - plus: buyer_closing_costs
        - equals: total_due_at_closing

    - rule_id: BR-CLO-011
      name: Wire Transfer Requirements
      name_vi: Yêu cầu chuyển khoản
      description: |
        Large sums must be transferred via bank wire with
        proper verification to prevent fraud.
      wire_requirements:
        threshold: 100000000  # VND (100 million)
        above_threshold:
          - bank_wire_only
          - verified_account_numbers
          - verbal_confirmation_of_instructions
          - no_last_minute_instruction_changes
      fraud_prevention:
        - verify_wire_instructions_in_person_or_phone
        - never_trust_email_only_instructions
        - confirm_recipient_account_ownership
      timing: funds_must_arrive_before_closing

    - rule_id: BR-CLO-012
      name: Closing Cost Calculation
      name_vi: Tính toán chi phí đóng giao dịch
      description: |
        All closing costs must be calculated and disclosed
        before closing.
      buyer_costs:
        registration_fee: 0.5%_of_property_value
        notary_fee: per_notary_schedule
        title_search: actual_cost
        title_insurance: if_applicable
        loan_fees: per_lender_disclosure
        appraisal: if_applicable
        inspection: if_applicable
        other: as_agreed
      seller_costs:
        personal_income_tax: 2%_of_transfer_value
        mortgage_payoff: actual_balance
        agent_commission: per_agreement
        title_clearance: if_needed
        repairs: per_agreement
        prorated_items: as_calculated
      settlement_statement: required_before_closing

  # Title Transfer
  title_transfer:
    - rule_id: BR-CLO-020
      name: Title Transfer Process
      name_vi: Quy trình chuyển nhượng quyền sở hữu
      description: |
        Title transfer follows Vietnamese legal requirements
        for real estate ownership transfer.
      process_steps:
        step_1_notarization:
          description: Contract notarized by licensed notary
          documents:
            - purchase_contract
            - property_certificate_original
            - party_identification
          output: notarized_contract
        step_2_tax_payment:
          description: Pay transfer taxes
          taxes:
            - personal_income_tax
            - registration_fee
          output: tax_receipts
        step_3_land_registration:
          description: Register transfer at Land Registration Office
          documents:
            - notarized_contract
            - tax_receipts
            - application_form
            - property_certificate
          output: updated_certificate_or_receipt
        step_4_certificate_issuance:
          description: New certificate issued to buyer
          timing: 15-30_working_days
          output: new_property_certificate

    - rule_id: BR-CLO-021
      name: Land Registration Deadline
      name_vi: Thời hạn đăng ký đất đai
      description: |
        Land registration must be completed within 30 days
        of contract notarization.
      legal_reference: Land Law 2013 Article 95
      deadline: 30_calendar_days
      penalty:
        late_fee: per_regulation
        interest: on_outstanding_fees
      enforcement: required
      severity: high

    - rule_id: BR-CLO-022
      name: Mortgage Recording
      name_vi: Đăng ký thế chấp
      description: |
        If buyer financing, mortgage must be recorded
        against property title.
      requirements:
        - mortgage_agreement_notarized
        - registered_at_land_office
        - noted_on_property_certificate
      timing: concurrent_with_transfer
      priority: recorded_order

  # Possession Transfer
  possession:
    - rule_id: BR-CLO-030
      name: Possession Date
      name_vi: Ngày bàn giao
      description: |
        Possession transfers on date specified in contract,
        typically at or shortly after closing.
      options:
        - at_closing: immediate_possession
        - after_closing: specified_date
        - rent_back: seller_remains_as_tenant
      default: at_closing
      documentation: possession_acknowledgment

    - rule_id: BR-CLO-031
      name: Property Condition at Possession
      name_vi: Tình trạng tài sản khi bàn giao
      description: |
        Property must be delivered in agreed condition,
        typically broom-clean and vacant.
      standard_condition:
        - broom_clean
        - all_personal_property_removed
        - all_debris_removed
        - all_keys_provided
        - agreed_fixtures_in_place
        - utilities_functional
      inspection_at_possession:
        - joint_walkthrough
        - condition_documented
        - meter_readings_recorded
        - keys_and_access_transferred

    - rule_id: BR-CLO-032
      name: Key Transfer
      name_vi: Bàn giao chìa khóa
      description: |
        All keys and access devices transferred to buyer
        at possession.
      items_to_transfer:
        - all_door_keys
        - gate_keys
        - garage_remotes
        - security_codes
        - mailbox_keys
        - storage_keys
        - smart_home_credentials
      documentation: key_transfer_receipt
      timing: at_possession

    - rule_id: BR-CLO-033
      name: Seller Holdover
      name_vi: Người bán ở lại quá hạn
      description: |
        If seller fails to vacate, buyer has remedies
        including per diem charges.
      holdover_terms:
        per_diem_charge: per_contract
        default_rate: 0.1%_of_purchase_price_per_day
        maximum_holdover: 5_days_before_legal_action
      buyer_remedies:
        - per_diem_charges
        - holdback_from_proceeds
        - legal_eviction
        - damages

  # Fund Disbursement
  disbursement:
    - rule_id: BR-CLO-040
      name: Disbursement Order
      name_vi: Thứ tự giải ngân
      description: |
        Closing funds disbursed in specific order to
        ensure all obligations met.
      disbursement_priority:
        1: existing_mortgage_payoff
        2: property_taxes_owed
        3: transfer_taxes
        4: notary_and_registration_fees
        5: agent_commissions
        6: other_closing_costs
        7: seller_net_proceeds
      timing: same_day_or_next_business_day

    - rule_id: BR-CLO-041
      name: Escrow Disbursement Authorization
      name_vi: Ủy quyền giải ngân ký quỹ
      description: |
        Escrow holder requires proper authorization before
        disbursing any funds.
      authorization_requirements:
        - all_documents_signed
        - funds_received_and_cleared
        - title_clear_to_record
        - all_conditions_satisfied
        - closing_agent_authorization
      disbursement_instruction: signed_by_all_parties

    - rule_id: BR-CLO-042
      name: Mortgage Payoff
      name_vi: Thanh toán nợ thế chấp
      description: |
        Existing mortgages must be paid off and released
        at or before closing.
      requirements:
        - payoff_statement_current
        - wire_to_lender
        - release_document_obtained
        - release_recorded
      timing: concurrent_with_closing
      verification: lender_confirmation

  # Closing Documentation
  documentation:
    - rule_id: BR-CLO-050
      name: Closing Statement
      name_vi: Bảng kê thanh toán
      description: |
        Detailed closing statement showing all debits
        and credits for each party.
      required_elements:
        - purchase_price
        - deposit_credit
        - prorations
        - closing_costs_itemized
        - net_due_from_buyer
        - net_due_to_seller
      distribution: all_parties_receive_copy
      timing: before_closing

    - rule_id: BR-CLO-051
      name: Prorations
      name_vi: Phân bổ chi phí
      description: |
        Certain costs prorated between buyer and seller
        based on closing date.
      prorated_items:
        property_taxes:
          proration_method: daily_proration
          seller_pays: through_closing_date
          buyer_pays: from_day_after_closing
        hoa_fees:
          proration_method: monthly_proration
          adjustment: at_closing
        utilities:
          handling: meter_reading_at_closing
          or: estimated_proration
        rent:
          if_tenant: prorate_rental_income
      calculation_basis: calendar_day_basis

    - rule_id: BR-CLO-052
      name: Document Retention
      name_vi: Lưu giữ tài liệu
      description: |
        Closing documents must be retained for specified
        periods per legal requirements.
      retention_periods:
        notarized_contract: permanent
        closing_statement: 10_years
        tax_documents: 10_years
        loan_documents: loan_term_plus_5_years
        correspondence: 5_years
      storage: secure_digital_and_physical

  # Post-Closing
  post_closing:
    - rule_id: BR-CLO-060
      name: Post-Closing Obligations
      name_vi: Nghĩa vụ sau đóng giao dịch
      description: |
        Certain obligations must be completed after closing.
      seller_obligations:
        - forward_mail
        - provide_warranties_and_manuals
        - cancel_insurance
        - final_utility_readings
      buyer_obligations:
        - change_locks
        - update_address
        - establish_utilities
        - obtain_insurance
        - complete_land_registration
      agent_obligations:
        - file_transaction_records
        - process_commission_payments
        - send_closing_package

    - rule_id: BR-CLO-061
      name: Certificate Issuance Follow-up
      name_vi: Theo dõi cấp giấy chứng nhận
      description: |
        Track new property certificate issuance and
        notify buyer upon receipt.
      expected_timing: 15-30_working_days
      follow_up_schedule:
        - at_15_days: check_status
        - at_30_days: escalate_if_not_issued
        - at_45_days: formal_inquiry
      delivery: to_buyer_or_agent
      notification: email_and_sms

    - rule_id: BR-CLO-062
      name: Closing File Compilation
      name_vi: Tổng hợp hồ sơ đóng giao dịch
      description: |
        Complete closing file compiled and distributed
        to appropriate parties.
      file_contents:
        - notarized_contract
        - closing_statement
        - all_receipts
        - tax_payment_proofs
        - registration_receipt
        - key_transfer_receipt
        - condition_acknowledgment
        - correspondence
      distribution:
        - buyer_copy
        - seller_copy
        - agent_copies
        - office_file

  # Problem Resolution
  problem_resolution:
    - rule_id: BR-CLO-070
      name: Closing Delay Handling
      name_vi: Xử lý chậm trễ đóng giao dịch
      description: |
        Procedures for handling closing delays.
      common_causes:
        - financing_delay
        - title_issues
        - document_issues
        - fund_transfer_problems
        - seller_not_ready
        - buyer_not_ready
      resolution_steps:
        - identify_cause
        - assess_resolution_time
        - negotiate_extension
        - document_agreement
        - adjust_costs_if_applicable

    - rule_id: BR-CLO-071
      name: Failed Closing Procedures
      name_vi: Thủ tục khi đóng giao dịch thất bại
      description: |
        Procedures when closing cannot be completed.
      failure_scenarios:
        buyer_cannot_close:
          - attempt_cure
          - extension_if_agreed
          - termination_if_default
          - deposit_disposition
        seller_cannot_close:
          - attempt_cure
          - extension_if_agreed
          - buyer_remedies
        mutual_inability:
          - mutual_termination
          - deposit_return
          - cost_allocation
      documentation: written_acknowledgment

  # Validation Functions
  validation_functions:
    check_closing_readiness:
      input: [transaction_id]
      output: [is_ready, missing_items]
      checks:
        - prerequisites_complete
        - funds_verified
        - documents_ready
        - title_clear

    calculate_closing_costs:
      input: [purchase_price, is_financed, loan_amount]
      output: [buyer_costs, seller_costs, total]
      components:
        - transfer_taxes
        - registration_fees
        - notary_fees
        - loan_costs

    calculate_prorations:
      input: [closing_date, annual_tax, hoa_monthly]
      output: [seller_credit, buyer_credit]
      method: daily_proration

    verify_funds_received:
      input: [expected_amount, received_amount, source]
      output: [is_verified, discrepancy]

  # Audit Trail
  audit:
    - All closing documents timestamped
    - Fund movements tracked
    - Authorization approvals logged
    - Disbursement confirmations recorded
    - Post-closing tasks tracked to completion
