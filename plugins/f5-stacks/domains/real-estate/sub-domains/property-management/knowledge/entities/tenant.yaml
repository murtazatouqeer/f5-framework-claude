# Tenant Entity
# F5 Framework v2.0 - Real Estate/Property Management
# Người thuê / テナント

entity:
  name: Tenant
  name_vi: Người thuê
  name_ja: テナント
  domain: real-estate
  subdomain: property-management
  version: "1.0.0"

  description: |
    Represents a tenant (individual or company) who rents property.
    Tracks personal information, screening status, rental history,
    and portal access for self-service operations.

  # Primary Key
  identifier:
    field: id
    type: uuid
    generated: true

  # Business Keys
  business_keys:
    tenant_id:
      pattern: "TNT-{YYYYMMDD}-{XXXX}"
      example: "TNT-20240115-0001"
      unique: true

  # Attributes
  attributes:
    # Status
    status:
      type: enum
      values:
        - applicant
        - approved
        - active
        - past
        - evicted
        - blacklisted
      default: applicant
      name_vi:
        applicant: Đang đăng ký
        approved: Đã duyệt
        active: Đang thuê
        past: Đã kết thúc
        evicted: Bị thu hồi
        blacklisted: Danh sách đen

    # Tenant Type
    tenant_type:
      type: enum
      values:
        - individual
        - company
      required: true
      name_vi:
        individual: Cá nhân
        company: Công ty

    # Personal Information (Individual)
    personal:
      type: object
      applicable_when: "tenant_type == 'individual'"
      properties:
        first_name:
          type: string
          max_length: 100
        last_name:
          type: string
          max_length: 100
        full_name:
          type: string
          required: true
        national_id:
          type: string
          description: "CMND/CCCD"
          name_vi: "CMND/CCCD"
        passport_number:
          type: string
        date_of_birth:
          type: date
        gender:
          type: enum
          values: [male, female, other]
          name_vi:
            male: Nam
            female: Nữ
            other: Khác
        nationality:
          type: string
          default: "Vietnamese"

    # Company Information
    company:
      type: object
      applicable_when: "tenant_type == 'company'"
      properties:
        company_name:
          type: string
          required: true
        business_registration:
          type: string
          description: "Giấy đăng ký kinh doanh"
        tax_id:
          type: string
        representative_name:
          type: string
        representative_title:
          type: string

    # Contact Information
    contact:
      type: object
      properties:
        phone:
          type: string
          required: true
        phone_secondary:
          type: string
        email:
          type: string
          format: email
          required: true
        current_address:
          type: string
        mailing_address:
          type: string
        preferred_contact_method:
          type: enum
          values: [phone, email, sms, zalo]
          default: phone

    # Emergency Contact
    emergency_contact:
      type: object
      properties:
        name:
          type: string
          required: true
        relationship:
          type: string
          required: true
        phone:
          type: string
          required: true
        email:
          type: string

    # Employment Information
    employment:
      type: object
      applicable_when: "tenant_type == 'individual'"
      properties:
        employment_status:
          type: enum
          values: [employed, self_employed, retired, student, unemployed]
        employer_name:
          type: string
        job_title:
          type: string
        employer_phone:
          type: string
        employer_address:
          type: string
        monthly_income:
          type: money
        income_verified:
          type: boolean
          default: false
        employment_verification_url:
          type: string
          format: url
        employment_start_date:
          type: date

    # Screening Information
    screening:
      type: object
      properties:
        credit_score:
          type: integer
          min: 300
          max: 850
        credit_check_date:
          type: date
        background_check_status:
          type: enum
          values: [not_started, pending, passed, failed, waived]
          default: not_started
          name_vi:
            not_started: Chưa bắt đầu
            pending: Đang xử lý
            passed: Đạt
            failed: Không đạt
            waived: Miễn
        background_check_date:
          type: date
        criminal_record:
          type: boolean
        eviction_history:
          type: boolean
        previous_landlord_reference:
          type: object
          properties:
            landlord_name:
              type: string
            landlord_phone:
              type: string
            previous_address:
              type: string
            tenancy_duration:
              type: string
            reference_notes:
              type: text
        screening_notes:
          type: text
        screening_score:
          type: integer
          description: "Internal screening score"

    # Rental History Summary
    history:
      type: object
      properties:
        total_leases:
          type: integer
          default: 0
        total_months_rented:
          type: integer
          default: 0
        on_time_payment_rate:
          type: decimal
          precision: 2
          description: "Percentage of on-time payments"
        late_payments_count:
          type: integer
          default: 0
        past_issues:
          type: array
          items:
            type: object
            properties:
              date:
                type: date
              issue_type:
                type: string
              description:
                type: text
              resolved:
                type: boolean

    # Tenant Portal
    portal:
      type: object
      properties:
        portal_access:
          type: boolean
          default: false
        portal_username:
          type: string
        portal_email:
          type: string
        last_login:
          type: timestamp
        auto_pay_enabled:
          type: boolean
          default: false
        payment_method_on_file:
          type: boolean
          default: false

    # Documents
    documents:
      type: object
      properties:
        id_document_url:
          type: string
        income_proof_url:
          type: string
        employment_letter_url:
          type: string
        reference_letters:
          type: array
          items:
            type: string
            format: url

    # Preferences
    preferences:
      type: object
      properties:
        communication_language:
          type: string
          default: "vi"
        receive_email_notifications:
          type: boolean
          default: true
        receive_sms_notifications:
          type: boolean
          default: true

    # Metadata
    notes:
      type: text
    created_at:
      type: timestamp
      auto: create
    updated_at:
      type: timestamp
      auto: update
    created_by:
      type: uuid

  # Relationships
  relationships:
    leases:
      type: has_many
      entity: Lease
      foreign_key: primary_tenant_id
    all_leases:
      type: has_many_through
      entity: Lease
      through: LeaseTenant
    current_lease:
      type: has_one
      entity: Lease
      condition: "status = 'active'"
    current_unit:
      type: has_one_through
      entity: Unit
      through: Lease
    payments:
      type: has_many
      entity: RentPayment
      foreign_key: tenant_id
    maintenance_requests:
      type: has_many
      entity: MaintenanceRequest
      foreign_key: tenant_id
    deposits:
      type: has_many
      entity: SecurityDeposit
      through: Lease

  # State Machine
  state_machine:
    field: status
    states:
      - applicant
      - approved
      - active
      - past
      - evicted
      - blacklisted
    transitions:
      - from: applicant
        to: approved
        event: approve_application
        guard: screening_passed
        action: notify_approval
      - from: applicant
        to: blacklisted
        event: reject_application
        action: record_rejection_reason
      - from: approved
        to: active
        event: activate
        guard: lease_signed
      - from: approved
        to: applicant
        event: revert_to_applicant
      - from: active
        to: past
        event: end_tenancy
        action: process_move_out
      - from: active
        to: evicted
        event: evict
        action: record_eviction
      - from: [past, evicted]
        to: blacklisted
        event: blacklist
        action: record_blacklist_reason
      - from: [past, blacklisted]
        to: applicant
        event: reapply
        guard: allowed_to_reapply

  # Indexes
  indexes:
    - fields: [tenant_id]
      unique: true
    - fields: [status]
    - fields: [email]
    - fields: [phone]
    - fields: [national_id]
    - fields: [tenant_type, status]

  # Validation Rules
  validations:
    - rule: "email must be valid format"
      condition: "email.match?(/\\A[\\w+\\-.]+@[a-z\\d\\-.]+\\.[a-z]+\\z/i)"
    - rule: "phone must be provided"
      condition: "phone.present?"
    - rule: "national_id or passport required for individuals"
      condition: "tenant_type != 'individual' || national_id.present? || passport_number.present?"
    - rule: "company_name required for companies"
      condition: "tenant_type != 'company' || company_name.present?"

  # Events
  events:
    - tenant_created
    - tenant_application_submitted
    - screening_completed
    - tenant_approved
    - tenant_rejected
    - tenant_activated
    - tenant_deactivated
    - tenant_evicted
    - tenant_blacklisted
    - portal_access_granted

  # Audit
  audit:
    enabled: true
    tracked_fields:
      - status
      - screening
      - contact
      - portal
