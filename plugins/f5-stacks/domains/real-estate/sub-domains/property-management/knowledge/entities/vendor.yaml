# Vendor Entity
# F5 Framework v2.0 - Real Estate/Property Management
# Nhà cung cấp / ベンダー

entity:
  name: Vendor
  name_vi: Nhà cung cấp
  name_ja: ベンダー
  domain: real-estate
  subdomain: property-management
  version: "1.0.0"

  description: |
    Represents a vendor or contractor who provides maintenance,
    repair, or other services to managed properties. Tracks
    qualifications, performance, and contract terms.

  # Primary Key
  identifier:
    field: id
    type: uuid
    generated: true

  # Business Keys
  business_keys:
    vendor_id:
      pattern: "VND-{XXXX}"
      example: "VND-0001"
      unique: true

  # Attributes
  attributes:
    # Status
    status:
      type: enum
      values:
        - active
        - inactive
        - suspended
        - preferred
        - probation
        - terminated
      default: active
      name_vi:
        active: Đang hoạt động
        inactive: Ngừng hoạt động
        suspended: Tạm ngưng
        preferred: Ưu tiên
        probation: Thử việc
        terminated: Chấm dứt

    # Business Information
    business:
      type: object
      properties:
        company_name:
          type: string
          required: true
        trading_name:
          type: string
        business_registration:
          type: string
          description: "Giấy đăng ký kinh doanh"
        tax_id:
          type: string
        year_established:
          type: integer
        business_type:
          type: enum
          values: [individual, company, partnership]
        number_of_employees:
          type: integer

    # Services
    services:
      type: object
      properties:
        service_categories:
          type: array
          items:
            type: enum
            values:
              - plumbing
              - electrical
              - hvac
              - appliance_repair
              - general_maintenance
              - painting
              - flooring
              - roofing
              - landscaping
              - pest_control
              - cleaning
              - locksmith
              - security
              - elevator
              - fire_safety
              - other
          required: true
        service_descriptions:
          type: array
          items:
            type: string
        specializations:
          type: array
          items:
            type: string
        brands_serviced:
          type: array
          items:
            type: string
          description: "Brands they're authorized to service"

    # Contact Information
    contact:
      type: object
      properties:
        primary_contact_name:
          type: string
          required: true
        primary_phone:
          type: string
          required: true
        secondary_phone:
          type: string
        emergency_phone:
          type: string
        email:
          type: string
          format: email
        website:
          type: string
          format: url
        address:
          type: string
        city:
          type: string
        district:
          type: string

    # Service Area
    service_area:
      type: object
      properties:
        coverage_areas:
          type: array
          items:
            type: string
          description: "Districts/areas served"
        travel_fee:
          type: money
        max_travel_distance_km:
          type: integer

    # Rates
    rates:
      type: object
      properties:
        hourly_rate:
          type: money
        overtime_rate:
          type: money
        weekend_rate:
          type: money
        emergency_rate:
          type: money
        call_out_fee:
          type: money
        minimum_charge:
          type: money
        rate_effective_date:
          type: date

    # Payment Terms
    payment:
      type: object
      properties:
        payment_terms_days:
          type: integer
          default: 30
        preferred_payment_method:
          type: enum
          values: [bank_transfer, check, cash]
        bank_name:
          type: string
        bank_account_number:
          type: string
        bank_account_name:
          type: string

    # Contract
    contract:
      type: object
      properties:
        contract_start_date:
          type: date
        contract_end_date:
          type: date
        contract_url:
          type: string
          format: url
        contract_terms:
          type: text
        auto_renew:
          type: boolean
          default: false

    # Insurance
    insurance:
      type: object
      properties:
        has_liability_insurance:
          type: boolean
          required: true
        liability_policy_number:
          type: string
        liability_coverage_amount:
          type: money
        liability_expiry:
          type: date
        has_workers_comp:
          type: boolean
        workers_comp_policy:
          type: string
        workers_comp_expiry:
          type: date
        insurance_certificate_url:
          type: string

    # Certifications
    certifications:
      type: object
      properties:
        licenses:
          type: array
          items:
            type: object
            properties:
              license_type:
                type: string
              license_number:
                type: string
              issuing_authority:
                type: string
              expiry_date:
                type: date
        certifications:
          type: array
          items:
            type: object
            properties:
              certification_name:
                type: string
              issuing_body:
                type: string
              expiry_date:
                type: date
        background_checked:
          type: boolean
          default: false
        background_check_date:
          type: date

    # Performance Metrics
    performance:
      type: object
      computed: true
      properties:
        total_work_orders:
          type: integer
        completed_work_orders:
          type: integer
        average_completion_time_hours:
          type: decimal
        on_time_rate:
          type: decimal
          description: "Percentage of jobs completed on time"
        average_rating:
          type: decimal
          min: 1
          max: 5
        total_ratings:
          type: integer
        callback_rate:
          type: decimal
          description: "Percentage requiring follow-up visits"
        total_billed:
          type: money

    # Availability
    availability:
      type: object
      properties:
        regular_hours:
          type: string
          example: "Mon-Fri 8:00-18:00"
        available_weekends:
          type: boolean
          default: false
        available_holidays:
          type: boolean
          default: false
        emergency_available:
          type: boolean
          default: false
        response_time_hours:
          type: integer
          description: "Typical response time"

    # Notes
    notes:
      type: text
    internal_notes:
      type: text
      description: "Internal comments about vendor"

    # Metadata
    created_at:
      type: timestamp
      auto: create
    updated_at:
      type: timestamp
      auto: update
    created_by:
      type: uuid

  # Relationships
  relationships:
    work_orders:
      type: has_many
      entity: WorkOrder
      foreign_key: vendor_id
    maintenance_requests:
      type: has_many
      entity: MaintenanceRequest
      foreign_key: vendor_id
    properties_serviced:
      type: has_many_through
      entity: ManagedProperty
      through: WorkOrder

  # State Machine
  state_machine:
    field: status
    states:
      - active
      - inactive
      - suspended
      - preferred
      - probation
      - terminated
    transitions:
      - from: active
        to: preferred
        event: promote
        guard: performance_excellent
      - from: active
        to: suspended
        event: suspend
        action: notify_vendor
      - from: active
        to: probation
        event: put_on_probation
        action: document_reason
      - from: suspended
        to: active
        event: reinstate
      - from: probation
        to: active
        event: confirm
      - from: probation
        to: terminated
        event: terminate
        action: close_relationship
      - from: preferred
        to: active
        event: demote
      - from: [active, suspended, probation]
        to: terminated
        event: terminate
        action: close_relationship
      - from: [active, preferred]
        to: inactive
        event: deactivate
      - from: inactive
        to: active
        event: reactivate

  # Indexes
  indexes:
    - fields: [vendor_id]
      unique: true
    - fields: [status]
    - fields: [service_categories]
    - fields: [city, district]
    - fields: [average_rating]

  # Validation Rules
  validations:
    - rule: "liability_insurance required for active vendors"
      condition: "status != 'active' || has_liability_insurance"
    - rule: "insurance must not be expired for active vendors"
      condition: "status != 'active' || liability_expiry > Date.today"
    - rule: "at least one service category required"
      condition: "service_categories.any?"

  # Events
  events:
    - vendor_created
    - vendor_activated
    - vendor_promoted_to_preferred
    - vendor_suspended
    - vendor_reinstated
    - vendor_terminated
    - insurance_updated
    - contract_renewed
    - performance_reviewed

  # Audit
  audit:
    enabled: true
    tracked_fields:
      - status
      - rates
      - insurance
      - contract
      - performance
