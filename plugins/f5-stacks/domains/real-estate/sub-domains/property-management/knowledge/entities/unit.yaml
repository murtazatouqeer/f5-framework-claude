# Unit Entity
# F5 Framework v2.0 - Real Estate/Property Management
# Căn hộ / ユニット

entity:
  name: Unit
  name_vi: Căn hộ
  name_ja: ユニット
  domain: real-estate
  subdomain: property-management
  version: "1.0.0"

  description: |
    Represents an individual rentable unit within a managed property.
    Can be an apartment, office space, retail unit, or any leasable space.

  # Primary Key
  identifier:
    field: id
    type: uuid
    generated: true

  # Business Keys
  business_keys:
    unit_id:
      pattern: "UNT-{PROPERTY_CODE}-{UNIT}"
      example: "UNT-SUNRISE-A101"
      unique: true
    unit_number:
      type: string
      max_length: 20
      examples: ["101", "A-201", "PH-01", "RETAIL-1"]

  # Attributes
  attributes:
    # References
    property_id:
      type: uuid
      required: true

    # Status
    status:
      type: enum
      values:
        - vacant
        - occupied
        - reserved
        - maintenance
        - not_available
      default: vacant
      name_vi:
        vacant: Trống
        occupied: Đã cho thuê
        reserved: Đã đặt
        maintenance: Đang bảo trì
        not_available: Không sẵn sàng

    # Specifications
    specifications:
      type: object
      properties:
        unit_type:
          type: enum
          values:
            - studio
            - 1br
            - 2br
            - 3br
            - 4br_plus
            - penthouse
            - duplex
            - office
            - retail
            - warehouse
          required: true
          name_vi:
            studio: Studio
            1br: 1 phòng ngủ
            2br: 2 phòng ngủ
            3br: 3 phòng ngủ
            4br_plus: 4+ phòng ngủ
            penthouse: Căn hộ penthouse
            duplex: Căn hộ duplex
            office: Văn phòng
            retail: Bán lẻ
            warehouse: Kho
        floor_number:
          type: integer
        area_sqm:
          type: decimal
          precision: 2
          required: true
        bedrooms:
          type: integer
          min: 0
        bathrooms:
          type: decimal
          precision: 1
        balcony:
          type: boolean
          default: false
        direction:
          type: enum
          values: [north, south, east, west, northeast, northwest, southeast, southwest]
          name_vi:
            north: Bắc
            south: Nam
            east: Đông
            west: Tây

    # Features
    features:
      type: object
      properties:
        amenities:
          type: array
          items:
            type: string
          examples:
            - air_conditioning
            - water_heater
            - washer
            - dryer
            - dishwasher
            - refrigerator
            - stove
            - microwave
            - balcony
            - city_view
            - parking_included
        furnished:
          type: enum
          values:
            - unfurnished
            - partially_furnished
            - fully_furnished
          default: unfurnished
          name_vi:
            unfurnished: Không nội thất
            partially_furnished: Nội thất cơ bản
            fully_furnished: Đầy đủ nội thất
        air_conditioning:
          type: boolean
          default: true
        water_heater:
          type: boolean
          default: true
        washer_dryer:
          type: enum
          values: [none, hookup, washer_only, washer_dryer, in_unit]
        parking_space:
          type: string
          description: "Assigned parking space number"
        storage_unit:
          type: string
          description: "Assigned storage unit number"

    # Rental Terms
    rental:
      type: object
      properties:
        base_rent:
          type: money
          required: true
        rent_currency:
          type: string
          default: "VND"
        rent_includes:
          type: array
          items:
            type: enum
            values: [management_fee, internet, cable, water, electricity, parking, none]
        security_deposit_months:
          type: decimal
          default: 2
          description: "Number of months rent for deposit"
        min_lease_months:
          type: integer
          default: 12
        max_lease_months:
          type: integer
        pets_allowed:
          type: boolean
          default: false
        pet_deposit:
          type: money
        pet_rent:
          type: money
          description: "Additional monthly pet rent"
        smoking_allowed:
          type: boolean
          default: false

    # Current Occupancy
    current_occupancy:
      type: object
      properties:
        current_tenant_id:
          type: uuid
        current_lease_id:
          type: uuid
        lease_start_date:
          type: date
        lease_end_date:
          type: date
        current_rent:
          type: money
        available_from:
          type: date

    # Condition
    condition:
      type: object
      properties:
        last_inspection_date:
          type: date
        condition_rating:
          type: enum
          values: [excellent, good, fair, poor]
          name_vi:
            excellent: Xuất sắc
            good: Tốt
            fair: Trung bình
            poor: Kém
        needs_repairs:
          type: array
          items:
            type: string
        last_renovation_date:
          type: date
        renovation_notes:
          type: text

    # Marketing
    marketing:
      type: object
      properties:
        listing_active:
          type: boolean
          default: false
        listing_title:
          type: string
        listing_description:
          type: text
        photos:
          type: array
          items:
            type: string
            format: url
        virtual_tour_url:
          type: string
          format: url
        featured:
          type: boolean
          default: false

    # Metadata
    notes:
      type: text
    created_at:
      type: timestamp
      auto: create
    updated_at:
      type: timestamp
      auto: update

  # Relationships
  relationships:
    property:
      type: belongs_to
      entity: ManagedProperty
      foreign_key: property_id
      required: true
    current_tenant:
      type: belongs_to
      entity: Tenant
      foreign_key: current_tenant_id
    current_lease:
      type: belongs_to
      entity: Lease
      foreign_key: current_lease_id
    leases:
      type: has_many
      entity: Lease
      foreign_key: unit_id
    maintenance_requests:
      type: has_many
      entity: MaintenanceRequest
      foreign_key: unit_id
    inspections:
      type: has_many
      entity: Inspection
      foreign_key: unit_id
    rent_charges:
      type: has_many
      entity: RentCharge
      foreign_key: unit_id

  # State Machine
  state_machine:
    field: status
    states:
      - vacant
      - reserved
      - occupied
      - maintenance
      - not_available
    transitions:
      - from: vacant
        to: reserved
        event: reserve
        guard: has_approved_application
      - from: vacant
        to: occupied
        event: move_in
        guard: lease_signed
      - from: reserved
        to: vacant
        event: cancel_reservation
      - from: reserved
        to: occupied
        event: move_in
        guard: lease_signed
      - from: occupied
        to: vacant
        event: move_out
        action: clear_current_tenant
      - from: occupied
        to: maintenance
        event: start_maintenance
      - from: vacant
        to: maintenance
        event: start_maintenance
      - from: maintenance
        to: vacant
        event: complete_maintenance
      - from: [vacant, maintenance]
        to: not_available
        event: take_offline
      - from: not_available
        to: vacant
        event: make_available

  # Indexes
  indexes:
    - fields: [unit_id]
      unique: true
    - fields: [property_id, unit_number]
      unique: true
    - fields: [property_id, status]
    - fields: [status]
    - fields: [current_tenant_id]
    - fields: [current_lease_id]
    - fields: [available_from]

  # Validation Rules
  validations:
    - rule: "base_rent must be positive"
      condition: "base_rent > 0"
    - rule: "area_sqm must be positive"
      condition: "area_sqm > 0"
    - rule: "security_deposit_months must be reasonable"
      condition: "security_deposit_months >= 0 && security_deposit_months <= 6"

  # Events
  events:
    - unit_created
    - unit_status_changed
    - unit_reserved
    - unit_occupied
    - unit_vacated
    - rent_updated
    - inspection_completed
    - maintenance_completed

  # Audit
  audit:
    enabled: true
    tracked_fields:
      - status
      - base_rent
      - current_tenant_id
      - current_lease_id
      - condition_rating
