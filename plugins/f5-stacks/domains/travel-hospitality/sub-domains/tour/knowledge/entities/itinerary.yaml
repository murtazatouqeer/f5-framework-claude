name: Itinerary
display_name: Itinerary / Lịch trình tour
description: |
  Detailed day-by-day or stop-by-stop plan for a tour.
  Includes timing, locations, activities, and logistics.

domain: travel-hospitality
subdomain: tour
category: supporting

attributes:
  - name: id
    type: uuid
    required: true

  - name: tour_id
    type: uuid
    required: true

  - name: version
    type: string
    required: true
    default: "1.0"

  - name: status
    type: enum
    required: true
    validation:
      values: [draft, published, archived]
    default: draft

  - name: itinerary_type
    type: enum
    required: true
    validation:
      values: [single_day, multi_day]

  - name: total_duration_hours
    type: decimal
    required: true

  - name: total_distance_km
    type: decimal
    required: false

  # For multi-day tours
  - name: total_days
    type: integer
    required: false

  - name: total_nights
    type: integer
    required: false

  # Stops/Days
  - name: items
    type: array
    required: true
    items:
      type: object
      properties:
        sequence: integer
        type: enum[stop, day, meal, transfer, free_time, accommodation]
        title: string
        description: text
        start_time: time
        end_time: time
        duration_minutes: integer
        day_number: integer
        location:
          name: string
          address: string
          latitude: decimal
          longitude: decimal
        activities: array
        inclusions: array
        photo_url: string
        tips: text
        optional: boolean
        additional_cost: decimal

  # Overview
  - name: overview
    type: text
    required: true
    description: Summary of the itinerary

  - name: route_map_url
    type: string
    required: false

  - name: elevation_profile_url
    type: string
    required: false
    description: For hiking/cycling tours

  # Logistics
  - name: transportation_modes
    type: array
    required: false
    validation:
      values: [walking, bus, van, car, boat, bicycle, motorcycle, train, flight]

  - name: meal_plan
    type: object
    required: false
    properties:
      breakfast_included: boolean
      lunch_included: boolean
      dinner_included: boolean
      snacks_included: boolean
      dietary_options: array

  - name: accommodation_info
    type: array
    required: false
    description: For multi-day tours
    items:
      type: object
      properties:
        night_number: integer
        hotel_name: string
        hotel_category: enum[budget, standard, comfort, premium, luxury]
        location: string
        amenities: array

  # Difficulty
  - name: physical_rating
    type: integer
    required: false
    validation:
      min: 1
      max: 5
    description: 1 = Easy, 5 = Strenuous

  - name: walking_distance_km
    type: decimal
    required: false

  - name: elevation_gain_m
    type: integer
    required: false

  # Notes
  - name: what_to_wear
    type: array
    required: false

  - name: what_to_bring
    type: array
    required: false

  - name: accessibility_notes
    type: text
    required: false

  - name: weather_considerations
    type: text
    required: false

  # Timestamps
  - name: published_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: tour
    type: belongs_to
    entity: Tour
    required: true

indexes:
  - [tour_id]
  - [status]

business_rules:
  - BR-ITI-001: Must have at least 2 stops/items
  - BR-ITI-002: Total duration must match tour duration
  - BR-ITI-003: Multi-day tours require accommodation info
  - BR-ITI-004: Each stop must have location coordinates
  - BR-ITI-005: Cannot publish without at least one photo

events:
  - name: itinerary.created
    payload: [id, tour_id]
  - name: itinerary.published
    payload: [id, tour_id]
  - name: itinerary.updated
    payload: [id, version]
