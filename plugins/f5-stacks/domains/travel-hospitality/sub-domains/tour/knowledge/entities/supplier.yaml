name: Supplier
display_name: Supplier / Nhà cung cấp tour
description: |
  Tour operator or activity provider who creates and manages
  tours, activities, and experiences on the platform.
  Can be local operators, DMCs, or individual hosts.

domain: travel-hospitality
subdomain: tour
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: supplier_code
    type: string
    required: true
    validation:
      pattern: "^SUP-[A-Z]{2}-[0-9]{6}$"
    example: "SUP-VN-001234"

  - name: status
    type: enum
    required: true
    validation:
      values: [pending, active, suspended, terminated]
    default: pending

  - name: supplier_type
    type: enum
    required: true
    validation:
      values: [tour_operator, dmc, activity_provider, local_host, reseller]

  - name: tier
    type: enum
    required: true
    validation:
      values: [standard, premium, elite]
    default: standard

  # Company Info
  - name: company_name
    type: string
    required: true

  - name: trading_name
    type: string
    required: false
    description: Brand name if different from legal name

  - name: logo_url
    type: string
    required: true

  - name: cover_image_url
    type: string
    required: false

  - name: description
    type: text
    required: true

  - name: tagline
    type: string
    required: false
    validation:
      max_length: 100

  # Legal
  - name: registration_number
    type: string
    required: true
    description: Business registration number

  - name: tax_id
    type: string
    required: true

  - name: tourism_license_number
    type: string
    required: false

  - name: tourism_license_expiry
    type: date
    required: false

  - name: legal_address
    type: object
    required: true
    properties:
      street: string
      city: string
      state: string
      country: string
      postal_code: string

  # Contact
  - name: primary_contact_name
    type: string
    required: true

  - name: primary_contact_email
    type: string
    required: true

  - name: primary_contact_phone
    type: string
    required: true

  - name: reservations_email
    type: string
    required: true

  - name: reservations_phone
    type: string
    required: true

  - name: emergency_phone
    type: string
    required: true
    description: 24/7 emergency contact

  - name: website
    type: string
    required: false

  - name: social_media
    type: object
    required: false
    properties:
      facebook: string
      instagram: string
      tripadvisor: string

  # Operations
  - name: operating_regions
    type: array
    required: true
    description: Regions where supplier operates

  - name: specializations
    type: array
    required: true
    description: Tour types/categories

  - name: languages_supported
    type: array
    required: true

  - name: years_in_business
    type: integer
    required: false

  # Insurance & Safety
  - name: liability_insurance
    type: object
    required: true
    properties:
      provider: string
      policy_number: string
      coverage_amount: decimal
      currency: string
      expiry_date: date

  - name: safety_certifications
    type: array
    required: false

  - name: safety_record
    type: object
    required: false
    properties:
      last_audit_date: date
      audit_score: decimal
      incidents_last_year: integer

  # Financial
  - name: bank_account
    type: object
    required: true
    properties:
      bank_name: string
      account_number: string
      account_holder: string
      swift_code: string

  - name: commission_rate
    type: decimal
    required: true
    description: Platform commission percentage

  - name: payment_terms
    type: enum
    required: true
    validation:
      values: [immediate, weekly, bi_weekly, monthly]

  - name: currency
    type: string
    required: true
    default: "VND"

  # Performance
  - name: total_tours
    type: integer
    required: true
    default: 0

  - name: total_bookings
    type: integer
    required: true
    default: 0

  - name: total_revenue
    type: decimal
    required: true
    default: 0

  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: true
    default: 0

  - name: response_rate
    type: decimal
    required: false
    description: Percentage of inquiries responded within 24h

  - name: response_time_avg_hours
    type: decimal
    required: false

  - name: cancellation_rate
    type: decimal
    required: false

  # Verification
  - name: verified
    type: boolean
    required: true
    default: false

  - name: verification_date
    type: date
    required: false

  - name: verification_documents
    type: array
    required: false

  # Settings
  - name: instant_confirmation
    type: boolean
    required: true
    default: true

  - name: auto_assign_guides
    type: boolean
    required: true
    default: false

  - name: notification_preferences
    type: object
    required: false
    properties:
      email_new_booking: boolean
      email_cancellation: boolean
      sms_urgent: boolean

  # Timestamps
  - name: approved_at
    type: timestamp
    required: false

  - name: last_active_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: tours
    type: has_many
    entity: Tour

  - name: activities
    type: has_many
    entity: Activity

  - name: guides
    type: has_many
    entity: Guide

  - name: bookings
    type: has_many
    entity: TourBooking

  - name: reviews
    type: has_many
    entity: TourReview

indexes:
  - [supplier_code]
  - [status]
  - [supplier_type]
  - [tier]
  - [operating_regions]
  - [average_rating DESC]
  - [verified]

business_rules:
  - BR-SUP-001: Liability insurance required before activation
  - BR-SUP-002: Tourism license required for tour_operator type
  - BR-SUP-003: Elite tier requires avg_rating >= 4.5 and 100+ bookings
  - BR-SUP-004: Cancellation rate > 5% triggers review
  - BR-SUP-005: Response rate < 80% results in search ranking penalty

events:
  - name: supplier.registered
    payload: [id, supplier_code, company_name]
  - name: supplier.approved
    payload: [id, approved_by]
  - name: supplier.verified
    payload: [id]
  - name: supplier.suspended
    payload: [id, reason]
  - name: supplier.tier_changed
    payload: [id, old_tier, new_tier]
