name: Activity
display_name: Activity / Hoạt động trải nghiệm
description: |
  Individual activity or experience that can be booked separately
  or included as part of a tour. Includes adventure sports,
  water activities, wellness, workshops, etc.

domain: travel-hospitality
subdomain: tour
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: activity_code
    type: string
    required: true
    validation:
      pattern: "^ACT-[A-Z]{2}-[0-9]{6}$"
    example: "ACT-VN-001234"

  - name: title
    type: string
    required: true
    validation:
      max_length: 200

  - name: slug
    type: string
    required: true
    unique: true

  - name: status
    type: enum
    required: true
    validation:
      values: [active, seasonal, suspended, archived]
    default: active

  - name: activity_type
    type: enum
    required: true
    validation:
      values: [adventure, water_sport, air_sport, land_sport, wellness, workshop, entertainment, culinary, cultural, nature]

  # Details
  - name: short_description
    type: string
    required: true
    validation:
      max_length: 500

  - name: full_description
    type: text
    required: true

  - name: highlights
    type: array
    required: true

  - name: difficulty_level
    type: enum
    required: true
    validation:
      values: [easy, moderate, challenging, extreme]

  - name: fitness_required
    type: enum
    required: true
    validation:
      values: [none, basic, moderate, high]

  - name: experience_required
    type: boolean
    required: true
    default: false
    description: Prior experience needed for this activity

  - name: skill_level_required
    type: enum
    required: false
    validation:
      values: [beginner, intermediate, advanced, expert]

  # Duration
  - name: duration_minutes
    type: integer
    required: true

  - name: available_slots_per_day
    type: integer
    required: false
    description: Maximum sessions per day

  # Requirements
  - name: min_age
    type: integer
    required: false
    description: Minimum age requirement

  - name: max_age
    type: integer
    required: false
    description: Maximum age limit

  - name: min_weight_kg
    type: decimal
    required: false

  - name: max_weight_kg
    type: decimal
    required: false

  - name: min_height_cm
    type: integer
    required: false

  - name: max_height_cm
    type: integer
    required: false

  - name: health_restrictions
    type: array
    required: false
    description: Conditions that prevent participation
    example: ["heart conditions", "pregnancy", "back problems"]

  - name: certifications_required
    type: array
    required: false
    description: Required certifications (e.g., diving license)

  # Safety
  - name: safety_briefing_required
    type: boolean
    required: true
    default: true

  - name: safety_briefing_duration_minutes
    type: integer
    required: false

  - name: safety_equipment_provided
    type: array
    required: false
    description: List of safety equipment included

  - name: waiver_required
    type: boolean
    required: true
    default: true

  - name: waiver_template_id
    type: uuid
    required: false

  - name: insurance_included
    type: boolean
    required: true
    default: true

  - name: insurance_coverage
    type: text
    required: false

  - name: emergency_procedures
    type: text
    required: false

  - name: risk_level
    type: enum
    required: true
    validation:
      values: [low, medium, high, extreme]

  # Location
  - name: location_address
    type: string
    required: true

  - name: location_coordinates
    type: object
    required: false
    properties:
      latitude: decimal
      longitude: decimal

  # Pricing
  - name: price_per_person
    type: decimal
    required: true

  - name: currency
    type: string
    required: true
    default: "VND"

  - name: equipment_rental_available
    type: boolean
    required: true
    default: false

  - name: equipment_rental_price
    type: decimal
    required: false

  - name: photo_package_available
    type: boolean
    required: false
    default: false

  - name: photo_package_price
    type: decimal
    required: false

  # Capacity
  - name: min_participants
    type: integer
    required: true
    default: 1

  - name: max_participants
    type: integer
    required: true

  - name: instructor_ratio
    type: string
    required: false
    description: Instructor to participant ratio
    example: "1:6"

  # Media
  - name: cover_image_url
    type: string
    required: true

  - name: gallery
    type: array
    required: true

  - name: video_url
    type: string
    required: false

  # Supplier
  - name: supplier_id
    type: uuid
    required: true

  # Ratings
  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: false
    default: 0

  # Timestamps
  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: supplier
    type: belongs_to
    entity: Supplier
    required: true

  - name: tours
    type: belongs_to_many
    entity: Tour
    through: tour_activities

  - name: bookings
    type: has_many
    entity: TourBooking

  - name: reviews
    type: has_many
    entity: TourReview

indexes:
  - [activity_code]
  - [slug]
  - [status]
  - [activity_type]
  - [difficulty_level]
  - [supplier_id]
  - [risk_level]

business_rules:
  - BR-ACT-001: Extreme activities require signed waiver
  - BR-ACT-002: Age restrictions must be enforced at booking
  - BR-ACT-003: Safety briefing duration >= 15 minutes for high-risk activities
  - BR-ACT-004: Insurance mandatory for risk_level > low
  - BR-ACT-005: max_participants must respect instructor_ratio

events:
  - name: activity.created
    payload: [id, activity_code, activity_type]
  - name: activity.updated
    payload: [id, changed_fields]
  - name: activity.suspended
    payload: [id, reason]
