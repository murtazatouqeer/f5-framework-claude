name: Experience
display_name: Experience / Trải nghiệm địa phương
description: |
  Unique local experiences hosted by locals or experts.
  Includes cooking classes, craft workshops, cultural immersions,
  home visits, and authentic local interactions.

domain: travel-hospitality
subdomain: tour
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: experience_code
    type: string
    required: true
    validation:
      pattern: "^EXP-[A-Z]{2}-[0-9]{6}$"
    example: "EXP-VN-001234"

  - name: title
    type: string
    required: true
    validation:
      max_length: 200

  - name: slug
    type: string
    required: true
    unique: true

  - name: status
    type: enum
    required: true
    validation:
      values: [draft, pending_approval, active, paused, archived]
    default: draft

  - name: experience_type
    type: enum
    required: true
    validation:
      values: [cooking_class, craft_workshop, cultural_immersion, home_visit, farm_visit, art_class, music_lesson, language_exchange, photography_walk, local_market_tour, food_tasting, wine_tasting, coffee_experience]

  # Host Info
  - name: host_id
    type: uuid
    required: true

  - name: host_story
    type: text
    required: true
    description: Personal story of the host

  - name: host_expertise
    type: array
    required: true
    description: Host's areas of expertise

  # Details
  - name: short_description
    type: string
    required: true
    validation:
      max_length: 500

  - name: full_description
    type: text
    required: true

  - name: what_you_will_do
    type: array
    required: true
    description: Step-by-step activities

  - name: what_you_will_learn
    type: array
    required: false

  - name: what_you_will_take_home
    type: array
    required: false
    description: Takeaways for guests

  - name: unique_aspects
    type: array
    required: true
    description: What makes this experience unique

  # Location
  - name: location_type
    type: enum
    required: true
    validation:
      values: [host_home, workshop_space, outdoor, online, multiple_locations]

  - name: location_address
    type: string
    required: true

  - name: location_coordinates
    type: object
    required: false
    properties:
      latitude: decimal
      longitude: decimal

  - name: neighborhood_description
    type: text
    required: false

  # Duration
  - name: duration_hours
    type: decimal
    required: true

  - name: start_times
    type: array
    required: true
    description: Available start times

  # Capacity
  - name: min_guests
    type: integer
    required: true
    default: 1

  - name: max_guests
    type: integer
    required: true
    description: Small group setting

  - name: private_available
    type: boolean
    required: true
    default: true

  # Pricing
  - name: price_per_guest
    type: decimal
    required: true

  - name: currency
    type: string
    required: true
    default: "VND"

  - name: private_experience_price
    type: decimal
    required: false

  # Inclusions
  - name: inclusions
    type: array
    required: true
    description: What's included (food, drinks, materials, etc.)

  - name: food_included
    type: boolean
    required: true
    default: false

  - name: drinks_included
    type: boolean
    required: true
    default: false

  - name: materials_included
    type: boolean
    required: true
    default: true

  # Requirements
  - name: suitable_for
    type: array
    required: false
    description: Suitable audience
    example: ["families", "couples", "solo travelers", "groups"]

  - name: age_restriction
    type: object
    required: false
    properties:
      min_age: integer
      max_age: integer
      children_allowed: boolean

  - name: dietary_options
    type: array
    required: false
    validation:
      values: [vegetarian, vegan, halal, kosher, gluten_free, dairy_free]

  - name: language
    type: string
    required: true
    description: Language the experience is conducted in

  - name: additional_languages
    type: array
    required: false

  # Media
  - name: cover_image_url
    type: string
    required: true

  - name: gallery
    type: array
    required: true
    validation:
      min_items: 5
      max_items: 15

  - name: video_url
    type: string
    required: false

  # Ratings
  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: false
    default: 0

  - name: booking_count
    type: integer
    required: false
    default: 0

  # Timestamps
  - name: approved_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: host
    type: belongs_to
    entity: Guide
    required: true

  - name: bookings
    type: has_many
    entity: TourBooking

  - name: reviews
    type: has_many
    entity: TourReview

  - name: availability
    type: has_many
    entity: TourAvailability

indexes:
  - [experience_code]
  - [slug]
  - [status]
  - [experience_type]
  - [host_id]
  - [location_type]
  - [average_rating DESC]

business_rules:
  - BR-EXP-001: max_guests <= 10 for home visits
  - BR-EXP-002: Experience requires at least 5 photos
  - BR-EXP-003: Host must be verified before publishing
  - BR-EXP-004: Cooking experiences must specify dietary options
  - BR-EXP-005: Online experiences must have video link

events:
  - name: experience.created
    payload: [id, experience_code, host_id]
  - name: experience.approved
    payload: [id, approved_by]
  - name: experience.published
    payload: [id]
  - name: experience.paused
    payload: [id, reason]
