name: Guide
display_name: Guide / Hướng dẫn viên
description: |
  Tour guide or experience host who conducts tours and activities.
  Can be freelance, employed, or partner guides with various
  certifications and specializations.

domain: travel-hospitality
subdomain: tour
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: guide_code
    type: string
    required: true
    validation:
      pattern: "^GID-[A-Z]{2}-[0-9]{6}$"
    example: "GID-VN-001234"

  - name: user_id
    type: uuid
    required: true
    description: Link to user account

  - name: status
    type: enum
    required: true
    validation:
      values: [pending, active, suspended, inactive, terminated]
    default: pending

  - name: guide_type
    type: enum
    required: true
    validation:
      values: [freelance, employed, partner, host]

  # Personal Info
  - name: first_name
    type: string
    required: true

  - name: last_name
    type: string
    required: true

  - name: display_name
    type: string
    required: true

  - name: avatar_url
    type: string
    required: true

  - name: cover_photo_url
    type: string
    required: false

  - name: date_of_birth
    type: date
    required: true

  - name: gender
    type: enum
    required: false
    validation:
      values: [male, female, other, prefer_not_to_say]

  - name: nationality
    type: string
    required: true

  # Bio & Expertise
  - name: bio
    type: text
    required: true
    validation:
      min_length: 100
      max_length: 2000

  - name: specialties
    type: array
    required: true
    description: Areas of expertise
    example: ["history", "food", "photography", "adventure"]

  - name: interests
    type: array
    required: false

  - name: fun_facts
    type: array
    required: false

  # Languages
  - name: languages
    type: array
    required: true
    items:
      type: object
      properties:
        language_code: string
        proficiency: enum[native, fluent, conversational, basic]

  - name: years_experience
    type: integer
    required: true

  # Credentials
  - name: license_number
    type: string
    required: false
    description: Official tour guide license

  - name: license_issuer
    type: string
    required: false

  - name: license_expiry
    type: date
    required: false

  - name: certifications
    type: array
    required: false
    items:
      type: object
      properties:
        name: string
        issuer: string
        issue_date: date
        expiry_date: date
        certificate_url: string

  - name: first_aid_certified
    type: boolean
    required: true
    default: false

  - name: first_aid_expiry
    type: date
    required: false

  - name: background_check_status
    type: enum
    required: true
    validation:
      values: [pending, passed, failed, expired]
    default: pending

  - name: background_check_date
    type: date
    required: false

  # Coverage
  - name: operating_areas
    type: array
    required: true
    description: Cities/regions where guide operates

  - name: tour_types
    type: array
    required: true
    description: Types of tours guide can lead

  - name: activity_types
    type: array
    required: false
    description: Types of activities guide is qualified for

  # Performance
  - name: total_tours_conducted
    type: integer
    required: true
    default: 0

  - name: total_guests_served
    type: integer
    required: true
    default: 0

  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: true
    default: 0

  - name: on_time_rate
    type: decimal
    required: false
    description: Percentage of tours started on time

  - name: repeat_booking_rate
    type: decimal
    required: false

  - name: cancellation_rate
    type: decimal
    required: false

  # Availability
  - name: calendar_id
    type: uuid
    required: false

  - name: max_tours_per_day
    type: integer
    required: true
    default: 2

  - name: advance_booking_days
    type: integer
    required: true
    default: 7
    description: How far in advance bookings accepted

  - name: blackout_dates
    type: array
    required: false
    description: Dates guide is unavailable

  # Contact
  - name: phone
    type: string
    required: true

  - name: whatsapp
    type: string
    required: false

  - name: email
    type: string
    required: true

  - name: emergency_contact
    type: object
    required: true
    properties:
      name: string
      phone: string
      relationship: string

  # Payment
  - name: payment_method
    type: enum
    required: true
    validation:
      values: [bank_transfer, e_wallet, cash]

  - name: bank_account
    type: object
    required: false
    properties:
      bank_name: string
      account_number: string
      account_holder: string

  - name: commission_rate
    type: decimal
    required: true
    description: Platform commission percentage

  # Verification
  - name: identity_verified
    type: boolean
    required: true
    default: false

  - name: identity_document_type
    type: enum
    required: false
    validation:
      values: [national_id, passport, driver_license]

  - name: identity_document_url
    type: string
    required: false

  # Timestamps
  - name: approved_at
    type: timestamp
    required: false

  - name: last_active_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: user
    type: belongs_to
    entity: User
    required: true

  - name: supplier
    type: belongs_to
    entity: Supplier
    required: false

  - name: schedules
    type: has_many
    entity: TourSchedule

  - name: reviews
    type: has_many
    entity: TourReview

  - name: experiences
    type: has_many
    entity: Experience

indexes:
  - [guide_code]
  - [user_id]
  - [status]
  - [guide_type]
  - [operating_areas]
  - [average_rating DESC]
  - [languages]

business_rules:
  - BR-GID-001: Guide must have valid license for licensed tour types
  - BR-GID-002: Background check must be passed before activation
  - BR-GID-003: First aid certification required for adventure activities
  - BR-GID-004: Guide cannot be assigned if max_tours_per_day reached
  - BR-GID-005: Guide rating < 3.5 after 10 tours triggers review
  - BR-GID-006: Cancellation rate > 10% triggers warning

events:
  - name: guide.registered
    payload: [id, guide_code]
  - name: guide.approved
    payload: [id, approved_by]
  - name: guide.suspended
    payload: [id, reason]
  - name: guide.assigned
    payload: [id, schedule_id]
  - name: guide.rating_updated
    payload: [id, new_rating, review_count]
