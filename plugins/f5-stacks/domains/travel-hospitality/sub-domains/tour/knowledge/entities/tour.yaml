name: Tour
display_name: Tour / Tour du lá»‹ch
description: |
  Tour product representing a guided travel experience.
  Can be day trips, multi-day tours, walking tours, food tours, etc.

domain: travel-hospitality
subdomain: tour
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: tour_code
    type: string
    required: true
    validation:
      pattern: "^TUR-[A-Z]{2}-[0-9]{6}$"
    example: "TUR-VN-001234"

  - name: title
    type: string
    required: true
    validation:
      min_length: 10
      max_length: 200

  - name: slug
    type: string
    required: true
    unique: true
    description: URL-friendly identifier

  - name: status
    type: enum
    required: true
    validation:
      values: [draft, pending_review, active, paused, archived]
    default: draft

  - name: tour_type
    type: enum
    required: true
    validation:
      values: [day_trip, multi_day, walking_tour, food_tour, adventure, cultural, wildlife, cruise, workshop, photography, night_tour]

  # Location
  - name: destination_city
    type: string
    required: true

  - name: destination_country
    type: string
    required: true
    validation:
      pattern: "^[A-Z]{2}$"
    description: ISO 3166-1 alpha-2 country code

  - name: meeting_point
    type: object
    required: true
    properties:
      address: string
      latitude: decimal
      longitude: decimal
      instructions: text
      google_maps_url: string

  - name: end_point
    type: object
    required: false
    description: If different from meeting point

  - name: regions_covered
    type: array
    required: false
    description: List of regions/areas covered in the tour

  # Duration
  - name: duration_type
    type: enum
    required: true
    validation:
      values: [hours, days]

  - name: duration_value
    type: decimal
    required: true
    description: Number of hours or days

  - name: start_time
    type: time
    required: true
    example: "08:00"

  - name: end_time
    type: time
    required: false
    description: Estimated end time

  # Description
  - name: short_description
    type: string
    required: true
    validation:
      max_length: 500

  - name: full_description
    type: text
    required: true

  - name: highlights
    type: array
    required: true
    description: Key highlights of the tour
    validation:
      min_items: 3
      max_items: 10

  - name: inclusions
    type: array
    required: true
    description: What's included in the tour price

  - name: exclusions
    type: array
    required: false
    description: What's not included

  - name: what_to_bring
    type: array
    required: false
    description: Recommended items for participants

  - name: know_before_you_go
    type: array
    required: false
    description: Important information before booking

  # Capacity
  - name: min_participants
    type: integer
    required: true
    default: 1
    description: Minimum to operate the tour

  - name: max_participants
    type: integer
    required: true
    description: Maximum capacity

  - name: private_tour_available
    type: boolean
    required: true
    default: false

  - name: private_tour_price
    type: decimal
    required: false
    description: Fixed price for private tour

  # Pricing
  - name: base_price_adult
    type: decimal
    required: true

  - name: base_price_child
    type: decimal
    required: false
    description: Price for children (age defined in child_age_range)

  - name: base_price_infant
    type: decimal
    required: false
    default: 0

  - name: child_age_range
    type: object
    required: false
    properties:
      min: integer
      max: integer
    example: { min: 4, max: 12 }

  - name: infant_age_max
    type: integer
    required: false
    default: 3

  - name: currency
    type: string
    required: true
    validation:
      pattern: "^[A-Z]{3}$"
    default: "VND"

  - name: price_per_person
    type: boolean
    required: true
    default: true
    description: If false, price is per group

  - name: group_pricing
    type: array
    required: false
    description: Tiered pricing for groups
    items:
      type: object
      properties:
        min_pax: integer
        max_pax: integer
        price_per_person: decimal

  # Media
  - name: cover_image_url
    type: string
    required: true

  - name: gallery
    type: array
    required: true
    validation:
      min_items: 3
      max_items: 20

  - name: video_url
    type: string
    required: false

  # Categories & Tags
  - name: categories
    type: array
    required: true

  - name: tags
    type: array
    required: false

  - name: accessibility
    type: array
    required: false
    description: Accessibility features
    validation:
      values: [wheelchair_accessible, stroller_accessible, service_animals_allowed, near_public_transportation, infant_seats_available]

  # Languages
  - name: offered_in_languages
    type: array
    required: true
    description: Languages the tour is conducted in

  - name: audio_guide_available
    type: boolean
    required: false
    default: false

  - name: audio_guide_languages
    type: array
    required: false

  # Supplier
  - name: supplier_id
    type: uuid
    required: true

  - name: guide_type
    type: enum
    required: true
    validation:
      values: [local_guide, professional_guide, self_guided, audio_guide]

  # Booking Settings
  - name: instant_confirmation
    type: boolean
    required: true
    default: true

  - name: cutoff_hours
    type: integer
    required: true
    default: 24
    description: Hours before start time to stop accepting bookings

  - name: cancellation_policy_id
    type: uuid
    required: true

  - name: free_cancellation_hours
    type: integer
    required: false
    description: Hours before start for free cancellation

  # Ratings
  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: false
    default: 0

  - name: booking_count
    type: integer
    required: false
    default: 0

  # SEO
  - name: meta_title
    type: string
    required: false

  - name: meta_description
    type: string
    required: false

  # Timestamps
  - name: published_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: supplier
    type: belongs_to
    entity: Supplier
    required: true

  - name: schedules
    type: has_many
    entity: TourSchedule

  - name: bookings
    type: has_many
    entity: TourBooking

  - name: reviews
    type: has_many
    entity: TourReview

  - name: itinerary
    type: has_one
    entity: Itinerary

  - name: cancellation_policy
    type: belongs_to
    entity: CancellationPolicy

  - name: pickup_points
    type: has_many
    entity: PickupPoint

  - name: activities
    type: has_many
    entity: Activity
    through: tour_activities

indexes:
  - [tour_code]
  - [slug]
  - [status]
  - [supplier_id]
  - [destination_city, destination_country]
  - [tour_type]
  - [average_rating DESC]
  - [created_at DESC]

business_rules:
  - BR-TUR-001: Tour must have at least 3 highlights
  - BR-TUR-002: max_participants >= min_participants
  - BR-TUR-003: base_price_child <= base_price_adult
  - BR-TUR-004: Tour must have at least 3 gallery images
  - BR-TUR-005: Cannot publish without itinerary
  - BR-TUR-006: Cannot archive tour with future bookings
  - BR-TUR-007: Private tour price > base_price_adult * max_participants

events:
  - name: tour.created
    payload: [id, tour_code, supplier_id]
  - name: tour.published
    payload: [id, tour_code]
  - name: tour.updated
    payload: [id, changed_fields]
  - name: tour.paused
    payload: [id, reason]
  - name: tour.archived
    payload: [id]
