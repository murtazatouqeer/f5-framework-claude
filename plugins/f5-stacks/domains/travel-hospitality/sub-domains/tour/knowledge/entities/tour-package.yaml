name: TourPackage
display_name: Tour Package / Combo tour
description: |
  Bundled package containing multiple tours, activities, or experiences
  sold together at a discounted price. Can include transfers,
  accommodation, and other services.

domain: travel-hospitality
subdomain: tour
category: supporting

attributes:
  - name: id
    type: uuid
    required: true

  - name: package_code
    type: string
    required: true
    validation:
      pattern: "^PKG-[A-Z]{2}-[0-9]{6}$"
    example: "PKG-VN-001234"

  - name: title
    type: string
    required: true
    validation:
      max_length: 200

  - name: slug
    type: string
    required: true
    unique: true

  - name: status
    type: enum
    required: true
    validation:
      values: [draft, active, paused, archived]
    default: draft

  - name: package_type
    type: enum
    required: true
    validation:
      values: [multi_tour, tour_plus_activity, destination_package, day_pass, adventure_package, cultural_package]

  # Description
  - name: short_description
    type: string
    required: true
    validation:
      max_length: 500

  - name: full_description
    type: text
    required: true

  - name: highlights
    type: array
    required: true

  - name: ideal_for
    type: array
    required: false
    example: ["families", "adventure seekers", "culture lovers"]

  # Items
  - name: items
    type: array
    required: true
    validation:
      min_items: 2
    items:
      type: object
      properties:
        item_type: enum[tour, activity, experience, transfer, accommodation, meal]
        item_id: uuid
        item_name: string
        day_number: integer
        sequence: integer
        is_optional: boolean
        included_quantity: integer
        retail_price: decimal

  # Duration
  - name: total_days
    type: integer
    required: true

  - name: total_nights
    type: integer
    required: false

  # Pricing
  - name: retail_total
    type: decimal
    required: true
    description: Sum of individual item prices

  - name: package_price
    type: decimal
    required: true
    description: Discounted package price

  - name: savings_amount
    type: decimal
    required: true
    computed: true

  - name: savings_percent
    type: decimal
    required: true
    computed: true

  - name: currency
    type: string
    required: true

  - name: price_per_person
    type: boolean
    required: true
    default: true

  - name: child_price
    type: decimal
    required: false

  # Validity
  - name: valid_from
    type: date
    required: true

  - name: valid_until
    type: date
    required: true

  - name: blackout_dates
    type: array
    required: false

  - name: booking_window_start
    type: date
    required: false
    description: When package can be purchased

  - name: booking_window_end
    type: date
    required: false

  # Capacity
  - name: min_participants
    type: integer
    required: true
    default: 1

  - name: max_participants
    type: integer
    required: true

  - name: total_inventory
    type: integer
    required: false
    description: Limited quantity packages

  - name: sold_count
    type: integer
    required: true
    default: 0

  # Inclusions
  - name: all_inclusions
    type: array
    required: true

  - name: all_exclusions
    type: array
    required: false

  - name: transfers_included
    type: boolean
    required: true
    default: false

  - name: meals_included
    type: object
    required: false
    properties:
      breakfast: integer
      lunch: integer
      dinner: integer

  - name: accommodation_included
    type: boolean
    required: true
    default: false

  - name: accommodation_nights
    type: integer
    required: false

  - name: accommodation_type
    type: enum
    required: false
    validation:
      values: [budget, standard, comfort, premium, luxury]

  # Supplier
  - name: supplier_id
    type: uuid
    required: true

  - name: partner_suppliers
    type: array
    required: false
    description: Other suppliers involved

  # Media
  - name: cover_image_url
    type: string
    required: true

  - name: gallery
    type: array
    required: true

  # Cancellation
  - name: cancellation_policy_id
    type: uuid
    required: true

  - name: partial_cancellation_allowed
    type: boolean
    required: true
    default: false
    description: Can cancel individual items

  # Ratings
  - name: average_rating
    type: decimal
    required: false

  - name: review_count
    type: integer
    required: true
    default: 0

  # Timestamps
  - name: published_at
    type: timestamp
    required: false

  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: supplier
    type: belongs_to
    entity: Supplier
    required: true

  - name: tours
    type: has_many
    entity: Tour
    through: package_items

  - name: activities
    type: has_many
    entity: Activity
    through: package_items

  - name: bookings
    type: has_many
    entity: TourBooking

indexes:
  - [package_code]
  - [slug]
  - [status]
  - [package_type]
  - [supplier_id]
  - [valid_from, valid_until]
  - [package_price]

business_rules:
  - BR-PKG-001: Package must have at least 2 items
  - BR-PKG-002: package_price < retail_total
  - BR-PKG-003: All items must be from same region
  - BR-PKG-004: Cannot modify package with active bookings
  - BR-PKG-005: Inventory tracking if total_inventory set
  - BR-PKG-006: All items must be available for booking dates

events:
  - name: package.created
    payload: [id, package_code]
  - name: package.published
    payload: [id]
  - name: package.sold_out
    payload: [id]
  - name: package.expired
    payload: [id]
