name: Participant
display_name: Participant / Người tham gia
description: |
  Individual participant in a tour booking. Stores personal details,
  requirements, and waiver information for each person on the tour.

domain: travel-hospitality
subdomain: tour
category: supporting

attributes:
  - name: id
    type: uuid
    required: true

  - name: booking_id
    type: uuid
    required: true

  - name: participant_number
    type: integer
    required: true
    description: Order in the booking (1, 2, 3...)

  - name: is_lead
    type: boolean
    required: true
    default: false
    description: Primary contact for the booking

  # Personal Info
  - name: title
    type: enum
    required: false
    validation:
      values: [mr, mrs, ms, miss, dr, prof]

  - name: first_name
    type: string
    required: true

  - name: last_name
    type: string
    required: true

  - name: full_name
    type: string
    required: true
    computed: true

  - name: email
    type: string
    required: false
    description: Required if is_lead = true

  - name: phone
    type: string
    required: false
    description: Required if is_lead = true

  - name: date_of_birth
    type: date
    required: false

  - name: age
    type: integer
    required: true

  - name: participant_type
    type: enum
    required: true
    validation:
      values: [adult, child, infant]

  - name: gender
    type: enum
    required: false
    validation:
      values: [male, female, other]

  - name: nationality
    type: string
    required: false
    description: Required for some tours

  - name: passport_number
    type: string
    required: false
    description: Required for border-crossing tours

  - name: passport_expiry
    type: date
    required: false

  # Physical
  - name: height_cm
    type: integer
    required: false
    description: Required for some activities

  - name: weight_kg
    type: decimal
    required: false
    description: Required for some activities

  - name: shoe_size
    type: string
    required: false
    description: For equipment rental

  - name: clothing_size
    type: enum
    required: false
    validation:
      values: [xs, s, m, l, xl, xxl]

  # Requirements
  - name: dietary_requirements
    type: array
    required: false
    validation:
      values: [vegetarian, vegan, halal, kosher, gluten_free, dairy_free, nut_allergy, seafood_allergy, other]

  - name: dietary_notes
    type: text
    required: false

  - name: medical_conditions
    type: array
    required: false
    description: Relevant medical conditions

  - name: allergies
    type: array
    required: false

  - name: accessibility_needs
    type: array
    required: false

  - name: special_requirements
    type: text
    required: false

  # Emergency Contact
  - name: emergency_contact
    type: object
    required: false
    description: Required for adventure activities
    properties:
      name: string
      relationship: string
      phone: string
      email: string

  # Waiver
  - name: waiver_required
    type: boolean
    required: true
    default: false

  - name: waiver_signed
    type: boolean
    required: true
    default: false

  - name: waiver_signed_at
    type: timestamp
    required: false

  - name: waiver_signature_url
    type: string
    required: false

  - name: waiver_signed_by
    type: string
    required: false
    description: Name of person who signed (for minors)

  - name: parent_guardian_consent
    type: boolean
    required: false
    description: Required for minors

  # Certifications (for certain activities)
  - name: certifications
    type: array
    required: false
    items:
      type: object
      properties:
        type: string
        number: string
        expiry_date: date
        verified: boolean

  # Attendance
  - name: checked_in
    type: boolean
    required: true
    default: false

  - name: checked_in_at
    type: timestamp
    required: false

  - name: no_show
    type: boolean
    required: true
    default: false

  # Experience
  - name: experience_level
    type: enum
    required: false
    validation:
      values: [first_time, beginner, intermediate, advanced, expert]

  # Timestamps
  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: booking
    type: belongs_to
    entity: TourBooking
    required: true

indexes:
  - [booking_id]
  - [email]
  - [passport_number]
  - [checked_in]

business_rules:
  - BR-PRT-001: Lead participant must have email and phone
  - BR-PRT-002: Age must match participant_type
  - BR-PRT-003: Waiver must be signed before tour for high-risk activities
  - BR-PRT-004: Minors (age < 18) require parent_guardian_consent
  - BR-PRT-005: Physical requirements must meet activity restrictions
  - BR-PRT-006: Passport required for international tours

events:
  - name: participant.added
    payload: [id, booking_id, participant_type]
  - name: participant.waiver_signed
    payload: [id]
  - name: participant.checked_in
    payload: [id, booking_id]
