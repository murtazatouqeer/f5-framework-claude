name: channel
display_name: Distribution Channel
display_name_vi: Kênh phân phối
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Distribution channel entity representing external booking channels
  including OTAs, GDS, wholesalers, and direct channels. Manages
  connectivity, mapping, and channel-specific configuration.

description_vi: |
  Thực thể kênh phân phối đại diện cho các kênh đặt phòng bên ngoài
  bao gồm OTA, GDS, đại lý bán buôn và kênh trực tiếp. Quản lý
  kết nối, ánh xạ và cấu hình theo kênh.

attributes:
  identity:
    - name: channel_id
      type: string
      format: "CH-{channel_code}"
      required: true
      description: Unique channel identifier

    - name: channel_code
      type: string
      max_length: 20
      required: true
      description: Short code (e.g., BKG, EXP, AGD)

    - name: channel_name
      type: string
      max_length: 100
      required: true
      description: Channel name

  classification:
    - name: channel_type
      type: enum
      values:
        - ota
        - meta_search
        - gds
        - wholesaler
        - direct_website
        - call_center
        - mobile_app
        - corporate
        - travel_agent
        - tour_operator
      required: true

    - name: channel_category
      type: enum
      values:
        - retail
        - wholesale
        - corporate
        - group
        - direct

    - name: market_segment
      type: enum
      values:
        - transient
        - corporate
        - group
        - leisure
        - wholesale

    - name: is_merchant
      type: boolean
      default: false
      description: Merchant model (prepaid)

    - name: is_agency
      type: boolean
      default: false
      description: Agency model (pay at hotel)

  connectivity:
    - name: connection_type
      type: enum
      values:
        - channel_manager
        - direct_api
        - gds_switch
        - xml_feed
        - manual
      required: true

    - name: channel_manager_id
      type: string
      description: CM provider reference

    - name: api_endpoint
      type: string
      description: API connection URL

    - name: api_version
      type: string

    - name: protocol
      type: enum
      values:
        - rest
        - soap
        - xml
        - htng
        - ota_xml

    - name: credentials
      type: object
      encrypted: true
      properties:
        username: string
        password: string
        api_key: string
        hotel_code: string
        property_code: string

  property_mapping:
    - name: property_mappings
      type: array
      items:
        type: object
        properties:
          property_id: string
          channel_property_code: string
          channel_property_name: string
          is_active: boolean
          activation_date: date

  room_mapping:
    - name: room_type_mappings
      type: array
      items:
        type: object
        properties:
          property_id: string
          room_type_id: string
          channel_room_code: string
          channel_room_name: string
          max_occupancy: integer
          bed_configuration: string

  rate_mapping:
    - name: rate_plan_mappings
      type: array
      items:
        type: object
        properties:
          property_id: string
          rate_plan_id: string
          channel_rate_code: string
          channel_rate_name: string
          meal_plan: string

  commission:
    - name: commission_type
      type: enum
      values:
        - percentage
        - fixed
        - tiered
        - none
      required: true

    - name: commission_rate
      type: decimal
      description: Percentage or fixed amount

    - name: commission_tiers
      type: array
      items:
        type: object
        properties:
          from_amount: decimal
          to_amount: decimal
          rate: decimal

    - name: commission_basis
      type: enum
      values:
        - room_revenue
        - total_revenue
        - net_rate
      default: room_revenue

    - name: payment_terms
      type: enum
      values:
        - monthly
        - bi_weekly
        - weekly
        - per_stay
      default: monthly

    - name: payment_method
      type: enum
      values:
        - bank_transfer
        - credit
        - virtual_card
        - check

  pricing:
    - name: pricing_model
      type: enum
      values:
        - sell_rate
        - net_rate
        - markup
        - commission
      required: true

    - name: markup_percentage
      type: decimal
      description: For markup model

    - name: tax_inclusive
      type: boolean
      default: false

    - name: currency_code
      type: string
      format: ISO 4217
      description: Channel's preferred currency

    - name: rate_parity_required
      type: boolean
      default: true

    - name: allow_rate_override
      type: boolean
      default: false

  inventory_settings:
    - name: allocation_type
      type: enum
      values:
        - pooled
        - allocated
        - hybrid
      default: pooled

    - name: default_allocation
      type: integer
      description: Default room allocation

    - name: auto_adjust_allocation
      type: boolean
      default: true

    - name: stop_sell_threshold
      type: integer
      description: Stop sell when inventory below

    - name: overbooking_allowed
      type: boolean
      default: false

  restrictions:
    - name: supports_cta
      type: boolean
      default: true
      description: Closed to Arrival

    - name: supports_ctd
      type: boolean
      default: true
      description: Closed to Departure

    - name: supports_min_los
      type: boolean
      default: true

    - name: supports_max_los
      type: boolean
      default: true

    - name: supports_min_advance
      type: boolean
      default: true

    - name: max_los_limit
      type: integer
      description: Channel's max LOS support

    - name: max_advance_days
      type: integer
      description: How far in advance

  policies:
    - name: cancellation_policy_mapping
      type: array
      items:
        type: object
        properties:
          our_policy_id: string
          channel_policy_code: string

    - name: deposit_policy_mapping
      type: array
      items:
        type: object
        properties:
          our_policy_id: string
          channel_policy_code: string

  booking_flow:
    - name: booking_confirmation
      type: enum
      values:
        - instant
        - on_request
        - manual
      default: instant

    - name: modification_allowed
      type: boolean
      default: true

    - name: cancellation_allowed
      type: boolean
      default: true

    - name: credit_card_required
      type: boolean
      default: true

    - name: send_confirmation_email
      type: boolean
      default: false
      description: Hotel sends or channel sends

  payment:
    - name: payment_model
      type: enum
      values:
        - pay_at_hotel
        - prepaid
        - hybrid
      required: true

    - name: virtual_card_supported
      type: boolean
      default: false

    - name: vcc_provider
      type: string

    - name: payment_timing
      type: enum
      values:
        - at_booking
        - at_checkin
        - at_checkout
        - on_invoice

  contact:
    - name: primary_contact
      type: object
      properties:
        name: string
        email: string
        phone: string
        role: string

    - name: support_contact
      type: object
      properties:
        email: string
        phone: string
        hours: string

    - name: extranet_url
      type: string
      description: Channel extranet login

  performance:
    - name: performance_metrics
      type: object
      properties:
        room_nights_ytd: integer
        revenue_ytd: decimal
        adr_ytd: decimal
        cancellation_rate: decimal
        no_show_rate: decimal
        average_lead_time: integer

    - name: quality_score
      type: integer
      min: 0
      max: 100

    - name: ranking_score
      type: decimal

  status:
    - name: status
      type: enum
      values:
        - active
        - inactive
        - suspended
        - pending_setup
        - terminated
      required: true
      default: pending_setup

    - name: activation_date
      type: date

    - name: deactivation_date
      type: date

    - name: suspension_reason
      type: string

  synchronization:
    - name: last_sync_at
      type: timestamp

    - name: sync_status
      type: enum
      values:
        - synced
        - pending
        - error
        - partial

    - name: sync_errors
      type: array
      items:
        type: object
        properties:
          error_date: timestamp
          error_type: string
          error_message: string
          resolved: boolean

    - name: ari_push_enabled
      type: boolean
      default: true

    - name: reservation_pull_enabled
      type: boolean
      default: true

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: created_by
      type: string

    - name: contract_start_date
      type: date

    - name: contract_end_date
      type: date

relationships:
  - entity: property
    type: many_to_many
    description: Channel connected to properties

  - entity: inventory
    type: one_to_many
    description: Channel has inventory allocations

  - entity: reservation
    type: one_to_many
    description: Channel sources reservations

indexes:
  - fields: [channel_code]
    unique: true
  - fields: [channel_type, status]
  - fields: [channel_manager_id]

business_rules:
  - rule: BR-CH-001
    description: Channel code must be unique
  - rule: BR-CH-002
    description: Rate parity monitored if required
  - rule: BR-CH-003
    description: Inactive channels stop receiving inventory
  - rule: BR-CH-004
    description: Commission calculated on confirmed stays
  - rule: BR-CH-005
    description: VCC charges processed before guest arrival

common_channels:
  ota:
    - code: BKG
      name: Booking.com
      type: ota
    - code: EXP
      name: Expedia
      type: ota
    - code: AGD
      name: Agoda
      type: ota
    - code: TRP
      name: Trip.com
      type: ota
    - code: HTC
      name: Hotels.com
      type: ota
  gds:
    - code: 1A
      name: Amadeus
      type: gds
    - code: 1S
      name: Sabre
      type: gds
    - code: 1G
      name: Galileo
      type: gds
    - code: 1P
      name: Worldspan
      type: gds
  meta:
    - code: TRV
      name: Trivago
      type: meta_search
    - code: KYK
      name: Kayak
      type: meta_search
    - code: GAD
      name: Google Hotel Ads
      type: meta_search
