name: guest-profile
display_name: Guest Profile
display_name_vi: Hồ sơ khách
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Persistent guest profile entity maintaining guest information
  across multiple stays and properties within the hotel chain.
  Central repository for preferences, history, and loyalty data.

description_vi: |
  Thực thể hồ sơ khách lưu giữ thông tin khách qua nhiều lần lưu trú
  và các cơ sở trong chuỗi khách sạn. Kho lưu trữ trung tâm cho
  sở thích, lịch sử và dữ liệu thành viên.

attributes:
  identity:
    - name: profile_id
      type: string
      format: "PRF-{chain_code}-{sequence}"
      required: true
      description: Unique profile identifier across chain

    - name: chain_id
      type: string
      description: Hotel chain reference

    - name: external_profile_ids
      type: array
      items:
        type: object
        properties:
          system: string
          profile_id: string
      description: IDs in integrated systems

  personal_info:
    - name: title
      type: enum
      values: [Mr, Mrs, Ms, Miss, Dr, Prof]

    - name: first_name
      type: string
      max_length: 100
      required: true

    - name: middle_name
      type: string
      max_length: 100

    - name: last_name
      type: string
      max_length: 100
      required: true

    - name: full_name
      type: string
      computed: true

    - name: preferred_name
      type: string

    - name: gender
      type: enum
      values: [male, female, other, prefer_not_to_say]

    - name: date_of_birth
      type: date

    - name: nationality
      type: string
      format: ISO 3166-1 alpha-2

    - name: preferred_language
      type: string
      format: ISO 639-1
      default: en

  contact:
    - name: primary_email
      type: string
      format: email
      required: true

    - name: secondary_email
      type: string
      format: email

    - name: primary_phone
      type: string
      format: E.164

    - name: mobile_phone
      type: string
      format: E.164

    - name: work_phone
      type: string
      format: E.164

    - name: home_address
      type: object
      properties:
        street: string
        city: string
        state_province: string
        postal_code: string
        country: string

    - name: work_address
      type: object
      properties:
        company_name: string
        street: string
        city: string
        state_province: string
        postal_code: string
        country: string

  identification:
    - name: passport
      type: object
      encrypted: true
      properties:
        number: string
        issuing_country: string
        expiry_date: date

    - name: national_id
      type: object
      encrypted: true
      properties:
        number: string
        issuing_country: string

    - name: drivers_license
      type: object
      encrypted: true
      properties:
        number: string
        issuing_state: string
        expiry_date: date

  loyalty:
    - name: loyalty_member_id
      type: string
      required: true
      description: Loyalty program member number

    - name: loyalty_tier
      type: enum
      values: [member, silver, gold, platinum, diamond, ambassador]
      default: member

    - name: tier_effective_date
      type: date

    - name: tier_expiry_date
      type: date

    - name: points_balance
      type: integer
      default: 0

    - name: lifetime_points
      type: integer
      default: 0

    - name: points_expiring
      type: object
      properties:
        amount: integer
        expiry_date: date

    - name: qualification_nights
      type: integer
      default: 0
      description: Nights toward next tier

    - name: qualification_stays
      type: integer
      default: 0
      description: Stays toward next tier

    - name: enrollment_date
      type: date

    - name: enrollment_property
      type: string

  stay_history:
    - name: total_stays
      type: integer
      default: 0

    - name: total_nights
      type: integer
      default: 0

    - name: total_revenue
      type: decimal
      default: 0

    - name: average_daily_rate
      type: decimal
      computed: true

    - name: first_stay_date
      type: date

    - name: last_stay_date
      type: date

    - name: last_stay_property
      type: string

    - name: frequent_properties
      type: array
      items:
        type: object
        properties:
          property_id: string
          stay_count: integer
          last_stay: date

    - name: no_show_count
      type: integer
      default: 0

    - name: cancellation_count
      type: integer
      default: 0

  preferences:
    - name: room_preferences
      type: object
      properties:
        preferred_room_type: string
        floor_preference: enum [low, high, specific]
        preferred_floor: integer
        view_preference: array
        bed_type: enum [king, queen, twin, double]
        smoking: boolean
        pillow_type: array
        room_temperature: enum [warm, normal, cool]
        minibar_stocked: boolean
        newspaper: string

    - name: dining_preferences
      type: object
      properties:
        dietary_restrictions: array
        favorite_cuisine: array
        breakfast_time: time
        table_preference: string
        wine_preferences: array

    - name: amenity_preferences
      type: array
      items: string
      description: Preferred in-room amenities

    - name: service_preferences
      type: object
      properties:
        wake_up_call: boolean
        turn_down_service: boolean
        do_not_disturb_hours: object
        preferred_contact_method: enum [email, phone, sms, app]

  special_dates:
    - name: special_occasions
      type: array
      items:
        type: object
        properties:
          occasion_type: enum [birthday, anniversary, wedding]
          date: date
          year: integer
          notes: string

  vip_status:
    - name: vip_code
      type: enum
      values: [none, vip1, vip2, vip3, celebrity, government, owner]
      default: none

    - name: vip_notes
      type: text

    - name: assigned_concierge
      type: string

  corporate:
    - name: company_name
      type: string

    - name: company_id
      type: string
      description: Corporate account link

    - name: job_title
      type: string

    - name: department
      type: string

    - name: assistant_name
      type: string

    - name: assistant_contact
      type: string

  travel_arranger:
    - name: travel_agency
      type: string

    - name: travel_agent_name
      type: string

    - name: travel_agent_contact
      type: string

  payment:
    - name: saved_payment_methods
      type: array
      items:
        type: object
        properties:
          payment_token: string
          card_type: string
          last_four: string
          expiry: string
          is_default: boolean
          nickname: string

    - name: billing_address
      type: object
      properties:
        street: string
        city: string
        state: string
        postal_code: string
        country: string

  communication:
    - name: email_opt_in
      type: boolean
      default: false

    - name: sms_opt_in
      type: boolean
      default: false

    - name: mail_opt_in
      type: boolean
      default: false

    - name: app_notifications
      type: boolean
      default: true

    - name: preferred_communication_language
      type: string
      format: ISO 639-1

    - name: do_not_contact
      type: boolean
      default: false

  feedback:
    - name: average_satisfaction_score
      type: decimal

    - name: total_surveys_completed
      type: integer
      default: 0

    - name: nps_score
      type: integer

    - name: complaints_count
      type: integer
      default: 0

    - name: compliments_count
      type: integer
      default: 0

  notes:
    - name: guest_notes
      type: array
      items:
        type: object
        properties:
          note_date: timestamp
          note_type: enum [preference, alert, compliment, complaint, general]
          note_text: text
          property_id: string
          created_by: string

    - name: alerts
      type: array
      items:
        type: object
        properties:
          alert_type: enum [vip, allergy, medical, billing, other]
          alert_text: string
          is_active: boolean

  status:
    - name: profile_status
      type: enum
      values: [active, inactive, merged, deceased]
      default: active

    - name: is_verified
      type: boolean
      default: false

    - name: verification_date
      type: timestamp

    - name: merged_into_profile_id
      type: string
      description: If profile was merged

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: created_by
      type: string

    - name: last_activity_date
      type: timestamp

relationships:
  - entity: guest
    type: one_to_many
    description: Profile has many guest records (stays)

  - entity: reservation
    type: one_to_many
    description: Profile has many reservations

indexes:
  - fields: [loyalty_member_id]
    unique: true
  - fields: [primary_email]
    unique: true
  - fields: [last_name, first_name, date_of_birth]
  - fields: [loyalty_tier]
  - fields: [company_id]

business_rules:
  - rule: BR-PROF-001
    description: Email must be unique across profiles
  - rule: BR-PROF-002
    description: Loyalty member ID must be unique
  - rule: BR-PROF-003
    description: Merged profiles cannot be reactivated
  - rule: BR-PROF-004
    description: Tier upgrade/downgrade follows program rules

data_protection:
  gdpr_applicable: true
  retention_period: 10_years
  right_to_erasure: true
  right_to_portability: true
  sensitive_fields:
    - passport
    - national_id
    - drivers_license
    - date_of_birth
    - saved_payment_methods
