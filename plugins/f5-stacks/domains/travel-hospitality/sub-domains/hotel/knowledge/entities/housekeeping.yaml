name: housekeeping
display_name: Housekeeping Task
display_name_vi: Nhiệm vụ buồng phòng
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Housekeeping task entity representing cleaning and service tasks
  for hotel rooms. Tracks assignments, completion status, and
  quality inspections.

description_vi: |
  Thực thể nhiệm vụ buồng phòng đại diện cho các công việc dọn dẹp
  và phục vụ phòng khách sạn. Theo dõi phân công, trạng thái hoàn thành
  và kiểm tra chất lượng.

attributes:
  identity:
    - name: task_id
      type: string
      format: "HK-{property_code}-{YYYYMMDD}-{sequence}"
      required: true
      description: Unique task identifier

    - name: property_id
      type: string
      required: true

    - name: room_id
      type: string
      required: true
      description: Target room

    - name: room_number
      type: string
      required: true

  task_info:
    - name: task_date
      type: date
      required: true
      description: Scheduled date

    - name: task_type
      type: enum
      values:
        - checkout_clean
        - stayover_service
        - turndown_service
        - deep_clean
        - inspection
        - touch_up
        - vip_preparation
        - special_request
      required: true

    - name: service_level
      type: enum
      values:
        - standard
        - enhanced
        - vip
        - suite
      default: standard

    - name: priority
      type: enum
      values:
        - urgent
        - high
        - normal
        - low
      default: normal

    - name: estimated_duration
      type: integer
      description: Minutes expected

  room_context:
    - name: previous_status
      type: enum
      values:
        - vacant_dirty
        - occupied_dirty
        - checkout
        - due_out
        - stayover

    - name: target_status
      type: enum
      values:
        - vacant_clean
        - vacant_inspected
        - occupied_clean

    - name: guest_departure_time
      type: time
      description: For checkout rooms

    - name: guest_arrival_time
      type: time
      description: For arrivals - rush priority

    - name: is_arrival_room
      type: boolean
      default: false

    - name: is_vip_room
      type: boolean
      default: false

    - name: guest_requests
      type: text
      description: Special guest requests

    - name: do_not_disturb
      type: boolean
      default: false

    - name: make_up_room
      type: boolean
      default: true

  assignment:
    - name: assigned_attendant_id
      type: string
      description: Primary housekeeper

    - name: assigned_attendant_name
      type: string

    - name: team_id
      type: string
      description: Housekeeping team

    - name: section_id
      type: string
      description: Floor/section assignment

    - name: supervisor_id
      type: string
      description: Supervising inspector

    - name: assigned_at
      type: timestamp

    - name: assigned_by
      type: string

  scheduling:
    - name: scheduled_start
      type: time
      description: Planned start time

    - name: scheduled_end
      type: time
      description: Planned completion

    - name: sequence_number
      type: integer
      description: Order in attendant's list

  execution:
    - name: actual_start
      type: timestamp
      description: When cleaning started

    - name: actual_end
      type: timestamp
      description: When cleaning completed

    - name: actual_duration
      type: integer
      description: Minutes taken

    - name: cleaned_by
      type: string
      description: Attendant who cleaned

    - name: number_of_staff
      type: integer
      default: 1
      description: Staff involved

  checklist:
    - name: checklist_items
      type: array
      items:
        type: object
        properties:
          item_code: string
          item_name: string
          category: enum [bathroom, bedroom, common_area, amenities, linen]
          is_required: boolean
          is_completed: boolean
          completed_at: timestamp
          notes: string

    - name: checklist_completed
      type: boolean
      default: false

    - name: checklist_compliance
      type: decimal
      description: Percentage completed

  supplies:
    - name: supplies_used
      type: array
      items:
        type: object
        properties:
          supply_code: string
          supply_name: string
          quantity: integer
          unit: string

    - name: linen_used
      type: object
      properties:
        sheets: integer
        pillowcases: integer
        towels: integer
        bathrobes: integer
        other: array

    - name: amenities_restocked
      type: array
      items:
        type: object
        properties:
          amenity_code: string
          quantity: integer

  minibar:
    - name: minibar_checked
      type: boolean
      default: false

    - name: minibar_consumption
      type: array
      items:
        type: object
        properties:
          item_code: string
          item_name: string
          quantity: integer
          unit_price: decimal

    - name: minibar_restocked
      type: boolean
      default: false

  inspection:
    - name: requires_inspection
      type: boolean
      default: true

    - name: inspection_status
      type: enum
      values:
        - pending
        - passed
        - failed
        - reinspection_required

    - name: inspected_by
      type: string

    - name: inspected_at
      type: timestamp

    - name: inspection_score
      type: integer
      min: 0
      max: 100

    - name: inspection_notes
      type: text

    - name: deficiencies
      type: array
      items:
        type: object
        properties:
          area: string
          issue: string
          severity: enum [minor, major, critical]
          photo_url: string
          resolved: boolean

  issues:
    - name: maintenance_issues
      type: array
      items:
        type: object
        properties:
          issue_type: string
          description: string
          maintenance_request_id: string
          reported_at: timestamp

    - name: lost_and_found
      type: array
      items:
        type: object
        properties:
          item_description: string
          location_found: string
          photo_url: string
          lost_found_id: string

  status:
    - name: status
      type: enum
      values:
        - scheduled
        - assigned
        - in_progress
        - completed
        - inspected
        - on_hold
        - cancelled
        - skipped
      required: true
      default: scheduled

    - name: hold_reason
      type: string
      description: Why on hold (DND, guest present)

    - name: skip_reason
      type: string

    - name: completion_notes
      type: text

  quality:
    - name: guest_feedback
      type: object
      properties:
        rating: integer
        comments: text
        feedback_date: timestamp

    - name: quality_score
      type: decimal
      description: Overall quality rating

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: created_by
      type: string

    - name: completed_at
      type: timestamp

    - name: completed_by
      type: string

relationships:
  - entity: property
    type: many_to_one
    required: true

  - entity: room
    type: many_to_one
    required: true

  - entity: maintenance
    type: one_to_many
    description: Issues discovered during cleaning

indexes:
  - fields: [property_id, task_date, room_number]
  - fields: [assigned_attendant_id, task_date, status]
  - fields: [property_id, status, priority]
  - fields: [supervisor_id, task_date]
  - fields: [section_id, task_date]

state_machine:
  name: task_status
  states:
    - scheduled
    - assigned
    - in_progress
    - completed
    - inspected
    - on_hold
    - cancelled
    - skipped

  transitions:
    - from: scheduled
      to: assigned
      trigger: attendant_assigned

    - from: assigned
      to: in_progress
      trigger: cleaning_started

    - from: in_progress
      to: completed
      trigger: cleaning_finished

    - from: completed
      to: inspected
      trigger: inspection_passed

    - from: completed
      to: in_progress
      trigger: inspection_failed

    - from: [assigned, in_progress]
      to: on_hold
      trigger: dnd_or_guest_present

    - from: on_hold
      to: in_progress
      trigger: room_available

    - from: [scheduled, assigned]
      to: cancelled
      trigger: task_cancelled

    - from: [assigned, in_progress]
      to: skipped
      trigger: task_skipped

business_rules:
  - rule: BR-HK-001
    description: Checkout rooms take priority over stayovers
  - rule: BR-HK-002
    description: VIP arrivals require supervisor inspection
  - rule: BR-HK-003
    description: DND rooms skipped after 2PM unless checkout
  - rule: BR-HK-004
    description: Deep clean required every 7 stayover days
  - rule: BR-HK-005
    description: Minibar must be checked on all checkouts

task_standards:
  checkout_clean:
    estimated_minutes: 45
    checklist_required: true
    inspection_required: true
  stayover_service:
    estimated_minutes: 25
    checklist_required: true
    inspection_required: false
  turndown_service:
    estimated_minutes: 10
    checklist_required: false
    inspection_required: false
  deep_clean:
    estimated_minutes: 90
    checklist_required: true
    inspection_required: true
