name: rate-plan
display_name: Rate Plan
display_name_vi: Bảng giá
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Rate plan entity defining pricing structures, restrictions, and
  policies for selling room inventory. Supports various rate types
  including public, corporate, promotional, and package rates.

description_vi: |
  Thực thể bảng giá định nghĩa cấu trúc giá, các hạn chế và chính sách
  bán tồn kho phòng. Hỗ trợ nhiều loại giá bao gồm giá công khai, doanh nghiệp,
  khuyến mãi và gói.

attributes:
  identity:
    - name: rate_plan_id
      type: string
      format: "RP-{property_code}-{rate_code}"
      required: true
      description: Unique rate plan identifier

    - name: property_id
      type: string
      required: true
      description: Parent property reference

    - name: rate_code
      type: string
      max_length: 20
      required: true
      description: Rate plan code (e.g., BAR, CORP, PROMO)

  naming:
    - name: name
      type: string
      max_length: 100
      required: true
      description: Rate plan name

    - name: name_vi
      type: string
      max_length: 100
      description: Vietnamese name

    - name: description
      type: text
      description: Rate plan description

    - name: internal_notes
      type: text
      description: Notes for staff only

  classification:
    - name: rate_type
      type: enum
      values:
        - public
        - corporate
        - wholesale
        - promotional
        - package
        - group
        - loyalty
        - employee
        - complimentary
      required: true

    - name: rate_category
      type: enum
      values:
        - rack
        - bar
        - advance_purchase
        - last_minute
        - non_refundable
        - flexible
      required: true

    - name: market_segment
      type: enum
      values:
        - transient
        - corporate
        - group
        - leisure
        - government
        - airline
        - wholesale

    - name: source_of_business
      type: enum
      values:
        - direct
        - ota
        - gds
        - corporate
        - wholesale
        - walk_in

  meal_plan:
    - name: meal_plan_code
      type: enum
      values:
        - RO
        - BB
        - HB
        - FB
        - AI
      required: true
      description: |
        RO: Room Only
        BB: Bed & Breakfast
        HB: Half Board (breakfast + dinner)
        FB: Full Board (all meals)
        AI: All Inclusive

    - name: meal_plan_name
      type: string

    - name: included_meals
      type: array
      items:
        type: enum
        values: [breakfast, lunch, dinner, snacks, beverages, alcohol]

  pricing:
    - name: base_rate
      type: decimal
      required: true
      description: Base rate amount

    - name: currency_code
      type: string
      format: ISO 4217
      required: true

    - name: rate_basis
      type: enum
      values:
        - per_room
        - per_person
      required: true

    - name: extra_adult_rate
      type: decimal
      default: 0

    - name: extra_child_rate
      type: decimal
      default: 0

    - name: single_supplement
      type: decimal
      description: Single occupancy supplement

    - name: child_rate_percentage
      type: decimal
      description: Child rate as % of adult

  taxes_and_fees:
    - name: tax_inclusive
      type: boolean
      default: false

    - name: service_charge_inclusive
      type: boolean
      default: false

    - name: additional_taxes
      type: array
      items:
        type: object
        properties:
          name: string
          type: enum [percentage, fixed]
          amount: decimal
          per: enum [stay, night, person]

  validity:
    - name: effective_date
      type: date
      required: true
      description: Rate plan start date

    - name: expiry_date
      type: date
      description: Rate plan end date

    - name: booking_window_start
      type: date
      description: Earliest booking date

    - name: booking_window_end
      type: date
      description: Latest booking date

    - name: travel_window_start
      type: date
      description: Earliest travel date

    - name: travel_window_end
      type: date
      description: Latest travel date

  stay_restrictions:
    - name: min_los
      type: integer
      default: 1
      description: Minimum length of stay

    - name: max_los
      type: integer
      description: Maximum length of stay

    - name: min_advance_days
      type: integer
      default: 0
      description: Minimum days in advance

    - name: max_advance_days
      type: integer
      description: Maximum days in advance

    - name: closed_to_arrival
      type: boolean
      default: false

    - name: closed_to_departure
      type: boolean
      default: false

    - name: stay_through_required
      type: array
      items: string
      description: Days guest must stay through

  day_of_week:
    - name: valid_days
      type: array
      items:
        type: enum
        values: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
      description: Days rate is valid

    - name: arrival_days
      type: array
      items:
        type: enum
        values: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
      description: Allowed arrival days

    - name: departure_days
      type: array
      items:
        type: enum
        values: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
      description: Allowed departure days

  cancellation:
    - name: cancellation_policy_id
      type: string
      description: Reference to cancellation policy

    - name: cancellation_deadline_hours
      type: integer
      default: 24
      description: Hours before arrival

    - name: cancellation_penalty_type
      type: enum
      values:
        - no_penalty
        - first_night
        - percentage
        - full_stay
        - fixed_amount

    - name: cancellation_penalty_amount
      type: decimal

    - name: is_non_refundable
      type: boolean
      default: false

  deposit:
    - name: deposit_required
      type: boolean
      default: false

    - name: deposit_type
      type: enum
      values:
        - first_night
        - percentage
        - fixed_amount
        - full_payment

    - name: deposit_amount
      type: decimal

    - name: deposit_due_days
      type: integer
      description: Days before arrival deposit due

  inclusions:
    - name: included_services
      type: array
      items:
        type: object
        properties:
          service_code: string
          service_name: string
          frequency: enum [per_stay, per_night, per_person]
          quantity: integer

    - name: value_adds
      type: array
      items: string
      description: Marketing value adds (e.g., "Free WiFi", "Parking included")

  distribution:
    - name: sell_channels
      type: array
      items:
        type: enum
        values:
          - direct_website
          - call_center
          - front_desk
          - gds
          - ota
          - wholesale
          - mobile_app

    - name: restricted_channels
      type: array
      items: string
      description: Channels where rate cannot be sold

    - name: commission_rate
      type: decimal
      description: Commission percentage

    - name: commission_type
      type: enum
      values: [commissionable, net, non_commissionable]

  corporate:
    - name: corporate_id
      type: string
      description: For corporate rates

    - name: contract_id
      type: string
      description: Contract reference

    - name: contracted_volume
      type: integer
      description: Room nights contracted

  room_types:
    - name: applicable_room_types
      type: array
      items:
        type: object
        properties:
          room_type_id: string
          rate_amount: decimal
          rate_modifier: decimal
      required: true
      description: Room types and their rates

  operational:
    - name: is_active
      type: boolean
      default: true

    - name: is_public
      type: boolean
      default: true
      description: Visible to public

    - name: requires_access_code
      type: boolean
      default: false

    - name: access_code
      type: string
      description: Promo/access code if required

    - name: priority
      type: integer
      description: Display priority

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: created_by
      type: string

    - name: approved_by
      type: string

    - name: approved_at
      type: timestamp

relationships:
  - entity: property
    type: many_to_one
    required: true
    description: Rate plan belongs to property

  - entity: room_type
    type: many_to_many
    description: Rate plan applies to room types

  - entity: reservation
    type: one_to_many
    description: Rate plan used in reservations

  - entity: inventory
    type: one_to_many
    description: Rate plan affects inventory

indexes:
  - fields: [property_id, rate_code]
    unique: true
  - fields: [property_id, rate_type, is_active]
  - fields: [effective_date, expiry_date]
  - fields: [corporate_id]

business_rules:
  - rule: BR-RP-001
    description: Rate code must be unique within property
  - rule: BR-RP-002
    description: Expiry date must be after effective date
  - rule: BR-RP-003
    description: Non-refundable rates must have clear disclosure
  - rule: BR-RP-004
    description: Min LOS cannot exceed max LOS
  - rule: BR-RP-005
    description: At least one room type must be applicable

htng_mapping:
  standard: HTNG Rate Plan Message
  elements:
    - RatePlanCode → rate_code
    - RatePlanName → name
    - BaseRate → base_rate
    - MealPlanCode → meal_plan_code
