name: inventory
display_name: Room Inventory
display_name_vi: Tồn kho phòng
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Room inventory entity tracking daily room availability, rates,
  and restrictions by room type and rate plan. Core for revenue
  management and channel distribution.

description_vi: |
  Thực thể tồn kho phòng theo dõi phòng trống hàng ngày, giá
  và hạn chế theo loại phòng và bảng giá. Cốt lõi cho quản lý
  doanh thu và phân phối kênh.

attributes:
  identity:
    - name: inventory_id
      type: string
      format: "INV-{property_code}-{room_type}-{date}"
      required: true
      description: Unique inventory identifier

    - name: property_id
      type: string
      required: true

    - name: room_type_id
      type: string
      required: true

    - name: rate_plan_id
      type: string
      description: If rate-specific inventory

    - name: inventory_date
      type: date
      required: true
      description: Date this inventory applies to

  physical_inventory:
    - name: physical_rooms
      type: integer
      required: true
      description: Total physical rooms of this type

    - name: out_of_order
      type: integer
      default: 0
      description: Rooms not available (maintenance)

    - name: out_of_service
      type: integer
      default: 0
      description: Rooms temporarily unavailable

    - name: house_use
      type: integer
      default: 0
      description: Rooms for internal use

    - name: complimentary
      type: integer
      default: 0
      description: Comp rooms allocated

    - name: group_blocked
      type: integer
      default: 0
      description: Rooms blocked for groups

  available_inventory:
    - name: sellable_rooms
      type: integer
      computed: true
      description: physical - OOO - OOS - house - comp

    - name: sold_rooms
      type: integer
      default: 0
      description: Currently booked rooms

    - name: available_rooms
      type: integer
      computed: true
      description: sellable - sold

    - name: overbooked_rooms
      type: integer
      default: 0
      description: Intentional overbooking

    - name: tentative_holds
      type: integer
      default: 0
      description: Tentative reservations

  channel_allocation:
    - name: channel_allocations
      type: array
      items:
        type: object
        properties:
          channel_id: string
          channel_name: string
          allocated_rooms: integer
          sold_rooms: integer
          available_rooms: integer
          stop_sell: boolean

    - name: direct_allocation
      type: integer
      description: Rooms for direct channels

    - name: ota_allocation
      type: integer
      description: Rooms for OTA channels

    - name: gds_allocation
      type: integer
      description: Rooms for GDS

    - name: wholesale_allocation
      type: integer
      description: Rooms for wholesalers

  pricing:
    - name: bar_rate
      type: decimal
      description: Best Available Rate

    - name: rack_rate
      type: decimal
      description: Published rate

    - name: min_rate
      type: decimal
      description: Floor rate

    - name: daily_rates
      type: array
      items:
        type: object
        properties:
          rate_plan_id: string
          rate_code: string
          rate_amount: decimal
          extra_adult: decimal
          extra_child: decimal
          single_rate: decimal

    - name: currency_code
      type: string
      format: ISO 4217
      required: true

    - name: rate_level
      type: integer
      description: Rate tier/level for yield

  restrictions:
    - name: closed
      type: boolean
      default: false
      description: Room type closed for date

    - name: closed_to_arrival
      type: boolean
      default: false
      description: No arrivals this date

    - name: closed_to_departure
      type: boolean
      default: false
      description: No departures this date

    - name: min_los
      type: integer
      default: 1
      description: Minimum length of stay

    - name: max_los
      type: integer
      description: Maximum length of stay

    - name: min_los_arrival
      type: integer
      description: Min LOS if arriving this date

    - name: full_pattern_los
      type: string
      description: Required stay pattern

    - name: min_advance_booking
      type: integer
      description: Days before arrival

    - name: max_advance_booking
      type: integer

  stop_sell:
    - name: stop_sell
      type: boolean
      default: false
      description: No selling this room type

    - name: stop_sell_reason
      type: string

    - name: stop_sell_by
      type: string

    - name: stop_sell_at
      type: timestamp

  yield_controls:
    - name: hurdle_rate
      type: decimal
      description: Minimum rate to accept

    - name: bid_price
      type: decimal
      description: Revenue management bid price

    - name: yield_status
      type: enum
      values:
        - open
        - restricted
        - closed_to_discount
        - closed
      default: open

    - name: demand_level
      type: enum
      values:
        - low
        - moderate
        - high
        - peak
      description: Expected demand

    - name: forecast_demand
      type: integer
      description: Forecasted bookings

    - name: forecast_revenue
      type: decimal

  occupancy_metrics:
    - name: occupancy_percentage
      type: decimal
      computed: true
      description: sold / sellable × 100

    - name: adr
      type: decimal
      description: Average Daily Rate

    - name: revpar
      type: decimal
      computed: true
      description: Revenue per available room

    - name: revenue
      type: decimal
      description: Total room revenue

  group_inventory:
    - name: group_blocks
      type: array
      items:
        type: object
        properties:
          group_id: string
          group_name: string
          blocked_rooms: integer
          picked_up: integer
          cutoff_date: date
          release_date: date

    - name: total_group_block
      type: integer
      computed: true

    - name: total_group_pickup
      type: integer
      computed: true

  dynamic_packaging:
    - name: package_availability
      type: array
      items:
        type: object
        properties:
          package_id: string
          available: boolean
          rate_amount: decimal

  events:
    - name: local_events
      type: array
      items:
        type: object
        properties:
          event_name: string
          event_type: string
          expected_demand: enum [low, medium, high]

    - name: demand_drivers
      type: array
      items: string
      description: Factors affecting demand

  distribution:
    - name: last_ari_update
      type: timestamp
      description: Last ARI push to channels

    - name: channel_updates_pending
      type: boolean
      default: false

    - name: ari_status
      type: object
      properties:
        availability_sent: boolean
        rates_sent: boolean
        restrictions_sent: boolean

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: updated_by
      type: string

    - name: rate_updated_at
      type: timestamp

    - name: rate_updated_by
      type: string

relationships:
  - entity: property
    type: many_to_one
    required: true

  - entity: room_type
    type: many_to_one
    required: true

  - entity: rate_plan
    type: many_to_one

  - entity: channel
    type: many_to_many
    description: Channel allocations

indexes:
  - fields: [property_id, room_type_id, inventory_date]
    unique: true
  - fields: [property_id, inventory_date]
  - fields: [property_id, room_type_id, rate_plan_id, inventory_date]
  - fields: [inventory_date, available_rooms]

business_rules:
  - rule: BR-INV-001
    description: Available cannot be negative (except overbooking)
  - rule: BR-INV-002
    description: Stop sell immediately blocks all channels
  - rule: BR-INV-003
    description: Channel allocation cannot exceed available
  - rule: BR-INV-004
    description: Group cutoff releases blocked rooms
  - rule: BR-INV-005
    description: Rate changes require ARI update

revenue_management:
  yield_strategies:
    low_demand:
      - open_all_rates
      - reduce_min_los
      - enable_promotions
    moderate_demand:
      - close_deep_discounts
      - standard_restrictions
    high_demand:
      - close_discounts
      - increase_min_los
      - raise_hurdle_rate
    peak_demand:
      - rack_rates_only
      - maximum_min_los
      - premium_pricing

ari_distribution:
  update_triggers:
    - inventory_change
    - rate_change
    - restriction_change
    - stop_sell
    - overbooking
  update_frequency: real_time
  channels:
    - ota
    - gds
    - channel_manager
    - direct_website
