name: guest
display_name: Guest
display_name_vi: Khách
version: "1.0"
domain: travel-hospitality
subdomain: hotel

description: |
  Guest entity representing a hotel guest for a specific stay,
  including personal details, identification, and stay-specific
  preferences and requirements.

description_vi: |
  Thực thể khách đại diện cho khách khách sạn trong một lần lưu trú cụ thể,
  bao gồm thông tin cá nhân, giấy tờ tùy thân và các yêu cầu, sở thích
  riêng cho lần lưu trú.

attributes:
  identity:
    - name: guest_id
      type: string
      format: "GST-{property_code}-{YYYYMMDD}-{sequence}"
      required: true
      description: Unique guest identifier for this stay

    - name: property_id
      type: string
      required: true

    - name: guest_profile_id
      type: string
      description: Link to persistent guest profile

    - name: reservation_id
      type: string
      required: true
      description: Associated reservation

  personal_info:
    - name: title
      type: enum
      values: [Mr, Mrs, Ms, Miss, Dr, Prof]

    - name: first_name
      type: string
      max_length: 100
      required: true

    - name: middle_name
      type: string
      max_length: 100

    - name: last_name
      type: string
      max_length: 100
      required: true

    - name: suffix
      type: string
      max_length: 20

    - name: full_name
      type: string
      computed: true

    - name: preferred_name
      type: string
      description: Name guest prefers to be called

    - name: gender
      type: enum
      values: [male, female, other, prefer_not_to_say]

    - name: date_of_birth
      type: date

    - name: nationality
      type: string
      format: ISO 3166-1 alpha-2

    - name: language
      type: string
      format: ISO 639-1
      default: en

  contact:
    - name: email
      type: string
      format: email

    - name: phone
      type: string
      format: E.164

    - name: mobile
      type: string
      format: E.164

    - name: address
      type: object
      properties:
        street: string
        city: string
        state_province: string
        postal_code: string
        country: string

    - name: emergency_contact
      type: object
      properties:
        name: string
        relationship: string
        phone: string

  identification:
    - name: id_type
      type: enum
      values:
        - passport
        - national_id
        - drivers_license
        - military_id
        - other

    - name: id_number
      type: string
      encrypted: true

    - name: id_issuing_country
      type: string
      format: ISO 3166-1 alpha-2

    - name: id_expiry_date
      type: date

    - name: id_scan_url
      type: string
      description: Secure storage reference

    - name: visa_number
      type: string
      encrypted: true

    - name: visa_type
      type: string

    - name: visa_expiry_date
      type: date

  guest_type:
    - name: guest_category
      type: enum
      values:
        - registered_guest
        - accompanying
        - day_use
        - visitor
      required: true

    - name: is_primary_guest
      type: boolean
      default: false
      description: Main guest on reservation

    - name: age_category
      type: enum
      values:
        - adult
        - child
        - infant
      required: true

    - name: age
      type: integer
      description: Age at time of stay

  membership:
    - name: loyalty_number
      type: string
      description: Hotel loyalty program number

    - name: loyalty_tier
      type: enum
      values: [none, member, silver, gold, platinum, diamond]
      default: none

    - name: loyalty_points_earned
      type: integer
      default: 0

    - name: external_loyalty
      type: array
      items:
        type: object
        properties:
          program_name: string
          member_number: string

  vip_status:
    - name: vip_code
      type: enum
      values: [none, vip1, vip2, vip3, celebrity, government, owner]
      default: none

    - name: vip_amenities
      type: array
      items: string
      description: Special amenities for VIP

    - name: blacklist_status
      type: boolean
      default: false

    - name: blacklist_reason
      type: string

  company:
    - name: company_name
      type: string
      description: Guest's company

    - name: company_id
      type: string
      description: Corporate account reference

    - name: job_title
      type: string

    - name: travel_purpose
      type: enum
      values:
        - business
        - leisure
        - conference
        - wedding
        - other

  preferences:
    - name: room_preferences
      type: object
      properties:
        floor_preference: enum [low, high, specific]
        preferred_floor: integer
        view_preference: string
        bed_preference: enum [king, queen, twin]
        smoking: enum [smoking, non_smoking]
        pillow_type: enum [firm, soft, feather, foam]
        room_temperature: enum [warm, normal, cool]

    - name: dietary_requirements
      type: array
      items:
        type: enum
        values:
          - vegetarian
          - vegan
          - halal
          - kosher
          - gluten_free
          - lactose_free
          - nut_allergy
          - shellfish_allergy

    - name: special_occasions
      type: array
      items:
        type: object
        properties:
          occasion: enum [birthday, anniversary, honeymoon, celebration]
          date: date
          notes: string

    - name: amenity_preferences
      type: array
      items: string

    - name: newspaper_preference
      type: string

  medical:
    - name: medical_conditions
      type: array
      items: string
      encrypted: true
      description: For emergency purposes

    - name: accessibility_needs
      type: array
      items:
        type: enum
        values:
          - wheelchair
          - hearing_impaired
          - visually_impaired
          - mobility_limited

  registration:
    - name: registration_card_signed
      type: boolean
      default: false

    - name: registration_card_url
      type: string
      description: Scanned registration card

    - name: terms_accepted
      type: boolean
      default: false

    - name: marketing_consent
      type: boolean
      default: false

    - name: registered_at
      type: timestamp

  stay_info:
    - name: check_in_date
      type: date

    - name: check_out_date
      type: date

    - name: room_number
      type: string

    - name: folio_id
      type: string

  audit:
    - name: created_at
      type: timestamp
      auto: true

    - name: updated_at
      type: timestamp
      auto: true

    - name: created_by
      type: string

relationships:
  - entity: property
    type: many_to_one
    required: true

  - entity: reservation
    type: many_to_one
    required: true

  - entity: guest_profile
    type: many_to_one
    description: Linked persistent profile

  - entity: folio
    type: one_to_many
    description: Guest may have multiple folios

  - entity: charge
    type: one_to_many
    description: Guest incurs charges

indexes:
  - fields: [property_id, reservation_id, is_primary_guest]
  - fields: [guest_profile_id]
  - fields: [id_type, id_number]
  - fields: [last_name, first_name]
  - fields: [loyalty_number]

business_rules:
  - rule: BR-GST-001
    description: Each reservation must have exactly one primary guest
  - rule: BR-GST-002
    description: ID required for check-in (regulatory requirement)
  - rule: BR-GST-003
    description: Guest count must not exceed room max occupancy
  - rule: BR-GST-004
    description: Blacklisted guests require manager approval

data_protection:
  gdpr_applicable: true
  retention_period: 7_years
  sensitive_fields:
    - id_number
    - visa_number
    - medical_conditions
    - date_of_birth
  encryption_required:
    - id_number
    - visa_number
    - medical_conditions
