name: booking-rules
display_name: Booking & Reservation Rules
display_name_vi: Quy tắc đặt chỗ & Giữ chỗ
version: "1.0"
domain: travel-hospitality
subdomain: booking

description: |
  Business rules governing the booking process, passenger information,
  payment timing, ticketing, and confirmation procedures.

categories:
  - name: passenger_information
    display_name: Passenger Information Rules
    rules:
      - id: BR-BK-P001
        name: Name Accuracy
        description: |
          Passenger names must match travel documents exactly.
        requirements:
          - name_format: LASTNAME/FIRSTNAME MIDDLENAME
          - match_passport_exactly: true
          - no_titles_allowed: Mr, Mrs, Ms (excluded from ticket)
          - special_characters: limited (hyphen, apostrophe allowed)
        validations:
          - first_name: required, 2-50 chars
          - last_name: required, 2-50 chars
          - middle_name: optional
        priority: critical
        compliance: [TSA_Secure_Flight, IATA_Resolution_830]

      - id: BR-BK-P002
        name: Date of Birth Requirements
        description: |
          DOB required for all passengers.
        requirements:
          - adult: 12+ years at travel date
          - child: 2-11 years at travel date
          - infant: under 2 years at travel date
          - infant_with_seat: if turns 2 during trip
        validations:
          - format: YYYY-MM-DD
          - not_future_date: true
          - reasonable_age: < 120 years
        priority: critical

      - id: BR-BK-P003
        name: Gender Requirements
        description: |
          Gender information for international travel.
        requirements:
          - domestic: optional
          - international: required
          - options: [male, female, other, undisclosed]
        destination_specific:
          - some_countries_binary_only: true
        priority: high

      - id: BR-BK-P004
        name: Contact Information
        description: |
          Contact details for booking communication.
        requirements:
          - email: required, validated format
          - phone: required, valid format with country code
          - emergency_contact: recommended for international
        validations:
          - email_verification: optional
          - sms_capable: recommended
        priority: high

      - id: BR-BK-P005
        name: Passport Information
        description: |
          Passport details for international travel.
        requirements:
          international:
            - passport_number: required
            - nationality: required
            - expiry_date: required
            - issue_country: required
          validity_rules:
            - minimum_validity: 6 months from return date
            - some_countries: 3 months
        validations:
          - format_check: country_specific
          - expiry_warning: if < 6 months
        priority: critical

  - name: booking_flow
    display_name: Booking Flow Rules
    rules:
      - id: BR-BK-F001
        name: Booking Session
        description: |
          Session management during booking process.
        session:
          - timeout: 20 minutes
          - warning: 2 minutes before expiry
          - extension: allow once, 10 minutes
        cart:
          - max_items: 1 primary (flight/hotel) + ancillaries
          - price_hold: 20 minutes
          - auto_clear: on expiry
        priority: high

      - id: BR-BK-F002
        name: Hold vs Immediate Booking
        description: |
          Rules for hold bookings vs instant confirmation.
        flight:
          - instant_ticketing: low-cost carriers
          - hold_allowed: full-service carriers
          - hold_duration: 24-72 hours
          - hold_deposit: optional or required
        hotel:
          - instant_confirmation: most properties
          - request_based: some properties
          - response_time: 24-48 hours
        priority: high

      - id: BR-BK-F003
        name: Booking Confirmation
        description: |
          Confirmation requirements and communication.
        confirmation:
          - pnr_generation: immediate
          - confirmation_email: within 5 minutes
          - sms_confirmation: optional
        content:
          - booking_reference
          - itinerary_summary
          - payment_receipt
          - terms_and_conditions
          - cancellation_policy
        priority: critical

  - name: payment_rules
    display_name: Payment Rules
    rules:
      - id: BR-BK-PAY001
        name: Payment Timing
        description: |
          When payment is collected.
        flight:
          - full_payment: at booking
          - deposit_option: some itineraries
        hotel:
          - prepaid: full payment at booking
          - pay_at_hotel: guarantee only
          - deposit: partial payment options
        package:
          - deposit: 20-50% at booking
          - balance: 30-45 days before travel
        priority: critical

      - id: BR-BK-PAY002
        name: Payment Methods
        description: |
          Accepted payment methods.
        accepted:
          credit_cards:
            - visa
            - mastercard
            - amex
            - jcb
          debit_cards:
            - visa_debit
            - mastercard_debit
          digital_wallets:
            - paypal
            - apple_pay
            - google_pay
            - momo
            - zalopay
          bank_transfer:
            - domestic_transfer
            - international_wire
          other:
            - agency_credit
            - voucher_redemption
        restrictions:
          - max_cards_per_booking: 2
          - split_payment: allowed with conditions
        priority: high

      - id: BR-BK-PAY003
        name: Payment Verification
        description: |
          Security checks for payment processing.
        checks:
          - address_verification: AVS
          - card_security_code: CVV/CVC required
          - 3d_secure: required for high-risk
        fraud_detection:
          - velocity_check: true
          - ip_geolocation: true
          - device_fingerprint: true
          - risk_scoring: enabled
        thresholds:
          - 3ds_required_above: VND 10,000,000
          - manual_review_above: VND 50,000,000
        priority: critical
        compliance: PCI_DSS

      - id: BR-BK-PAY004
        name: Payment Failure Handling
        description: |
          How to handle payment failures.
        retry_policy:
          - max_retries: 3
          - retry_interval: immediate
          - alternative_payment: offer
        on_failure:
          - hold_booking: 10 minutes
          - notify_customer: immediately
          - release_inventory: after timeout
        priority: high

  - name: ticketing_rules
    display_name: Ticketing Rules
    rules:
      - id: BR-BK-T001
        name: Ticketing Timeline
        description: |
          When tickets must be issued.
        deadlines:
          immediate_ticketing:
            - low_cost_carriers: at booking
            - promotional_fares: at booking
          time_limit:
            - gds_default: 24-72 hours
            - airline_specific: varies
            - queue_monitoring: automatic
        auto_ticketing:
          - enabled: yes
          - after_payment_confirmation: immediate
          - queue_failed: manual review
        priority: critical

      - id: BR-BK-T002
        name: Ticket Issuance
        description: |
          Rules for issuing electronic tickets.
        process:
          - verify_payment: completed
          - verify_passenger_data: complete
          - verify_inventory: confirmed
          - issue_ticket: generate 13-digit number
          - send_confirmation: email + optional SMS
        ticket_content:
          - ticket_number: unique
          - passenger_name: as booked
          - flight_coupons: per segment
          - fare_calculation: full breakdown
          - baggage_allowance: stated
        priority: critical

      - id: BR-BK-T003
        name: Void Window
        description: |
          Rules for voiding tickets before use.
        window:
          - standard: 24 hours from issue
          - some_airlines: same calendar day
          - promotional_fares: not voidable
        conditions:
          - unused_ticket: required
          - original_form_of_payment: refund method
          - void_fee: usually none
        priority: high

  - name: special_bookings
    display_name: Special Booking Rules
    rules:
      - id: BR-BK-S001
        name: Group Bookings
        description: |
          Rules for group reservations.
        definition:
          - flight_group: 10+ passengers
          - hotel_group: 10+ rooms
        process:
          - request_quote: required
          - deposit: 10-20%
          - name_list_deadline: 21-30 days
          - payment_deadline: 14-21 days
        pricing:
          - negotiated_rates: typical
          - free_places: 1 per 15-20
        priority: medium

      - id: BR-BK-S002
        name: Corporate Bookings
        description: |
          Rules for corporate/business travel.
        features:
          - corporate_rates: negotiated
          - billing: monthly invoice
          - traveler_profiles: stored
          - approval_workflow: configurable
          - reporting: detailed
        requirements:
          - corporate_agreement: signed
          - credit_check: required
          - authorized_bookers: registered
        priority: medium

      - id: BR-BK-S003
        name: Special Assistance
        description: |
          Booking rules for passengers needing assistance.
        types:
          wheelchair:
            - WCHR: can walk short distances
            - WCHS: cannot climb stairs
            - WCHC: completely immobile
          medical:
            - MEDA: medical case
            - OXYG: needs oxygen
            - STCR: stretcher
          unaccompanied_minor:
            - age: 5-11 years
            - um_service: required
            - documentation: required
        booking_process:
          - advance_notice: 48-72 hours
          - airline_confirmation: required
          - additional_fees: may apply
        priority: high

      - id: BR-BK-S004
        name: Infant Bookings
        description: |
          Rules for booking infant passengers.
        requirements:
          - age: under 2 at travel date
          - accompanied_by: adult (1 infant per adult)
          - fare: 10% of adult fare (no seat)
          - with_seat: child fare applies
        documentation:
          - birth_certificate: may be required
          - passport: for international
        restrictions:
          - bassinet_request: limited availability
          - oxygen_mask_limit: per row
        priority: high

  - name: modification_rules
    display_name: Modification Rules
    rules:
      - id: BR-BK-M001
        name: Name Corrections
        description: |
          Rules for correcting passenger names.
        allowed:
          - minor_corrections: up to 3 characters
          - spelling_errors: with documentation
          - title_changes: allowed
        not_allowed:
          - name_transfer: different person
          - significant_changes: more than 3 chars
        fees:
          - minor_correction: often free
          - significant: airline fee + service fee
        priority: high

      - id: BR-BK-M002
        name: Date/Route Changes
        description: |
          Rules for changing itinerary.
        conditions:
          - fare_rules_allow: check fare class
          - availability_exists: on new date/route
          - within_ticket_validity: required
        fees:
          - change_fee: per fare rules
          - fare_difference: pay if higher
          - fare_difference_refund: usually not
        process:
          - check_availability
          - calculate_fees
          - collect_payment
          - reissue_ticket
        priority: high

  - name: booking_validation
    display_name: Booking Validation Rules
    rules:
      - id: BR-BK-V001
        name: Duplicate Booking Check
        description: |
          Prevent duplicate bookings.
        checks:
          - same_passenger_same_flight: warn
          - same_email_same_day: warn
          - potential_duplicate: flag for review
        action:
          - warn_customer: show existing booking
          - allow_override: with confirmation
        priority: high

      - id: BR-BK-V002
        name: Minimum Connection Time
        description: |
          Validate connections meet minimum times.
        standards:
          - domestic_to_domestic: 60 minutes
          - domestic_to_international: 90 minutes
          - international_to_international: 90-120 minutes
          - terminal_change: +30 minutes
        action:
          - block_invalid: automatic
          - warn_tight: < 30 min buffer
        priority: critical

      - id: BR-BK-V003
        name: Travel Document Validity
        description: |
          Validate travel documents are valid.
        checks:
          - passport_expiry: 6 months minimum
          - visa_requirements: check destination
          - transit_visa: check route
        warnings:
          - expiring_passport: alert customer
          - visa_required: notify during booking
        priority: high

error_handling:
  - error: payment_declined
    action: retry_or_alternative
    message: "Payment was declined. Please try another card."

  - error: no_availability
    action: suggest_alternatives
    message: "This option is no longer available. Here are alternatives."

  - error: ticketing_failed
    action: manual_intervention
    message: "We're processing your booking. Confirmation within 4 hours."

  - error: duplicate_booking
    action: confirm_intent
    message: "You may already have a similar booking. Continue?"

audit_trail:
  - log_booking_creation
  - log_passenger_changes
  - log_payment_attempts
  - log_ticket_issuance
  - retain_records_7_years
