name: traveler
display_name: Traveler
display_name_vi: Hành khách
version: "1.0"
domain: travel-hospitality
subdomain: booking

description: |
  Traveler/passenger information including personal details,
  travel documents, and preferences.

attributes:
  # Identification
  - name: id
    type: uuid
    primary_key: true

  - name: user_id
    type: uuid
    nullable: true
    description: Link to registered user account

  - name: traveler_type
    type: enum
    values: [adult, child, infant]
    default: adult

  # Personal Information
  - name: title
    type: enum
    values: [Mr, Mrs, Ms, Miss, Dr, Prof]
    nullable: true

  - name: first_name
    type: string
    required: true
    max_length: 50

  - name: middle_name
    type: string
    nullable: true
    max_length: 50

  - name: last_name
    type: string
    required: true
    max_length: 50

  - name: suffix
    type: string
    nullable: true
    description: Jr, Sr, III, etc.

  - name: date_of_birth
    type: date
    required: true

  - name: gender
    type: enum
    values: [male, female, other]

  - name: nationality
    type: string
    length: 2
    description: ISO country code

  # Contact
  - name: email
    type: email
    nullable: true

  - name: phone
    type: string
    nullable: true

  - name: address
    type: object
    nullable: true
    properties:
      line1:
        type: string
      line2:
        type: string
      city:
        type: string
      state:
        type: string
      postal_code:
        type: string
      country:
        type: string

  # Travel Documents
  - name: passport_number
    type: string
    nullable: true

  - name: passport_expiry
    type: date
    nullable: true

  - name: passport_country
    type: string
    length: 2
    nullable: true
    description: Issuing country

  - name: passport_first_name
    type: string
    nullable: true
    description: Name as on passport

  - name: passport_last_name
    type: string
    nullable: true

  - name: national_id
    type: string
    nullable: true
    description: National ID card number

  - name: visa_info
    type: array
    nullable: true
    items:
      type: object
      properties:
        country:
          type: string
        visa_type:
          type: string
        visa_number:
          type: string
        issue_date:
          type: date
        expiry_date:
          type: date

  # Known Traveler Programs
  - name: redress_number
    type: string
    nullable: true
    description: TSA Redress Number

  - name: known_traveler_number
    type: string
    nullable: true
    description: Global Entry / TSA PreCheck

  # Frequent Flyer
  - name: frequent_flyer_programs
    type: array
    nullable: true
    items:
      type: object
      properties:
        airline_code:
          type: string
        program_name:
          type: string
        member_number:
          type: string
        tier_status:
          type: string

  # Hotel Loyalty
  - name: hotel_loyalty_programs
    type: array
    nullable: true
    items:
      type: object
      properties:
        chain_code:
          type: string
        program_name:
          type: string
        member_number:
          type: string
        tier_status:
          type: string

  # Preferences
  - name: seat_preference
    type: enum
    values: [window, aisle, middle, no_preference]
    default: no_preference

  - name: meal_preference
    type: enum
    values: [regular, vegetarian, vegan, halal, kosher, gluten_free, diabetic, child, infant]
    default: regular

  - name: special_assistance
    type: array
    nullable: true
    items:
      type: enum
      values: [wheelchair, deaf, blind, oxygen, stretcher, unaccompanied_minor]

  - name: dietary_restrictions
    type: array
    nullable: true
    items:
      type: string

  - name: room_preferences
    type: array
    nullable: true
    items:
      type: string

  # Emergency Contact
  - name: emergency_contact
    type: object
    nullable: true
    properties:
      name:
        type: string
      relationship:
        type: string
      phone:
        type: string
      email:
        type: string

  # For Infants
  - name: accompanying_adult_id
    type: uuid
    nullable: true
    description: Adult traveling with infant

  # Timestamps
  - name: created_at
    type: timestamp
    auto_set: true

  - name: updated_at
    type: timestamp
    auto_update: true

validations:
  - rule: first_name.length >= 2
    message: First name must be at least 2 characters

  - rule: last_name.length >= 2
    message: Last name must be at least 2 characters

  - rule: date_of_birth <= current_date
    message: Date of birth must be in past

  - rule: |
      traveler_type = 'infant' IMPLIES accompanying_adult_id IS NOT NULL
    message: Infant must have accompanying adult

  - rule: |
      passport_expiry IS NULL OR passport_expiry > current_date + 6 months
    message: Passport must be valid for at least 6 months

relationships:
  - name: user
    type: belongs_to
    entity: user
    foreign_key: user_id
    optional: true

  - name: bookings
    type: has_many_through
    entity: booking
    through: booking_travelers

  - name: tickets
    type: has_many
    entity: ticket
    foreign_key: traveler_id

  - name: accompanying_adult
    type: belongs_to
    entity: traveler
    foreign_key: accompanying_adult_id
    optional: true

indexes:
  - name: idx_traveler_user
    columns: [user_id]

  - name: idx_traveler_name
    columns: [last_name, first_name]

  - name: idx_traveler_passport
    columns: [passport_number, passport_country]

  - name: idx_traveler_dob
    columns: [date_of_birth]

computed_fields:
  - name: full_name
    formula: |
      CONCAT_WS(' ', title, first_name, middle_name, last_name, suffix)

  - name: age
    formula: |
      FLOOR(DATEDIFF(CURRENT_DATE, date_of_birth) / 365)

  - name: is_adult
    formula: age >= 12

  - name: is_child
    formula: age >= 2 AND age < 12

  - name: is_infant
    formula: age < 2

  - name: passport_valid_for_travel
    formula: |
      passport_expiry IS NOT NULL AND passport_expiry > CURRENT_DATE + INTERVAL 6 MONTH

  - name: name_as_per_document
    formula: |
      COALESCE(
        CONCAT(passport_first_name, ' ', passport_last_name),
        CONCAT(first_name, ' ', last_name)
      )

business_rules:
  - id: BR-TRV-001
    name: Name Matching
    rule: |
      Traveler name must match travel document exactly.
      Airlines require name as per passport for international travel.

  - id: BR-TRV-002
    name: Age Classification
    rule: |
      Adult: 12+ years
      Child: 2-11 years
      Infant: Under 2 years (at date of travel)

  - id: BR-TRV-003
    name: Infant Requirements
    rule: |
      - Must travel with adult
      - Max 1 infant per adult
      - Infant does not get seat (lap infant)
      - Some airlines allow bassinet request

  - id: BR-TRV-004
    name: Document Requirements
    rule: |
      Domestic: National ID or passport
      International: Valid passport (6 months validity)
      Visa requirements per destination

  - id: BR-TRV-005
    name: Unaccompanied Minor
    rule: |
      Children 5-11 traveling alone require:
      - Airline UM service
      - Guardian contact at origin and destination
      - Additional fee

events:
  - name: traveler.created
    payload: [id, user_id, full_name]

  - name: traveler.updated
    payload: [id, updated_fields]

  - name: traveler.document_expiring
    payload: [id, document_type, expiry_date]
