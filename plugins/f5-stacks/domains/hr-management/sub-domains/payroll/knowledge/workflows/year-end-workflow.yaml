name: year-end-workflow
display_name: Year-End Payroll Workflow
description: |
  Comprehensive year-end payroll workflow including 13th month bonus,
  annual reconciliation, statutory reporting, and year close procedures.

domain: hr-management
subdomain: payroll
category: workflows
version: "1.0.0"
status: active

workflow:
  id: WF-PAY-004
  name: year_end_payroll
  trigger: annual_schedule
  frequency: annual
  timing: "December - March"

  actors:
    - role: payroll_admin
      responsibilities:
        - coordinate_year_end
        - process_bonuses
        - reconcile_records

    - role: hr_manager
      responsibilities:
        - approve_bonus_eligibility
        - verify_headcount

    - role: finance_manager
      responsibilities:
        - budget_allocation
        - approve_payments
        - accounting_closure

    - role: ceo
      responsibilities:
        - approve_bonus_pool
        - approve_budget

  timeline:
    november:
      - bonus_eligibility_review
      - budget_planning
    december:
      - thirteenth_month_processing
      - final_regular_payroll
      - year_close_preparation
    january:
      - annual_reconciliation
      - ytd_verification
      - tax_data_compilation
    february_march:
      - tax_finalization
      - statutory_reporting
      - audit_preparation

  stages:
    # 13th Month Bonus Processing
    - id: STAGE-1
      name: thirteenth_month_bonus
      description: Process mandatory 13th month salary (Tet bonus)
      timing: "December"

      steps:
        - id: STEP-1.1
          name: determine_eligibility
          actor: hr_manager
          action: review_eligibility
          criteria:
            standard:
              - employment_status: active
              - service_period: ">= 12 months"
              - eligibility: full_bonus
            prorated:
              - employment_status: active
              - service_period: "< 12 months"
              - eligibility: prorated_by_months
            excluded:
              - employment_status: [terminated, resigned_before_payment]
              - disciplinary_status: severe_violation
          outputs:
            - eligible_employee_list
            - proration_factors

        - id: STEP-1.2
          name: calculate_bonus_amounts
          actor: system
          action: compute_thirteenth_month
          calculation:
            full_bonus: "base_salary_december"
            prorated: "base_salary_december * (service_months / 12)"
          includes:
            - basic_salary
            - fixed_allowances_per_policy
          excludes:
            - overtime
            - one_time_bonuses
            - variable_allowances
          outputs:
            - bonus_amounts_per_employee

        - id: STEP-1.3
          name: budget_verification
          actor: finance_manager
          action: verify_budget
          inputs:
            - total_bonus_amount
            - budget_allocation
          outputs:
            - budget_status
            - approval_status

        - id: STEP-1.4
          name: ceo_approval
          actor: ceo
          action: approve_bonus_pool
          inputs:
            - bonus_summary
            - budget_impact
          outputs:
            - final_approval

        - id: STEP-1.5
          name: process_bonus_payroll
          actor: payroll_admin
          action: run_bonus_payroll
          run_type: thirteenth_month
          processing:
            - create_bonus_records
            - calculate_tax
            - generate_payslips
          outputs:
            - bonus_payroll_run_id
            - bonus_payslips

        - id: STEP-1.6
          name: disburse_bonus
          actor: finance_manager
          action: process_payment
          timing: "Before Tet holiday"
          outputs:
            - payment_confirmation

    # Annual Reconciliation
    - id: STAGE-2
      name: annual_reconciliation
      description: Reconcile all payroll records for the year
      timing: "January"

      steps:
        - id: STEP-2.1
          name: verify_ytd_totals
          actor: system
          action: reconcile_ytd
          reconciliation_points:
            - gross_earnings_ytd
            - tax_withheld_ytd
            - insurance_ee_ytd
            - insurance_er_ytd
            - net_pay_ytd
          outputs:
            - ytd_verification_report
            - discrepancy_list

        - id: STEP-2.2
          name: resolve_discrepancies
          actor: payroll_admin
          action: investigate_and_fix
          inputs:
            - discrepancy_list
          actions:
            - trace_source_of_error
            - apply_corrections
            - document_adjustments
          outputs:
            - resolved_discrepancies
            - adjustment_records

        - id: STEP-2.3
          name: reconcile_insurance
          actor: payroll_admin
          action: verify_bhxh_contributions
          checks:
            - monthly_declarations_match_payroll
            - employee_records_match_bhxh
            - contribution_bases_correct
          outputs:
            - bhxh_reconciliation_report

        - id: STEP-2.4
          name: reconcile_tax
          actor: payroll_admin
          action: verify_tax_withholding
          checks:
            - monthly_declarations_match_payroll
            - bracket_applications_correct
            - deductions_properly_applied
          outputs:
            - tax_reconciliation_report

        - id: STEP-2.5
          name: verify_headcount
          actor: hr_manager
          action: confirm_employee_data
          checks:
            - active_employees_match
            - terminated_employees_processed
            - new_hires_correctly_prorated
          outputs:
            - headcount_verification

    # Statutory Reporting
    - id: STAGE-3
      name: statutory_reports
      description: Prepare and submit required statutory reports
      timing: "January - March"

      steps:
        - id: STEP-3.1
          name: bhxh_annual_report
          actor: payroll_admin
          action: prepare_bhxh_annual
          includes:
            - total_contributions_by_type
            - employee_change_summary
            - adjustment_summary
          deadline: "January 31"
          outputs:
            - bhxh_annual_report

        - id: STEP-3.2
          name: pit_annual_finalization
          actor: payroll_admin
          action: prepare_tax_finalization
          reference: tax-filing-workflow
          deadline: "March 31"
          outputs:
            - pit_finalization_report

        - id: STEP-3.3
          name: labor_statistics_report
          actor: hr_manager
          action: prepare_labor_report
          includes:
            - headcount_by_category
            - salary_statistics
            - turnover_data
          deadline: varies
          outputs:
            - labor_statistics_report

        - id: STEP-3.4
          name: submit_all_reports
          actor: payroll_admin
          action: submit_to_authorities
          submissions:
            - bhxh_office
            - tax_authority
            - labor_department
          outputs:
            - submission_receipts

    # Year Close
    - id: STAGE-4
      name: year_close
      description: Close payroll year and prepare for new year
      timing: "December 31"

      steps:
        - id: STEP-4.1
          name: close_final_period
          actor: payroll_admin
          action: close_december_period
          inputs:
            - december_payroll_run
          actions:
            - finalize_all_payslips
            - lock_period
            - archive_records
          outputs:
            - period_closed_confirmation

        - id: STEP-4.2
          name: lock_annual_records
          actor: system
          action: apply_year_lock
          locks:
            - all_payslips
            - all_tax_calculations
            - all_insurance_records
          outputs:
            - year_locked_status

        - id: STEP-4.3
          name: reset_ytd_counters
          actor: system
          action: initialize_new_year
          resets:
            - ytd_gross
            - ytd_tax
            - ytd_insurance
            - ytd_net
            - overtime_hours_ytd
          effective: "January 1"
          outputs:
            - new_year_initialized

        - id: STEP-4.4
          name: carry_forward_items
          actor: system
          action: process_carryforwards
          items:
            - outstanding_loans
            - suspended_deductions
            - unused_leave (if_applicable)
          outputs:
            - carryforward_records

        - id: STEP-4.5
          name: accounting_entries
          actor: finance_manager
          action: post_year_end_entries
          entries:
            - accrued_salaries
            - accrued_bonuses
            - payroll_liabilities
            - provision_adjustments
          outputs:
            - journal_entries

    # New Year Setup
    - id: STAGE-5
      name: new_year_setup
      description: Configure system for new year
      timing: "January"

      steps:
        - id: STEP-5.1
          name: update_parameters
          actor: payroll_admin
          action: configure_new_year
          updates:
            - minimum_wages (if_changed)
            - tax_brackets (if_changed)
            - insurance_rates (if_changed)
            - holiday_calendar
          outputs:
            - parameters_updated

        - id: STEP-5.2
          name: create_periods
          actor: system
          action: generate_periods
          creates: "12 monthly periods"
          outputs:
            - period_ids_for_year

        - id: STEP-5.3
          name: review_salary_structures
          actor: hr_manager
          action: verify_structures
          checks:
            - minimum_wage_compliance
            - budget_alignment
          outputs:
            - structure_review_report

        - id: STEP-5.4
          name: communicate_changes
          actor: hr_manager
          action: notify_employees
          topics:
            - parameter_changes
            - policy_updates
            - calendar_changes
          outputs:
            - communication_sent

    # Audit Preparation
    - id: STAGE-6
      name: audit_preparation
      description: Prepare documentation for audits
      timing: "Ongoing"

      steps:
        - id: STEP-6.1
          name: compile_audit_package
          actor: payroll_admin
          action: prepare_documentation
          documents:
            - payroll_summary_by_month
            - tax_declaration_copies
            - bhxh_declaration_copies
            - bank_payment_records
            - approval_records
          outputs:
            - audit_package

        - id: STEP-6.2
          name: internal_audit_review
          actor: finance_manager
          action: conduct_internal_audit
          scope:
            - calculation_accuracy
            - compliance_verification
            - control_effectiveness
          outputs:
            - internal_audit_report

        - id: STEP-6.3
          name: address_findings
          actor: payroll_admin
          action: remediate_issues
          inputs:
            - audit_findings
          outputs:
            - remediation_plan
            - completed_actions

  performance_bonus_process:
    description: "Optional performance bonus processing"
    timing: "Per company policy"

    steps:
      - id: PERF-1
        name: collect_ratings
        actor: hr_manager
        action: gather_performance_data
        inputs:
          - performance_reviews
          - ratings
          - recommendations

      - id: PERF-2
        name: calculate_bonus_pool
        actor: finance_manager
        action: determine_budget
        formula: "Based on company performance and budget"

      - id: PERF-3
        name: allocate_bonuses
        actor: hr_manager
        action: distribute_pool
        method: "Per performance rating"

      - id: PERF-4
        name: approve_and_process
        actor: ceo
        action: final_approval
        outputs:
          - approved_bonus_list

  notifications:
    - event: bonus_eligibility_review
      recipients: [hr_manager, department_managers]
      timing: November
      template: "Please review 13th month bonus eligibility"

    - event: year_end_approaching
      recipients: [payroll_admin, finance_manager]
      timing: December_15
      template: "Year-end payroll close in 2 weeks"

    - event: thirteenth_month_paid
      recipients: [all_employees]
      template: "13th month salary has been deposited"

    - event: tax_certificate_ready
      recipients: [all_employees]
      timing: March
      template: "Your annual tax certificate is available"

  exception_handling:
    bonus_budget_shortfall:
      detection: "Budget insufficient for full bonuses"
      action:
        - escalate_to_ceo
        - propose_alternatives
      options:
        - partial_bonus_now_remainder_later
        - reduce_bonus_percentage
        - seek_additional_budget

    reconciliation_discrepancy:
      detection: "Material discrepancy in reconciliation"
      action:
        - immediate_investigation
        - document_findings
        - implement_corrections
      escalation: finance_director

    late_statutory_submission:
      detection: "Missed reporting deadline"
      action:
        - submit_immediately
        - document_reason
        - calculate_penalties
      notification: ceo

  audit:
    logged_events:
      - bonus_approvals
      - reconciliation_results
      - year_close_actions
      - parameter_changes

    retention: 10_years

  compliance:
    - standard: Vietnam_Labor_Code
      requirement: 13th month salary timing
    - standard: BHXH_Law
      requirement: Annual reporting
    - standard: PIT_Law
      requirement: Annual finalization
    - standard: Accounting_Standards
      requirement: Year-end closure
