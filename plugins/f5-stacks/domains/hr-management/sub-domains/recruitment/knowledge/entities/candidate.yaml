name: candidate
display_name: Candidate
description: |
  A person who has expressed interest in employment. Candidates may apply to
  multiple positions and be tracked across the talent pool for future opportunities.

domain: hr-management
subdomain: recruitment
category: entities
version: "1.0.0"
status: active

entity:
  name: Candidate
  table_name: candidates
  primary_key: id
  natural_key: candidate_id

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true

    - name: candidate_id
      type: string
      length: 20
      unique: true
      format: "CND-{YYYYMMDD}-{NNNN}"
      description: Human-readable candidate ID

    - name: status
      type: enum
      values: [active, inactive, hired, blacklisted, do_not_contact]
      default: active

    - name: source
      type: enum
      values: [career_site, job_board, referral, agency, linkedin, direct, event, university, internal]
      required: true
      description: How candidate was sourced

    - name: source_detail
      type: string
      length: 200
      description: Specific source (e.g., "LinkedIn Campaign Q4")

    # Personal Information
    - name: first_name
      type: string
      length: 100
      required: true

    - name: last_name
      type: string
      length: 100
      required: true

    - name: full_name
      type: string
      length: 200
      computed: true

    - name: email
      type: string
      length: 255
      required: true
      unique: true
      format: email

    - name: phone
      type: string
      length: 50

    - name: phone_secondary
      type: string
      length: 50

    # Address
    - name: address_line1
      type: string
      length: 255

    - name: address_line2
      type: string
      length: 255

    - name: city
      type: string
      length: 100

    - name: state_province
      type: string
      length: 100

    - name: postal_code
      type: string
      length: 20

    - name: country
      type: string
      length: 100

    # Online Presence
    - name: linkedin_url
      type: string
      length: 500

    - name: portfolio_url
      type: string
      length: 500

    - name: github_url
      type: string
      length: 500

    - name: personal_website
      type: string
      length: 500

    # Professional Information
    - name: current_title
      type: string
      length: 200

    - name: current_company
      type: string
      length: 200

    - name: years_of_experience
      type: integer
      description: Total years of professional experience

    - name: education_level
      type: enum
      values: [high_school, associate, bachelor, master, doctorate, other]

    - name: highest_degree
      type: string
      length: 200

    - name: field_of_study
      type: string
      length: 200

    # Skills & Languages
    - name: skills
      type: jsonb
      description: Skills with proficiency levels
      example: |
        [
          {"skill": "Python", "years": 5, "level": "expert"},
          {"skill": "SQL", "years": 3, "level": "intermediate"}
        ]

    - name: languages
      type: jsonb
      description: Language proficiencies
      example: |
        [
          {"language": "English", "proficiency": "native"},
          {"language": "Vietnamese", "proficiency": "fluent"}
        ]

    - name: certifications
      type: jsonb
      description: Professional certifications

    # Resume
    - name: primary_resume_id
      type: uuid
      description: Current/primary resume

    - name: resume_text
      type: text
      description: Parsed resume content for search

    # Preferences
    - name: desired_salary_min
      type: decimal
      precision: 15
      scale: 2

    - name: desired_salary_max
      type: decimal
      precision: 15
      scale: 2

    - name: salary_currency
      type: string
      length: 3
      default: "USD"

    - name: desired_locations
      type: jsonb
      description: Preferred work locations

    - name: open_to_remote
      type: boolean
      default: false

    - name: open_to_relocation
      type: boolean
      default: false

    - name: notice_period_days
      type: integer
      description: Current notice period in days

    - name: available_from
      type: date
      description: Earliest start date

    - name: work_authorization
      type: string
      length: 100
      description: Work authorization status

    - name: requires_sponsorship
      type: boolean
      default: false

    # Engagement
    - name: total_applications
      type: integer
      default: 0

    - name: last_application_at
      type: timestamp

    - name: last_activity_at
      type: timestamp

    - name: last_contacted_at
      type: timestamp

    - name: email_opt_in
      type: boolean
      default: true

    - name: sms_opt_in
      type: boolean
      default: false

    # Tags & Pools
    - name: tags
      type: jsonb
      description: Custom tags for categorization

    - name: talent_pool_ids
      type: jsonb
      description: Talent pools candidate belongs to

    # GDPR/Privacy
    - name: consent_given
      type: boolean
      default: false
      description: Data processing consent

    - name: consent_date
      type: timestamp

    - name: consent_source
      type: string
      length: 100
      description: Where consent was collected

    - name: data_retention_until
      type: date
      description: Date to delete if not hired

    - name: deletion_requested
      type: boolean
      default: false

    - name: deletion_requested_at
      type: timestamp

    # Referral
    - name: referred_by_employee_id
      type: uuid
      description: If referral, who referred

    - name: referral_id
      type: uuid
      description: Associated referral record

    # Internal Notes
    - name: notes
      type: text
      description: General notes about candidate

    - name: blacklist_reason
      type: text
      description: If blacklisted, reason why

    # Timestamps
    - name: created_at
      type: timestamp
      required: true
      default: now()

    - name: updated_at
      type: timestamp
      required: true
      default: now()

  relationships:
    - name: applications
      type: has_many
      entity: Application
      foreign_key: candidate_id

    - name: resumes
      type: has_many
      entity: Resume
      foreign_key: candidate_id

    - name: primary_resume
      type: belongs_to
      entity: Resume
      foreign_key: primary_resume_id

    - name: interviews
      type: has_many
      entity: Interview
      foreign_key: candidate_id

    - name: assessments
      type: has_many
      entity: Assessment
      foreign_key: candidate_id

    - name: offers
      type: has_many
      entity: Offer
      foreign_key: candidate_id

    - name: referral
      type: belongs_to
      entity: Referral
      foreign_key: referral_id

    - name: referred_by
      type: belongs_to
      entity: Employee
      foreign_key: referred_by_employee_id

    - name: talent_pools
      type: many_to_many
      entity: TalentPool
      through: candidate_talent_pools

  indexes:
    - columns: [candidate_id]
      unique: true
    - columns: [email]
      unique: true
    - columns: [status]
    - columns: [source]
    - columns: [current_company]
    - columns: [created_at]
    - columns: [last_activity_at]
    - type: fulltext
      columns: [resume_text, full_name, current_title]

  validations:
    - field: email
      rule: format
      pattern: email
      message: "Invalid email format"

    - field: consent_given
      rule: required_if
      condition: source_is_gdpr_region
      message: "Consent required for GDPR compliance"

  hooks:
    before_save:
      - compute_full_name
      - normalize_email
      - validate_work_authorization

    after_create:
      - send_acknowledgment_email
      - add_to_default_pool
      - schedule_retention_review

  privacy:
    pii_fields: [first_name, last_name, email, phone, address_line1, address_line2]
    retention_policy: 2_years_after_last_activity
    deletion_cascade: [applications, resumes, interviews, assessments]

compliance:
  - standard: GDPR
    requirements:
      - Collect explicit consent
      - Support right to deletion
      - Define retention period
      - Anonymize after retention

  - standard: EEO
    requirements:
      - Do not store protected characteristics in main record
      - Separate voluntary self-identification data
