name: job-requisition
display_name: Job Requisition
description: |
  A formal request to hire for a position. The requisition defines the job requirements,
  compensation, headcount, and tracks the approval process before recruiting begins.

domain: hr-management
subdomain: recruitment
category: entities
version: "1.0.0"
status: active

entity:
  name: JobRequisition
  table_name: job_requisitions
  primary_key: id
  natural_key: requisition_number

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true
      description: Unique identifier

    - name: requisition_number
      type: string
      length: 20
      unique: true
      format: "REQ-{YYYYMMDD}-{NNNN}"
      description: Human-readable requisition number

    - name: status
      type: enum
      values: [draft, pending_approval, approved, open, on_hold, filled, cancelled]
      default: draft
      description: Current status of requisition

    - name: requisition_type
      type: enum
      values: [new_position, replacement, expansion, contract, intern]
      required: true
      description: Type of hiring need

    # Position Details
    - name: job_title
      type: string
      length: 200
      required: true
      description: Title of the position

    - name: job_code
      type: string
      length: 50
      description: Internal job code/level

    - name: department_id
      type: uuid
      required: true
      description: Department the position belongs to

    - name: team_id
      type: uuid
      description: Specific team within department

    - name: reports_to_position_id
      type: uuid
      description: Manager position this role reports to

    - name: location_id
      type: uuid
      required: true
      description: Primary work location

    - name: is_remote
      type: boolean
      default: false
      description: Whether position allows remote work

    - name: remote_type
      type: enum
      values: [on_site, hybrid, fully_remote]
      default: on_site
      description: Remote work arrangement

    - name: employment_type
      type: enum
      values: [full_time, part_time, contract, intern, temporary]
      required: true
      description: Type of employment

    # Job Description
    - name: job_description
      type: text
      required: true
      description: Full job description

    - name: responsibilities
      type: jsonb
      description: Array of key responsibilities
      example: ["Lead team of 5 engineers", "Design system architecture"]

    - name: requirements
      type: jsonb
      description: Required qualifications
      example: ["5+ years experience", "Bachelor's degree"]

    - name: preferred_qualifications
      type: jsonb
      description: Nice-to-have qualifications

    - name: skills_required
      type: jsonb
      description: Required skills with proficiency levels
      example: [{"skill": "Python", "level": "expert"}]

    # Compensation
    - name: salary_range_min
      type: decimal
      precision: 15
      scale: 2
      description: Minimum salary

    - name: salary_range_max
      type: decimal
      precision: 15
      scale: 2
      description: Maximum salary

    - name: salary_currency
      type: string
      length: 3
      default: "USD"
      description: Currency code

    - name: salary_frequency
      type: enum
      values: [hourly, monthly, annual]
      default: annual
      description: Salary payment frequency

    - name: bonus_eligible
      type: boolean
      default: false
      description: Whether position is bonus eligible

    - name: bonus_target_percent
      type: decimal
      precision: 5
      scale: 2
      description: Target bonus percentage

    - name: equity_eligible
      type: boolean
      default: false
      description: Whether position is equity eligible

    - name: benefits_package
      type: string
      length: 50
      description: Benefits package tier

    # Headcount
    - name: positions_requested
      type: integer
      default: 1
      description: Number of positions to fill

    - name: positions_filled
      type: integer
      default: 0
      description: Number of positions filled so far

    - name: target_start_date
      type: date
      description: Desired start date for new hire

    # Request Info
    - name: requested_by_id
      type: uuid
      required: true
      description: User who created the requisition

    - name: requested_date
      type: timestamp
      required: true
      description: When requisition was created

    - name: reason_for_opening
      type: text
      description: Business justification

    - name: replacement_for
      type: string
      length: 200
      description: If replacement, who is being replaced

    # Approval
    - name: approval_chain
      type: jsonb
      description: Array of approval steps
      example: |
        [
          {"user_id": "xxx", "role": "manager", "status": "approved", "date": "..."},
          {"user_id": "yyy", "role": "hr", "status": "pending", "date": null}
        ]

    - name: approved_budget
      type: decimal
      precision: 15
      scale: 2
      description: Approved compensation budget

    - name: final_approved_by_id
      type: uuid
      description: Final approver

    - name: final_approved_at
      type: timestamp
      description: Final approval timestamp

    # Priority & Tracking
    - name: priority
      type: enum
      values: [low, medium, high, urgent]
      default: medium
      description: Hiring priority

    - name: target_fill_date
      type: date
      description: Target date to fill position

    - name: days_open
      type: integer
      computed: true
      description: Days since requisition opened

    # Assignment
    - name: assigned_recruiter_id
      type: uuid
      description: Primary recruiter assigned

    - name: hiring_manager_id
      type: uuid
      required: true
      description: Hiring manager for position

    # Timestamps
    - name: opened_at
      type: timestamp
      description: When requisition was opened for sourcing

    - name: filled_at
      type: timestamp
      description: When all positions were filled

    - name: cancelled_at
      type: timestamp
      description: When requisition was cancelled

    - name: cancellation_reason
      type: text
      description: Reason for cancellation

    - name: created_at
      type: timestamp
      required: true
      default: now()

    - name: updated_at
      type: timestamp
      required: true
      default: now()

  relationships:
    - name: department
      type: belongs_to
      entity: Department
      foreign_key: department_id

    - name: location
      type: belongs_to
      entity: Location
      foreign_key: location_id

    - name: hiring_manager
      type: belongs_to
      entity: User
      foreign_key: hiring_manager_id

    - name: recruiter
      type: belongs_to
      entity: User
      foreign_key: assigned_recruiter_id

    - name: requested_by
      type: belongs_to
      entity: User
      foreign_key: requested_by_id

    - name: job_postings
      type: has_many
      entity: JobPosting
      foreign_key: requisition_id

    - name: applications
      type: has_many
      entity: Application
      foreign_key: requisition_id

    - name: offers
      type: has_many
      entity: Offer
      foreign_key: requisition_id

  indexes:
    - columns: [requisition_number]
      unique: true
    - columns: [status]
    - columns: [department_id]
    - columns: [hiring_manager_id]
    - columns: [assigned_recruiter_id]
    - columns: [created_at]

  state_machine:
    field: status
    initial: draft
    transitions:
      - from: draft
        to: pending_approval
        action: submit_for_approval
        guards: [has_required_fields, has_approvers]

      - from: pending_approval
        to: approved
        action: approve
        guards: [all_approvers_approved]

      - from: pending_approval
        to: draft
        action: return_for_revision
        triggers: [notify_requester]

      - from: approved
        to: open
        action: open_requisition
        triggers: [assign_recruiter, notify_hiring_manager]

      - from: open
        to: on_hold
        action: put_on_hold
        triggers: [pause_postings, notify_applicants]

      - from: on_hold
        to: open
        action: resume
        triggers: [reactivate_postings]

      - from: open
        to: filled
        action: mark_filled
        guards: [all_positions_filled]
        triggers: [close_postings, notify_stakeholders]

      - from: [draft, pending_approval, approved, open, on_hold]
        to: cancelled
        action: cancel
        triggers: [close_postings, notify_applicants, notify_stakeholders]

  validations:
    - field: salary_range_max
      rule: greater_than_or_equal
      compare_to: salary_range_min
      message: "Maximum salary must be >= minimum salary"

    - field: positions_requested
      rule: minimum
      value: 1
      message: "Must request at least 1 position"

    - field: target_start_date
      rule: future_date
      message: "Target start date must be in the future"

  audit:
    enabled: true
    fields: [status, approved_budget, assigned_recruiter_id, priority]

compliance:
  - standard: EEO
    requirement: Job descriptions must not contain discriminatory language
  - standard: internal_policy
    requirement: All requisitions require documented business justification
