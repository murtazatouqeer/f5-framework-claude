name: interview
display_name: Interview
description: |
  A scheduled interview session between interviewers and a candidate.
  Tracks scheduling, participation, evaluation, and feedback.

domain: hr-management
subdomain: recruitment
category: entities
version: "1.0.0"
status: active

entity:
  name: Interview
  table_name: interviews
  primary_key: id

  attributes:
    # Identity
    - name: id
      type: uuid
      primary_key: true

    - name: interview_id
      type: string
      length: 20
      unique: true
      format: "INT-{YYYYMMDD}-{NNNN}"

    - name: application_id
      type: uuid
      required: true

    - name: candidate_id
      type: uuid
      required: true

    # Status
    - name: status
      type: enum
      values: [draft, scheduled, confirmed, in_progress, completed, cancelled, no_show, rescheduled]
      default: draft

    - name: interview_type
      type: enum
      values: [phone_screen, video, onsite, panel, technical, behavioral, cultural, case_study, final, executive]
      required: true

    - name: interview_round
      type: integer
      default: 1
      description: Which round (1, 2, 3, etc.)

    # Schedule
    - name: scheduled_date
      type: date
      required: true

    - name: scheduled_start_time
      type: time
      required: true

    - name: scheduled_end_time
      type: time
      required: true

    - name: duration_minutes
      type: integer
      required: true
      description: Planned duration

    - name: timezone
      type: string
      length: 50
      default: "UTC"

    - name: actual_start_time
      type: timestamp

    - name: actual_end_time
      type: timestamp

    - name: actual_duration_minutes
      type: integer

    # Location / Meeting
    - name: location_type
      type: enum
      values: [phone, video, in_person]
      required: true

    - name: location
      type: string
      length: 500
      description: Physical location or meeting room

    - name: video_platform
      type: enum
      values: [zoom, teams, meet, webex, other]

    - name: meeting_link
      type: string
      length: 1000

    - name: meeting_id
      type: string
      length: 100

    - name: meeting_password
      type: string
      length: 50

    - name: dial_in_number
      type: string
      length: 50

    # Calendar
    - name: calendar_event_id
      type: string
      length: 200
      description: External calendar event ID

    - name: calendar_synced
      type: boolean
      default: false

    # Participants
    - name: interviewers
      type: jsonb
      required: true
      description: Array of interviewers
      example: |
        [
          {"user_id": "xxx", "role": "hiring_manager", "is_lead": true, "confirmed": true},
          {"user_id": "yyy", "role": "technical", "is_lead": false, "confirmed": true},
          {"user_id": "zzz", "role": "peer", "is_lead": false, "confirmed": false}
        ]

    - name: lead_interviewer_id
      type: uuid
      description: Primary interviewer

    - name: coordinator_id
      type: uuid
      description: Who scheduled the interview

    # Candidate Confirmation
    - name: candidate_confirmed
      type: boolean
      default: false

    - name: candidate_confirmed_at
      type: timestamp

    - name: confirmation_sent_at
      type: timestamp

    - name: reminder_sent_at
      type: timestamp

    # Interview Guide
    - name: interview_guide_id
      type: uuid
      description: Structured interview guide template

    - name: competencies_to_assess
      type: jsonb
      description: Which competencies to evaluate
      example: ["technical_skills", "problem_solving", "communication", "leadership"]

    - name: questions
      type: jsonb
      description: Pre-defined questions for this interview

    # Evaluation
    - name: overall_rating
      type: decimal
      precision: 3
      scale: 2
      description: Average rating (1-5)

    - name: recommendation
      type: enum
      values: [strong_yes, yes, neutral, no, strong_no]

    - name: feedback_summary
      type: text
      description: Overall feedback summary

    - name: competency_scores
      type: jsonb
      description: Scores by competency
      example: |
        [
          {"competency": "technical_skills", "score": 4, "notes": "Strong Python skills"},
          {"competency": "communication", "score": 3.5, "notes": "Clear but could improve"}
        ]

    - name: strengths
      type: jsonb
      description: Key strengths identified

    - name: concerns
      type: jsonb
      description: Areas of concern

    - name: feedback_submitted
      type: boolean
      default: false

    - name: feedback_submitted_at
      type: timestamp

    - name: feedback_deadline
      type: timestamp
      description: When feedback is due

    # Recording
    - name: recording_url
      type: string
      length: 1000

    - name: recording_consent
      type: boolean
      default: false

    - name: transcript_url
      type: string
      length: 1000

    - name: notes_url
      type: string
      length: 1000

    # Rescheduling
    - name: reschedule_count
      type: integer
      default: 0

    - name: reschedule_reason
      type: text

    - name: original_interview_id
      type: uuid
      description: If rescheduled, original interview

    # Cancellation
    - name: cancelled_by_id
      type: uuid

    - name: cancelled_at
      type: timestamp

    - name: cancellation_reason
      type: text

    # No Show
    - name: no_show_by
      type: enum
      values: [candidate, interviewer]

    - name: no_show_reported_at
      type: timestamp

    # Timestamps
    - name: created_at
      type: timestamp
      required: true
      default: now()

    - name: updated_at
      type: timestamp
      required: true
      default: now()

  relationships:
    - name: application
      type: belongs_to
      entity: Application
      foreign_key: application_id

    - name: candidate
      type: belongs_to
      entity: Candidate
      foreign_key: candidate_id

    - name: lead_interviewer
      type: belongs_to
      entity: User
      foreign_key: lead_interviewer_id

    - name: coordinator
      type: belongs_to
      entity: User
      foreign_key: coordinator_id

    - name: scorecards
      type: has_many
      entity: InterviewScorecard
      foreign_key: interview_id

    - name: original_interview
      type: belongs_to
      entity: Interview
      foreign_key: original_interview_id

  indexes:
    - columns: [interview_id]
      unique: true
    - columns: [application_id]
    - columns: [candidate_id]
    - columns: [status]
    - columns: [scheduled_date]
    - columns: [lead_interviewer_id]
    - columns: [coordinator_id]

  state_machine:
    field: status
    initial: draft
    transitions:
      - from: draft
        to: scheduled
        action: schedule
        guards: [has_interviewers, has_time_slot]
        triggers: [send_invites, create_calendar_event]

      - from: scheduled
        to: confirmed
        action: confirm
        guards: [candidate_confirmed, interviewers_confirmed]

      - from: [scheduled, confirmed]
        to: in_progress
        action: start
        triggers: [log_start_time]

      - from: in_progress
        to: completed
        action: complete
        triggers: [log_end_time, notify_for_feedback]

      - from: [scheduled, confirmed]
        to: rescheduled
        action: reschedule
        triggers: [cancel_calendar_event, increment_reschedule_count]

      - from: rescheduled
        to: scheduled
        action: reschedule_complete
        triggers: [send_invites, create_calendar_event]

      - from: [scheduled, confirmed]
        to: cancelled
        action: cancel
        triggers: [cancel_calendar_event, notify_participants]

      - from: [scheduled, confirmed]
        to: no_show
        action: mark_no_show
        triggers: [record_no_show, notify_coordinator]

  validations:
    - field: scheduled_end_time
      rule: after
      compare_to: scheduled_start_time
      message: "End time must be after start time"

    - field: duration_minutes
      rule: minimum
      value: 15
      message: "Interview must be at least 15 minutes"

    - field: interviewers
      rule: min_length
      value: 1
      message: "At least one interviewer required"

  audit:
    enabled: true
    fields: [status, scheduled_date, interviewers, overall_rating, recommendation]

compliance:
  - standard: interview_fairness
    requirement: Use structured interview guides for consistency
  - standard: recording_consent
    requirement: Obtain consent before recording
