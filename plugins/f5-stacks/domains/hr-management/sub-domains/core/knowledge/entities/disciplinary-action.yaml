name: disciplinary-action
display_name: Disciplinary Action
description: |
  Disciplinary action entity for managing employee misconduct cases,
  warnings, sanctions, and performance improvement plans.

domain: hr-management
subdomain: core
category: entities
version: "1.0.0"
status: active

compliance:
  vietnam_labor_code:
    disciplinary_forms:
      - reprimand
      - deferment_of_wage_increase  # Max 6 months
      - demotion  # Max 6 months
      - dismissal
    statute_of_limitations: "6 months from violation (12 months for complex cases)"
    appeal_right: "Employee has right to appeal"
    due_process: "Required hearing before action"

entity:
  name: DisciplinaryAction
  table_name: disciplinary_actions
  primary_key: id

  attributes:
    # Identification
    identification:
      - name: id
        type: uuid
        required: true
        description: "System-generated unique identifier"

      - name: case_number
        type: string
        required: true
        unique: true
        format: "DIS-YYYY-XXXXXX"
        description: "Disciplinary case number"

      - name: employee_id
        type: uuid
        required: true
        foreign_key: employees.id
        description: "Employee subject to action"

      - name: status
        type: enum
        required: true
        default: "reported"
        values:
          - reported
          - under_investigation
          - hearing_scheduled
          - hearing_completed
          - decision_pending
          - action_issued
          - appealed
          - closed
          - withdrawn
        description: "Case status"

    # Incident
    incident:
      - name: incident_date
        type: date
        required: true
        description: "Date of incident/violation"

      - name: incident_time
        type: time
        description: "Time of incident"

      - name: incident_location
        type: string
        description: "Location of incident"

      - name: reported_date
        type: date
        required: true
        description: "Date incident was reported"

      - name: reported_by_id
        type: uuid
        foreign_key: employees.id
        description: "Person who reported"

    # Violation
    violation:
      - name: violation_type
        type: enum
        required: true
        values:
          - attendance
          - performance
          - misconduct
          - policy_violation
          - harassment
          - discrimination
          - theft
          - fraud
          - insubordination
          - safety_violation
          - substance_abuse
          - confidentiality_breach
          - other
        description: "Type of violation"

      - name: violation_severity
        type: enum
        required: true
        values:
          - minor
          - moderate
          - serious
          - gross
        description: "Severity level"

      - name: violation_description
        type: text
        required: true
        description: "Detailed description of violation"

      - name: policy_violated
        type: string
        description: "Company policy violated"

      - name: policy_section
        type: string
        description: "Specific policy section"

    # Evidence
    evidence:
      - name: evidence_documents
        type: jsonb
        description: "Array of evidence documents"
        schema:
          type: array
          items:
            document_id: uuid
            document_type: string
            description: string
            upload_date: date

      - name: witnesses
        type: jsonb
        description: "Array of witnesses"
        schema:
          type: array
          items:
            witness_id: uuid
            witness_name: string
            statement: text
            statement_date: date

    # Investigation
    investigation:
      - name: investigation_required
        type: boolean
        default: true
        description: "Whether investigation is required"

      - name: investigator_id
        type: uuid
        foreign_key: employees.id
        description: "Person conducting investigation"

      - name: investigation_start_date
        type: date
        description: "Investigation start date"

      - name: investigation_end_date
        type: date
        description: "Investigation end date"

      - name: investigation_findings
        type: text
        description: "Investigation findings"

      - name: investigation_recommendation
        type: text
        description: "Investigator's recommendation"

    # Hearing
    hearing:
      - name: hearing_required
        type: boolean
        default: true
        description: "Whether hearing is required"

      - name: hearing_date
        type: date
        description: "Disciplinary hearing date"

      - name: hearing_time
        type: time
        description: "Hearing time"

      - name: hearing_location
        type: string
        description: "Hearing location"

      - name: hearing_committee
        type: jsonb
        description: "Committee members"
        schema:
          type: array
          items:
            member_id: uuid
            role: string  # chair, member, hr_rep

      - name: employee_response
        type: text
        description: "Employee's response/defense"

      - name: employee_representative
        type: string
        description: "Employee's representative (union/lawyer)"

      - name: hearing_minutes
        type: text
        description: "Minutes of hearing"

      - name: hearing_outcome
        type: text
        description: "Hearing outcome"

    # Decision
    decision:
      - name: decision_date
        type: date
        description: "Date decision was made"

      - name: decision_maker_id
        type: uuid
        foreign_key: employees.id
        description: "Person who made decision"

      - name: action_type
        type: enum
        required: true
        values:
          - no_action
          - verbal_warning
          - written_warning
          - final_warning
          - reprimand
          - salary_freeze
          - demotion
          - suspension
          - performance_improvement_plan
          - termination
        description: "Type of disciplinary action"

      - name: action_severity
        type: enum
        values:
          - level_1  # Verbal warning
          - level_2  # Written warning
          - level_3  # Final warning
          - level_4  # Serious action (demotion, suspension)
          - level_5  # Termination
        description: "Action severity level"

      - name: decision_rationale
        type: text
        description: "Rationale for decision"

    # Action Details
    action_details:
      - name: effective_date
        type: date
        description: "When action takes effect"

      - name: end_date
        type: date
        description: "When action ends (for temporary actions)"

      - name: duration_months
        type: integer
        description: "Duration in months"

      - name: salary_impact
        type: decimal
        description: "Impact on salary (percentage)"

      - name: position_change
        type: string
        description: "New position if demoted"

      - name: suspension_days
        type: integer
        description: "Number of suspension days"

      - name: suspension_paid
        type: boolean
        description: "Whether suspension is paid"

    # PIP (Performance Improvement Plan)
    pip:
      - name: pip_required
        type: boolean
        default: false
        description: "Whether PIP is required"

      - name: pip_start_date
        type: date
        description: "PIP start date"

      - name: pip_end_date
        type: date
        description: "PIP end date"

      - name: pip_goals
        type: jsonb
        description: "PIP goals and expectations"

      - name: pip_review_dates
        type: jsonb
        description: "Scheduled review dates"

      - name: pip_outcome
        type: enum
        values:
          - in_progress
          - successful
          - unsuccessful
          - extended
        description: "PIP outcome"

    # Appeal
    appeal:
      - name: can_appeal
        type: boolean
        default: true
        description: "Whether employee can appeal"

      - name: appeal_deadline
        type: date
        description: "Deadline to file appeal"

      - name: appeal_filed
        type: boolean
        default: false
        description: "Whether appeal was filed"

      - name: appeal_date
        type: date
        description: "Date appeal was filed"

      - name: appeal_reason
        type: text
        description: "Reason for appeal"

      - name: appeal_status
        type: enum
        values:
          - none
          - pending
          - under_review
          - upheld
          - modified
          - overturned
        default: "none"
        description: "Appeal status"

      - name: appeal_decision
        type: text
        description: "Appeal decision"

      - name: appeal_decision_date
        type: date
        description: "Date of appeal decision"

    # Communication
    communication:
      - name: notice_issued
        type: boolean
        default: false
        description: "Whether formal notice was issued"

      - name: notice_date
        type: date
        description: "Date notice was issued"

      - name: notice_document_url
        type: string
        description: "URL to notice document"

      - name: employee_acknowledged
        type: boolean
        default: false
        description: "Employee acknowledged receipt"

      - name: acknowledged_date
        type: date
        description: "Date acknowledged"

    # Previous History
    history:
      - name: previous_actions_count
        type: integer
        default: 0
        description: "Number of previous disciplinary actions"

      - name: related_cases
        type: jsonb
        description: "Related case references"

    # Closure
    closure:
      - name: closed_date
        type: date
        description: "Date case was closed"

      - name: closure_reason
        type: text
        description: "Reason for closure"

      - name: expunged
        type: boolean
        default: false
        description: "Whether record was expunged"

      - name: expunge_date
        type: date
        description: "Date record was expunged"

    # System
    system:
      - name: created_at
        type: timestamp
        auto_generate: true

      - name: updated_at
        type: timestamp
        auto_update: true

      - name: created_by
        type: uuid
        foreign_key: users.id

      - name: updated_by
        type: uuid
        foreign_key: users.id

  relationships:
    - name: employee
      type: belongs_to
      entity: Employee
      foreign_key: employee_id
      description: "Employee"

    - name: reported_by
      type: belongs_to
      entity: Employee
      foreign_key: reported_by_id
      description: "Reporter"

    - name: investigator
      type: belongs_to
      entity: Employee
      foreign_key: investigator_id
      description: "Investigator"

    - name: decision_maker
      type: belongs_to
      entity: Employee
      foreign_key: decision_maker_id
      description: "Decision maker"

  state_machine:
    field: status
    initial: reported
    transitions:
      - from: reported
        to: under_investigation
        event: start_investigation
        actions:
          - assign_investigator
          - notify_employee

      - from: under_investigation
        to: hearing_scheduled
        event: schedule_hearing
        actions:
          - send_hearing_notice

      - from: hearing_scheduled
        to: hearing_completed
        event: complete_hearing
        actions:
          - record_minutes

      - from: hearing_completed
        to: decision_pending
        event: submit_for_decision

      - from: decision_pending
        to: action_issued
        event: issue_action
        actions:
          - generate_notice
          - update_employee_record
          - notify_stakeholders

      - from: action_issued
        to: appealed
        event: file_appeal
        conditions:
          - within_appeal_deadline

      - from: [action_issued, appealed]
        to: closed
        event: close_case
        actions:
          - archive_case

  indexes:
    - columns: [case_number]
      unique: true
    - columns: [employee_id]
    - columns: [status]
    - columns: [violation_type]
    - columns: [action_type]
    - columns: [incident_date]

  validations:
    - field: hearing_date
      rule: "must_give_adequate_notice"
      message: "Hearing must be scheduled with adequate notice"

    - field: action_type
      rule: "must_match_severity"
      message: "Action must be proportionate to violation"

  hooks:
    before_create:
      - generate_case_number
      - check_statute_of_limitations
      - load_previous_history

    after_action_issued:
      - update_employee_status
      - trigger_pip_if_needed
      - send_notifications

  audit:
    enabled: true
    tracked_fields:
      - status
      - action_type
      - decision_date
    retention: "10 years"
