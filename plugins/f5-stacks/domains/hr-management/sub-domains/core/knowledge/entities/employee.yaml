name: employee
display_name: Employee
description: |
  Core employee entity containing personal information, employment details,
  organizational assignment, and work-related data. Central entity in HR
  management with relationships to all other HR entities.

domain: hr-management
subdomain: core
category: entities
version: "1.0.0"
status: active

entity:
  name: Employee
  table_name: employees
  primary_key: id

  attributes:
    # Identification
    identification:
      - name: id
        type: uuid
        required: true
        description: "System-generated unique identifier"

      - name: employee_id
        type: string
        required: true
        unique: true
        format: "EMP-XXXXXXXX"
        description: "Human-readable employee code"
        auto_generate: true

      - name: status
        type: enum
        required: true
        default: "pre_hire"
        values:
          - pre_hire
          - active
          - on_leave
          - suspended
          - terminated
          - retired
        description: "Current employment status"

    # Personal Information
    personal:
      - name: first_name
        type: string
        required: true
        max_length: 100
        description: "Employee first name"

      - name: last_name
        type: string
        required: true
        max_length: 100
        description: "Employee last name"

      - name: full_name
        type: string
        computed: true
        formula: "CONCAT(last_name, ' ', first_name)"
        description: "Full name (Vietnamese format: Last First)"

      - name: full_name_en
        type: string
        computed: true
        formula: "CONCAT(first_name, ' ', last_name)"
        description: "Full name (English format: First Last)"

      - name: date_of_birth
        type: date
        required: true
        validation: "Must be 18+ years old"
        description: "Date of birth"

      - name: gender
        type: enum
        required: true
        values: [male, female, other]
        description: "Gender"

      - name: national_id
        type: string
        required: true
        unique: true
        max_length: 12
        description: "National ID / CCCD number"

      - name: national_id_issue_date
        type: date
        description: "National ID issue date"

      - name: national_id_issue_place
        type: string
        description: "National ID issue place"

      - name: tax_id
        type: string
        unique: true
        max_length: 13
        description: "Tax identification number (MST)"

      - name: social_insurance_number
        type: string
        unique: true
        description: "Social insurance book number"

      - name: nationality
        type: string
        default: "Vietnamese"
        description: "Nationality"

      - name: ethnicity
        type: string
        description: "Ethnicity"

      - name: religion
        type: string
        description: "Religion (optional)"

      - name: marital_status
        type: enum
        values: [single, married, divorced, widowed]
        description: "Marital status"

      - name: number_of_children
        type: integer
        default: 0
        description: "Number of children"

    # Contact Information
    contact:
      - name: personal_email
        type: email
        description: "Personal email address"

      - name: work_email
        type: email
        unique: true
        description: "Work email address"

      - name: personal_phone
        type: string
        max_length: 15
        description: "Personal phone number"

      - name: work_phone
        type: string
        max_length: 15
        description: "Work phone number"

      - name: current_address
        type: text
        description: "Current residential address"

      - name: current_city
        type: string
        description: "Current city/province"

      - name: permanent_address
        type: text
        description: "Permanent address (as per ID)"

      - name: permanent_city
        type: string
        description: "Permanent city/province"

    # Emergency Contact
    emergency_contact:
      - name: emergency_contact_name
        type: string
        required: true
        description: "Emergency contact person name"

      - name: emergency_contact_relationship
        type: string
        required: true
        description: "Relationship to employee"

      - name: emergency_contact_phone
        type: string
        required: true
        description: "Emergency contact phone"

      - name: emergency_contact_address
        type: text
        description: "Emergency contact address"

    # Employment Information
    employment:
      - name: hire_date
        type: date
        required: true
        description: "Date of joining / hire date"

      - name: original_hire_date
        type: date
        description: "Original hire date (for rehires)"

      - name: probation_start_date
        type: date
        description: "Probation period start"

      - name: probation_end_date
        type: date
        description: "Probation period end"

      - name: confirmation_date
        type: date
        description: "Date of confirmation after probation"

      - name: employment_type
        type: enum
        required: true
        values:
          - full_time
          - part_time
          - contract
          - intern
          - consultant
        description: "Type of employment"

      - name: contract_type
        type: enum
        values:
          - indefinite
          - definite
          - seasonal
          - probation
        description: "Current contract type"

      - name: current_contract_id
        type: uuid
        foreign_key: employment_contracts.id
        description: "Reference to current active contract"

      - name: department_id
        type: uuid
        required: true
        foreign_key: departments.id
        description: "Assigned department"

      - name: position_id
        type: uuid
        required: true
        foreign_key: positions.id
        description: "Current position"

      - name: manager_id
        type: uuid
        foreign_key: employees.id
        description: "Direct manager/supervisor"

      - name: work_location_id
        type: uuid
        foreign_key: work_locations.id
        description: "Primary work location"

      - name: cost_center
        type: string
        description: "Cost center code for accounting"

      - name: years_of_service
        type: decimal
        computed: true
        formula: "DATEDIFF(CURRENT_DATE, hire_date) / 365"
        description: "Years of service"

    # Compensation
    compensation:
      - name: grade_level
        type: string
        description: "Job grade/level"

      - name: salary_structure_id
        type: uuid
        foreign_key: salary_structures.id
        description: "Linked salary structure"

    # Work Information
    work:
      - name: employee_badge_id
        type: string
        unique: true
        description: "Employee badge/card number"

      - name: biometric_id
        type: string
        unique: true
        description: "Biometric system ID"

      - name: desk_location
        type: string
        description: "Desk/workspace location"

      - name: work_schedule_id
        type: uuid
        foreign_key: shifts.id
        description: "Assigned work schedule"

    # Education
    education:
      - name: highest_education
        type: enum
        values:
          - high_school
          - vocational
          - associate
          - bachelor
          - master
          - doctorate
        description: "Highest education level"

      - name: education_history
        type: jsonb
        description: "Array of education records"
        schema:
          type: array
          items:
            degree: string
            major: string
            institution: string
            graduation_year: integer
            gpa: decimal

    # Bank Information
    bank:
      - name: bank_name
        type: string
        description: "Bank name for salary"

      - name: bank_branch
        type: string
        description: "Bank branch"

      - name: bank_account_number
        type: string
        encrypted: true
        description: "Bank account number"

      - name: bank_account_name
        type: string
        description: "Account holder name"

    # Profile
    profile:
      - name: photo_url
        type: string
        description: "Profile photo URL"

      - name: bio
        type: text
        description: "Short biography"

      - name: skills
        type: jsonb
        description: "Array of skills"

      - name: languages
        type: jsonb
        description: "Languages spoken with proficiency"

    # System
    system:
      - name: created_at
        type: timestamp
        auto_generate: true

      - name: updated_at
        type: timestamp
        auto_update: true

      - name: created_by
        type: uuid
        foreign_key: users.id

      - name: updated_by
        type: uuid
        foreign_key: users.id

  relationships:
    - name: department
      type: belongs_to
      entity: Department
      foreign_key: department_id
      description: "Employee's department"

    - name: position
      type: belongs_to
      entity: Position
      foreign_key: position_id
      description: "Employee's position"

    - name: manager
      type: belongs_to
      entity: Employee
      foreign_key: manager_id
      description: "Direct manager"

    - name: direct_reports
      type: has_many
      entity: Employee
      foreign_key: manager_id
      description: "Employees reporting to this person"

    - name: contracts
      type: has_many
      entity: EmploymentContract
      foreign_key: employee_id
      description: "Employment contracts"

    - name: current_contract
      type: belongs_to
      entity: EmploymentContract
      foreign_key: current_contract_id
      description: "Current active contract"

    - name: leave_requests
      type: has_many
      entity: LeaveRequest
      foreign_key: employee_id
      description: "Leave requests"

    - name: leave_balances
      type: has_many
      entity: LeaveBalance
      foreign_key: employee_id
      description: "Leave balances"

    - name: attendance_records
      type: has_many
      entity: Attendance
      foreign_key: employee_id
      description: "Attendance records"

    - name: performance_reviews
      type: has_many
      entity: PerformanceReview
      foreign_key: employee_id
      description: "Performance reviews"

    - name: goals
      type: has_many
      entity: Goal
      foreign_key: employee_id
      description: "Performance goals"

    - name: trainings
      type: has_many
      entity: Training
      foreign_key: employee_id
      description: "Training records"

    - name: documents
      type: has_many
      entity: Document
      foreign_key: employee_id
      description: "Employee documents"

    - name: disciplinary_actions
      type: has_many
      entity: DisciplinaryAction
      foreign_key: employee_id
      description: "Disciplinary records"

    - name: payroll_profile
      type: has_one
      entity: EmployeePayroll
      foreign_key: employee_id
      description: "Payroll profile"

  state_machine:
    field: status
    initial: pre_hire
    transitions:
      - from: pre_hire
        to: active
        event: activate
        conditions:
          - contract_signed
          - documents_complete
        actions:
          - send_welcome_email
          - initiate_onboarding

      - from: active
        to: on_leave
        event: start_leave
        conditions:
          - leave_approved
        actions:
          - update_attendance_status

      - from: on_leave
        to: active
        event: return_from_leave
        actions:
          - update_attendance_status

      - from: active
        to: suspended
        event: suspend
        conditions:
          - suspension_approved
        actions:
          - revoke_system_access
          - notify_stakeholders

      - from: suspended
        to: active
        event: reinstate
        conditions:
          - reinstatement_approved
        actions:
          - restore_system_access
          - notify_stakeholders

      - from: [active, suspended, on_leave]
        to: terminated
        event: terminate
        conditions:
          - separation_approved
          - clearance_complete
        actions:
          - revoke_all_access
          - initiate_final_settlement
          - archive_records

      - from: active
        to: retired
        event: retire
        conditions:
          - retirement_eligible
          - retirement_approved
        actions:
          - process_retirement_benefits
          - revoke_all_access

  indexes:
    - columns: [employee_id]
      unique: true
    - columns: [national_id]
      unique: true
    - columns: [work_email]
      unique: true
    - columns: [department_id]
    - columns: [position_id]
    - columns: [manager_id]
    - columns: [status]
    - columns: [hire_date]

  validations:
    - field: date_of_birth
      rule: "age_at_hire >= 18"
      message: "Employee must be at least 18 years old"

    - field: work_email
      rule: "must_be_company_domain"
      message: "Work email must use company domain"

    - field: manager_id
      rule: "cannot_be_self"
      message: "Employee cannot be their own manager"

    - field: probation_end_date
      rule: "must_be_after_start_date"
      message: "Probation end must be after start date"

  hooks:
    before_create:
      - generate_employee_id
      - validate_required_documents

    after_create:
      - create_leave_balances
      - send_welcome_notification
      - create_payroll_profile

    before_update:
      - log_changes
      - validate_status_transition

    after_update:
      - notify_relevant_parties
      - sync_to_payroll

  audit:
    enabled: true
    tracked_fields:
      - status
      - department_id
      - position_id
      - manager_id
      - salary_structure_id
    retention: "10 years after separation"

  data_privacy:
    pii_fields:
      - national_id
      - tax_id
      - social_insurance_number
      - bank_account_number
      - date_of_birth
      - personal_phone
      - personal_email
      - current_address
      - permanent_address
    encryption_required:
      - national_id
      - bank_account_number
    consent_required: true
    retention_policy: "10 years after separation"
