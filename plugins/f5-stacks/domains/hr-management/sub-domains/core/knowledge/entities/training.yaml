name: training
display_name: Training
description: |
  Training record entity for tracking employee learning and development
  activities, certifications, and skill acquisition.

domain: hr-management
subdomain: core
category: entities
version: "1.0.0"
status: active

entity:
  name: Training
  table_name: trainings
  primary_key: id

  attributes:
    # Identification
    identification:
      - name: id
        type: uuid
        required: true
        description: "System-generated unique identifier"

      - name: training_id
        type: string
        required: true
        unique: true
        format: "TRN-YYYYMMDD-XXXX"
        description: "Training reference number"

      - name: employee_id
        type: uuid
        required: true
        foreign_key: employees.id
        description: "Employee"

      - name: status
        type: enum
        required: true
        default: "registered"
        values:
          - registered
          - approved
          - in_progress
          - completed
          - cancelled
          - no_show
        description: "Training status"

    # Training Details
    details:
      - name: training_program_id
        type: uuid
        description: "Reference to training program"

      - name: title
        type: string
        required: true
        max_length: 300
        description: "Training title"

      - name: description
        type: text
        description: "Training description"

      - name: training_type
        type: enum
        required: true
        values:
          - internal
          - external
          - online
          - on_the_job
          - certification
          - conference
          - workshop
          - seminar
        description: "Type of training"

      - name: category
        type: enum
        values:
          - technical
          - soft_skills
          - leadership
          - compliance
          - onboarding
          - safety
          - product
          - process
        description: "Training category"

      - name: mandatory
        type: boolean
        default: false
        description: "Whether training is mandatory"

    # Provider
    provider:
      - name: provider_type
        type: enum
        values:
          - internal
          - external_vendor
          - online_platform
          - institution
        description: "Provider type"

      - name: provider_name
        type: string
        description: "Training provider name"

      - name: trainer_name
        type: string
        description: "Trainer/instructor name"

      - name: trainer_id
        type: uuid
        foreign_key: employees.id
        description: "Internal trainer (if applicable)"

    # Schedule
    schedule:
      - name: start_date
        type: date
        required: true
        description: "Training start date"

      - name: end_date
        type: date
        description: "Training end date"

      - name: duration_hours
        type: decimal
        description: "Total training hours"

      - name: schedule_details
        type: jsonb
        description: "Detailed schedule"
        schema:
          type: array
          items:
            date: date
            start_time: time
            end_time: time
            location: string

    # Location
    location:
      - name: location_type
        type: enum
        values:
          - onsite
          - offsite
          - virtual
          - blended
        description: "Training location type"

      - name: venue
        type: string
        description: "Training venue"

      - name: address
        type: text
        description: "Venue address"

      - name: online_platform
        type: string
        description: "Online platform (if virtual)"

      - name: meeting_link
        type: string
        description: "Meeting/course link"

    # Cost
    cost:
      - name: cost_amount
        type: decimal
        precision: 12
        scale: 2
        description: "Training cost"

      - name: currency
        type: string
        default: "VND"
        description: "Cost currency"

      - name: cost_center
        type: string
        description: "Cost center to charge"

      - name: paid_by
        type: enum
        values:
          - company
          - employee
          - shared
          - sponsored
        description: "Who pays for training"

      - name: travel_required
        type: boolean
        default: false
        description: "Whether travel is required"

      - name: travel_cost
        type: decimal
        description: "Associated travel cost"

    # Attendance
    attendance:
      - name: attendance_status
        type: enum
        values:
          - present
          - absent
          - partial
        description: "Attendance status"

      - name: attendance_hours
        type: decimal
        description: "Hours attended"

      - name: attendance_percentage
        type: decimal
        computed: true
        description: "Attendance percentage"

    # Assessment
    assessment:
      - name: assessment_required
        type: boolean
        default: false
        description: "Whether assessment is required"

      - name: assessment_type
        type: enum
        values:
          - test
          - practical
          - project
          - presentation
          - none
        description: "Type of assessment"

      - name: assessment_score
        type: decimal
        description: "Assessment score"

      - name: passing_score
        type: decimal
        description: "Minimum passing score"

      - name: passed
        type: boolean
        computed: true
        formula: "assessment_score >= passing_score"
        description: "Whether passed assessment"

    # Certification
    certification:
      - name: certification_earned
        type: boolean
        default: false
        description: "Whether certification was earned"

      - name: certification_name
        type: string
        description: "Certification name"

      - name: certificate_number
        type: string
        description: "Certificate number"

      - name: certificate_url
        type: string
        description: "URL to certificate"

      - name: certification_expiry
        type: date
        description: "Certification expiry date"

      - name: renewal_required
        type: boolean
        default: false
        description: "Whether renewal is required"

    # Feedback
    feedback:
      - name: employee_feedback
        type: text
        description: "Employee's feedback on training"

      - name: employee_rating
        type: integer
        min: 1
        max: 5
        description: "Employee's rating of training"

      - name: manager_feedback
        type: text
        description: "Manager's feedback on effectiveness"

      - name: skills_gained
        type: jsonb
        description: "Skills gained from training"

    # Approval
    approval:
      - name: requires_approval
        type: boolean
        default: false
        description: "Whether approval is required"

      - name: approved_by
        type: uuid
        foreign_key: employees.id
        description: "Approver"

      - name: approved_at
        type: timestamp
        description: "Approval timestamp"

      - name: rejection_reason
        type: text
        description: "Reason if rejected"

    # Completion
    completion:
      - name: completed_date
        type: date
        description: "Completion date"

      - name: completion_notes
        type: text
        description: "Completion notes"

    # System
    system:
      - name: created_at
        type: timestamp
        auto_generate: true

      - name: updated_at
        type: timestamp
        auto_update: true

      - name: created_by
        type: uuid
        foreign_key: users.id

      - name: updated_by
        type: uuid
        foreign_key: users.id

  relationships:
    - name: employee
      type: belongs_to
      entity: Employee
      foreign_key: employee_id
      description: "Employee"

    - name: trainer
      type: belongs_to
      entity: Employee
      foreign_key: trainer_id
      description: "Internal trainer"

    - name: approver
      type: belongs_to
      entity: Employee
      foreign_key: approved_by
      description: "Approver"

  indexes:
    - columns: [training_id]
      unique: true
    - columns: [employee_id]
    - columns: [status]
    - columns: [training_type]
    - columns: [start_date]
    - columns: [mandatory]

  hooks:
    before_create:
      - generate_training_id
      - check_budget_availability

    after_complete:
      - update_employee_skills
      - issue_certificate
      - update_training_history

    scheduled:
      - name: certification_expiry_reminder
        schedule: "daily"
        action: "check_expiring_certifications"

  notifications:
    - event: registered
      recipients: [employee, manager]
      template: "training_registered"

    - event: reminder
      recipients: [employee]
      template: "training_reminder"
      timing: "1 day before"

    - event: completed
      recipients: [employee, manager, hr]
      template: "training_completed"

  audit:
    enabled: true
    tracked_fields:
      - status
      - assessment_score
      - certification_earned
    retention: "permanent"
