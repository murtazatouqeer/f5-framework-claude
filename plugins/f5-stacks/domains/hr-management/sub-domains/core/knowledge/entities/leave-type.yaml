name: leave-type
display_name: Leave Type
description: |
  Leave type configuration entity defining various types of leave,
  entitlements, accrual rules, and policies compliant with Vietnam Labor Code.

domain: hr-management
subdomain: core
category: entities
version: "1.0.0"
status: active

compliance:
  vietnam_labor_code:
    annual_leave:
      standard: "12 days/year"
      hazardous_mild: "14 days/year"
      hazardous_severe: "16 days/year"
      seniority_bonus: "+1 day per 5 years of service"
    sick_leave:
      with_si: "As per Social Insurance regulations"
      without_si: "Per company policy"
    maternity:
      duration: "6 months (180 days)"
      benefit: "Social Insurance benefit"
    paternity:
      single_birth: "5 working days"
      cesarean_or_premature: "7 working days"
      twins: "10 working days"
      triplets_or_more: "14 working days"

entity:
  name: LeaveType
  table_name: leave_types
  primary_key: id

  attributes:
    # Identification
    identification:
      - name: id
        type: uuid
        required: true
        description: "System-generated unique identifier"

      - name: leave_code
        type: string
        required: true
        unique: true
        max_length: 20
        description: "Leave type code"

      - name: name
        type: string
        required: true
        max_length: 100
        description: "Leave type name"

      - name: name_en
        type: string
        max_length: 100
        description: "Leave type name in English"

      - name: description
        type: text
        description: "Detailed description of leave type"

      - name: status
        type: enum
        required: true
        default: "active"
        values: [active, inactive, deprecated]
        description: "Leave type status"

    # Classification
    classification:
      - name: category
        type: enum
        required: true
        values:
          - annual
          - sick
          - maternity
          - paternity
          - bereavement
          - marriage
          - unpaid
          - special
          - compensatory
          - public_holiday
        description: "Leave category"

      - name: is_paid
        type: boolean
        required: true
        default: true
        description: "Whether leave is paid"

      - name: payment_type
        type: enum
        values:
          - full_pay
          - partial_pay
          - social_insurance
          - unpaid
        description: "How leave is compensated"

      - name: payment_percentage
        type: decimal
        default: 100
        description: "Percentage of salary paid (if partial)"

      - name: affects_attendance
        type: boolean
        default: true
        description: "Whether counted in attendance"

      - name: is_statutory
        type: boolean
        default: false
        description: "Whether mandated by law"

    # Entitlement
    entitlement:
      - name: default_days_per_year
        type: decimal
        description: "Default annual entitlement in days"

      - name: max_days_per_year
        type: decimal
        description: "Maximum days allowed per year"

      - name: accrual_method
        type: enum
        required: true
        values:
          - annual_grant
          - monthly_accrual
          - per_occurrence
          - unlimited
          - none
        description: "How leave is accrued"

      - name: accrual_rate
        type: decimal
        description: "Days accrued per period (for monthly)"

      - name: accrual_start
        type: enum
        default: "hire_date"
        values:
          - hire_date
          - calendar_year_start
          - fiscal_year_start
          - probation_end
        description: "When accrual begins"

      - name: proration_method
        type: enum
        default: "monthly"
        values:
          - none
          - daily
          - monthly
          - quarterly
        description: "How to prorate for partial year"

    # Carry Forward
    carry_forward:
      - name: carry_forward_allowed
        type: boolean
        default: false
        description: "Whether unused days can be carried forward"

      - name: max_carry_forward_days
        type: decimal
        description: "Maximum days that can be carried"

      - name: carry_forward_expiry_months
        type: integer
        description: "Months before carried days expire"

      - name: carry_forward_deadline
        type: string
        description: "Deadline to use carried days (e.g., 'Q1')"

    # Encashment
    encashment:
      - name: encashment_allowed
        type: boolean
        default: false
        description: "Whether unused days can be encashed"

      - name: max_encashment_days
        type: decimal
        description: "Maximum days that can be encashed"

      - name: encashment_rate
        type: decimal
        default: 100
        description: "Percentage of daily rate for encashment"

      - name: encashment_on_separation
        type: boolean
        default: true
        description: "Whether to encash on separation"

    # Request Rules
    request_rules:
      - name: min_days_per_request
        type: decimal
        default: 0.5
        description: "Minimum days per request"

      - name: max_days_per_request
        type: decimal
        description: "Maximum days per single request"

      - name: max_consecutive_days
        type: integer
        description: "Maximum consecutive days allowed"

      - name: advance_notice_days
        type: integer
        default: 0
        description: "Days notice required before leave"

      - name: half_day_allowed
        type: boolean
        default: true
        description: "Whether half-day leave is allowed"

      - name: hourly_leave_allowed
        type: boolean
        default: false
        description: "Whether hourly leave is allowed"

      - name: requires_approval
        type: boolean
        default: true
        description: "Whether manager approval is required"

      - name: auto_approve
        type: boolean
        default: false
        description: "Whether to auto-approve"

    # Documentation
    documentation:
      - name: requires_document
        type: boolean
        default: false
        description: "Whether supporting document is required"

      - name: document_type
        type: string
        description: "Type of document required"
        examples:
          - medical_certificate
          - death_certificate
          - marriage_certificate
          - birth_certificate

      - name: document_required_after_days
        type: integer
        description: "Document required if leave exceeds X days"

    # Eligibility
    eligibility:
      - name: probation_eligible
        type: boolean
        default: false
        description: "Whether available during probation"

      - name: min_service_months
        type: integer
        default: 0
        description: "Minimum months of service required"

      - name: employment_types
        type: jsonb
        description: "Eligible employment types"
        default: ["full_time", "part_time", "contract"]

      - name: gender_restriction
        type: enum
        values: [male, female, all]
        default: "all"
        description: "Gender eligibility"

      - name: custom_eligibility_rules
        type: jsonb
        description: "Custom eligibility criteria"

    # Seniority Bonus
    seniority:
      - name: seniority_bonus_enabled
        type: boolean
        default: false
        description: "Whether seniority adds extra days"

      - name: seniority_bonus_days
        type: decimal
        description: "Extra days per seniority milestone"

      - name: seniority_years_interval
        type: integer
        description: "Years between seniority bonuses"

    # Display
    display:
      - name: color
        type: string
        description: "Color for calendar display"

      - name: icon
        type: string
        description: "Icon for UI display"

      - name: sort_order
        type: integer
        default: 0
        description: "Display order in lists"

    # System
    system:
      - name: created_at
        type: timestamp
        auto_generate: true

      - name: updated_at
        type: timestamp
        auto_update: true

      - name: created_by
        type: uuid
        foreign_key: users.id

      - name: updated_by
        type: uuid
        foreign_key: users.id

  relationships:
    - name: leave_requests
      type: has_many
      entity: LeaveRequest
      foreign_key: leave_type_id
      description: "Leave requests of this type"

    - name: leave_balances
      type: has_many
      entity: LeaveBalance
      foreign_key: leave_type_id
      description: "Employee balances for this type"

  indexes:
    - columns: [leave_code]
      unique: true
    - columns: [category]
    - columns: [status]
    - columns: [is_statutory]

  seed_data:
    - leave_code: "AL"
      name: "Phép năm"
      name_en: "Annual Leave"
      category: annual
      is_paid: true
      payment_type: full_pay
      default_days_per_year: 12
      accrual_method: monthly_accrual
      accrual_rate: 1
      carry_forward_allowed: true
      max_carry_forward_days: 6
      carry_forward_expiry_months: 3
      encashment_on_separation: true
      probation_eligible: false
      seniority_bonus_enabled: true
      seniority_bonus_days: 1
      seniority_years_interval: 5
      is_statutory: true

    - leave_code: "SL"
      name: "Nghỉ ốm"
      name_en: "Sick Leave"
      category: sick
      is_paid: true
      payment_type: social_insurance
      accrual_method: per_occurrence
      requires_document: true
      document_type: "medical_certificate"
      document_required_after_days: 3
      is_statutory: true

    - leave_code: "ML"
      name: "Nghỉ thai sản"
      name_en: "Maternity Leave"
      category: maternity
      is_paid: true
      payment_type: social_insurance
      default_days_per_year: 180
      accrual_method: per_occurrence
      gender_restriction: female
      requires_document: true
      document_type: "birth_certificate"
      is_statutory: true

    - leave_code: "PL"
      name: "Nghỉ chăm con"
      name_en: "Paternity Leave"
      category: paternity
      is_paid: true
      payment_type: social_insurance
      default_days_per_year: 5
      accrual_method: per_occurrence
      gender_restriction: male
      requires_document: true
      document_type: "birth_certificate"
      is_statutory: true

    - leave_code: "BL"
      name: "Nghỉ tang"
      name_en: "Bereavement Leave"
      category: bereavement
      is_paid: true
      payment_type: full_pay
      default_days_per_year: 3
      accrual_method: per_occurrence
      requires_document: true
      document_type: "death_certificate"
      is_statutory: true

    - leave_code: "MR"
      name: "Nghỉ kết hôn"
      name_en: "Marriage Leave"
      category: marriage
      is_paid: true
      payment_type: full_pay
      default_days_per_year: 3
      accrual_method: per_occurrence
      requires_document: true
      document_type: "marriage_certificate"
      is_statutory: true

    - leave_code: "UL"
      name: "Nghỉ không lương"
      name_en: "Unpaid Leave"
      category: unpaid
      is_paid: false
      payment_type: unpaid
      accrual_method: none
      requires_approval: true
      max_consecutive_days: 30

    - leave_code: "CO"
      name: "Nghỉ bù"
      name_en: "Compensatory Off"
      category: compensatory
      is_paid: true
      payment_type: full_pay
      accrual_method: per_occurrence
      carry_forward_allowed: true
      max_carry_forward_days: 5
      carry_forward_expiry_months: 3

  hooks:
    before_create:
      - validate_statutory_compliance
      - set_defaults_by_category

    after_update:
      - recalculate_affected_balances
      - notify_policy_change

  audit:
    enabled: true
    tracked_fields:
      - default_days_per_year
      - accrual_method
      - carry_forward_allowed
      - status
    retention: "permanent"
