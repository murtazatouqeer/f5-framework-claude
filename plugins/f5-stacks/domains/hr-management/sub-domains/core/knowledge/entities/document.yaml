name: document
display_name: Document
description: |
  Employee document entity for managing HR documents including
  contracts, certificates, identification, and compliance documents.

domain: hr-management
subdomain: core
category: entities
version: "1.0.0"
status: active

entity:
  name: Document
  table_name: employee_documents
  primary_key: id

  attributes:
    # Identification
    identification:
      - name: id
        type: uuid
        required: true
        description: "System-generated unique identifier"

      - name: document_id
        type: string
        required: true
        unique: true
        format: "DOC-YYYYMMDD-XXXX"
        description: "Document reference number"

      - name: employee_id
        type: uuid
        required: true
        foreign_key: employees.id
        description: "Document owner"

      - name: status
        type: enum
        required: true
        default: "active"
        values:
          - draft
          - pending_review
          - active
          - expired
          - superseded
          - archived
        description: "Document status"

    # Document Details
    details:
      - name: document_type
        type: enum
        required: true
        values:
          - contract
          - id_card
          - passport
          - work_permit
          - degree
          - certificate
          - license
          - medical
          - background_check
          - photo
          - bank_document
          - tax_document
          - insurance_document
          - training_certificate
          - performance_review
          - warning_letter
          - resignation_letter
          - termination_letter
          - other
        description: "Type of document"

      - name: document_category
        type: enum
        values:
          - personal
          - employment
          - education
          - certification
          - compliance
          - medical
          - financial
          - performance
          - disciplinary
        description: "Document category"

      - name: title
        type: string
        required: true
        max_length: 300
        description: "Document title"

      - name: description
        type: text
        description: "Document description"

      - name: document_number
        type: string
        description: "External document number (e.g., license number)"

    # File Information
    file_info:
      - name: file_url
        type: string
        required: true
        description: "File storage URL"

      - name: file_name
        type: string
        required: true
        description: "Original file name"

      - name: file_type
        type: string
        description: "File MIME type"

      - name: file_size
        type: integer
        description: "File size in bytes"

      - name: file_hash
        type: string
        description: "File hash for integrity"

      - name: thumbnail_url
        type: string
        description: "Thumbnail URL for preview"

      - name: storage_location
        type: string
        description: "Storage bucket/location"

    # Validity
    validity:
      - name: issue_date
        type: date
        description: "Document issue date"

      - name: effective_date
        type: date
        description: "When document becomes effective"

      - name: expiry_date
        type: date
        description: "Document expiry date"

      - name: is_expired
        type: boolean
        computed: true
        formula: "expiry_date < CURRENT_DATE"
        description: "Whether document is expired"

      - name: days_until_expiry
        type: integer
        computed: true
        description: "Days until expiry"

      - name: renewal_reminder_days
        type: integer
        default: 30
        description: "Days before expiry to send reminder"

    # Issuer
    issuer:
      - name: issued_by
        type: string
        description: "Issuing authority/organization"

      - name: issuer_country
        type: string
        description: "Country of issuer"

    # Verification
    verification:
      - name: requires_verification
        type: boolean
        default: false
        description: "Whether verification is required"

      - name: verification_status
        type: enum
        values:
          - not_required
          - pending
          - verified
          - rejected
          - expired
        default: "not_required"
        description: "Verification status"

      - name: verified_by
        type: uuid
        foreign_key: employees.id
        description: "Who verified the document"

      - name: verified_at
        type: timestamp
        description: "When verified"

      - name: verification_notes
        type: text
        description: "Verification notes"

    # Access Control
    access:
      - name: confidentiality
        type: enum
        default: "internal"
        values:
          - public
          - internal
          - restricted
          - confidential
        description: "Confidentiality level"

      - name: accessible_by
        type: jsonb
        description: "Roles that can access"
        default: ["hr_admin", "manager"]

      - name: view_count
        type: integer
        default: 0
        description: "Number of times viewed"

      - name: download_count
        type: integer
        default: 0
        description: "Number of times downloaded"

    # Version Control
    versioning:
      - name: version
        type: integer
        default: 1
        description: "Document version"

      - name: previous_version_id
        type: uuid
        foreign_key: employee_documents.id
        description: "Previous version"

      - name: is_latest
        type: boolean
        default: true
        description: "Whether this is latest version"

    # Compliance
    compliance:
      - name: required_for_employment
        type: boolean
        default: false
        description: "Required for employment"

      - name: compliance_requirement
        type: string
        description: "Compliance requirement reference"

      - name: last_compliance_check
        type: date
        description: "Last compliance check date"

    # Metadata
    metadata:
      - name: tags
        type: jsonb
        description: "Document tags"

      - name: custom_fields
        type: jsonb
        description: "Custom metadata fields"

    # System
    system:
      - name: uploaded_by
        type: uuid
        foreign_key: users.id
        description: "Who uploaded"

      - name: uploaded_at
        type: timestamp
        auto_generate: true
        description: "Upload timestamp"

      - name: updated_at
        type: timestamp
        auto_update: true

      - name: deleted_at
        type: timestamp
        description: "Soft delete timestamp"

  relationships:
    - name: employee
      type: belongs_to
      entity: Employee
      foreign_key: employee_id
      description: "Document owner"

    - name: previous_version
      type: belongs_to
      entity: Document
      foreign_key: previous_version_id
      description: "Previous version"

    - name: newer_versions
      type: has_many
      entity: Document
      foreign_key: previous_version_id
      description: "Newer versions"

  indexes:
    - columns: [document_id]
      unique: true
    - columns: [employee_id]
    - columns: [document_type]
    - columns: [status]
    - columns: [expiry_date]
    - columns: [verification_status]

  hooks:
    before_create:
      - generate_document_id
      - calculate_hash
      - scan_for_virus

    after_create:
      - notify_hr_if_required
      - trigger_verification_if_needed

    scheduled:
      - name: expiry_reminder
        schedule: "daily"
        action: "send_expiry_reminders"

      - name: compliance_check
        schedule: "weekly"
        action: "check_required_documents"

  notifications:
    - event: uploaded
      recipients: [employee, hr_admin]
      template: "document_uploaded"

    - event: expiring_soon
      recipients: [employee, hr_admin]
      template: "document_expiring"
      timing: "30 days before expiry"

    - event: expired
      recipients: [employee, manager, hr_admin]
      template: "document_expired"

  data_privacy:
    pii_fields:
      - file_url
    encryption_required:
      - file_url
    access_logging: true
    retention_policy: "As per document type"

  audit:
    enabled: true
    tracked_fields:
      - status
      - verification_status
    retention: "10 years after separation"
