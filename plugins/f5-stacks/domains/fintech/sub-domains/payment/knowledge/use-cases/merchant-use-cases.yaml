# Merchant Use Cases
# Domain: fintech/payment
# Actor: Merchant receiving payments

name: Merchant Use Cases
display_name: Merchant Use Cases
description: |
  Use cases for merchants interacting with the payment platform including
  onboarding, payment processing, refunds, disputes, and reporting.

  Vietnamese: Các use case cho merchant tương tác với nền tảng thanh toán
  bao gồm đăng ký, xử lý thanh toán, hoàn tiền, tranh chấp và báo cáo.

domain: fintech
sub_domain: payment
category: use-cases
actor: merchant
version: "1.0.0"

use_cases:
  # ============ ONBOARDING USE CASES ============
  - id: UC-MER-001
    name: Onboard as Merchant
    vietnamese: Đăng ký làm Merchant
    description: Business registers as a merchant to accept payments
    actor: merchant
    preconditions:
      - Business has valid registration documents
      - Business has bank account for payouts
    trigger: Business submits merchant application
    main_flow:
      1: Business visits merchant registration page
      2: Business enters business information (name, type, address)
      3: Business enters contact information (email, phone)
      4: Business selects merchant category (MCC)
      5: Business uploads required documents (license, ID)
      6: Business enters bank account for payouts
      7: System creates merchant account (pending status)
      8: System sends verification email
      9: Business confirms email
      10: System initiates KYC verification
      11: KYC team reviews documents
      12: System activates merchant account
      13: System generates API credentials
      14: System sends onboarding email with next steps
    alternative_flows:
      A1_documents_rejected:
        trigger: Documents fail verification
        steps:
          - System notifies merchant of issues
          - Merchant uploads corrected documents
          - Return to step 10
      A2_high_risk_category:
        trigger: Business is high-risk category
        steps:
          - System flags for enhanced due diligence
          - Additional verification required
    postconditions:
      - Merchant account created and active
      - API credentials generated
      - Can begin accepting payments
    business_rules:
      - BR-MER-001: MCC code required
      - BR-MER-003: Verification required before payouts

  - id: UC-MER-002
    name: Configure Payment Methods
    vietnamese: Cấu hình phương thức thanh toán
    description: Merchant configures which payment methods to accept
    actor: merchant
    preconditions:
      - Merchant account is active
    trigger: Merchant accesses payment settings
    main_flow:
      1: Merchant navigates to Payment Settings
      2: System displays available payment methods
      3: Merchant enables/disables payment methods
      4: Merchant configures method-specific settings
      5: System validates configuration
      6: System saves configuration
    postconditions:
      - Payment method configuration updated
      - Takes effect on next payment

  - id: UC-MER-003
    name: Create Payment Link
    vietnamese: Tạo link thanh toán
    description: Merchant creates a shareable payment link
    actor: merchant
    preconditions:
      - Merchant account active
    trigger: Merchant creates new payment link
    main_flow:
      1: Merchant clicks "Create Payment Link"
      2: Merchant enters amount and description
      3: Merchant sets expiry (optional)
      4: Merchant configures payment methods
      5: System generates unique payment link
      6: System displays link and QR code
      7: Merchant shares link with customer
    postconditions:
      - Payment link created and shareable
      - Link tracks payments

  # ============ TRANSACTION MANAGEMENT ============
  - id: UC-MER-010
    name: Process Refund
    vietnamese: Xử lý hoàn tiền
    description: Merchant initiates a refund for a payment
    actor: merchant
    preconditions:
      - Payment exists and is captured
      - Within refund window
    trigger: Merchant initiates refund
    main_flow:
      1: Merchant navigates to transaction details
      2: Merchant clicks "Refund"
      3: System displays refund form
      4: Merchant enters refund amount (full or partial)
      5: Merchant selects refund reason
      6: Merchant confirms refund
      7: System validates refund eligibility
      8: System processes refund
      9: System updates transaction status
      10: System notifies customer
    alternative_flows:
      A1_insufficient_balance:
        trigger: Merchant balance insufficient
        steps:
          - System displays balance warning
          - Merchant must add funds first
      A2_fraud_check:
        trigger: Refund flagged for fraud
        steps:
          - System requires additional verification
          - May need approval
    postconditions:
      - Refund processed
      - Customer notified
      - Merchant balance updated
    business_rules:
      - BR-REF-001 to BR-REF-006: Refund rules

  - id: UC-MER-011
    name: Respond to Dispute
    vietnamese: Phản hồi tranh chấp
    description: Merchant responds to a payment dispute/chargeback
    actor: merchant
    preconditions:
      - Dispute received from card network
      - Within evidence submission deadline
    trigger: Merchant receives dispute notification
    main_flow:
      1: Merchant receives dispute alert
      2: Merchant navigates to dispute details
      3: System displays dispute information and evidence requirements
      4: Merchant gathers required evidence
      5: Merchant uploads evidence documents
      6: Merchant adds text description
      7: System validates evidence package
      8: Merchant submits evidence
      9: System forwards to card network
      10: System updates dispute status
    alternative_flows:
      A1_accept_dispute:
        trigger: Merchant chooses to accept dispute
        steps:
          - Merchant clicks "Accept Dispute"
          - System confirms acceptance
          - Funds remain with customer
      A2_deadline_missed:
        trigger: Evidence deadline passed
        steps:
          - System auto-accepts dispute
          - Merchant loses by default
    postconditions:
      - Evidence submitted (or dispute accepted)
      - Awaiting network decision
    business_rules:
      - BR-DIS-001: Evidence deadline
      - BR-DIS-005: Dispute rate monitoring

  # ============ REPORTING & ANALYTICS ============
  - id: UC-MER-020
    name: View Transactions
    vietnamese: Xem giao dịch
    description: Merchant views transaction list and details
    actor: merchant
    preconditions:
      - Merchant account active
    trigger: Merchant accesses transaction dashboard
    main_flow:
      1: Merchant navigates to Transactions
      2: System displays transaction list
      3: Merchant applies filters (date, status, amount)
      4: System updates list based on filters
      5: Merchant clicks transaction for details
      6: System displays full transaction details
    postconditions:
      - Merchant views transaction data

  - id: UC-MER-021
    name: View Settlements
    vietnamese: Xem quyết toán
    description: Merchant views settlement history and details
    actor: merchant
    preconditions:
      - Merchant has processed transactions
    trigger: Merchant accesses settlements
    main_flow:
      1: Merchant navigates to Settlements
      2: System displays settlement history
      3: Merchant selects settlement for details
      4: System displays settlement breakdown
      5: Merchant can view included transactions
      6: Merchant can download settlement report
    postconditions:
      - Merchant views settlement details

  - id: UC-MER-022
    name: Configure Payouts
    vietnamese: Cấu hình thanh toán
    description: Merchant configures payout settings
    actor: merchant
    preconditions:
      - Merchant account active
      - Bank account verified
    trigger: Merchant accesses payout settings
    main_flow:
      1: Merchant navigates to Payout Settings
      2: System displays current configuration
      3: Merchant sets payout schedule (daily/weekly/monthly)
      4: Merchant sets minimum payout amount
      5: Merchant selects default bank account
      6: System validates configuration
      7: System saves settings
    alternative_flows:
      A1_add_bank_account:
        trigger: Merchant wants to add new account
        steps:
          - Merchant enters bank account details
          - System initiates verification
          - Account available after verification
    postconditions:
      - Payout configuration updated

  - id: UC-MER-023
    name: Download Reports
    vietnamese: Tải báo cáo
    description: Merchant downloads transaction and settlement reports
    actor: merchant
    preconditions:
      - Merchant has transaction history
    trigger: Merchant requests report download
    main_flow:
      1: Merchant navigates to Reports
      2: Merchant selects report type
      3: Merchant sets date range
      4: Merchant selects format (CSV, PDF, XLSX)
      5: System generates report
      6: System provides download link
      7: Merchant downloads report
    postconditions:
      - Report downloaded

  # ============ INTEGRATION & API ============
  - id: UC-MER-030
    name: Manage API Keys
    vietnamese: Quản lý API Keys
    description: Merchant manages API credentials
    actor: merchant
    preconditions:
      - Merchant account active
    trigger: Merchant accesses API settings
    main_flow:
      1: Merchant navigates to API Settings
      2: System displays existing API keys (masked)
      3: Merchant can view, create, or revoke keys
      4: To create: Merchant names new key
      5: System generates new key pair
      6: System displays key (shown once)
      7: Merchant copies and stores key securely
    alternative_flows:
      A1_revoke_key:
        trigger: Merchant revokes existing key
        steps:
          - Merchant selects key to revoke
          - System confirms revocation
          - Key immediately invalid
    postconditions:
      - API keys managed
    security_notes:
      - Secret key shown only once
      - Cannot retrieve secret after creation

  - id: UC-MER-031
    name: Configure Webhooks
    vietnamese: Cấu hình Webhooks
    description: Merchant sets up webhook endpoints
    actor: merchant
    preconditions:
      - Merchant account active
      - Merchant has endpoint URL
    trigger: Merchant configures webhooks
    main_flow:
      1: Merchant navigates to Webhooks
      2: Merchant enters endpoint URL
      3: Merchant selects events to subscribe
      4: System generates webhook secret
      5: System tests endpoint (if requested)
      6: System saves webhook configuration
    alternative_flows:
      A1_endpoint_unreachable:
        trigger: Test ping fails
        steps:
          - System shows error
          - Merchant can save anyway or fix URL
    postconditions:
      - Webhook configured
      - Events will be delivered
    events:
      - payment.succeeded
      - payment.failed
      - refund.created
      - refund.succeeded
      - dispute.created
      - dispute.won
      - dispute.lost
      - payout.paid

  # ============ ACCOUNT MANAGEMENT ============
  - id: UC-MER-040
    name: Update Business Information
    vietnamese: Cập nhật thông tin doanh nghiệp
    description: Merchant updates business details
    actor: merchant
    preconditions:
      - Merchant account exists
    trigger: Merchant edits business information
    main_flow:
      1: Merchant navigates to Business Settings
      2: System displays current information
      3: Merchant edits fields (name, address, contact)
      4: System validates changes
      5: System may require re-verification for some changes
      6: System saves changes
    postconditions:
      - Business information updated

  - id: UC-MER-041
    name: View Dashboard Summary
    vietnamese: Xem tổng quan Dashboard
    description: Merchant views business dashboard
    actor: merchant
    preconditions:
      - Merchant account active
    trigger: Merchant logs into dashboard
    main_flow:
      1: Merchant logs into merchant portal
      2: System displays dashboard summary
      3: Dashboard shows:
         - Today's volume and count
         - Pending balance
         - Available balance
         - Recent transactions
         - Alerts (disputes, failures)
         - Charts (volume trend, success rate)
    postconditions:
      - Merchant sees business overview

# ============ ACTOR PROFILE ============
actor_profile:
  id: merchant
  name: Merchant
  description: Business entity accepting payments through the platform
  vietnamese: Doanh nghiệp chấp nhận thanh toán qua nền tảng
  goals:
    - Accept payments seamlessly
    - Get paid quickly (fast settlements)
    - Minimize disputes and fraud
    - Access clear reporting
    - Easy integration
  pain_points:
    - Complex onboarding
    - Slow payouts
    - High dispute rates
    - Unclear fee structure
    - Poor API documentation

# ============ PERMISSION MATRIX ============
permissions:
  owner:
    - all_actions
  admin:
    - view_transactions
    - process_refunds
    - respond_disputes
    - view_settlements
    - manage_api_keys
    - configure_webhooks
    - view_reports
  finance:
    - view_transactions
    - view_settlements
    - view_reports
    - configure_payouts
  support:
    - view_transactions
    - process_refunds (limited)
    - view_reports
  developer:
    - manage_api_keys
    - configure_webhooks
    - view_test_transactions

# ============ REQUIREMENTS TRACEABILITY ============
requirements_traceability:
  - use_case: UC-MER-001
    requirements: [FR-MER-001, FR-KYC-001, NFR-SEC-003]
  - use_case: UC-MER-010
    requirements: [FR-REF-010, FR-REF-011]
  - use_case: UC-MER-011
    requirements: [FR-DIS-001, FR-DIS-002]
  - use_case: UC-MER-030
    requirements: [FR-API-001, NFR-SEC-004]
