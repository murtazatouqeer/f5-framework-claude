name: AccountHolder
display_name: Account Holder / Chủ tài khoản
description: |
  Individual or entity that owns bank accounts. Contains KYC information,
  identity verification status, and links to all associated banking
  products and services.

domain: fintech
sub_domain: banking
version: "1.0"
status: active

# =============================================================================
# ATTRIBUTES
# =============================================================================
attributes:
  # ---------------------------------------------------------------------------
  # Identity
  # ---------------------------------------------------------------------------
  id:
    type: uuid
    primary_key: true
    description: Unique account holder identifier

  customer_id:
    type: uuid
    nullable: true
    indexed: true
    description: Link to parent domain Customer entity

  holder_reference:
    type: string
    format: "^AH-[0-9]{10}$"
    unique: true
    indexed: true
    description: Human-readable holder reference
    description_vi: Mã khách hàng
    example: "AH-0012345678"

  # ---------------------------------------------------------------------------
  # Holder Type
  # ---------------------------------------------------------------------------
  holder_type:
    type: enum
    values: [individual, joint, corporate, trust, minor]
    required: true
    indexed: true
    description: Type of account holder
    description_vi: Loại chủ tài khoản
    value_descriptions:
      individual: "Individual person / Cá nhân"
      joint: "Joint account holders / Đồng sở hữu"
      corporate: "Business entity / Doanh nghiệp"
      trust: "Trust or estate / Ủy thác"
      minor: "Minor with guardian / Vị thành niên"

  # ---------------------------------------------------------------------------
  # Personal Information (Individual)
  # ---------------------------------------------------------------------------
  title:
    type: enum
    values: [mr, mrs, ms, dr, prof]
    nullable: true
    description: Title/salutation

  first_name:
    type: string
    max_length: 100
    required: true
    description: First name
    description_vi: Tên

  middle_name:
    type: string
    max_length: 100
    nullable: true
    description: Middle name

  last_name:
    type: string
    max_length: 100
    required: true
    description: Last name / Family name
    description_vi: Họ

  full_name:
    type: string
    max_length: 200
    computed: true
    description: Full name for display

  date_of_birth:
    type: date
    nullable: true
    description: Date of birth
    description_vi: Ngày sinh

  gender:
    type: enum
    values: [male, female, other, undisclosed]
    nullable: true
    description: Gender

  nationality:
    type: string
    format: "^[A-Z]{2}$"
    nullable: true
    description: Nationality (ISO 3166-1)
    description_vi: Quốc tịch

  country_of_residence:
    type: string
    format: "^[A-Z]{2}$"
    default: "VN"
    description: Country of residence

  # ---------------------------------------------------------------------------
  # Corporate Information
  # ---------------------------------------------------------------------------
  company_name:
    type: string
    max_length: 200
    nullable: true
    description: Company/Business name
    description_vi: Tên công ty

  company_registration_number:
    type: string
    max_length: 50
    nullable: true
    description: Business registration number
    description_vi: Số đăng ký kinh doanh

  company_type:
    type: enum
    values: [llc, corporation, partnership, sole_proprietor, ngo, government]
    nullable: true
    description: Type of business entity

  incorporation_date:
    type: date
    nullable: true
    description: Date of incorporation

  industry_code:
    type: string
    max_length: 10
    nullable: true
    description: Industry classification code

  # ---------------------------------------------------------------------------
  # Identity Documents
  # ---------------------------------------------------------------------------
  primary_id_type:
    type: enum
    values: [national_id, passport, driving_license, resident_card]
    required: true
    description: Primary ID document type
    description_vi: Loại giấy tờ tùy thân

  primary_id_number:
    type: string
    max_length: 50
    required: true
    encrypted: true
    indexed: true
    description: Primary ID number
    description_vi: Số giấy tờ tùy thân

  primary_id_issue_date:
    type: date
    nullable: true
    description: ID issue date

  primary_id_expiry_date:
    type: date
    nullable: true
    description: ID expiry date

  primary_id_issue_place:
    type: string
    max_length: 100
    nullable: true
    description: ID issue location

  secondary_id_type:
    type: enum
    values: [national_id, passport, driving_license, resident_card]
    nullable: true
    description: Secondary ID type

  secondary_id_number:
    type: string
    max_length: 50
    nullable: true
    encrypted: true
    description: Secondary ID number

  # ---------------------------------------------------------------------------
  # Contact Information
  # ---------------------------------------------------------------------------
  email:
    type: string
    format: email
    required: true
    indexed: true
    description: Primary email
    description_vi: Email

  email_verified:
    type: boolean
    default: false
    description: Email verified

  phone_number:
    type: string
    format: "^\\+?[0-9]{10,15}$"
    required: true
    indexed: true
    description: Primary phone number
    description_vi: Số điện thoại

  phone_verified:
    type: boolean
    default: false
    description: Phone verified

  alternate_phone:
    type: string
    format: "^\\+?[0-9]{10,15}$"
    nullable: true
    description: Alternate phone number

  # ---------------------------------------------------------------------------
  # Address
  # ---------------------------------------------------------------------------
  address_line1:
    type: string
    max_length: 200
    required: true
    description: Street address line 1
    description_vi: Địa chỉ

  address_line2:
    type: string
    max_length: 200
    nullable: true
    description: Street address line 2

  city:
    type: string
    max_length: 100
    required: true
    description: City
    description_vi: Thành phố

  district:
    type: string
    max_length: 100
    nullable: true
    description: District/Ward
    description_vi: Quận/Huyện

  province:
    type: string
    max_length: 100
    nullable: true
    description: Province/State
    description_vi: Tỉnh/Thành

  postal_code:
    type: string
    max_length: 20
    nullable: true
    description: Postal/ZIP code

  country:
    type: string
    format: "^[A-Z]{2}$"
    default: "VN"
    description: Country code

  address_verified:
    type: boolean
    default: false
    description: Address verified

  # ---------------------------------------------------------------------------
  # KYC Information
  # ---------------------------------------------------------------------------
  kyc_status:
    type: enum
    values: [pending, in_progress, verified, rejected, expired]
    default: pending
    indexed: true
    description: KYC verification status
    description_vi: Trạng thái xác minh KYC

  kyc_level:
    type: enum
    values: [basic, standard, enhanced]
    default: basic
    description: KYC verification level
    description_vi: Cấp độ KYC
    value_descriptions:
      basic: "Basic verification / Xác minh cơ bản"
      standard: "Standard verification / Xác minh tiêu chuẩn"
      enhanced: "Enhanced due diligence / Xác minh nâng cao"

  kyc_verified_at:
    type: timestamp
    nullable: true
    description: When KYC was verified

  kyc_expiry_date:
    type: date
    nullable: true
    description: When KYC expires

  kyc_documents:
    type: json
    nullable: true
    description: KYC document references

  # ---------------------------------------------------------------------------
  # Risk Assessment
  # ---------------------------------------------------------------------------
  risk_rating:
    type: enum
    values: [low, medium, high, prohibited]
    default: low
    indexed: true
    description: Customer risk rating
    description_vi: Mức độ rủi ro

  risk_score:
    type: integer
    minimum: 0
    maximum: 100
    nullable: true
    description: Numeric risk score

  pep_status:
    type: boolean
    default: false
    description: Politically Exposed Person
    description_vi: Người có ảnh hưởng chính trị

  sanctions_checked:
    type: boolean
    default: false
    description: Sanctions screening completed

  last_screening_at:
    type: timestamp
    nullable: true
    description: Last AML/sanctions screening

  # ---------------------------------------------------------------------------
  # Employment/Income (for individuals)
  # ---------------------------------------------------------------------------
  employment_status:
    type: enum
    values: [employed, self_employed, retired, student, unemployed, other]
    nullable: true
    description: Employment status
    description_vi: Tình trạng việc làm

  employer_name:
    type: string
    max_length: 200
    nullable: true
    description: Employer name

  occupation:
    type: string
    max_length: 100
    nullable: true
    description: Occupation/Job title
    description_vi: Nghề nghiệp

  annual_income:
    type: decimal
    precision: 18
    scale: 2
    nullable: true
    description: Annual income
    description_vi: Thu nhập hàng năm

  income_source:
    type: string
    max_length: 200
    nullable: true
    description: Primary source of income

  # ---------------------------------------------------------------------------
  # Status
  # ---------------------------------------------------------------------------
  status:
    type: enum
    values: [active, suspended, blocked, closed]
    default: active
    indexed: true
    description: Account holder status
    description_vi: Trạng thái

  status_reason:
    type: string
    max_length: 500
    nullable: true
    description: Reason for current status

  # ---------------------------------------------------------------------------
  # Preferences
  # ---------------------------------------------------------------------------
  preferred_language:
    type: string
    format: "^[a-z]{2}$"
    default: "vi"
    description: Preferred language

  preferred_contact_method:
    type: enum
    values: [email, sms, phone, mail]
    default: email
    description: Preferred contact method

  marketing_consent:
    type: boolean
    default: false
    description: Marketing communication consent

  data_sharing_consent:
    type: boolean
    default: false
    description: Data sharing consent

  # ---------------------------------------------------------------------------
  # Digital Banking
  # ---------------------------------------------------------------------------
  digital_banking_enabled:
    type: boolean
    default: true
    description: Digital banking access enabled

  digital_banking_enrolled_at:
    type: timestamp
    nullable: true
    description: When enrolled in digital banking

  last_login_at:
    type: timestamp
    nullable: true
    description: Last login timestamp

  login_count:
    type: integer
    default: 0
    description: Total login count

  # ---------------------------------------------------------------------------
  # Relationship
  # ---------------------------------------------------------------------------
  relationship_manager_id:
    type: uuid
    nullable: true
    description: Assigned relationship manager

  customer_segment:
    type: enum
    values: [mass, mass_affluent, affluent, high_net_worth, ultra_high_net_worth]
    default: mass
    description: Customer segment
    description_vi: Phân khúc khách hàng

  customer_since:
    type: date
    required: true
    description: Customer since date
    description_vi: Khách hàng từ ngày

  # ---------------------------------------------------------------------------
  # Timestamps
  # ---------------------------------------------------------------------------
  created_at:
    type: timestamp
    auto: true

  updated_at:
    type: timestamp
    auto: true

  closed_at:
    type: timestamp
    nullable: true

# =============================================================================
# RELATIONSHIPS
# =============================================================================
relationships:
  customer:
    type: belongs_to
    entity: Customer
    foreign_key: customer_id
    description: Link to parent domain customer

  accounts:
    type: has_many
    entity: BankAccount
    foreign_key: account_holder_id
    description: Bank accounts owned

  cards:
    type: has_many
    entity: Card
    foreign_key: account_holder_id
    description: Cards issued

  beneficiaries:
    type: has_many
    entity: Beneficiary
    foreign_key: account_holder_id
    description: Saved beneficiaries

  notification_preferences:
    type: has_many
    entity: NotificationPreference
    foreign_key: account_holder_id

  direct_debits:
    type: has_many
    entity: DirectDebit
    foreign_key: account_holder_id

# =============================================================================
# STATE MACHINE
# =============================================================================
state_machine:
  field: status
  initial: active

  states:
    active:
      description: "Active account holder"
      allowed_operations: [transact, open_account, apply_products]

    suspended:
      description: "Temporarily suspended"
      allowed_operations: [view_only]
      restrictions:
        - "No new products"
        - "Limited transactions"

    blocked:
      description: "Blocked by compliance/fraud"
      allowed_operations: [none]

    closed:
      description: "Relationship ended"
      final: true

  transitions:
    - from: active
      to: suspended
      event: suspend
      actions:
        - "Record reason"
        - "Notify customer"

    - from: suspended
      to: active
      event: reactivate
      conditions:
        - "Suspension reason resolved"

    - from: [active, suspended]
      to: blocked
      event: block
      conditions:
        - "Compliance or fraud trigger"
      actions:
        - "Block all accounts"
        - "Block all cards"
        - "Notify compliance"

    - from: blocked
      to: active
      event: unblock
      conditions:
        - "Compliance clearance"

    - from: [active, suspended]
      to: closed
      event: close
      conditions:
        - "All accounts closed"
        - "No outstanding obligations"
      actions:
        - "Archive records"
        - "Send closure confirmation"

# =============================================================================
# BUSINESS RULES
# =============================================================================
business_rules:
  - id: BR-AH-001
    name: Age Requirement
    description: Must be 18+ for individual accounts
    description_vi: Phải từ 18 tuổi trở lên
    rule: |
      IF holder_type = 'individual'
      AND date_of_birth > (current_date - 18 years)
      THEN require guardian OR holder_type = 'minor'

  - id: BR-AH-002
    name: KYC Requirement
    description: KYC must be verified for account opening
    description_vi: KYC phải được xác minh để mở tài khoản
    rule: |
      TO open_account
      REQUIRE kyc_status = 'verified'

  - id: BR-AH-003
    name: KYC Renewal
    description: KYC must be renewed periodically
    description_vi: KYC phải được làm mới định kỳ
    rule: |
      IF risk_rating = 'high' THEN kyc_renewal = 1 year
      ELSE IF risk_rating = 'medium' THEN kyc_renewal = 2 years
      ELSE kyc_renewal = 5 years

  - id: BR-AH-004
    name: PEP Enhanced Due Diligence
    description: Enhanced checks for PEPs
    description_vi: Kiểm tra nâng cao cho PEP
    rule: |
      IF pep_status = true
      THEN kyc_level = 'enhanced'
           risk_rating >= 'medium'

  - id: BR-AH-005
    name: Document Validity
    description: ID documents must be valid
    description_vi: Giấy tờ tùy thân phải còn hiệu lực
    rule: |
      primary_id_expiry_date > current_date
      OR primary_id_expiry_date IS NULL (for non-expiring IDs)

# =============================================================================
# KYC LEVELS
# =============================================================================
kyc_levels:
  basic:
    name: "Basic KYC"
    name_vi: "KYC Cơ bản"
    requirements:
      - "Government ID"
      - "Phone verification"
    limits:
      daily_transfer: 20000000
      monthly_transfer: 100000000

  standard:
    name: "Standard KYC"
    name_vi: "KYC Tiêu chuẩn"
    requirements:
      - "Government ID"
      - "Phone verification"
      - "Address verification"
      - "Selfie with ID"
    limits:
      daily_transfer: 500000000
      monthly_transfer: 2000000000

  enhanced:
    name: "Enhanced KYC"
    name_vi: "KYC Nâng cao"
    requirements:
      - "All standard requirements"
      - "Source of funds documentation"
      - "In-person verification"
      - "Reference letters"
    limits:
      daily_transfer: unlimited
      monthly_transfer: unlimited

# =============================================================================
# CUSTOMER SEGMENTS
# =============================================================================
customer_segments:
  mass:
    name: "Mass Market"
    name_vi: "Phổ thông"
    criteria:
      total_relationship_balance: "< 500,000,000 VND"

  mass_affluent:
    name: "Mass Affluent"
    name_vi: "Khá giả"
    criteria:
      total_relationship_balance: "500M - 2B VND"

  affluent:
    name: "Affluent"
    name_vi: "Giàu có"
    criteria:
      total_relationship_balance: "2B - 10B VND"

  high_net_worth:
    name: "High Net Worth"
    name_vi: "Giàu có cao"
    criteria:
      total_relationship_balance: "10B - 50B VND"

  ultra_high_net_worth:
    name: "Ultra High Net Worth"
    name_vi: "Siêu giàu có"
    criteria:
      total_relationship_balance: "> 50B VND"

# =============================================================================
# INDEXES
# =============================================================================
indexes:
  - name: idx_holder_reference
    fields: [holder_reference]
    unique: true

  - name: idx_holder_customer
    fields: [customer_id]

  - name: idx_holder_email
    fields: [email]

  - name: idx_holder_phone
    fields: [phone_number]

  - name: idx_holder_id_number
    fields: [primary_id_number]

  - name: idx_holder_status
    fields: [status]

  - name: idx_holder_kyc
    fields: [kyc_status]

  - name: idx_holder_risk
    fields: [risk_rating]

# =============================================================================
# AUDIT
# =============================================================================
audit:
  enabled: true
  retention_years: 10
  events:
    - holder_created
    - holder_updated
    - kyc_submitted
    - kyc_verified
    - kyc_rejected
    - kyc_expired
    - risk_rating_changed
    - status_changed
    - suspended
    - reactivated
    - blocked
    - unblocked
    - closed
