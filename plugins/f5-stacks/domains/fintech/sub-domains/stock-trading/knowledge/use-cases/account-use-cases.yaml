name: account-use-cases
display_name: Use Cases - Trading Account Management
description: |
  Use cases related to securities trading account management.
  Includes account opening, deposit/withdrawal, personal information management.

domain: fintech/stock-trading
version: "1.0"

use_cases:
  # =============================================================================
  - id: UC-ACCOUNT-001
    name: Open Trading Account
    actor: New Customer
    description: |
      New customer registers to open securities trading account.
      Includes eKYC and identity verification.

    preconditions:
      - Customer aged 18 and above
      - Has valid CCCD/CMND (National ID)
      - Has phone number and email

    triggers:
      - Customer accesses registration page
      - Or downloads app and selects "Open Account"

    main_flow:
      - step: 1
        action: Enter basic information
        system_response: |
          Input form:
          - Full name
          - Email
          - Phone number
          - Gender
          - Date of birth

      - step: 2
        action: Verify phone number (OTP)
        system_response: |
          - Send OTP via SMS
          - Allow 3 incorrect attempts
          - Timeout 3 minutes

      - step: 3
        action: Take photo of CCCD/CMND
        system_response: |
          - Guide to photograph front/back
          - Check image quality
          - OCR extract information

      - step: 4
        action: Facial verification
        system_response: |
          - Guide to take selfie
          - Liveness detection
          - Face matching with CCCD

      - step: 5
        action: Enter additional information
        system_response: |
          - Permanent address
          - Occupation
          - Annual income
          - Investment fund source
          - Investment objectives

      - step: 6
        action: Read and agree to terms
        system_response: |
          - Display terms of use
          - Privacy policy
          - Investment risk notice

      - step: 7
        action: Digital signature on contract
        system_response: |
          - Generate account opening contract
          - Sign with OTP or eSign

      - step: 8
        action: Wait for approval
        system_response: |
          - Check AML/KYC
          - Auto or manual approval
          - Notify result

    alternative_flows:
      - id: AF1
        name: eKYC failed
        trigger_step: 4
        flow:
          - Switch to video call with staff
          - Or schedule branch visit

      - id: AF2
        name: AML flagged
        trigger_step: 8
        flow:
          - Move to manual review
          - Request additional documents
          - Processing time 24-48h

    postconditions:
      - Account created and activated
      - Customer receives confirmation email
      - Can login and deposit funds

    business_rules:
      - BR001: One CCCD can only open 1 account
      - BR002: Account must pass KYC before trading
      - BR003: Face match score >= 80%

  # =============================================================================
  - id: UC-ACCOUNT-002
    name: Deposit Funds to Account
    actor: Investor
    description: |
      Deposit funds to trading account for buying power.

    preconditions:
      - Has activated account
      - Logged in

    main_flow:
      - step: 1
        action: Go to "Deposit"
        system_response: |
          Display methods:
          - Bank transfer
          - E-wallet
          - ATM/VISA/Master card

      - step: 2
        action: Select method and amount
        system_response: |
          - Validate amount (min/max)
          - Display fees (if any)
          - Generate transaction code

      - step: 3
        action: Execute payment
        system_response: |
          Bank transfer: Display receiving account info
          E-wallet: Redirect to wallet app
          Card: Open payment gateway page

      - step: 4
        action: Confirm payment
        system_response: |
          - Receive webhook from bank/wallet
          - Credit funds to account
          - Send confirmation notification

    alternative_flows:
      - id: AF1
        name: Deposit from linked bank account
        flow:
          - Select linked bank
          - Confirm with bank OTP
          - Instant credit

      - id: AF2
        name: Deposit via QR Code
        flow:
          - Display QR code with deposit info
          - Scan with banking app
          - Auto confirmation

    business_rules:
      - BR001: Minimum deposit 100,000 VND
      - BR002: Deposit limit 2 billion VND/day
      - BR003: Only accept from same-name account

  # =============================================================================
  - id: UC-ACCOUNT-003
    name: Withdraw Funds from Account
    actor: Investor
    description: |
      Withdraw available funds to bank account.

    preconditions:
      - Has available balance to withdraw
      - Linked bank account

    main_flow:
      - step: 1
        action: Go to "Withdraw"
        system_response: |
          Display:
          - Available balance
          - List of linked bank accounts

      - step: 2
        action: Enter amount and select receiving account
        system_response: |
          - Validate amount <= available
          - Display withdrawal fee (if any)
          - Display expected receipt time

      - step: 3
        action: Confirm withdrawal
        system_response: |
          - Send OTP confirmation
          - Deduct from account
          - Create transfer order

      - step: 4
        action: Wait for processing
        system_response: |
          - Process during business hours
          - Transfer to bank
          - Notify when complete

    alternative_flows:
      - id: AF1
        name: Fast withdrawal same day
        flow:
          - Select "Fast Withdrawal"
          - Higher fee, receive within 15 minutes

    business_rules:
      - BR001: Minimum withdrawal 100,000 VND
      - BR002: Withdrawal limit 500 million VND/day
      - BR003: Only withdraw to same-name linked account
      - BR004: Standard withdrawal T+1, fast withdrawal 15 minutes

  # =============================================================================
  - id: UC-ACCOUNT-004
    name: Link Bank Account
    actor: Investor
    description: |
      Link bank account for deposit/withdrawal.

    preconditions:
      - Has securities account
      - Has same-name bank account

    main_flow:
      - step: 1
        action: Go to "Link Bank"
        system_response: Display list of supported banks

      - step: 2
        action: Select bank and enter account number
        system_response: |
          - Validate account number format
          - Check account holder name (name matching)

      - step: 3
        action: Verify account ownership
        system_response: |
          Method 1: Verification transfer (1,000 VND)
          Method 2: OTP via SMS banking

      - step: 4
        action: Complete linking
        system_response: |
          - Save bank account info
          - Set as default account (optional)

    business_rules:
      - BR001: Only link same-owner accounts
      - BR002: Maximum 5 linked bank accounts
      - BR003: Bank account must have SMS banking

  # =============================================================================
  - id: UC-ACCOUNT-005
    name: Change Password
    actor: Investor
    description: |
      Change login password.

    preconditions:
      - Logged in

    main_flow:
      - step: 1
        action: Go to "Change Password"
        system_response: Display password change form

      - step: 2
        action: Enter old password and new password
        system_response: |
          Validate new password:
          - Length >= 8 characters
          - Has uppercase, lowercase, numbers
          - Not same as last 5 passwords

      - step: 3
        action: Confirm with OTP
        system_response: |
          - Send OTP
          - Verify OTP
          - Update password
          - Logout all other sessions

    business_rules:
      - BR001: New password must differ from last 5 passwords
      - BR002: Mandatory password change after 90 days
      - BR003: Lock after 5 incorrect attempts

  # =============================================================================
  - id: UC-ACCOUNT-006
    name: Forgot Password
    actor: Customer
    description: |
      Recover password when forgotten.

    preconditions:
      - Has registered account

    main_flow:
      - step: 1
        action: Select "Forgot Password" from login screen
        system_response: Request email or phone number

      - step: 2
        action: Enter registered email/phone
        system_response: Send verification OTP

      - step: 3
        action: Enter OTP
        system_response: Verify and allow setting new password

      - step: 4
        action: Set new password
        system_response: |
          - Validate password
          - Update
          - Logout all sessions

    alternative_flows:
      - id: AF1
        name: Did not receive OTP
        flow:
          - Resend OTP (3 times)
          - If still not received, contact hotline

  # =============================================================================
  - id: UC-ACCOUNT-007
    name: Setup 2FA
    actor: Investor
    description: |
      Enable two-factor authentication for increased security.

    preconditions:
      - Logged in

    main_flow:
      - step: 1
        action: Go to "Security" > "Two-Factor Authentication"
        system_response: |
          Display methods:
          - SMS OTP
          - Authenticator App (Google/Microsoft)
          - Biometric (FaceID/TouchID)

      - step: 2
        action: Select method and setup
        system_response: |
          SMS: Confirm phone number
          Authenticator: Display QR code to scan
          Biometric: Register fingerprint/face

      - step: 3
        action: Confirm setup
        system_response: |
          - Save 2FA settings
          - Require 2FA from next login

    business_rules:
      - BR001: 2FA mandatory for orders > 100 million VND
      - BR002: Backup codes provided when using Authenticator

  # =============================================================================
  - id: UC-ACCOUNT-008
    name: Update Personal Information
    actor: Investor
    description: |
      Update contact and personal information.

    preconditions:
      - Logged in

    main_flow:
      - step: 1
        action: Go to "Account Information"
        system_response: Display current information

      - step: 2
        action: Edit information
        system_response: |
          Editable:
          - Email
          - Phone number
          - Address
          - Occupation

          Not editable (requires ID):
          - Full name
          - Date of birth
          - CCCD number

      - step: 3
        action: Confirm with OTP
        system_response: |
          - Verify OTP
          - Update information
          - Log changes

    alternative_flows:
      - id: AF1
        name: Change phone number
        flow:
          - OTP sent to old number
          - OTP sent to new number
          - Update when both verified

  # =============================================================================
  - id: UC-ACCOUNT-009
    name: View Login History
    actor: Investor
    description: |
      View login history to detect unusual access.

    main_flow:
      - step: 1
        action: Go to "Security" > "Login History"
        system_response: |
          Display list:
          - Login time
          - Device (iOS/Android/Web)
          - IP address
          - Location (estimated)
          - Status (success/failed)

      - step: 2
        action: Logout other devices (optional)
        system_response: |
          - Select session to logout
          - Confirm
          - Invalidate session token

    security_features:
      - Alert when login from new device
      - Alert when login from unusual location
      - Auto-lock after 5 failed login attempts

  # =============================================================================
  - id: UC-ACCOUNT-010
    name: Close Account
    actor: Investor
    description: |
      Request to close trading account.

    preconditions:
      - Cash balance = 0
      - No remaining positions
      - No pending orders
      - No margin debt

    main_flow:
      - step: 1
        action: Go to "Close Account"
        system_response: |
          Check and display:
          - Cash balance
          - Remaining positions
          - Unfulfilled obligations

      - step: 2
        action: Confirm account closure
        system_response: |
          - Confirm with OTP
          - Fill closure reason (optional)
          - Digital signature on closure form

      - step: 3
        action: Process request
        system_response: |
          - Deactivate account
          - Archive data (5 years)
          - Send confirmation email

    alternative_flows:
      - id: AF1
        name: Has remaining assets
        flow:
          - Request withdrawal/sell securities first
          - Guide required steps

    business_rules:
      - BR001: Must settle all assets first
      - BR002: Data archived 5-10 years per regulation
      - BR003: Cannot reopen with same CCCD

# =============================================================================
# Security Requirements
# =============================================================================
security_requirements:
  authentication:
    - Password policy: 8+ chars, upper/lower/number
    - 2FA for sensitive operations
    - Session timeout: 15 minutes inactive
    - Max concurrent sessions: 3

  authorization:
    - Role-based access control
    - IP whitelist for API
    - Rate limiting: 100 req/min

  data_protection:
    - Encryption at rest (AES-256)
    - Encryption in transit (TLS 1.3)
    - PII masking in logs
    - CCCD images encrypted separately

  audit:
    - All login attempts logged
    - All transactions logged
    - All profile changes logged
    - Retention: 5 years

# =============================================================================
# Compliance Requirements
# =============================================================================
compliance:
  kyc_aml:
    - Identity verification required
    - AML screening on registration
    - Periodic re-verification (yearly)
    - Suspicious activity monitoring

  data_privacy:
    - PDPA Vietnam compliance
    - Customer consent management
    - Data deletion request handling
    - Third-party data sharing controls

  regulatory:
    - SSC reporting requirements
    - VSD data submission
    - Customer complaint handling
    - Record keeping (5-10 years)
