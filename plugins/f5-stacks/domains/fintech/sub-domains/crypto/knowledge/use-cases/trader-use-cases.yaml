name: TraderUseCases
display_name: Trader Use Cases / Ca sử dụng Trader
description: |
  Use cases for cryptocurrency traders interacting with the exchange platform.
  Covers account management, trading, deposits, withdrawals, and staking.

domain: fintech
sub_domain: crypto
actor: trader
version: "1.0"
status: active

# =============================================================================
# ACTOR PROFILE
# =============================================================================
actor_profile:
  name: Trader
  name_vi: Nhà giao dịch
  description: |
    Individual or entity using the platform to trade cryptocurrencies,
    manage assets, and earn rewards through staking.
  types:
    - retail: Individual traders
    - professional: High-volume traders
    - institutional: Companies and funds
    - market_maker: Liquidity providers

# =============================================================================
# ACCOUNT MANAGEMENT
# =============================================================================
account_management:
  - id: UC-TRD-001
    name: Register Account
    name_vi: Đăng ký tài khoản
    description: New user creates an account on the platform
    preconditions:
      - User has valid email
      - User is not from restricted jurisdiction
    main_flow:
      1: User accesses registration page
      2: User enters email and password
      3: System validates email format and password strength
      4: System sends verification email
      5: User clicks verification link
      6: System creates account with basic status
      7: User is logged in and directed to dashboard
    postconditions:
      - Account created with 'basic' status
      - Email verified
      - Basic wallet created automatically
    exceptions:
      3a: Invalid email → Show error, retry
      3b: Weak password → Show requirements, retry
      5a: Link expired → Resend verification email

  - id: UC-TRD-002
    name: Complete KYC Verification
    name_vi: Hoàn thành xác minh KYC
    description: User completes identity verification to unlock features
    preconditions:
      - User is logged in
      - User has basic account status
    main_flow:
      1: User navigates to verification page
      2: User selects document type (passport, ID, license)
      3: User uploads document photos
      4: User takes selfie with liveness check
      5: System performs OCR and facial matching
      6: System screens against sanctions lists
      7: System approves or queues for review
      8: User receives notification of result
    postconditions:
      - KYC status updated
      - Trading and withdrawal limits adjusted
    alternatives:
      7a: High risk → Manual review required
      7b: Document unclear → Request resubmission
    exceptions:
      5a: OCR fails → Manual review
      6a: Sanctions match → Rejection and report

  - id: UC-TRD-003
    name: Enable Two-Factor Authentication
    name_vi: Kích hoạt xác thực hai yếu tố
    description: User sets up 2FA for account security
    preconditions:
      - User is logged in
    main_flow:
      1: User navigates to security settings
      2: User selects 2FA method (authenticator, SMS)
      3: For authenticator: System displays QR code
      4: User scans QR code with authenticator app
      5: User enters verification code
      6: System validates and enables 2FA
      7: System displays backup codes
      8: User saves backup codes
    postconditions:
      - 2FA enabled on account
      - Backup codes generated

  - id: UC-TRD-004
    name: Manage API Keys
    name_vi: Quản lý khóa API
    description: User creates and manages API keys for automated trading
    preconditions:
      - User is logged in
      - 2FA is enabled
    main_flow:
      1: User navigates to API management
      2: User clicks "Create New Key"
      3: User selects permissions (read, trade, withdraw)
      4: User optionally sets IP whitelist
      5: User verifies with 2FA
      6: System generates API key and secret
      7: User copies and securely stores credentials
    postconditions:
      - New API key created
      - Permissions applied
    notes:
      - Secret shown only once
      - Maximum 30 keys per account

# =============================================================================
# DEPOSIT USE CASES
# =============================================================================
deposits:
  - id: UC-TRD-010
    name: Get Deposit Address
    name_vi: Lấy địa chỉ nạp tiền
    description: User obtains deposit address for a cryptocurrency
    preconditions:
      - User is logged in
      - User has verified account (if required)
    main_flow:
      1: User navigates to deposit page
      2: User selects cryptocurrency
      3: User selects network (if multiple available)
      4: System displays deposit address
      5: System shows QR code and copy button
      6: System displays network confirmations required
      7: User copies address for use
    postconditions:
      - Deposit address displayed
      - User understands network and confirmations
    notes:
      - Same address can be reused
      - Warn about sending correct asset

  - id: UC-TRD-011
    name: Track Deposit Status
    name_vi: Theo dõi trạng thái nạp tiền
    description: User monitors incoming deposit confirmation
    preconditions:
      - User has initiated deposit to platform address
    main_flow:
      1: User navigates to deposit history
      2: User sees list of deposits with status
      3: For pending deposits: User sees confirmation progress
      4: User can click for transaction details
      5: User receives notification when credited
    postconditions:
      - User informed of deposit status
    statuses:
      - detected: Transaction seen on blockchain
      - confirming: Waiting for confirmations
      - completed: Credited to balance
      - failed: Transaction failed

# =============================================================================
# WITHDRAWAL USE CASES
# =============================================================================
withdrawals:
  - id: UC-TRD-020
    name: Withdraw Cryptocurrency
    name_vi: Rút tiền điện tử
    description: User withdraws cryptocurrency to external wallet
    preconditions:
      - User is logged in
      - User has sufficient balance
      - User has completed required KYC
      - 2FA is enabled
    main_flow:
      1: User navigates to withdrawal page
      2: User selects asset and network
      3: User enters destination address
      4: User enters amount
      5: System displays fee and net amount
      6: User reviews and confirms
      7: User completes 2FA verification
      8: System processes withdrawal
      9: User receives confirmation notification
    postconditions:
      - Withdrawal initiated
      - Balance deducted
    alternatives:
      3a: New address → 24-hour cooling period applies
      3b: Whitelisted address → Skip cooling period
    exceptions:
      4a: Amount exceeds limit → Show limit info
      7a: 2FA fails → Block withdrawal
      8a: High risk → Manual review required

  - id: UC-TRD-021
    name: Add Address to Whitelist
    name_vi: Thêm địa chỉ vào whitelist
    description: User adds trusted withdrawal address
    preconditions:
      - User is logged in
      - 2FA is enabled
    main_flow:
      1: User navigates to address book
      2: User clicks "Add New Address"
      3: User enters address, label, and network
      4: System validates address format
      5: User verifies with 2FA
      6: System adds address with 24-hour lock
      7: After 24 hours, address is whitelisted
    postconditions:
      - Address added to whitelist
      - Can withdraw without cooling period after 24h

  - id: UC-TRD-022
    name: Cancel Pending Withdrawal
    name_vi: Hủy rút tiền đang chờ
    description: User cancels withdrawal before processing
    preconditions:
      - Withdrawal in pending status
      - Not yet broadcast to blockchain
    main_flow:
      1: User navigates to withdrawal history
      2: User finds pending withdrawal
      3: User clicks "Cancel"
      4: User confirms cancellation
      5: System releases locked balance
      6: User sees updated available balance
    postconditions:
      - Withdrawal cancelled
      - Balance restored
    exceptions:
      3a: Already processing → Cannot cancel

# =============================================================================
# TRADING USE CASES
# =============================================================================
trading:
  - id: UC-TRD-030
    name: Place Limit Order
    name_vi: Đặt lệnh giới hạn
    description: User places limit order to buy or sell at specific price
    preconditions:
      - User is logged in
      - Trading enabled for pair
      - Sufficient balance
    main_flow:
      1: User navigates to trading page
      2: User selects trading pair
      3: User selects "Limit" order type
      4: User enters price and quantity
      5: System displays order value and fees
      6: User clicks Buy or Sell
      7: System validates and locks balance
      8: System places order in order book
      9: User sees order in open orders
    postconditions:
      - Order placed in order book
      - Balance locked
    alternatives:
      8a: Immediate match → Partial or full execution

  - id: UC-TRD-031
    name: Place Market Order
    name_vi: Đặt lệnh thị trường
    description: User places market order for immediate execution
    preconditions:
      - User is logged in
      - Trading enabled for pair
      - Sufficient balance
    main_flow:
      1: User navigates to trading page
      2: User selects trading pair
      3: User selects "Market" order type
      4: User enters quantity (or quote amount for buys)
      5: System displays estimated price and slippage
      6: User clicks Buy or Sell
      7: System executes order immediately
      8: User sees trade in history
    postconditions:
      - Order executed at market price
      - Balance updated
    exceptions:
      7a: Insufficient liquidity → Partial fill or rejection

  - id: UC-TRD-032
    name: Place Stop-Loss Order
    name_vi: Đặt lệnh cắt lỗ
    description: User places stop-loss to limit downside
    preconditions:
      - User is logged in
      - Has open position or balance
    main_flow:
      1: User selects "Stop-Limit" order type
      2: User enters stop price (trigger)
      3: User enters limit price (execution)
      4: User enters quantity
      5: User confirms order
      6: System places conditional order
      7: Order remains dormant until stop triggered
      8: When triggered, limit order placed
    postconditions:
      - Stop order active
      - Triggers when price reached

  - id: UC-TRD-033
    name: Cancel Open Order
    name_vi: Hủy lệnh đang mở
    description: User cancels order in order book
    preconditions:
      - Order is open or partially filled
    main_flow:
      1: User navigates to open orders
      2: User finds order to cancel
      3: User clicks "Cancel"
      4: System removes from order book
      5: System unlocks remaining balance
      6: Order status updated to cancelled
    postconditions:
      - Order cancelled
      - Unfilled balance restored

  - id: UC-TRD-034
    name: View Trade History
    name_vi: Xem lịch sử giao dịch
    description: User reviews completed trades
    preconditions:
      - User is logged in
    main_flow:
      1: User navigates to trade history
      2: User sees list of executed trades
      3: User can filter by pair, date, side
      4: User can export to CSV
      5: User can view trade details
    display_fields:
      - Time
      - Pair
      - Side (buy/sell)
      - Price
      - Quantity
      - Fee
      - Total

# =============================================================================
# STAKING USE CASES
# =============================================================================
staking:
  - id: UC-TRD-040
    name: Stake Cryptocurrency
    name_vi: Stake tiền điện tử
    description: User stakes crypto to earn rewards
    preconditions:
      - User is logged in
      - Sufficient available balance
    main_flow:
      1: User navigates to staking page
      2: User browses available products
      3: User selects staking product
      4: User enters amount to stake
      5: System displays APY and terms
      6: User reviews lock period if applicable
      7: User confirms staking
      8: System locks balance and activates position
      9: User receives confirmation
    postconditions:
      - Staking position created
      - Balance moved to staking
    alternatives:
      3a: Flexible staking → No lock period
      3b: Locked staking → Fixed term with higher APY

  - id: UC-TRD-041
    name: Claim Staking Rewards
    name_vi: Nhận phần thưởng staking
    description: User claims accumulated staking rewards
    preconditions:
      - Active staking position
      - Pending rewards > 0
    main_flow:
      1: User navigates to staking positions
      2: User sees pending rewards
      3: User clicks "Claim Rewards"
      4: System calculates final amount
      5: System credits to available balance
      6: User sees updated balance
    postconditions:
      - Rewards credited
      - Pending rewards reset

  - id: UC-TRD-042
    name: Unstake Cryptocurrency
    name_vi: Hủy stake tiền điện tử
    description: User withdraws staked cryptocurrency
    preconditions:
      - Active staking position
    main_flow:
      1: User navigates to staking positions
      2: User selects position to unstake
      3: User clicks "Unstake"
      4: System shows unstaking terms
      5: For locked: System shows early withdrawal penalty
      6: User confirms unstaking
      7: System initiates unbonding if required
      8: After unbonding, balance restored
    postconditions:
      - Staking position closed
      - Balance returned (minus any penalty)
    alternatives:
      7a: Flexible → Immediate return
      7b: PoS → Unbonding period required

# =============================================================================
# PORTFOLIO MANAGEMENT
# =============================================================================
portfolio:
  - id: UC-TRD-050
    name: View Portfolio
    name_vi: Xem danh mục đầu tư
    description: User views overall portfolio and performance
    preconditions:
      - User is logged in
    main_flow:
      1: User navigates to portfolio/wallet page
      2: System displays total portfolio value
      3: System shows breakdown by asset
      4: User sees 24h change and P&L
      5: User can toggle between spot/staking views
    display_elements:
      - Total value (USD/BTC)
      - Asset breakdown with percentages
      - 24h change
      - Unrealized P&L

  - id: UC-TRD-051
    name: Transfer Between Wallets
    name_vi: Chuyển giữa các ví
    description: User transfers assets between wallet types
    preconditions:
      - User is logged in
      - Sufficient balance in source wallet
    main_flow:
      1: User selects "Transfer" option
      2: User selects source wallet (spot, funding, etc.)
      3: User selects destination wallet
      4: User selects asset and amount
      5: User confirms transfer
      6: System moves balance instantly
    postconditions:
      - Balance moved between wallets
      - No fees for internal transfers

# =============================================================================
# NOTIFICATIONS & ALERTS
# =============================================================================
notifications:
  - id: UC-TRD-060
    name: Set Price Alert
    name_vi: Đặt cảnh báo giá
    description: User creates alert for price movement
    preconditions:
      - User is logged in
    main_flow:
      1: User navigates to alerts
      2: User clicks "Create Alert"
      3: User selects trading pair
      4: User sets condition (above/below price)
      5: User sets target price
      6: User enables notification channels
      7: System saves alert
      8: When triggered, user is notified
    postconditions:
      - Alert active
      - User notified when condition met

  - id: UC-TRD-061
    name: Manage Notification Preferences
    name_vi: Quản lý tùy chọn thông báo
    description: User configures notification settings
    preconditions:
      - User is logged in
    main_flow:
      1: User navigates to settings
      2: User selects notifications
      3: User toggles notification types
      4: User selects channels (push, email, SMS)
      5: User saves preferences
    notification_types:
      - Order executions
      - Deposits credited
      - Withdrawals completed
      - Security alerts
      - Price alerts
      - Staking rewards

# =============================================================================
# EXCEPTION HANDLING
# =============================================================================
common_exceptions:
  - id: EX-001
    name: Session Expired
    handling: Redirect to login with return URL

  - id: EX-002
    name: Insufficient Balance
    handling: Show clear error with available balance

  - id: EX-003
    name: Rate Limit Exceeded
    handling: Show cooldown timer

  - id: EX-004
    name: Service Maintenance
    handling: Show maintenance message with ETA

  - id: EX-005
    name: Network Error
    handling: Retry with exponential backoff, show retry option
