name: Wallet
display_name: Wallet / Ví điện tử
description: |
  User wallet for holding cryptocurrency assets on the exchange.
  Supports multiple wallet types for different trading functions.

domain: fintech
sub_domain: crypto
entity_type: core
version: "1.0"
status: active

# =============================================================================
# ATTRIBUTES
# =============================================================================
attributes:
  # Primary Key
  id:
    type: uuid
    primary_key: true
    description: Unique wallet identifier

  # User Reference
  user_id:
    type: uuid
    required: true
    indexed: true
    description: Owner of the wallet
    reference: users.id

  # Wallet Classification
  wallet_type:
    type: enum
    required: true
    values:
      - spot
      - funding
      - margin
      - futures
      - earn
    default: spot
    description: Type of wallet for different trading modes
    definition:
      spot: Regular trading wallet
      funding: For deposits/withdrawals, P2P
      margin: For margin trading (borrowed funds)
      futures: For futures/derivatives trading
      earn: For staking, savings, lending

  # Status
  status:
    type: enum
    required: true
    values:
      - active
      - frozen
      - suspended
      - closed
    default: active
    description: Wallet operational status
    definition:
      active: Normal operations allowed
      frozen: No withdrawals, trading paused
      suspended: No operations allowed
      closed: Permanently closed

  freeze_reason:
    type: enum
    required: false
    values:
      - security_concern
      - aml_investigation
      - user_request
      - regulatory_order
      - suspicious_activity
    description: Reason for wallet freeze

  # Calculated Values
  total_value_usd:
    type: decimal
    precision: 18
    scale: 2
    calculated: true
    description: Total value of all balances in USD

  total_value_btc:
    type: decimal
    precision: 18
    scale: 8
    calculated: true
    description: Total value of all balances in BTC

  # Settings
  hide_small_balances:
    type: boolean
    default: true
    description: Hide balances below threshold

  small_balance_threshold:
    type: decimal
    default: 1.00
    description: USD threshold for small balance

  # Timestamps
  created_at:
    type: timestamp
    auto_generate: true
    description: Wallet creation time

  last_activity_at:
    type: timestamp
    description: Last transaction or trade time

  frozen_at:
    type: timestamp
    description: When wallet was frozen

# =============================================================================
# RELATIONSHIPS
# =============================================================================
relationships:
  user:
    type: belongs_to
    entity: User
    foreign_key: user_id
    description: Wallet owner

  balances:
    type: has_many
    entity: Balance
    foreign_key: wallet_id
    description: Asset balances in this wallet

  deposits:
    type: has_many
    entity: Deposit
    foreign_key: wallet_id
    description: Incoming deposits

  withdrawals:
    type: has_many
    entity: Withdrawal
    foreign_key: wallet_id
    description: Outgoing withdrawals

  orders:
    type: has_many
    entity: Order
    foreign_key: wallet_id
    description: Trading orders from this wallet

# =============================================================================
# INDEXES
# =============================================================================
indexes:
  - name: idx_wallet_user
    columns: [user_id]
    unique: false

  - name: idx_wallet_user_type
    columns: [user_id, wallet_type]
    unique: true

  - name: idx_wallet_status
    columns: [status]
    unique: false

# =============================================================================
# BUSINESS RULES
# =============================================================================
business_rules:
  - id: BR-WAL-001
    name: One Wallet Type Per User
    name_vi: Mỗi loại ví một cái cho mỗi người dùng
    description: User can have only one wallet of each type
    enforcement: unique_constraint

  - id: BR-WAL-002
    name: Frozen Wallet Restrictions
    name_vi: Hạn chế ví bị đóng băng
    description: Frozen wallet cannot process withdrawals or trades
    enforcement: application_logic

  - id: BR-WAL-003
    name: Spot Wallet Required
    name_vi: Yêu cầu ví spot
    description: Spot wallet created automatically on registration
    enforcement: application_logic

# =============================================================================
# VALIDATIONS
# =============================================================================
validations:
  wallet_type:
    - rule: inclusion
      in: [spot, funding, margin, futures, earn]
      message: Invalid wallet type

  status:
    - rule: inclusion
      in: [active, frozen, suspended, closed]
      message: Invalid wallet status

# =============================================================================
# AUDIT
# =============================================================================
audit:
  enabled: true
  log_changes: true
  sensitive_fields: []
  retention_years: 7
