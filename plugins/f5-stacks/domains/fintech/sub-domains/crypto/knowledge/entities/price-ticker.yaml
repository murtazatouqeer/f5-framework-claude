name: PriceTicker
display_name: Price Ticker / Bảng giá
description: |
  Real-time and historical price data for a trading pair.
  Includes current price, 24-hour statistics, and OHLCV data.

domain: fintech
sub_domain: crypto
entity_type: aggregate
version: "1.0"
status: active

# =============================================================================
# ATTRIBUTES - REAL-TIME TICKER
# =============================================================================
attributes:
  # Identification
  trading_pair_id:
    type: uuid
    required: true
    indexed: true
    description: Trading pair reference
    reference: trading_pairs.id

  symbol:
    type: string
    max_length: 20
    required: true
    indexed: true
    description: Trading pair symbol

  # Current Price
  last_price:
    type: decimal
    precision: 28
    scale: 8
    required: true
    description: Most recent trade price

  last_quantity:
    type: decimal
    precision: 28
    scale: 8
    description: Quantity of last trade

  last_trade_time:
    type: timestamp
    description: Time of last trade

  # Bid/Ask
  bid_price:
    type: decimal
    precision: 28
    scale: 8
    description: Best bid price

  bid_quantity:
    type: decimal
    precision: 28
    scale: 8
    description: Quantity at best bid

  ask_price:
    type: decimal
    precision: 28
    scale: 8
    description: Best ask price

  ask_quantity:
    type: decimal
    precision: 28
    scale: 8
    description: Quantity at best ask

  # 24-Hour Statistics
  open_price:
    type: decimal
    precision: 28
    scale: 8
    description: Price 24 hours ago

  high_price:
    type: decimal
    precision: 28
    scale: 8
    description: 24-hour high

  low_price:
    type: decimal
    precision: 28
    scale: 8
    description: 24-hour low

  close_price:
    type: decimal
    precision: 28
    scale: 8
    description: Current/latest price (same as last_price)

  # Price Change
  price_change:
    type: decimal
    precision: 28
    scale: 8
    calculated: true
    description: Absolute price change (close - open)

  price_change_percent:
    type: decimal
    precision: 10
    scale: 4
    calculated: true
    description: Percentage price change

  # Volume
  volume:
    type: decimal
    precision: 28
    scale: 8
    description: 24-hour volume in base asset

  quote_volume:
    type: decimal
    precision: 28
    scale: 8
    description: 24-hour volume in quote asset

  # Trade Count
  trade_count:
    type: integer
    description: Number of trades in 24 hours

  # Weighted Average
  weighted_avg_price:
    type: decimal
    precision: 28
    scale: 8
    calculated: true
    description: Volume-weighted average price (quote_volume / volume)

  # Timestamps
  open_time:
    type: timestamp
    description: Start of 24-hour window

  close_time:
    type: timestamp
    description: End of 24-hour window (current)

  updated_at:
    type: timestamp
    auto_update: true
    description: Last update time

# =============================================================================
# OHLCV CANDLESTICK DATA
# =============================================================================
ohlcv:
  description: |
    OHLCV (Open, High, Low, Close, Volume) candlestick data
    for technical analysis and charting.

  intervals:
    - name: 1m
      duration: 1 minute
      retention: 7 days
      description: Scalping, high-frequency

    - name: 5m
      duration: 5 minutes
      retention: 30 days
      description: Day trading

    - name: 15m
      duration: 15 minutes
      retention: 90 days
      description: Intraday trading

    - name: 30m
      duration: 30 minutes
      retention: 90 days
      description: Intraday trading

    - name: 1h
      duration: 1 hour
      retention: 1 year
      description: Swing trading

    - name: 4h
      duration: 4 hours
      retention: 2 years
      description: Swing trading

    - name: 1d
      duration: 1 day
      retention: forever
      description: Position trading

    - name: 1w
      duration: 1 week
      retention: forever
      description: Long-term analysis

    - name: 1M
      duration: 1 month
      retention: forever
      description: Macro analysis

  candlestick_structure:
    open_time:
      type: timestamp
      description: Candle start time

    open:
      type: decimal
      description: Opening price

    high:
      type: decimal
      description: Highest price in interval

    low:
      type: decimal
      description: Lowest price in interval

    close:
      type: decimal
      description: Closing price

    volume:
      type: decimal
      description: Base asset volume

    close_time:
      type: timestamp
      description: Candle end time

    quote_volume:
      type: decimal
      description: Quote asset volume

    trade_count:
      type: integer
      description: Number of trades

    taker_buy_volume:
      type: decimal
      description: Taker buy base volume

    taker_buy_quote_volume:
      type: decimal
      description: Taker buy quote volume

# =============================================================================
# MARKET DATA STREAMS
# =============================================================================
streams:
  ticker_stream:
    name: "ticker@{symbol}"
    description: Real-time ticker updates
    update_speed: 1000ms
    fields:
      - symbol
      - last_price
      - price_change
      - price_change_percent
      - high_price
      - low_price
      - volume
      - quote_volume

  mini_ticker_stream:
    name: "miniTicker@{symbol}"
    description: Lightweight ticker updates
    update_speed: 1000ms
    fields:
      - symbol
      - last_price
      - open_price
      - high_price
      - low_price
      - volume

  all_tickers_stream:
    name: "!ticker@arr"
    description: All market tickers
    update_speed: 1000ms

  kline_stream:
    name: "kline@{symbol}@{interval}"
    description: Real-time candlestick updates
    update_speed: 1000ms
    intervals: [1m, 5m, 15m, 30m, 1h, 4h, 1d, 1w, 1M]

# =============================================================================
# DERIVED METRICS
# =============================================================================
derived_metrics:
  - name: spread
    formula: ask_price - bid_price
    description: Current spread

  - name: spread_percentage
    formula: (spread / last_price) * 100
    description: Spread as percentage

  - name: mid_price
    formula: (bid_price + ask_price) / 2
    description: Mid-market price

  - name: vwap
    formula: quote_volume / volume
    description: Volume-weighted average price

  - name: volatility_24h
    formula: (high_price - low_price) / low_price * 100
    description: 24-hour price range percentage

  - name: momentum
    formula: close_price - open_price
    description: Price momentum indicator

# =============================================================================
# TECHNICAL INDICATORS
# =============================================================================
technical_indicators:
  description: Common indicators calculated from OHLCV data

  moving_averages:
    - sma_7: Simple Moving Average (7 periods)
    - sma_25: Simple Moving Average (25 periods)
    - sma_99: Simple Moving Average (99 periods)
    - ema_7: Exponential Moving Average (7 periods)
    - ema_25: Exponential Moving Average (25 periods)

  oscillators:
    - rsi_14: Relative Strength Index (14 periods)
    - macd: MACD (12, 26, 9)
    - stochastic: Stochastic Oscillator (14, 3, 3)

  volume_indicators:
    - obv: On-Balance Volume
    - volume_sma: Volume SMA (20 periods)

  volatility:
    - bollinger_bands: Bollinger Bands (20, 2)
    - atr: Average True Range (14)

# =============================================================================
# MARKET SUMMARY
# =============================================================================
market_summary:
  description: Aggregate market statistics

  global_metrics:
    total_volume_24h:
      type: decimal
      description: Total 24h volume across all pairs (USD)

    total_trades_24h:
      type: integer
      description: Total trades across all pairs

    btc_dominance:
      type: decimal
      description: BTC trading volume dominance

    active_pairs:
      type: integer
      description: Number of actively traded pairs

  gainers_losers:
    top_gainers:
      type: array
      description: Top 10 gaining pairs by percentage
      fields: [symbol, price_change_percent, volume]

    top_losers:
      type: array
      description: Top 10 losing pairs by percentage
      fields: [symbol, price_change_percent, volume]

    top_volume:
      type: array
      description: Top 10 pairs by volume
      fields: [symbol, volume, quote_volume]

# =============================================================================
# CACHING STRATEGY
# =============================================================================
caching:
  realtime_data:
    cache_type: in_memory
    ttl: null
    description: Always fresh from matching engine

  ticker_24h:
    cache_type: redis
    ttl: 1s
    description: Frequently updated statistics

  ohlcv_1m:
    cache_type: redis
    ttl: 10s
    description: Current minute candle

  ohlcv_historical:
    cache_type: redis
    ttl: 60s
    description: Completed candles

  market_summary:
    cache_type: redis
    ttl: 5s
    description: Aggregate market data

# =============================================================================
# DATA RETENTION
# =============================================================================
data_retention:
  tick_data:
    retention: 24 hours
    description: Individual trade ticks

  ohlcv_1m:
    retention: 7 days
    aggregation: Archive to 5m after 24h

  ohlcv_5m:
    retention: 30 days
    aggregation: Keep as-is

  ohlcv_1h:
    retention: 1 year
    aggregation: Keep as-is

  ohlcv_1d:
    retention: forever
    aggregation: Keep as-is

# =============================================================================
# AUDIT
# =============================================================================
audit:
  enabled: false
  description: Market data is not audited, derived from trades
