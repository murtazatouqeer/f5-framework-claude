name: TradingPair
display_name: Trading Pair / Cặp giao dịch
description: |
  A trading pair representing the market for exchanging one cryptocurrency
  for another. Defines the base and quote assets and trading parameters.

domain: fintech
sub_domain: crypto
entity_type: reference
version: "1.0"
status: active

# =============================================================================
# ATTRIBUTES
# =============================================================================
attributes:
  # Primary Key
  id:
    type: uuid
    primary_key: true
    description: Unique trading pair identifier

  # Symbol
  symbol:
    type: string
    max_length: 20
    required: true
    unique: true
    indexed: true
    description: Trading pair symbol
    example: "BTC/USDT"

  # Asset References
  base_asset_id:
    type: uuid
    required: true
    indexed: true
    description: Base asset (first in pair)
    reference: crypto_assets.id
    example: "BTC in BTC/USDT"

  quote_asset_id:
    type: uuid
    required: true
    indexed: true
    description: Quote asset (second in pair)
    reference: crypto_assets.id
    example: "USDT in BTC/USDT"

  base_asset_symbol:
    type: string
    max_length: 20
    description: Base asset symbol (denormalized)

  quote_asset_symbol:
    type: string
    max_length: 20
    description: Quote asset symbol (denormalized)

  # Status
  status:
    type: enum
    required: true
    values:
      - active
      - suspended
      - delisted
      - pre_trading
    default: active
    indexed: true
    description: Trading pair status
    definition:
      active: Normal trading
      suspended: Trading temporarily halted
      delisted: Pair removed from exchange
      pre_trading: Announced but not yet trading

  trading_enabled:
    type: boolean
    default: true
    description: Whether trading is currently enabled

  # Price Precision
  price_precision:
    type: integer
    required: true
    min: 0
    max: 18
    description: Decimal places for price
    example: 2

  tick_size:
    type: decimal
    precision: 28
    scale: 18
    required: true
    description: Minimum price movement
    example: "0.01"

  # Quantity Precision
  quantity_precision:
    type: integer
    required: true
    min: 0
    max: 18
    description: Decimal places for quantity
    example: 6

  lot_size:
    type: decimal
    precision: 28
    scale: 18
    required: true
    description: Minimum quantity increment
    example: "0.000001"

  # Order Limits
  min_order_quantity:
    type: decimal
    precision: 28
    scale: 8
    required: true
    description: Minimum order quantity
    example: "0.0001"

  max_order_quantity:
    type: decimal
    precision: 28
    scale: 8
    description: Maximum order quantity per order
    example: "1000"

  min_notional:
    type: decimal
    precision: 18
    scale: 2
    required: true
    description: Minimum order value in quote asset
    example: "10.00"

  max_notional:
    type: decimal
    precision: 18
    scale: 2
    description: Maximum order value in quote asset
    example: "1000000.00"

  # Price Limits
  max_price:
    type: decimal
    precision: 28
    scale: 8
    description: Maximum allowed price

  min_price:
    type: decimal
    precision: 28
    scale: 8
    description: Minimum allowed price

  price_deviation_limit:
    type: decimal
    precision: 5
    scale: 2
    default: 10.00
    description: Max price deviation from market (%)

  # Rate Limits
  max_orders_per_second:
    type: integer
    default: 10
    description: Order rate limit per user

  max_open_orders:
    type: integer
    default: 200
    description: Maximum open orders per user

  # Fees
  maker_fee:
    type: decimal
    precision: 8
    scale: 6
    default: 0.001
    description: Default maker fee rate
    example: "0.001 = 0.1%"

  taker_fee:
    type: decimal
    precision: 8
    scale: 6
    default: 0.001
    description: Default taker fee rate
    example: "0.001 = 0.1%"

  # Market Classification
  market_type:
    type: enum
    values:
      - spot
      - margin
      - futures
    default: spot
    description: Market type

  tier:
    type: enum
    values:
      - tier_1
      - tier_2
      - tier_3
      - innovation
    default: tier_2
    description: Trading pair tier/category
    definition:
      tier_1: Major pairs (BTC, ETH against stables)
      tier_2: Mid-cap altcoins
      tier_3: Small-cap altcoins
      innovation: New/experimental tokens

  # Trading Hours
  trading_hours:
    type: enum
    values:
      - 24_7
      - market_hours
    default: 24_7
    description: Trading availability

  # Margin Trading (if applicable)
  margin_enabled:
    type: boolean
    default: false
    description: Whether margin trading is available

  max_leverage:
    type: integer
    description: Maximum leverage allowed
    example: 10

  # Order Types
  allowed_order_types:
    type: array
    items: string
    default: [limit, market]
    description: Allowed order types
    example: [limit, market, stop_limit, stop_market]

  allowed_time_in_force:
    type: array
    items: string
    default: [gtc, ioc, fok]
    description: Allowed time in force options

  # Features
  iceberg_enabled:
    type: boolean
    default: true
    description: Whether iceberg orders are allowed

  post_only_enabled:
    type: boolean
    default: true
    description: Whether post-only orders are allowed

  # Timestamps
  listed_at:
    type: timestamp
    description: When pair was listed

  delisted_at:
    type: timestamp
    description: When pair was delisted

  updated_at:
    type: timestamp
    auto_update: true

# =============================================================================
# RELATIONSHIPS
# =============================================================================
relationships:
  base_asset:
    type: belongs_to
    entity: CryptoAsset
    foreign_key: base_asset_id

  quote_asset:
    type: belongs_to
    entity: CryptoAsset
    foreign_key: quote_asset_id

  orders:
    type: has_many
    entity: Order
    foreign_key: trading_pair_id

  trades:
    type: has_many
    entity: Trade
    foreign_key: trading_pair_id

  price_tickers:
    type: has_many
    entity: PriceTicker
    foreign_key: trading_pair_id

# =============================================================================
# INDEXES
# =============================================================================
indexes:
  - name: idx_pair_symbol
    columns: [symbol]
    unique: true

  - name: idx_pair_base_quote
    columns: [base_asset_id, quote_asset_id]
    unique: true

  - name: idx_pair_status
    columns: [status]

  - name: idx_pair_tier
    columns: [tier]

  - name: idx_pair_active
    columns: [symbol]
    condition: "status = 'active' AND trading_enabled = true"

# =============================================================================
# VALIDATION RULES
# =============================================================================
validations:
  symbol:
    - rule: format
      pattern: "^[A-Z]+/[A-Z]+$"
      message: Symbol must be in format BASE/QUOTE

  min_order_quantity:
    - rule: numericality
      greater_than: 0

  min_notional:
    - rule: numericality
      greater_than: 0

  tick_size:
    - rule: numericality
      greater_than: 0

  lot_size:
    - rule: numericality
      greater_than: 0

# =============================================================================
# BUSINESS RULES
# =============================================================================
business_rules:
  - id: BR-TP-001
    name: Unique Asset Pair
    name_vi: Cặp tài sản duy nhất
    description: Same base/quote combination cannot exist twice
    enforcement: database_constraint

  - id: BR-TP-002
    name: Different Assets
    name_vi: Tài sản khác nhau
    description: Base and quote assets must be different
    enforcement: validation

  - id: BR-TP-003
    name: Active Assets Required
    name_vi: Yêu cầu tài sản hoạt động
    description: Both assets must be in active status
    enforcement: application_logic

  - id: BR-TP-004
    name: Precision Consistency
    name_vi: Tính nhất quán độ chính xác
    description: |
      tick_size must have no more decimal places than price_precision
      lot_size must have no more decimal places than quantity_precision
    enforcement: validation

# =============================================================================
# COMMON TRADING PAIRS
# =============================================================================
seed_data:
  - symbol: BTC/USDT
    base_asset_symbol: BTC
    quote_asset_symbol: USDT
    price_precision: 2
    quantity_precision: 6
    tick_size: 0.01
    lot_size: 0.000001
    min_order_quantity: 0.00001
    min_notional: 10
    tier: tier_1
    maker_fee: 0.001
    taker_fee: 0.001

  - symbol: ETH/USDT
    base_asset_symbol: ETH
    quote_asset_symbol: USDT
    price_precision: 2
    quantity_precision: 5
    tick_size: 0.01
    lot_size: 0.00001
    min_order_quantity: 0.0001
    min_notional: 10
    tier: tier_1
    maker_fee: 0.001
    taker_fee: 0.001

  - symbol: ETH/BTC
    base_asset_symbol: ETH
    quote_asset_symbol: BTC
    price_precision: 6
    quantity_precision: 4
    tick_size: 0.000001
    lot_size: 0.0001
    min_order_quantity: 0.001
    min_notional: 0.0001
    tier: tier_1
    maker_fee: 0.001
    taker_fee: 0.001

  - symbol: BNB/USDT
    base_asset_symbol: BNB
    quote_asset_symbol: USDT
    price_precision: 2
    quantity_precision: 3
    tick_size: 0.01
    lot_size: 0.001
    min_order_quantity: 0.01
    min_notional: 10
    tier: tier_1

  - symbol: SOL/USDT
    base_asset_symbol: SOL
    quote_asset_symbol: USDT
    price_precision: 3
    quantity_precision: 3
    tick_size: 0.001
    lot_size: 0.001
    min_order_quantity: 0.01
    min_notional: 10
    tier: tier_1

# =============================================================================
# AUDIT
# =============================================================================
audit:
  enabled: true
  log_changes: true
  sensitive_fields: []
  retention_years: 7
