# Pharmacist Use Cases
# F5 Framework v2.0 - Healthcare/Pharmacy
# Use cases from pharmacist perspective

use_cases:
  id: pharmacist-use-cases
  name: Pharmacist Use Cases
  name_ja: 薬剤師ユースケース
  description: Use cases for pharmacist clinical and dispensing activities
  domain: healthcare
  subdomain: pharmacy
  version: "1.0.0"
  actor: Pharmacist

  cases:
    # UC-RPH-001: Verify Prescription Entry
    - id: UC-RPH-001
      name: Verify Prescription Entry
      name_ja: 処方箋入力検証
      description: Pharmacist verifies accuracy of prescription data entry
      priority: critical
      
      preconditions:
        - Prescription entered by technician
        - Original prescription available (image or physical)
        - Patient profile complete
        
      trigger: Prescription queued for pharmacist verification
      
      main_flow:
        1:
          action: Pharmacist selects prescription from verification queue
          displays:
            - Entered prescription data
            - Original prescription image
            - Patient profile
            - DUR alerts
        2:
          action: Pharmacist compares entry to original
          verifies:
            - Patient name and DOB
            - Drug name and strength
            - Quantity and days supply
            - Directions (sig)
            - Refills authorized
            - Prescriber information
            - DAW code accuracy
        3:
          action: Pharmacist reviews prescriber validity
          checks:
            - NPI valid and active
            - DEA valid (if controlled)
            - State license active
            - Authorized for drug class
        4:
          action: Pharmacist reviews clinical appropriateness
          assesses:
            - Drug appropriate for patient
            - Dose reasonable
            - No contraindications
            - Directions clear
        5:
          action: Pharmacist resolves any DUR alerts
          options:
            - Acknowledge with documentation
            - Contact prescriber
            - Reject and modify
        6:
          action: Pharmacist approves or rejects entry
          if_approved:
            - Sign off verification
            - Queue for filling
          if_rejected:
            - Document reason
            - Return to data entry
            
      alternate_flows:
        entry_error:
          trigger: Entry does not match original
          flow:
            - Pharmacist documents discrepancy
            - Returns to technician for correction
            - Re-verification required
        clinical_concern:
          trigger: Drug therapy problem identified
          flow:
            - Pharmacist documents concern
            - Contacts prescriber
            - Awaits clarification
            - Proceeds based on response
            
      postconditions:
        - Prescription entry verified
        - Clinical review documented
        - Prescription queued for filling or held
        
      regulatory_requirement:
        - State law requires pharmacist verification
        - Cannot delegate final verification
        
      business_rules:
        - BR-DIS-001 through BR-DIS-007

    # UC-RPH-002: Perform Drug Utilization Review
    - id: UC-RPH-002
      name: Perform Drug Utilization Review
      name_ja: 薬剤使用評価
      description: Pharmacist performs prospective DUR on prescription
      priority: critical
      
      preconditions:
        - Prescription ready for clinical review
        - Patient medication history available
        - DUR database current
        
      trigger: System generates DUR alerts during processing
      
      main_flow:
        1:
          action: Pharmacist receives DUR alert notification
          alert_types:
            - Drug-drug interaction
            - Drug-allergy interaction
            - Drug-disease interaction
            - Therapeutic duplication
            - Dose/duration concern
            - Age/gender appropriateness
        2:
          action: Pharmacist reviews alert details
          displays:
            - Interacting medications
            - Severity level
            - Clinical significance
            - Recommendation
        3:
          action: Pharmacist assesses clinical significance
          considers:
            - Alert severity
            - Patient-specific factors
            - Clinical context
            - Risk vs benefit
        4:
          action: Pharmacist makes clinical decision
          options:
            approve_with_monitoring:
              action: "Proceed with counseling points"
              documentation: "Clinical reasoning documented"
            contact_prescriber:
              action: "Call for clarification/alternative"
              documentation: "Intervention recorded"
            reject_prescription:
              action: "Cannot fill safely"
              documentation: "Refusal documented"
        5:
          action: Pharmacist documents intervention
          records:
            - Alert type and severity
            - Decision made
            - Clinical reasoning
            - Prescriber contact if applicable
            - Outcome
            
      postconditions:
        - DUR review completed
        - Intervention documented
        - Prescription disposition determined
        
      quality_metrics:
        - DUR override rate
        - Intervention rate
        - Prescriber contact rate
        
      business_rules:
        - BR-DUR-001 through BR-DUR-016

    # UC-RPH-003: Final Product Verification
    - id: UC-RPH-003
      name: Final Product Verification
      name_ja: 最終製品検証
      description: Pharmacist performs final check before dispensing
      priority: critical
      
      preconditions:
        - Prescription filled by technician
        - Product packaged and labeled
        - Ready for pharmacist verification
        
      trigger: Filled prescription staged for final check
      
      main_flow:
        1:
          action: Pharmacist receives filled prescription
          staging:
            - Labeled vial/package
            - Prescription hard copy or image
            - Patient profile visible
        2:
          action: Pharmacist verifies product selection
          checks:
            - Correct drug (NDC matches)
            - Correct strength
            - Correct form
            - Appearance matches database image
        3:
          action: Pharmacist verifies quantity
          methods:
            - Visual count estimate
            - Weight verification (optional)
            - Barcode scan confirmation
        4:
          action: Pharmacist verifies label accuracy
          confirms:
            - Patient name correct
            - Drug/strength matches product
            - Directions complete and clear
            - Prescriber listed
            - Refills correct
            - Expiration dating appropriate
            - Required warnings applied
        5:
          action: Pharmacist assesses packaging
          verifies:
            - Appropriate container
            - Child-resistant (or documented exception)
            - Professional appearance
        6:
          action: Pharmacist signs off verification
          records:
            - Verification initials
            - Timestamp
            - Any notes
        7:
          action: Prescription staged for patient pickup
          
      alternate_flows:
        error_detected:
          trigger: Discrepancy found during verification
          flow:
            - Pharmacist documents error
            - Returns to filling with instructions
            - Error tracked for quality improvement
            - Re-verification required after correction
            
      postconditions:
        - Prescription verified safe and accurate
        - Ready for dispensing
        - Verification documented
        
      error_prevention:
        - Never verify own work if avoidable
        - Compare product to prescription, not label
        - Use barcode scanning when available

    # UC-RPH-004: Review PDMP
    - id: UC-RPH-004
      name: Review Prescription Drug Monitoring Program
      name_ja: 処方薬監視プログラム確認
      description: Pharmacist queries and reviews PDMP for controlled substance
      priority: critical
      
      preconditions:
        - Controlled substance prescription received
        - PDMP access credentials active
        - Patient consent obtained (if required by state)
        
      trigger: Controlled substance prescription processing
      
      main_flow:
        1:
          action: Pharmacist accesses PDMP system
          access:
            - Integrated through pharmacy system
            - Direct PDMP website login
        2:
          action: Pharmacist enters patient identifiers
          search_criteria:
            - Patient name
            - Date of birth
            - Address (if required)
        3:
          action: PDMP returns patient history
          displays:
            - All controlled substances
            - Date range (typically 12 months)
            - Prescribers
            - Pharmacies
            - Quantities and days supply
        4:
          action: Pharmacist analyzes results
          evaluates:
            - Number of prescribers
            - Number of pharmacies
            - Drug quantities (MME for opioids)
            - Fill patterns
            - Concerning combinations
        5:
          action: Pharmacist assesses risk indicators
          red_flags:
            - Multiple prescribers (>3 in 90 days)
            - Multiple pharmacies (>3 in 90 days)
            - High opioid doses (>90 MME/day)
            - Overlapping controlled prescriptions
            - Opioid + benzodiazepine combination
            - Early refill patterns
        6:
          action: Pharmacist makes clinical decision
          outcomes:
            clear: "No concerns, proceed with fill"
            concerning: "Contact prescriber, document discussion"
            refuse: "Cannot fill safely, document refusal"
        7:
          action: Pharmacist documents PDMP review
          records:
            - Query date/time
            - Findings summary
            - Risk assessment
            - Decision and rationale
            
      postconditions:
        - PDMP review completed
        - Findings documented
        - Dispensing decision made
        
      state_requirements:
        - Many states mandate PDMP check
        - Frequency varies by state
        - Documentation requirements vary
        
      business_rules:
        - BR-CS-005 (PDMP requirements)

    # UC-RPH-005: Contact Prescriber
    - id: UC-RPH-005
      name: Contact Prescriber for Clarification
      name_ja: 処方医への確認連絡
      description: Pharmacist contacts prescriber to resolve prescription issue
      priority: high
      
      preconditions:
        - Prescription requires clarification
        - Prescriber contact information available
        - Issue documented
        
      trigger: Clinical or administrative issue with prescription
      
      main_flow:
        1:
          action: Pharmacist identifies need for contact
          reasons:
            - Clinical concerns (dose, drug selection)
            - Missing information
            - Clarification needed (illegible, confusing)
            - DUR alerts requiring prescriber input
            - Therapeutic interchange request
            - Refill authorization request
        2:
          action: Pharmacist prepares for call
          gathers:
            - Patient information
            - Prescription details
            - Specific question or concern
            - Patient medication history
            - Suggested alternatives (if applicable)
        3:
          action: Pharmacist contacts prescriber office
          methods:
            - Phone call (urgent)
            - Fax (routine)
            - Electronic message (if available)
        4:
          action: Pharmacist presents concern
          communication:
            - Identify self and pharmacy
            - State patient and medication
            - Clearly explain concern
            - Provide recommendation if appropriate
        5:
          action: Prescriber provides response
          response_types:
            - Clarification provided
            - Change authorized
            - Original order confirmed
            - Prescription cancelled
        6:
          action: Pharmacist documents interaction
          records:
            - Date and time
            - Person spoken to
            - Issue presented
            - Resolution obtained
            - Any changes made
        7:
          action: Pharmacist implements resolution
          actions:
            - Update prescription as authorized
            - Add documentation
            - Proceed with processing
            
      postconditions:
        - Issue resolved
        - Prescription can be processed or appropriately handled
        - Documentation complete
        
      documentation_requirement:
        - All prescriber contacts documented
        - Changes documented with authorization
        - Maintain audit trail

    # UC-RPH-006: Provide Patient Counseling
    - id: UC-RPH-006
      name: Provide Patient Counseling
      name_ja: 患者カウンセリング提供
      description: Pharmacist counsels patient on medication use
      priority: high
      
      preconditions:
        - Prescription ready for dispensing
        - Patient present (or caregiver)
        - Counseling environment available
        
      trigger: New prescription pickup or patient request
      
      main_flow:
        1:
          action: Pharmacist offers counseling
          required_for:
            - New prescriptions
            - Changed medications
            - Patient or caregiver request
            - High-risk medications
        2:
          action: Patient accepts counseling
        3:
          action: Pharmacist reviews medication with patient
          covers:
            - Name and purpose of medication
            - Directions for use (dose, frequency, route)
            - Expected duration of therapy
            - Special administration instructions
            - Common side effects
            - Serious side effects requiring attention
            - Drug and food interactions
            - Storage requirements
            - Refill information
        4:
          action: Pharmacist uses teach-back method
          confirms: Patient understanding of key points
        5:
          action: Pharmacist answers patient questions
          addresses:
            - Patient concerns
            - Clarification requests
            - Practical questions
        6:
          action: Pharmacist provides written materials
          includes:
            - Medication guide (if required)
            - Patient information sheet
            - Special device instructions (if applicable)
        7:
          action: Pharmacist documents counseling
          records:
            - Counseling offered
            - Counseling provided
            - Topics covered
            - Patient questions
            - Special concerns noted
            
      alternate_flows:
        patient_declines:
          trigger: Patient refuses counseling
          flow:
            - Document offer
            - Obtain signature (if state requires)
            - Note declination in system
        language_barrier:
          trigger: Patient doesn't speak English
          flow:
            - Use interpreter services
            - Provide translated materials
            - Document language accommodation
            
      postconditions:
        - Patient informed about medication
        - Counseling documented
        - Patient can safely use medication
        
      regulatory_requirement:
        - OBRA '90 requires counseling offer
        - State laws may be more stringent

    # UC-RPH-007: Manage Controlled Substance Inventory
    - id: UC-RPH-007
      name: Manage Controlled Substance Inventory
      name_ja: 規制薬物在庫管理
      description: Pharmacist maintains and verifies controlled substance inventory
      priority: critical
      
      preconditions:
        - Pharmacist is PIC or authorized
        - Access to controlled substance storage
        - Perpetual inventory system in place
        
      trigger: Regular inventory duties or discrepancy identified
      
      main_flow:
        1:
          action: Pharmacist performs physical count
          timing:
            - Daily for high-movement C-II
            - Weekly for other controlled
            - Upon receipt of order
            - At discrepancy identification
        2:
          action: Pharmacist compares to perpetual inventory
          verification:
            - System quantity vs physical count
            - By NDC and lot number
        3:
          action: Pharmacist investigates discrepancies
          investigation:
            - Review recent transactions
            - Check for entry errors
            - Look for pending dispenses
            - Review waste documentation
        4:
          action: Pharmacist resolves discrepancy
          resolutions:
            - Documentation error: Correct entry
            - Count error: Recount and adjust
            - Unexplained loss: Escalate per policy
        5:
          action: Pharmacist documents inventory
          records:
            - Date and time
            - Drug counted
            - Physical count
            - System count
            - Discrepancy resolution
        6:
          action: Pharmacist secures inventory
          ensures:
            - Locked storage
            - Limited access
            - Documentation complete
            
      discrepancy_handling:
        minor_discrepancy:
          threshold: "< 2 units"
          action: "Document, investigate, adjust"
        significant_discrepancy:
          threshold: ">= 2 units"
          action: "Manager notification, thorough investigation"
        suspected_diversion:
          action: "Immediate investigation, possible DEA notification"
          
      postconditions:
        - Inventory verified
        - Discrepancies resolved or escalated
        - Documentation complete
        
      business_rules:
        - BR-CS-006 (perpetual inventory)
        - BR-CS-013 (discrepancy investigation)

    # UC-RPH-008: Process Immunization
    - id: UC-RPH-008
      name: Administer Immunization
      name_ja: 予防接種実施
      description: Pharmacist screens, administers, and documents immunization
      priority: medium
      
      preconditions:
        - Pharmacist immunization certified
        - Patient consent obtained
        - Vaccine available and properly stored
        - Emergency supplies available
        
      trigger: Patient requests immunization or recommended by screening
      
      main_flow:
        1:
          action: Pharmacist screens patient
          screening:
            - Review medical history
            - Check for contraindications
            - Verify prior immunizations
            - Assess current health status
        2:
          action: Pharmacist reviews VIS with patient
          requirement: Vaccine Information Statement must be provided
        3:
          action: Patient provides informed consent
          documentation:
            - Consent form signed
            - VIS receipt acknowledged
        4:
          action: Pharmacist prepares vaccine
          preparation:
            - Verify vaccine and expiration
            - Prepare proper dose
            - Select administration site
        5:
          action: Pharmacist administers vaccine
          technique:
            - Proper injection technique
            - Appropriate needle length
            - Correct anatomical site
        6:
          action: Pharmacist observes patient
          observation:
            - Minimum 15 minutes for most vaccines
            - 30 minutes if history of reaction
            - Monitor for adverse reactions
        7:
          action: Pharmacist documents administration
          records:
            - Vaccine name and manufacturer
            - Lot number and expiration
            - Administration site
            - VIS date
            - Administering pharmacist
        8:
          action: Pharmacist reports to registry
          reporting:
            - State immunization registry
            - Patient's physician (if requested)
            
      postconditions:
        - Patient immunized
        - Documentation complete
        - Registry updated
        
      emergency_preparation:
        - Epinephrine available
        - Emergency protocols known
        - Support contacted if needed

  clinical_competencies:
    - Drug therapy knowledge
    - Patient assessment skills
    - Clinical decision-making
    - Communication skills
    - Documentation proficiency
    - Regulatory knowledge

  success_metrics:
    - verification_accuracy_rate
    - intervention_documentation_rate
    - pdmp_compliance_rate
    - counseling_completion_rate
    - controlled_inventory_accuracy
    - immunization_volume
