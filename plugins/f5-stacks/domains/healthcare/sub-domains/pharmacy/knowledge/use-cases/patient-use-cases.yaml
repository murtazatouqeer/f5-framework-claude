# Patient Use Cases
# F5 Framework v2.0 - Healthcare/Pharmacy
# Use cases from patient perspective

use_cases:
  id: patient-use-cases
  name: Patient Use Cases
  name_ja: 患者ユースケース
  description: Use cases for patient interactions with pharmacy services
  domain: healthcare
  subdomain: pharmacy
  version: "1.0.0"
  actor: Patient

  cases:
    # UC-PAT-001: Request Prescription Refill
    - id: UC-PAT-001
      name: Request Prescription Refill
      name_ja: 処方箋リフィル依頼
      description: Patient requests refill of existing prescription
      priority: high
      
      preconditions:
        - Patient has active prescription on file
        - Patient is registered in pharmacy system
        - Prescription has refills remaining OR can be renewed
        
      trigger: Patient needs medication refill
      
      main_flow:
        1:
          action: Patient accesses refill request channel
          channels:
            - Mobile app
            - Website portal
            - Phone/IVR
            - In-store request
        2:
          action: System authenticates patient identity
          methods:
            - App login (biometric/password)
            - Phone verification (DOB + phone digits)
            - In-store ID verification
        3:
          action: Patient selects prescription to refill
          display:
            - Medication name and strength
            - Last fill date
            - Refills remaining
            - Estimated ready time
        4:
          action: System validates refill eligibility
          checks:
            - Refills available
            - Not too soon
            - Prescription not expired
        5:
          action: Patient selects pickup or delivery
          options:
            - Store pickup
            - Curbside pickup
            - Mail delivery
            - Same-day delivery
        6:
          action: System processes refill request
          steps:
            - Check insurance coverage
            - Estimate copay
            - Add to fill queue
        7:
          action: Patient receives confirmation
          includes:
            - Estimated ready time
            - Copay amount
            - Pickup/delivery details
        8:
          action: Patient receives ready notification
          methods:
            - SMS text
            - Email
            - App push notification
        9:
          action: Patient picks up or receives prescription
          
      alternate_flows:
        no_refills:
          trigger: Refills exhausted
          flow:
            - System notifies patient
            - Offers to request new prescription from prescriber
            - Patient confirms request
            - Pharmacy contacts prescriber
            - Patient notified of outcome
        too_soon:
          trigger: Refill requested before eligible date
          flow:
            - System displays next fill date
            - Offers to schedule for later
            - Patient can request vacation override
            - Or choose to pay cash
        prescription_expired:
          trigger: Prescription past expiration date
          flow:
            - System notifies patient
            - Pharmacy contacts prescriber
            - New prescription required
            - Patient notified when ready
            
      postconditions:
        - Refill request is processed
        - Patient is notified of status
        - Prescription ready for pickup/delivery
        
      business_rules:
        - BR-DIS-005 (refill timing)
        - BR-BIL-008 (refill too soon)
        
      related_workflows:
        - refill-workflow
        - dispensing-workflow

    # UC-PAT-002: Transfer Prescription
    - id: UC-PAT-002
      name: Transfer Prescription
      name_ja: 処方箋転送依頼
      description: Patient requests prescription transfer from another pharmacy
      priority: medium
      
      preconditions:
        - Patient has prescription at another pharmacy
        - Patient has created profile at receiving pharmacy
        - Prescription is eligible for transfer
        
      trigger: Patient wants to fill prescription at different pharmacy
      
      main_flow:
        1:
          action: Patient contacts new pharmacy
          methods:
            - In-store request
            - Phone request
            - Online transfer request
        2:
          action: Patient provides transfer information
          required:
            - Original pharmacy name and phone
            - Medication name
            - Patient information
        3:
          action: New pharmacy contacts original pharmacy
          method: Phone or electronic
        4:
          action: Pharmacist-to-pharmacist transfer
          exchange:
            - Full prescription details
            - Refills remaining
            - Original prescription number
        5:
          action: New pharmacy enters prescription
          creates: New prescription record with transfer documentation
        6:
          action: Original pharmacy invalidates prescription
          status: Transferred out
        7:
          action: Patient notified transfer complete
          includes:
            - New Rx number
            - Refills available
            - Estimated ready time
            
      alternate_flows:
        controlled_substance:
          trigger: Controlled C-III through C-V prescription
          flow:
            - One-time transfer only rule applies
            - Additional documentation required
            - Cannot transfer C-II prescriptions
        out_of_state:
          trigger: Transfer from different state
          flow:
            - Verify reciprocity
            - Additional verification steps
            - May require prescriber contact
            
      postconditions:
        - Prescription transferred to new pharmacy
        - Original pharmacy record updated
        - Patient can fill at new location
        
      business_rules:
        - BR-CS-011 (controlled transfer)
        - BR-DIS-001 (prescription validity)
        
      exceptions:
        - Schedule II controlled substances cannot be transferred
        - Some states have additional transfer restrictions

    # UC-PAT-003: View Prescription History
    - id: UC-PAT-003
      name: View Prescription History
      name_ja: 処方履歴閲覧
      description: Patient views their medication history and prescription details
      priority: medium
      
      preconditions:
        - Patient registered in pharmacy system
        - Patient authenticated
        
      trigger: Patient wants to review medication history
      
      main_flow:
        1:
          action: Patient logs into patient portal/app
          authentication: Secure login required
        2:
          action: Patient navigates to prescription history
        3:
          action: System displays prescription list
          shows:
            - Active prescriptions
            - Fill history
            - Pending prescriptions
            - Expired prescriptions
        4:
          action: Patient selects prescription for details
          displays:
            - Medication name and strength
            - Prescriber information
            - Fill dates and quantities
            - Refills remaining
            - Copay history
        5:
          action: Patient can perform actions
          options:
            - Request refill
            - Set refill reminders
            - Request records export
            - View medication images
            
      postconditions:
        - Patient viewed requested information
        - Access logged for audit
        
      hipaa_compliance:
        - Secure access required
        - Audit trail maintained
        - Data encrypted in transit

    # UC-PAT-004: Enroll in Auto-Refill
    - id: UC-PAT-004
      name: Enroll in Auto-Refill Program
      name_ja: 自動リフィル登録
      description: Patient enrolls prescriptions in automatic refill program
      priority: medium
      
      preconditions:
        - Patient has active maintenance medications
        - Prescriptions have refills remaining
        - Medications eligible for auto-refill
        
      trigger: Patient wants automatic prescription refills
      
      main_flow:
        1:
          action: Patient accesses auto-refill settings
          location: App, website, or in-store
        2:
          action: System displays eligible prescriptions
          filters_out:
            - Controlled substances (C-II)
            - PRN medications
            - Short-term prescriptions
        3:
          action: Patient selects prescriptions to enroll
        4:
          action: Patient reviews program terms
          includes:
            - Fill timing calculation
            - Notification policy
            - Skip/cancel options
        5:
          action: Patient provides consent
          consent_elements:
            - Authorization to fill automatically
            - Notification preferences
            - Pickup/delivery preference
        6:
          action: System enrolls prescriptions
          setup:
            - Calculate next fill date
            - Set notification triggers
            - Store preferences
        7:
          action: Patient receives confirmation
          includes:
            - Enrolled medications
            - Expected next fill dates
            - How to manage enrollment
            
      alternate_flows:
        skip_fill:
          trigger: Patient doesn't need scheduled fill
          flow:
            - Patient receives upcoming fill notification
            - Patient selects "skip this fill"
            - Fill is cancelled
            - Next fill rescheduled
        unenroll:
          trigger: Patient wants to stop auto-refill
          flow:
            - Patient accesses enrollment settings
            - Selects prescription to remove
            - Confirms unenrollment
            - Future auto-fills cancelled
            
      postconditions:
        - Prescriptions enrolled in auto-refill
        - Patient preferences stored
        - Automatic fills scheduled

    # UC-PAT-005: Check Prescription Price
    - id: UC-PAT-005
      name: Check Prescription Price
      name_ja: 処方箋価格確認
      description: Patient checks price/copay for prescription before filling
      priority: medium
      
      preconditions:
        - Prescription exists in system
        - Patient insurance on file (if applicable)
        
      trigger: Patient wants to know cost before filling
      
      main_flow:
        1:
          action: Patient requests price check
          methods:
            - App/website price lookup
            - Phone inquiry
            - In-store request
        2:
          action: System retrieves prescription details
        3:
          action: System submits test claim (if insured)
          returns:
            - Copay amount
            - Deductible status
            - Coverage tier
        4:
          action: System calculates cash price
          displays: Price without insurance
        5:
          action: System checks discount programs
          options:
            - Manufacturer coupons
            - Pharmacy discount cards
            - GoodRx / RxSaver prices
        6:
          action: Patient views price comparison
          shows:
            - Insurance copay
            - Cash price
            - Discount program prices
            - Generic alternatives if available
        7:
          action: Patient makes informed decision
          options:
            - Proceed with fill
            - Request generic
            - Use discount program
            - Decline/shop around
            
      postconditions:
        - Patient informed of prescription cost
        - Pricing logged for reference

    # UC-PAT-006: Report Medication Side Effect
    - id: UC-PAT-006
      name: Report Medication Side Effect
      name_ja: 副作用報告
      description: Patient reports experiencing side effect from medication
      priority: high
      
      preconditions:
        - Patient has active or recent prescription
        - Side effect related to dispensed medication
        
      trigger: Patient experiences adverse reaction or side effect
      
      main_flow:
        1:
          action: Patient contacts pharmacy
          urgency_routing:
            - Emergency symptoms: Direct to 911 first
            - Serious reaction: Immediate pharmacist
            - Minor concern: Standard consultation
        2:
          action: Pharmacist conducts consultation
          assessment:
            - Symptom description
            - Onset timing
            - Severity assessment
            - Other medications review
        3:
          action: Pharmacist provides guidance
          options:
            - Self-care recommendations
            - Stop medication and contact prescriber
            - Seek immediate medical attention
        4:
          action: Pharmacist documents interaction
          records:
            - Reported symptoms
            - Assessment and recommendations
            - Follow-up if needed
        5:
          action: Pharmacist considers reporting
          reports_to:
            - FDA MedWatch (if serious)
            - Prescriber notification
            - Patient profile update (allergy if applicable)
            
      postconditions:
        - Patient received guidance
        - Interaction documented
        - Appropriate reporting completed

    # UC-PAT-007: Request Medication Synchronization
    - id: UC-PAT-007
      name: Request Medication Synchronization
      name_ja: 服薬同期化依頼
      description: Patient requests to sync multiple prescriptions to same fill date
      priority: medium
      
      preconditions:
        - Patient has multiple maintenance medications
        - Prescriptions eligible for synchronization
        
      trigger: Patient wants to pick up all medications together
      
      main_flow:
        1:
          action: Patient requests med sync consultation
          method: In-store, phone, or app
        2:
          action: Pharmacist reviews patient profile
          analyzes:
            - Current medications
            - Fill patterns
            - Refill quantities remaining
        3:
          action: Pharmacist identifies sync date
          considers:
            - Patient preference
            - Most medications due
            - Insurance timing
        4:
          action: Pharmacist proposes sync plan
          includes:
            - Target sync date
            - Short fills needed
            - Adjusted quantities
        5:
          action: Patient agrees to plan
        6:
          action: System adjusts fill schedule
          actions:
            - Set sync date flag
            - Calculate partial fills
            - Adjust future quantities
        7:
          action: Medications synchronized
          outcome:
            - All medications fill same date monthly
            - Single pickup trip
            - Coordinated refill reminders
            
      postconditions:
        - Medications aligned to single fill date
        - Ongoing sync maintained
        
      benefits:
        - Improved adherence
        - Convenience for patient
        - Fewer pharmacy trips

    # UC-PAT-008: Receive Pharmacist Counseling
    - id: UC-PAT-008
      name: Receive Pharmacist Counseling
      name_ja: 薬剤師カウンセリング
      description: Patient receives medication counseling from pharmacist
      priority: high
      
      preconditions:
        - Prescription ready for pickup
        - Pharmacist available
        
      trigger: New prescription pickup or patient request
      
      main_flow:
        1:
          action: Patient picks up prescription
        2:
          action: Staff offers pharmacist counseling
          requirement: "Required by law for new prescriptions"
        3:
          action: Patient accepts counseling
        4:
          action: Pharmacist provides counseling
          covers:
            - Medication name and purpose
            - Proper dosing and administration
            - Expected side effects
            - Drug interactions to avoid
            - Storage instructions
            - What to do if dose missed
            - When to seek medical attention
        5:
          action: Pharmacist answers patient questions
        6:
          action: Pharmacist provides written materials
          includes:
            - Medication guide
            - Patient information sheet
            - Administration aids if needed
        7:
          action: Counseling documented
          records:
            - Counseling offered
            - Counseling accepted/declined
            - Topics covered
            - Patient questions
            
      alternate_flows:
        patient_declines:
          trigger: Patient declines counseling
          flow:
            - Document offer
            - Patient signs declination (if required)
            - Note in system
            
      postconditions:
        - Patient informed about medication
        - Counseling documented
        - Patient can use medication safely

  success_metrics:
    - refill_request_completion_rate
    - time_to_ready_notification
    - auto_refill_enrollment_rate
    - patient_satisfaction_score
    - counseling_acceptance_rate

  accessibility_requirements:
    - Multiple request channels (app, web, phone, in-store)
    - Language support for prescription information
    - Large print labels available
    - TTY/TDD for hearing impaired
    - Medication guides in multiple formats
