# Drug Entity
# F5 Framework v2.0 - Healthcare/Pharmacy
# Core drug/medication master data entity

entity:
  id: drug
  name: Drug
  name_ja: 医薬品
  description: Master data for drugs and medications in pharmacy system
  domain: healthcare
  subdomain: pharmacy
  version: "1.0.0"

  attributes:
    # Primary Identifiers
    - name: drug_id
      type: uuid
      primary_key: true
      description: Unique drug identifier
      
    - name: ndc
      type: string
      length: 11
      unique: true
      required: true
      description: National Drug Code (11-digit format)
      format: "XXXXX-XXXX-XX"
      
    - name: ndc_10
      type: string
      length: 10
      description: 10-digit NDC format
      
    - name: rxnorm_cui
      type: string
      description: RxNorm Concept Unique Identifier
      
    - name: gpi
      type: string
      length: 14
      description: Generic Product Identifier
      
    - name: upc
      type: string
      length: 12
      description: Universal Product Code for OTC products

    # Drug Names
    - name: brand_name
      type: string
      length: 255
      description: Brand/trade name
      
    - name: generic_name
      type: string
      length: 255
      required: true
      description: Generic/chemical name
      
    - name: proprietary_name
      type: string
      length: 255
      description: Proprietary name from labeler
      
    - name: display_name
      type: string
      length: 255
      description: Preferred display name

    # Manufacturer/Labeler
    - name: labeler_name
      type: string
      length: 255
      required: true
      description: Drug manufacturer/labeler name
      
    - name: labeler_code
      type: string
      length: 5
      description: NDC labeler code (first 5 digits)

    # Drug Classification
    - name: drug_class
      type: string
      description: Therapeutic class
      
    - name: pharmacologic_class
      type: string
      description: Pharmacologic/mechanism class
      
    - name: dea_schedule
      type: enum
      values: [unscheduled, II, III, IV, V]
      default: unscheduled
      description: DEA controlled substance schedule
      
    - name: otc_monograph
      type: boolean
      default: false
      description: Is OTC monograph product

    # Dosage Information
    - name: dosage_form
      type: string
      length: 100
      required: true
      description: Form (tablet, capsule, solution, etc.)
      examples: [TABLET, CAPSULE, SOLUTION, SUSPENSION, INJECTION]
      
    - name: strength
      type: string
      length: 100
      required: true
      description: Drug strength (e.g., "500 MG")
      
    - name: strength_numeric
      type: decimal
      precision: 10
      scale: 4
      description: Numeric strength value
      
    - name: strength_unit
      type: string
      length: 20
      description: Strength unit (MG, ML, MCG, etc.)
      
    - name: route_of_administration
      type: string
      length: 100
      description: Route (oral, topical, injection, etc.)
      examples: [ORAL, TOPICAL, INTRAVENOUS, INTRAMUSCULAR, SUBCUTANEOUS]

    # Package Information
    - name: package_size
      type: decimal
      precision: 10
      scale: 2
      description: Package quantity
      
    - name: package_unit
      type: string
      length: 20
      description: Package unit (EA, ML, GM)
      
    - name: package_description
      type: string
      length: 255
      description: Full package description
      
    - name: unit_dose
      type: boolean
      default: false
      description: Is unit dose packaging

    # Pricing
    - name: awp
      type: decimal
      precision: 12
      scale: 4
      description: Average Wholesale Price
      
    - name: wac
      type: decimal
      precision: 12
      scale: 4
      description: Wholesale Acquisition Cost
      
    - name: aac
      type: decimal
      precision: 12
      scale: 4
      description: Actual Acquisition Cost
      
    - name: mac
      type: decimal
      precision: 12
      scale: 4
      description: Maximum Allowable Cost
      
    - name: unit_price
      type: decimal
      precision: 12
      scale: 6
      description: Price per dispensing unit

    # Dispensing Information
    - name: dispense_unit
      type: string
      length: 20
      description: Unit for dispensing (EA, ML, GM)
      
    - name: units_per_package
      type: decimal
      precision: 10
      scale: 2
      description: Dispensing units per package
      
    - name: default_days_supply
      type: integer
      description: Default days supply for quantity
      
    - name: max_daily_dose
      type: decimal
      precision: 10
      scale: 2
      description: Maximum daily dose
      
    - name: typical_quantity
      type: integer
      description: Typical dispensed quantity

    # Storage Requirements
    - name: storage_requirements
      type: enum
      values: [room_temp, refrigerated, frozen, controlled_room_temp]
      default: room_temp
      description: Storage temperature requirements
      
    - name: light_sensitive
      type: boolean
      default: false
      description: Requires protection from light
      
    - name: hazardous
      type: boolean
      default: false
      description: USP <800> hazardous drug

    # Regulatory Status
    - name: fda_status
      type: enum
      values: [approved, tentative, discontinued, recalled]
      default: approved
      
    - name: rems_required
      type: boolean
      default: false
      description: REMS program required
      
    - name: rems_id
      type: string
      description: REMS program identifier
      
    - name: black_box_warning
      type: boolean
      default: false
      description: Has FDA black box warning

    # Therapeutic Equivalence
    - name: orange_book_code
      type: string
      length: 10
      description: FDA Orange Book therapeutic equivalence code
      examples: [AA, AB, AB1, AB2, AB3, AN, AO, AP, AT, BC, BD, BE, BN, BP, BR, BS, BT, BX]
      
    - name: reference_ndc
      type: string
      length: 11
      description: Reference listed drug NDC
      
    - name: multi_source
      type: enum
      values: [Y, N, M]
      description: Multi-source indicator

    # Status
    - name: status
      type: enum
      values: [active, inactive, discontinued, recalled]
      default: active
      
    - name: effective_date
      type: date
      description: Date drug became available
      
    - name: discontinue_date
      type: date
      description: Date drug was discontinued

    # Audit
    - name: created_at
      type: timestamp
      auto: create
      
    - name: updated_at
      type: timestamp
      auto: update
      
    - name: data_source
      type: string
      description: Source of drug data (FDB, Medi-Span, etc.)

  relationships:
    - name: interactions
      type: many_to_many
      target: drug_interaction
      description: Drug-drug interactions
      
    - name: inventory_items
      type: one_to_many
      target: drug_inventory
      foreign_key: ndc
      description: Inventory records for this drug
      
    - name: formulary_entries
      type: one_to_many
      target: formulary
      foreign_key: ndc
      description: Formulary status entries
      
    - name: recalls
      type: one_to_many
      target: drug_recall
      foreign_key: ndc
      description: Recall records

  indexes:
    - fields: [ndc]
      unique: true
      name: idx_drug_ndc
      
    - fields: [generic_name]
      name: idx_drug_generic_name
      
    - fields: [brand_name]
      name: idx_drug_brand_name
      
    - fields: [dea_schedule]
      name: idx_drug_dea_schedule
      
    - fields: [labeler_code]
      name: idx_drug_labeler
      
    - fields: [gpi]
      name: idx_drug_gpi
      
    - fields: [rxnorm_cui]
      name: idx_drug_rxnorm

  validations:
    - field: ndc
      rule: format
      pattern: "^[0-9]{11}$"
      message: "NDC must be 11 numeric digits"
      
    - field: dea_schedule
      rule: controlled_requires_schedule
      condition: "dea_schedule != 'unscheduled' requires additional tracking"
      
    - field: strength_numeric
      rule: positive
      message: "Strength must be positive"

  audit:
    enabled: true
    events: [create, update, delete]
    retention_days: 2555
    fields: [ndc, dea_schedule, status, awp, wac]
