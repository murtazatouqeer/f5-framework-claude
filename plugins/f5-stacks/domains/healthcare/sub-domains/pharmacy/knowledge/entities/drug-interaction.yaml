# Drug Interaction Entity
# F5 Framework v2.0 - Healthcare/Pharmacy
# Drug-drug and drug-condition interaction records

entity:
  id: drug_interaction
  name: Drug Interaction
  name_ja: 薬物相互作用
  description: Drug interaction checking and management
  domain: healthcare
  subdomain: pharmacy
  version: "1.0.0"

  attributes:
    # Identifiers
    - name: interaction_id
      type: uuid
      primary_key: true
      description: Unique interaction record ID
      
    - name: interaction_code
      type: string
      length: 50
      description: Vendor interaction code (FDB, Medi-Span)

    # Interacting Drugs
    - name: drug_1_id
      type: string
      description: First drug identifier (GPI, RxNorm, or NDC)
      
    - name: drug_1_name
      type: string
      length: 255
      required: true
      description: First drug name
      
    - name: drug_1_class
      type: string
      description: First drug therapeutic class
      
    - name: drug_2_id
      type: string
      description: Second drug identifier
      
    - name: drug_2_name
      type: string
      length: 255
      required: true
      description: Second drug name
      
    - name: drug_2_class
      type: string
      description: Second drug therapeutic class

    # Interaction Type
    - name: interaction_type
      type: enum
      values: [
        drug_drug,
        drug_food,
        drug_alcohol,
        drug_disease,
        drug_allergy,
        drug_lab,
        drug_pregnancy,
        drug_lactation,
        duplicate_therapy,
        therapeutic_duplication
      ]
      required: true
      description: Type of interaction
      
    - name: mechanism
      type: text
      description: Mechanism of interaction

    # Severity
    - name: severity
      type: enum
      values: [severe, moderate, minor, contraindicated]
      required: true
      description: Interaction severity level
      mapping:
        contraindicated: "Absolute contraindication - do not use together"
        severe: "May cause serious harm - avoid combination if possible"
        moderate: "May worsen condition or require monitoring"
        minor: "Limited clinical significance"
        
    - name: severity_score
      type: integer
      min: 1
      max: 10
      description: Numeric severity (1=lowest, 10=highest)

    # Documentation Level
    - name: documentation_level
      type: enum
      values: [established, probable, suspected, possible, unlikely]
      description: Level of documentation/evidence
      
    - name: onset
      type: enum
      values: [rapid, delayed, not_specified]
      description: How quickly interaction occurs

    # Clinical Information
    - name: clinical_effect
      type: text
      required: true
      description: What happens clinically
      example: "Increased risk of bleeding"
      
    - name: management
      type: text
      required: true
      description: How to manage if co-administered
      example: "Monitor INR closely; consider dose reduction"
      
    - name: patient_counseling
      type: text
      description: What to tell patient
      
    - name: professional_note
      type: text
      description: Additional information for pharmacist

    # Screening Settings
    - name: screening_level
      type: enum
      values: [always_screen, optional, informational]
      default: always_screen
      description: When to display during DUR
      
    - name: hard_stop
      type: boolean
      default: false
      description: Requires override to continue
      
    - name: require_override_reason
      type: boolean
      default: false
      description: Must document reason for override

    # References
    - name: reference_source
      type: string
      description: Source database (FDB, Medi-Span, etc.)
      
    - name: monograph_id
      type: string
      description: Reference to full monograph
      
    - name: last_reviewed
      type: date
      description: Date interaction was last reviewed

    # Status
    - name: status
      type: enum
      values: [active, inactive, under_review]
      default: active
      
    - name: created_at
      type: timestamp
      auto: create
      
    - name: updated_at
      type: timestamp
      auto: update

  relationships:
    - name: drug_1
      type: many_to_one
      target: drug
      description: First drug in interaction
      
    - name: drug_2
      type: many_to_one
      target: drug
      description: Second drug in interaction

  indexes:
    - fields: [drug_1_id, drug_2_id]
      name: idx_interaction_drugs
      
    - fields: [severity]
      name: idx_interaction_severity
      
    - fields: [interaction_type]
      name: idx_interaction_type
      
    - fields: [interaction_code]
      name: idx_interaction_code

  validations:
    - field: drug_1_id
      rule: different_from
      compare_field: drug_2_id
      message: "Interacting drugs must be different"
      
    - field: hard_stop
      rule: required_if
      condition: "severity == 'contraindicated'"
      value: true
      message: "Contraindicated interactions must be hard stops"

  audit:
    enabled: true
    events: [create, update, override]
    retention_days: 2555
