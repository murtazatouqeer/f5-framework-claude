name: Provider
display_name: Provider / Nhà cung cấp dịch vụ y tế
description: |
  Healthcare provider entity representing physicians, nurses, and other
  clinical staff who deliver patient care. Includes credentials,
  licensing, and scope of practice information.

domain: healthcare
sub_domain: ehr
entity_type: master
version: "1.0"
status: active

# =============================================================================
# IDENTIFIERS
# =============================================================================
identifiers:
  primary:
    name: id
    type: uuid

  business:
    - name: provider_id
      display_name: Provider ID
      type: string
      pattern: "^PRV-[0-9]{6}$"
      example: "PRV-001234"
      auto_generated: true

    - name: npi
      display_name: National Provider Identifier
      type: string
      pattern: "^[0-9]{10}$"
      description: US NPI or equivalent national provider ID
      unique: true

# =============================================================================
# STATUS
# =============================================================================
status_field:
  name: status
  type: enum
  values:
    - value: active
      description: Currently practicing and credentialed

    - value: inactive
      description: Not currently practicing (leave, etc.)

    - value: suspended
      description: Temporarily suspended from practice

    - value: retired
      description: Permanently retired from practice

    - value: terminated
      description: Employment/affiliation terminated

  default: active

# =============================================================================
# ATTRIBUTES
# =============================================================================
attributes:
  personal:
    - name: first_name
      type: string
      required: true
      max_length: 100

    - name: middle_name
      type: string
      max_length: 100

    - name: last_name
      type: string
      required: true
      max_length: 100

    - name: credentials
      type: array
      items:
        type: string
      example: ["MD", "FACC"]
      description: Professional credentials/degrees

    - name: title
      type: string
      example: "Dr., Nurse, etc."

    - name: display_name
      type: string
      computed: true
      formula: "title + ' ' + first_name + ' ' + last_name + ', ' + credentials.join(', ')"

    - name: gender
      type: enum
      values: [male, female, other]

    - name: date_of_birth
      type: date

    - name: photo_url
      type: string
      format: url

    - name: signature_url
      type: string
      format: url
      description: Digital signature image

  provider_type:
    - name: provider_type
      type: enum
      required: true
      values:
        - value: physician
          description: Medical Doctor (MD, DO)
        - value: nurse_practitioner
          description: Nurse Practitioner (NP)
        - value: physician_assistant
          description: Physician Assistant (PA)
        - value: registered_nurse
          description: Registered Nurse (RN)
        - value: licensed_practical_nurse
          description: Licensed Practical Nurse (LPN)
        - value: pharmacist
          description: Pharmacist (PharmD)
        - value: therapist
          description: Physical/Occupational Therapist
        - value: psychologist
          description: Clinical Psychologist
        - value: social_worker
          description: Clinical Social Worker
        - value: technician
          description: Medical Technician
        - value: dentist
          description: Dentist (DDS, DMD)
        - value: other
          description: Other clinical staff

    - name: classification
      type: enum
      values:
        - attending
        - consulting
        - resident
        - fellow
        - intern
        - student
        - mid_level
        - nursing
        - ancillary

  specialty:
    - name: specialty
      type: enum
      required: true
      values:
        - internal_medicine
        - family_medicine
        - pediatrics
        - obstetrics_gynecology
        - surgery_general
        - surgery_orthopedic
        - surgery_cardiovascular
        - surgery_neuro
        - cardiology
        - pulmonology
        - gastroenterology
        - nephrology
        - neurology
        - oncology
        - hematology
        - endocrinology
        - rheumatology
        - infectious_disease
        - dermatology
        - psychiatry
        - radiology
        - pathology
        - anesthesiology
        - emergency_medicine
        - critical_care
        - ophthalmology
        - otolaryngology
        - urology
        - physical_medicine
        - pharmacy
        - nursing
        - other

    - name: sub_specialty
      type: string
      max_length: 100
      example: "Interventional Cardiology"

    - name: board_certifications
      type: array
      items:
        type: object
        properties:
          board:
            type: string
          specialty:
            type: string
          certification_date:
            type: date
          expiry_date:
            type: date
          certificate_number:
            type: string

  licensing:
    - name: license_number
      type: string
      required: true

    - name: license_state
      type: string
      description: State/province of license

    - name: license_issue_date
      type: date

    - name: license_expiry_date
      type: date
      required: true

    - name: license_status
      type: enum
      values: [active, expired, suspended, revoked]

    - name: dea_number
      type: string
      description: DEA registration for controlled substances
      sensitive: true

    - name: dea_expiry_date
      type: date

    - name: dea_schedules
      type: array
      items:
        type: enum
        values: [II, IIN, III, IIIN, IV, V]
      description: Authorized controlled substance schedules

  contact:
    - name: email
      type: string
      format: email
      required: true

    - name: phone
      type: string

    - name: fax
      type: string

    - name: pager
      type: string

    - name: office_address
      type: object
      properties:
        line1:
          type: string
        line2:
          type: string
        city:
          type: string
        state:
          type: string
        postal_code:
          type: string

  affiliation:
    - name: department_id
      type: uuid
      references: Department

    - name: department_name
      type: string

    - name: facility_ids
      type: array
      items:
        type: uuid
        references: Facility

    - name: practice_group
      type: string

    - name: employment_type
      type: enum
      values: [employed, contracted, affiliated, locum_tenens]

    - name: hire_date
      type: date

    - name: termination_date
      type: date

  scheduling:
    - name: default_appointment_duration
      type: integer
      description: Default appointment length in minutes
      default: 30

    - name: working_hours
      type: object
      properties:
        monday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        tuesday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        wednesday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        thursday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        friday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        saturday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }
        sunday:
          type: object
          properties:
            start: { type: time }
            end: { type: time }

    - name: accepts_new_patients
      type: boolean
      default: true

    - name: max_daily_patients
      type: integer

  privileges:
    - name: admitting_privileges
      type: boolean
      default: false

    - name: surgical_privileges
      type: boolean
      default: false

    - name: prescribing_authority
      type: boolean
      default: true

    - name: controlled_substance_authority
      type: boolean
      default: false

    - name: epcs_enrolled
      type: boolean
      default: false
      description: Electronic Prescribing for Controlled Substances enrollment

    - name: supervising_provider_id
      type: uuid
      references: Provider
      description: Supervising physician for mid-levels/residents

# =============================================================================
# RELATIONSHIPS
# =============================================================================
relationships:
  - name: encounters
    type: one_to_many
    target: Encounter
    foreign_key: primary_provider_id

  - name: prescriptions
    type: one_to_many
    target: Prescription
    foreign_key: prescriber_id

  - name: orders
    type: one_to_many
    target: Order
    foreign_key: ordering_provider_id

  - name: clinical_notes
    type: one_to_many
    target: ClinicalNote
    foreign_key: author_id

  - name: department
    type: many_to_one
    target: Department
    foreign_key: department_id

  - name: facilities
    type: many_to_many
    target: Facility
    through: ProviderFacility

  - name: patients
    type: one_to_many
    target: Patient
    foreign_key: primary_care_provider_id
    description: Patients for whom this provider is PCP

  - name: supervising_provider
    type: many_to_one
    target: Provider
    foreign_key: supervising_provider_id

  - name: supervisees
    type: one_to_many
    target: Provider
    foreign_key: supervising_provider_id

# =============================================================================
# BUSINESS RULES
# =============================================================================
business_rules:
  - id: BR-PRV-001
    name: License Required
    description: Active license required for clinical activities
    rule: |
      status = 'active' REQUIRES
        license_expiry_date > CURRENT_DATE AND
        license_status = 'active'

  - id: BR-PRV-002
    name: DEA for Controlled Substances
    description: DEA number required for controlled substance prescribing
    rule: |
      controlled_substance_authority = TRUE REQUIRES
        dea_number IS NOT NULL AND
        dea_expiry_date > CURRENT_DATE

  - id: BR-PRV-003
    name: EPCS Enrollment
    description: EPCS enrollment required for electronic controlled substance prescribing
    rule: |
      prescribe_controlled_electronically REQUIRES
        epcs_enrolled = TRUE AND
        identity_proofed = TRUE

  - id: BR-PRV-004
    name: Supervision Required
    description: Mid-level providers require supervising physician
    rule: |
      provider_type IN ('nurse_practitioner', 'physician_assistant') AND
      classification NOT IN ('attending') REQUIRES
        supervising_provider_id IS NOT NULL

  - id: BR-PRV-005
    name: Specialty Match
    description: Provider can only see patients within scope of specialty
    rule: |
      WARN IF encounter.specialty NOT IN provider.specialty_scope

  - id: BR-PRV-006
    name: Credential Verification
    description: Credentials must be verified before granting privileges
    rule: |
      status = 'active' REQUIRES
        credentials_verified = TRUE AND
        credentials_verification_date > CURRENT_DATE - INTERVAL '2 years'

  - id: BR-PRV-007
    name: Co-signature Requirement
    description: Trainees require attending co-signature
    rule: |
      classification IN ('resident', 'fellow', 'intern', 'student')
      REQUIRES co_signature ON clinical_documents

# =============================================================================
# INDEXES
# =============================================================================
indexes:
  - name: idx_provider_npi
    columns: [npi]
    unique: true
    condition: "npi IS NOT NULL"

  - name: idx_provider_name
    columns: [last_name, first_name]

  - name: idx_provider_specialty
    columns: [specialty]

  - name: idx_provider_department
    columns: [department_id]

  - name: idx_provider_status
    columns: [status]

  - name: idx_provider_license
    columns: [license_number, license_state]

# =============================================================================
# SEED DATA
# =============================================================================
seed_data:
  specialties:
    - code: IM
      name: Internal Medicine
      name_vi: Nội khoa
    - code: FM
      name: Family Medicine
      name_vi: Y học gia đình
    - code: PED
      name: Pediatrics
      name_vi: Nhi khoa
    - code: OBG
      name: Obstetrics & Gynecology
      name_vi: Sản phụ khoa
    - code: CARD
      name: Cardiology
      name_vi: Tim mạch
    - code: ORTH
      name: Orthopedics
      name_vi: Chấn thương chỉnh hình
    - code: NEUR
      name: Neurology
      name_vi: Thần kinh
    - code: ONCO
      name: Oncology
      name_vi: Ung bướu
    - code: DERM
      name: Dermatology
      name_vi: Da liễu
    - code: PSYCH
      name: Psychiatry
      name_vi: Tâm thần
    - code: EMER
      name: Emergency Medicine
      name_vi: Cấp cứu
    - code: RAD
      name: Radiology
      name_vi: Chẩn đoán hình ảnh
    - code: PATH
      name: Pathology
      name_vi: Giải phẫu bệnh
