name: Bid
display_name: Bid / Lượt đấu giá
description: |
  Một lượt đấu giá của buyer trong phiên auction.

domain: agriculture
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: auction_id
    type: uuid
    required: true

  - name: bidder_id
    type: uuid
    required: true
    description: Người đấu giá

  - name: amount
    type: decimal
    required: true
    description: Số tiền đấu giá

  - name: is_auto_bid
    type: boolean
    required: true
    default: false
    description: Là auto-bid không

  - name: max_auto_bid
    type: decimal
    required: false
    description: Giá tối đa cho auto-bid

  - name: is_winning
    type: boolean
    required: true
    default: false
    description: Đang là bid cao nhất

  - name: status
    type: enum
    required: true
    validation:
      values: [active, outbid, won, cancelled]
    default: active

  - name: ip_address
    type: string
    required: false

  - name: user_agent
    type: string
    required: false

  - name: created_at
    type: timestamp
    required: true

relationships:
  - name: auction
    type: belongs_to
    entity: Auction
    required: true

  - name: bidder
    type: belongs_to
    entity: User
    required: true

indexes:
  - [auction_id, created_at]
  - [bidder_id]
  - [status]

business_rules:
  - BR-BID-001: amount >= auction.current_price + auction.bid_increment
  - BR-BID-002: bidder_id != listing.farm.owner_id (không tự bid)
  - BR-BID-003: Cùng IP bid trên nhiều listing của nhau = shill bidding alert
  - BR-BID-004: Không thể hủy bid sau khi đặt
