name: DeliveryZone
display_name: Delivery Zone
description: |
  Geographic area for delivery coverage and operations.
  Defines service availability, capacity, and pricing for a region.

domain: logistics
subdomain: last-mile
category: entities
version: "1.0.0"
status: active

database:
  table_name: delivery_zones
  primary_key: id
  indexes:
    - columns: [zone_code]
      unique: true
    - columns: [status]
    - columns: [city]
    - columns: [zone_type]

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: zone_code
    type: string
    description: Unique zone code
    pattern: "ZN-[A-Z]{2,4}-[0-9]{3}"
    example: "ZN-HCM-001"
    required: true
    unique: true

  - name: name
    type: string
    description: Zone display name
    max_length: 100
    required: true
    example: "District 1 - Central"

  - name: description
    type: text
    description: Zone description
    max_length: 500

  # Status
  - name: status
    type: enum
    description: Zone operational status
    values:
      - active
      - limited
      - suspended
      - inactive
    default: active

  - name: zone_type
    type: enum
    description: Type of zone
    values:
      - urban
      - suburban
      - rural
      - remote
      - industrial
    required: true

  # Geography
  - name: city
    type: string
    description: City name
    required: true

  - name: district
    type: string
    description: District/area name

  - name: state
    type: string
    description: State/province

  - name: country
    type: string
    description: Country code
    default: "VN"

  - name: polygon
    type: geometry
    description: Zone boundary as GeoJSON polygon
    geometry_type: Polygon

  - name: center_point
    type: object
    description: Zone center coordinates
    properties:
      lat:
        type: decimal
        precision: 10
        scale: 8
      lng:
        type: decimal
        precision: 11
        scale: 8

  - name: area_sqkm
    type: decimal
    description: Zone area in square kilometers
    precision: 10
    scale: 4

  # Coverage
  - name: postcodes
    type: array
    description: Postal codes covered
    items:
      type: string

  - name: neighborhoods
    type: array
    description: Neighborhood/ward names
    items:
      type: string

  - name: landmarks
    type: array
    description: Major landmarks in zone
    items:
      type: string

  # Capacity
  - name: daily_delivery_capacity
    type: integer
    description: Maximum daily deliveries
    default: 500

  - name: current_daily_load
    type: integer
    description: Today's scheduled deliveries
    default: 0

  - name: capacity_utilization
    type: decimal
    description: Current utilization percentage
    precision: 5
    scale: 2
    computed: "(current_daily_load / daily_delivery_capacity) * 100"

  - name: agents_assigned
    type: integer
    description: Total agents for this zone
    default: 0

  - name: agents_available
    type: integer
    description: Currently available agents
    default: 0

  - name: agents_online
    type: integer
    description: Currently online agents
    default: 0

  # Service levels
  - name: standard_available
    type: boolean
    description: Standard delivery available
    default: true

  - name: express_available
    type: boolean
    description: Express delivery available
    default: true

  - name: same_day_available
    type: boolean
    description: Same-day delivery available
    default: false

  - name: same_day_cutoff_time
    type: time
    description: Cutoff for same-day orders
    example: "11:00"

  - name: instant_available
    type: boolean
    description: Instant delivery available
    default: false

  - name: scheduled_available
    type: boolean
    description: Scheduled delivery available
    default: true

  # Operating hours
  - name: operating_hours
    type: object
    description: Zone operating hours
    properties:
      monday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      tuesday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      wednesday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      thursday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      friday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      saturday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }
      sunday:
        type: object
        properties:
          open: { type: time }
          close: { type: time }
          closed: { type: boolean }

  # Delivery windows
  - name: available_slots
    type: array
    description: Available time slots
    items:
      type: object
      properties:
        slot_name:
          type: string
        start_time:
          type: time
        end_time:
          type: time
        capacity:
          type: integer
        premium:
          type: boolean

  - name: slot_duration_minutes
    type: integer
    description: Standard slot duration
    default: 120

  # Pricing
  - name: base_delivery_fee
    type: decimal
    description: Base delivery fee
    precision: 10
    scale: 2

  - name: distance_fee_per_km
    type: decimal
    description: Additional fee per km
    precision: 6
    scale: 2

  - name: weight_fee_per_kg
    type: decimal
    description: Additional fee per kg over threshold
    precision: 6
    scale: 2

  - name: weight_threshold_kg
    type: decimal
    description: Weight included in base fee
    precision: 6
    scale: 2
    default: 5

  - name: express_multiplier
    type: decimal
    description: Express delivery price multiplier
    precision: 4
    scale: 2
    default: 1.5

  - name: same_day_multiplier
    type: decimal
    description: Same-day delivery multiplier
    precision: 4
    scale: 2
    default: 2.0

  - name: surge_multiplier
    type: decimal
    description: Current surge pricing multiplier
    precision: 4
    scale: 2
    default: 1.0

  - name: surge_active
    type: boolean
    description: Surge pricing currently active
    default: false

  - name: minimum_order_value
    type: decimal
    description: Minimum order for free delivery
    precision: 10
    scale: 2

  # Hub assignment
  - name: hub_id
    type: uuid
    description: Primary fulfillment hub

  - name: backup_hub_id
    type: uuid
    description: Backup hub

  # Performance
  - name: average_delivery_time_minutes
    type: integer
    description: Average delivery time

  - name: on_time_rate
    type: decimal
    description: On-time delivery percentage
    precision: 5
    scale: 2

  - name: success_rate
    type: decimal
    description: Delivery success rate
    precision: 5
    scale: 2

  # Restrictions
  - name: max_parcel_weight_kg
    type: decimal
    description: Maximum parcel weight
    precision: 6
    scale: 2
    default: 30

  - name: max_parcel_dimensions_cm
    type: object
    description: Maximum parcel dimensions
    properties:
      length: { type: decimal, default: 100 }
      width: { type: decimal, default: 80 }
      height: { type: decimal, default: 80 }

  - name: cod_available
    type: boolean
    description: COD service available
    default: true

  - name: cod_max_amount
    type: decimal
    description: Maximum COD amount
    precision: 12
    scale: 2

  # Adjacent zones
  - name: adjacent_zone_ids
    type: array
    description: Neighboring zones for overflow
    items:
      type: uuid

  # Audit
  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: hub
    type: belongs_to
    entity: WarehouseHub
    foreign_key: hub_id

  - name: agents
    type: has_many
    entity: DeliveryAgent
    through: assigned_zone_ids

  - name: deliveries
    type: has_many
    entity: Delivery
    foreign_key: zone_id

  - name: slots
    type: has_many
    entity: DeliverySlot
    foreign_key: zone_id

  - name: lockers
    type: has_many
    entity: Locker
    foreign_key: zone_id

  - name: pickup_points
    type: has_many
    entity: PickupPoint
    foreign_key: zone_id

events:
  - name: zone.capacity_critical
    description: Zone capacity above 90%
    payload: [zone_id, utilization]

  - name: zone.surge_activated
    description: Surge pricing activated
    payload: [zone_id, multiplier]

  - name: zone.suspended
    description: Zone temporarily suspended
    payload: [zone_id, reason]
