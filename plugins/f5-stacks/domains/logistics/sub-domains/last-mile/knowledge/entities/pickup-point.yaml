name: PickupPoint
display_name: Pickup Point
description: |
  Partner location for package collection (PUDO - Pick-up/Drop-off).
  Convenience stores, post offices, and other collection points.

domain: logistics
subdomain: last-mile
category: entities
version: "1.0.0"
status: active

database:
  table_name: pickup_points
  primary_key: id
  indexes:
    - columns: [point_id]
      unique: true
    - columns: [zone_id]
    - columns: [status]
    - columns: [partner_id]
    - columns: [location]
      type: spatial

attributes:
  # Identifiers
  - name: id
    type: uuid
    required: true
    generated: true

  - name: point_id
    type: string
    description: Human-readable point ID
    pattern: "PUP-[A-Z]{2}-[0-9]{4}"
    example: "PUP-HCM-0001"
    required: true
    unique: true

  - name: name
    type: string
    description: Location name
    max_length: 100
    required: true
    example: "Circle K - 123 Le Loi"

  # Status
  - name: status
    type: enum
    description: Point status
    values:
      - active
      - temporarily_closed
      - suspended
      - inactive
    default: active

  # Partner
  - name: partner_id
    type: uuid
    description: Partner business

  - name: partner_name
    type: string
    description: Partner brand name
    max_length: 50

  - name: partner_type
    type: enum
    description: Type of partner
    values:
      - convenience_store
      - supermarket
      - pharmacy
      - post_office
      - retail_store
      - gas_station
      - cafe
      - agent_store
      - dedicated_point

  # Location
  - name: address
    type: object
    description: Point address
    properties:
      address_line1:
        type: string
        required: true
      address_line2:
        type: string
      city:
        type: string
        required: true
      district:
        type: string
      postal_code:
        type: string
      lat:
        type: decimal
        precision: 10
        scale: 8
      lng:
        type: decimal
        precision: 11
        scale: 8

  - name: zone_id
    type: uuid
    description: Delivery zone

  - name: location_directions
    type: text
    description: How to find the location
    max_length: 500

  # Operating hours
  - name: operating_hours
    type: object
    properties:
      monday: { open: time, close: time, closed: boolean }
      tuesday: { open: time, close: time, closed: boolean }
      wednesday: { open: time, close: time, closed: boolean }
      thursday: { open: time, close: time, closed: boolean }
      friday: { open: time, close: time, closed: boolean }
      saturday: { open: time, close: time, closed: boolean }
      sunday: { open: time, close: time, closed: boolean }

  - name: is_24_hours
    type: boolean
    description: 24/7 operation
    default: false

  - name: holiday_schedule
    type: text
    description: Holiday operation notes
    max_length: 200

  # Capacity
  - name: max_parcels
    type: integer
    description: Maximum parcels to hold
    default: 50

  - name: current_parcels
    type: integer
    description: Currently held parcels
    default: 0

  - name: available_capacity
    type: integer
    computed: "max_parcels - current_parcels"

  - name: max_parcel_weight_kg
    type: decimal
    description: Max weight per parcel
    precision: 6
    scale: 2
    default: 20

  - name: max_parcel_size
    type: enum
    description: Max parcel size accepted
    values:
      - small
      - medium
      - large
      - extra_large
    default: large

  # Services
  - name: services_offered
    type: array
    description: Available services
    items:
      type: enum
      values:
        - pickup
        - drop_off
        - returns
        - cod_collection
        - cash_payment
        - card_payment
        - printing

  - name: accepts_cod
    type: boolean
    description: Can collect COD
    default: true

  - name: accepts_returns
    type: boolean
    description: Accepts returns
    default: true

  - name: accepts_oversized
    type: boolean
    description: Accepts large packages
    default: false

  # Hold policy
  - name: hold_days
    type: integer
    description: Days to hold packages
    default: 7

  - name: overdue_fee_per_day
    type: decimal
    description: Fee per day after free period
    precision: 6
    scale: 2

  - name: auto_return_days
    type: integer
    description: Days before auto-return
    default: 10

  # Contact
  - name: phone
    type: string
    description: Location phone

  - name: email
    type: string
    description: Location email
    format: email

  - name: manager_name
    type: string
    description: Store manager name

  - name: manager_phone
    type: string
    description: Manager phone

  # Access
  - name: requires_id
    type: boolean
    description: ID required for pickup
    default: true

  - name: allows_third_party
    type: boolean
    description: Third party can pickup
    default: true

  - name: pickup_code_required
    type: boolean
    description: Pickup code needed
    default: true

  # Features
  - name: has_parking
    type: boolean
    description: Parking available
    default: false

  - name: has_accessibility
    type: boolean
    description: Wheelchair accessible
    default: false

  - name: has_cctv
    type: boolean
    description: Security cameras
    default: true

  # Performance
  - name: total_pickups
    type: integer
    description: Lifetime pickups
    default: 0

  - name: average_pickup_days
    type: decimal
    description: Average days to pickup
    precision: 4
    scale: 2

  - name: rating
    type: decimal
    description: Customer rating
    precision: 3
    scale: 2

  - name: rating_count
    type: integer
    description: Number of ratings
    default: 0

  # Financial
  - name: commission_rate
    type: decimal
    description: Commission percentage
    precision: 5
    scale: 2

  - name: commission_per_parcel
    type: decimal
    description: Fixed amount per parcel
    precision: 6
    scale: 2

  # Audit
  - name: activated_at
    type: date
    description: When point was activated

  - name: last_delivery_at
    type: timestamp
    description: Last delivery received

  - name: created_at
    type: timestamp
    required: true
    auto_generate: true

  - name: updated_at
    type: timestamp
    auto_update: true

relationships:
  - name: zone
    type: belongs_to
    entity: DeliveryZone
    foreign_key: zone_id

  - name: deliveries
    type: has_many
    entity: Delivery
    conditions:
      delivery_method: pickup_point

events:
  - name: pickup_point.parcel_deposited
    description: Parcel deposited at point
    payload: [point_id, delivery_id]

  - name: pickup_point.parcel_collected
    description: Parcel collected by recipient
    payload: [point_id, delivery_id]

  - name: pickup_point.capacity_critical
    description: Near capacity limit
    payload: [point_id, current_parcels, max_parcels]
