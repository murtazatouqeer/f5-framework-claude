name: RecipientUseCases
display_name: Recipient Use Cases
description: |
  Use cases for delivery recipients (customers).
  Covers tracking, scheduling, receiving, and feedback scenarios.

domain: logistics
subdomain: last-mile
category: use-cases
version: "1.0.0"
status: active

actor: recipient
actor_description: Customer receiving a delivery

use_cases:
  # Tracking Use Cases
  - id: UC-REC-001
    name: Track Delivery
    description: Recipient tracks delivery status in real-time
    priority: critical
    frequency: very_high

    preconditions:
      - Delivery exists and is active
      - Recipient has tracking number or order reference
      - Recipient is authenticated (optional for basic tracking)

    main_flow:
      - step: 1
        action: Recipient opens tracking page or app
        system_response: Display tracking interface

      - step: 2
        action: Recipient enters tracking number
        system_response: Validate and retrieve delivery info

      - step: 3
        action: System displays current status
        system_response: Show status, location, ETA

      - step: 4
        action: Recipient views delivery timeline
        system_response: Display all status updates chronologically

      - step: 5
        action: Recipient views agent location (if out for delivery)
        system_response: Show real-time map with agent position

    alternative_flows:
      - id: AF1
        condition: Tracking number not found
        steps:
          - Display error message
          - Suggest checking order confirmation
          - Offer customer support contact

      - id: AF2
        condition: Delivery already completed
        steps:
          - Show completed status
          - Display POD details
          - Offer feedback option

    postconditions:
      - Recipient informed of delivery status
      - Tracking view logged for analytics

    business_rules:
      - BR-REC-001: Real-time location only shown during out_for_delivery
      - BR-REC-002: Sensitive details masked for unauthenticated users

  - id: UC-REC-002
    name: Receive Delivery Notifications
    description: Recipient receives proactive delivery updates
    priority: high
    frequency: very_high

    preconditions:
      - Delivery exists and is active
      - Recipient contact info available
      - Notification preferences set

    main_flow:
      - step: 1
        action: Delivery status changes
        system_response: Trigger notification workflow

      - step: 2
        action: System determines notification type
        system_response: Select appropriate template

      - step: 3
        action: System sends notification via preferred channel
        system_response: SMS/Push/Email sent

      - step: 4
        action: Recipient receives notification
        system_response: Track delivery status

    notification_types:
      - Order dispatched
      - Out for delivery
      - Agent nearby (5 mins away)
      - Agent arrived
      - Delivery completed
      - Delivery failed
      - Rescheduled

    postconditions:
      - Recipient aware of delivery progress
      - Notification delivery tracked

  # Scheduling Use Cases
  - id: UC-REC-003
    name: Select Delivery Time Slot
    description: Recipient chooses preferred delivery time
    priority: high
    frequency: high

    preconditions:
      - Order placed or delivery created
      - Delivery zone supports scheduled delivery
      - Time slots available

    main_flow:
      - step: 1
        action: Recipient accesses slot selection
        system_response: Show available time slots

      - step: 2
        action: Recipient views slot options
        system_response: Display slots with pricing and availability

      - step: 3
        action: Recipient selects preferred slot
        system_response: Validate slot availability

      - step: 4
        action: System confirms slot booking
        system_response: Reserve slot, update delivery

      - step: 5
        action: Recipient receives confirmation
        system_response: Send booking confirmation

    alternative_flows:
      - id: AF1
        condition: No slots available on preferred date
        steps:
          - Show next available dates
          - Offer waitlist option
          - Suggest alternative delivery methods

      - id: AF2
        condition: Selected slot becomes full
        steps:
          - Notify slot no longer available
          - Show next best alternatives
          - Auto-select if configured

    postconditions:
      - Delivery slot confirmed
      - Recipient notified

  - id: UC-REC-004
    name: Reschedule Delivery
    description: Recipient changes delivery date or time
    priority: high
    frequency: medium

    preconditions:
      - Delivery exists and not yet completed
      - Reschedule allowed per policy
      - Within modification window

    main_flow:
      - step: 1
        action: Recipient requests reschedule
        system_response: Check reschedule eligibility

      - step: 2
        action: System shows available options
        system_response: Display new slots and any fees

      - step: 3
        action: Recipient selects new slot
        system_response: Validate and calculate fees

      - step: 4
        action: Recipient confirms change
        system_response: Update delivery, charge fee if applicable

      - step: 5
        action: System sends confirmation
        system_response: Notify recipient and operations

    alternative_flows:
      - id: AF1
        condition: Past modification cutoff
        steps:
          - Inform customer of policy
          - Offer contact customer service
          - Process exception if approved

    postconditions:
      - Delivery rescheduled
      - All parties notified
      - Fee charged if applicable

  # Receiving Use Cases
  - id: UC-REC-005
    name: Receive Package - Standard
    description: Recipient receives package from delivery agent
    priority: critical
    frequency: very_high

    preconditions:
      - Agent at delivery location
      - Recipient available
      - Package ready for handover

    main_flow:
      - step: 1
        action: Agent arrives and contacts recipient
        system_response: Send arrival notification

      - step: 2
        action: Recipient meets agent
        system_response: Verify recipient identity if required

      - step: 3
        action: Agent hands over package
        system_response: Capture POD photo

      - step: 4
        action: Recipient signs for delivery (if required)
        system_response: Capture digital signature

      - step: 5
        action: Agent confirms delivery complete
        system_response: Update status, notify parties

    alternative_flows:
      - id: AF1
        condition: Recipient wants to inspect package
        steps:
          - Allow inspection of package exterior
          - Note any visible damage
          - Proceed with conditional acceptance

      - id: AF2
        condition: Package appears damaged
        steps:
          - Document damage with photos
          - Offer acceptance with damage note
          - Allow refusal option

    postconditions:
      - Package delivered
      - POD captured
      - Delivery marked complete

  - id: UC-REC-006
    name: Receive COD Package
    description: Recipient receives package and pays on delivery
    priority: critical
    frequency: high

    preconditions:
      - Delivery is COD type
      - Agent at location
      - Recipient has payment method

    main_flow:
      - step: 1
        action: Agent arrives with COD package
        system_response: Display COD amount to agent

      - step: 2
        action: Agent informs recipient of amount due
        system_response: Show itemized amount

      - step: 3
        action: Recipient provides payment
        system_response: Agent verifies amount

      - step: 4
        action: Agent issues receipt
        system_response: Generate and send digital receipt

      - step: 5
        action: Package handed over
        system_response: Capture POD, complete delivery

    alternative_flows:
      - id: AF1
        condition: Recipient has insufficient funds
        steps:
          - Offer partial payment options (if allowed)
          - Allow mobile payment alternative
          - Reschedule if needed

      - id: AF2
        condition: Recipient disputes amount
        steps:
          - Show order breakdown
          - Contact customer service
          - Escalate if unresolved

    postconditions:
      - Payment collected
      - Package delivered
      - Receipt provided

  - id: UC-REC-007
    name: Receive Package at Locker
    description: Recipient picks up package from smart locker
    priority: high
    frequency: medium

    preconditions:
      - Package deposited in locker
      - Pickup code sent to recipient
      - Locker operational

    main_flow:
      - step: 1
        action: Recipient goes to locker location
        system_response: Locker ready for interaction

      - step: 2
        action: Recipient enters pickup code
        system_response: Validate code

      - step: 3
        action: Compartment door opens
        system_response: Log door open event

      - step: 4
        action: Recipient retrieves package
        system_response: Detect package removed

      - step: 5
        action: Recipient closes door
        system_response: Confirm pickup, free compartment

    alternative_flows:
      - id: AF1
        condition: Wrong code entered
        steps:
          - Show error message
          - Allow retry (max 5 attempts)
          - Lock out and alert after max

      - id: AF2
        condition: Locker malfunction
        steps:
          - Display error code
          - Provide support hotline
          - Alert maintenance

    postconditions:
      - Package collected
      - Compartment freed
      - Delivery completed

  # Address & Preferences
  - id: UC-REC-008
    name: Update Delivery Address
    description: Recipient changes delivery address before delivery
    priority: medium
    frequency: medium

    preconditions:
      - Delivery not yet picked up
      - Address change allowed
      - New address in service area

    main_flow:
      - step: 1
        action: Recipient requests address change
        system_response: Check eligibility

      - step: 2
        action: Recipient enters new address
        system_response: Validate address format

      - step: 3
        action: System verifies service availability
        system_response: Check zone and pricing

      - step: 4
        action: System shows any price difference
        system_response: Display fee changes

      - step: 5
        action: Recipient confirms change
        system_response: Update delivery, notify agent

    postconditions:
      - Address updated
      - Routing recalculated
      - All parties notified

  - id: UC-REC-009
    name: Add Delivery Instructions
    description: Recipient provides special delivery instructions
    priority: medium
    frequency: medium

    preconditions:
      - Delivery exists
      - Instructions allowed

    main_flow:
      - step: 1
        action: Recipient accesses delivery details
        system_response: Show current instructions

      - step: 2
        action: Recipient adds/updates instructions
        system_response: Validate input length

      - step: 3
        action: System saves instructions
        system_response: Confirm update

    instruction_examples:
      - "Leave at door if not home"
      - "Ring doorbell twice"
      - "Call before arriving"
      - "Deliver to security guard"
      - "Gate code: 1234"

    postconditions:
      - Instructions saved
      - Visible to delivery agent

  # Returns & Issues
  - id: UC-REC-010
    name: Request Return Pickup
    description: Recipient initiates return and schedules pickup
    priority: high
    frequency: medium

    preconditions:
      - Original delivery completed
      - Within return window
      - Return policy allows

    main_flow:
      - step: 1
        action: Recipient initiates return request
        system_response: Show return options

      - step: 2
        action: Recipient selects return reason
        system_response: Validate eligibility

      - step: 3
        action: Recipient chooses pickup method
        system_response: Show available slots

      - step: 4
        action: Recipient schedules pickup
        system_response: Confirm booking

      - step: 5
        action: System creates return order
        system_response: Generate return label, send confirmation

    postconditions:
      - Return request created
      - Pickup scheduled
      - Refund process initiated

  - id: UC-REC-011
    name: Report Delivery Issue
    description: Recipient reports problem with delivery
    priority: high
    frequency: low

    preconditions:
      - Delivery completed or attempted
      - Issue exists

    main_flow:
      - step: 1
        action: Recipient selects issue type
        system_response: Show issue categories

      - step: 2
        action: Recipient provides details
        system_response: Capture description and photos

      - step: 3
        action: System creates support ticket
        system_response: Assign priority and handler

      - step: 4
        action: Recipient receives confirmation
        system_response: Provide ticket number

    issue_types:
      - Package damaged
      - Wrong item received
      - Package missing items
      - Package not received
      - Poor delivery experience
      - Agent behavior issue

    postconditions:
      - Issue logged
      - Ticket created
      - Resolution process started

  # Feedback
  - id: UC-REC-012
    name: Rate Delivery Experience
    description: Recipient provides rating and feedback
    priority: medium
    frequency: high

    preconditions:
      - Delivery completed
      - Rating not yet submitted
      - Within rating window

    main_flow:
      - step: 1
        action: Recipient receives rating request
        system_response: Show rating interface

      - step: 2
        action: Recipient provides overall rating
        system_response: Accept 1-5 star rating

      - step: 3
        action: Recipient optionally adds feedback
        system_response: Show feedback options

      - step: 4
        action: System saves rating
        system_response: Thank recipient

    rating_dimensions:
      - Overall experience
      - Delivery speed
      - Agent behavior
      - Package condition

    postconditions:
      - Rating recorded
      - Agent score updated
      - Analytics updated

  - id: UC-REC-013
    name: Tip Delivery Agent
    description: Recipient provides tip to delivery agent
    priority: low
    frequency: low

    preconditions:
      - Delivery completed
      - Tipping enabled
      - Payment method available

    main_flow:
      - step: 1
        action: Recipient selects tip option
        system_response: Show tip amounts or custom input

      - step: 2
        action: Recipient enters tip amount
        system_response: Validate amount

      - step: 3
        action: Recipient confirms payment
        system_response: Process tip payment

      - step: 4
        action: System credits agent
        system_response: Add to agent earnings

    postconditions:
      - Tip processed
      - Agent credited
      - Thank you sent

metrics:
  - name: tracking_usage
    description: Percentage of recipients who track deliveries
    target: > 60%

  - name: rating_submission_rate
    description: Percentage providing ratings
    target: > 30%

  - name: self_service_rate
    description: Issues resolved via self-service
    target: > 40%

  - name: reschedule_rate
    description: Deliveries rescheduled by recipient
    benchmark: < 10%

  - name: return_rate
    description: Deliveries returned
    benchmark: < 5%
