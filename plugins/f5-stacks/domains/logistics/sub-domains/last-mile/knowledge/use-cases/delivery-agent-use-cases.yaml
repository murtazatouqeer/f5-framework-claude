name: DeliveryAgentUseCases
display_name: Delivery Agent Use Cases
description: |
  Use cases for delivery agents (riders/drivers).
  Covers task management, navigation, delivery execution, and earnings.

domain: logistics
subdomain: last-mile
category: use-cases
version: "1.0.0"
status: active

actor: delivery_agent
actor_description: Delivery rider or driver performing last-mile deliveries

use_cases:
  # Shift & Availability
  - id: UC-AGT-001
    name: Start Shift
    description: Agent starts their delivery shift
    priority: critical
    frequency: daily

    preconditions:
      - Agent account active
      - Agent authenticated
      - Vehicle/equipment ready

    main_flow:
      - step: 1
        action: Agent opens delivery app
        system_response: Show shift start screen

      - step: 2
        action: Agent confirms equipment check
        system_response: Display checklist

      - step: 3
        action: Agent starts shift
        system_response: Set status to available

      - step: 4
        action: System enables location tracking
        system_response: Start GPS tracking

      - step: 5
        action: Agent receives available deliveries
        system_response: Show delivery queue

    equipment_checklist:
      - Vehicle in working condition
      - Phone fully charged
      - Cash float ready (for COD)
      - Delivery bag/equipment
      - ID and documents

    postconditions:
      - Agent marked as available
      - Location tracking active
      - Ready to receive assignments

  - id: UC-AGT-002
    name: Accept Delivery Assignment
    description: Agent accepts assigned delivery task
    priority: critical
    frequency: very_high

    preconditions:
      - Agent on shift and available
      - Delivery assigned to agent
      - Assignment not expired

    main_flow:
      - step: 1
        action: System sends assignment notification
        system_response: Show delivery details

      - step: 2
        action: Agent reviews delivery info
        system_response: Display pickup, dropoff, payment

      - step: 3
        action: Agent accepts assignment
        system_response: Confirm acceptance

      - step: 4
        action: System updates delivery status
        system_response: Mark as assigned, start tracking

      - step: 5
        action: Agent receives navigation
        system_response: Show route to pickup

    assignment_details:
      - Pickup location and contact
      - Delivery address
      - Package details
      - Special instructions
      - COD amount if applicable
      - Time slot if scheduled

    alternative_flows:
      - id: AF1
        condition: Agent rejects assignment
        steps:
          - Record rejection reason
          - Reassign to next agent
          - Track rejection rate

      - id: AF2
        condition: Assignment times out
        steps:
          - Auto-reassign
          - Notify operations
          - Log timeout

    postconditions:
      - Delivery assigned to agent
      - Route navigation started
      - ETA calculated

  # Pickup
  - id: UC-AGT-003
    name: Pick Up Package
    description: Agent collects package from sender/hub
    priority: critical
    frequency: very_high

    preconditions:
      - Agent at pickup location
      - Package ready for pickup
      - Agent authenticated

    main_flow:
      - step: 1
        action: Agent arrives at pickup
        system_response: Detect geofence entry

      - step: 2
        action: Agent confirms arrival
        system_response: Mark arrived at pickup

      - step: 3
        action: Agent collects package
        system_response: Show package details to verify

      - step: 4
        action: Agent scans package barcode
        system_response: Validate package ID

      - step: 5
        action: Agent confirms pickup complete
        system_response: Update status, start delivery

    verification_steps:
      - Match tracking number
      - Verify package count
      - Check package condition
      - Note any damage
      - Confirm COD amount

    alternative_flows:
      - id: AF1
        condition: Package not ready
        steps:
          - Wait or contact sender
          - Report delay if excessive
          - Option to skip and return

      - id: AF2
        condition: Package damaged
        steps:
          - Photo document damage
          - Report to operations
          - Await instructions

    postconditions:
      - Package in agent possession
      - Delivery timer started
      - Route to recipient calculated

  # Delivery Execution
  - id: UC-AGT-004
    name: Complete Standard Delivery
    description: Agent delivers package to recipient
    priority: critical
    frequency: very_high

    preconditions:
      - Agent at delivery location
      - Recipient available
      - Package ready for handover

    main_flow:
      - step: 1
        action: Agent arrives at delivery address
        system_response: Detect arrival, notify recipient

      - step: 2
        action: Agent contacts recipient
        system_response: Provide contact options

      - step: 3
        action: Agent meets recipient
        system_response: Verify identity if required

      - step: 4
        action: Agent hands over package
        system_response: Prompt for POD capture

      - step: 5
        action: Agent captures proof of delivery
        system_response: Accept photo/signature

      - step: 6
        action: Agent marks delivery complete
        system_response: Update status, calculate earnings

    postconditions:
      - Package delivered
      - POD captured
      - Agent ready for next task

  - id: UC-AGT-005
    name: Collect COD Payment
    description: Agent collects cash on delivery
    priority: critical
    frequency: high

    preconditions:
      - Delivery is COD type
      - Agent at delivery location
      - Recipient has payment

    main_flow:
      - step: 1
        action: Agent informs recipient of COD amount
        system_response: Display exact amount

      - step: 2
        action: Recipient provides payment
        system_response: Show payment confirmation screen

      - step: 3
        action: Agent counts and verifies money
        system_response: Prompt verification steps

      - step: 4
        action: Agent provides change if needed
        system_response: Calculate change amount

      - step: 5
        action: Agent issues receipt
        system_response: Generate digital receipt

      - step: 6
        action: Agent hands over package
        system_response: Complete delivery flow

    verification_steps:
      - Count money received
      - Check for counterfeit (large bills)
      - Confirm correct amount
      - Provide change if needed
      - Issue receipt

    alternative_flows:
      - id: AF1
        condition: Payment amount incorrect
        steps:
          - Recount with recipient
          - Request correct amount
          - Escalate if dispute

      - id: AF2
        condition: Recipient cannot pay
        steps:
          - Offer mobile payment option
          - If not possible, mark as failed
          - Schedule reattempt

    postconditions:
      - Payment collected
      - Receipt issued
      - Package delivered

  - id: UC-AGT-006
    name: Deposit to Smart Locker
    description: Agent deposits package in smart locker
    priority: high
    frequency: medium

    preconditions:
      - Locker delivery assigned
      - Compartment reserved
      - Locker operational

    main_flow:
      - step: 1
        action: Agent arrives at locker
        system_response: Show locker access instructions

      - step: 2
        action: Agent authenticates at locker
        system_response: Open assigned compartment

      - step: 3
        action: Agent places package inside
        system_response: Detect package placement

      - step: 4
        action: Agent closes compartment
        system_response: Lock and confirm deposit

      - step: 5
        action: System sends pickup code to recipient
        system_response: Notify customer

    postconditions:
      - Package deposited
      - Compartment locked
      - Customer notified with code

  - id: UC-AGT-007
    name: Record Failed Delivery
    description: Agent documents unsuccessful delivery attempt
    priority: high
    frequency: medium

    preconditions:
      - Agent at delivery location
      - Delivery cannot be completed
      - Valid failure reason

    main_flow:
      - step: 1
        action: Agent cannot complete delivery
        system_response: Show failure options

      - step: 2
        action: Agent selects failure reason
        system_response: Display reason list

      - step: 3
        action: Agent captures evidence
        system_response: Require photo of location

      - step: 4
        action: Agent adds notes
        system_response: Accept text notes

      - step: 5
        action: Agent confirms failure
        system_response: Update status, trigger reattempt flow

    failure_reasons:
      - Recipient not home
      - Wrong address
      - Access denied
      - Recipient refused
      - Address not found
      - Security concerns

    postconditions:
      - Failure documented
      - Evidence captured
      - Reattempt scheduled

  # Navigation & Route
  - id: UC-AGT-008
    name: Navigate to Destination
    description: Agent uses in-app navigation
    priority: high
    frequency: very_high

    preconditions:
      - Active delivery assignment
      - GPS enabled
      - Destination set

    main_flow:
      - step: 1
        action: Agent views delivery route
        system_response: Display map with route

      - step: 2
        action: Agent starts navigation
        system_response: Show turn-by-turn directions

      - step: 3
        action: Agent follows route
        system_response: Update ETA in real-time

      - step: 4
        action: Agent arrives at destination
        system_response: Notify arrival

    features:
      - Turn-by-turn navigation
      - Real-time traffic updates
      - ETA updates
      - Route optimization
      - Alternate routes

    postconditions:
      - Agent at destination
      - ETA accurate

  - id: UC-AGT-009
    name: View Optimized Route
    description: Agent views optimized multi-stop route
    priority: medium
    frequency: high

    preconditions:
      - Multiple deliveries assigned
      - Route optimization enabled

    main_flow:
      - step: 1
        action: Agent views delivery queue
        system_response: Show ordered stop list

      - step: 2
        action: Agent reviews optimized sequence
        system_response: Display map with all stops

      - step: 3
        action: Agent starts multi-stop navigation
        system_response: Navigate to first stop

      - step: 4
        action: After each delivery, show next stop
        system_response: Auto-advance to next destination

    optimization_factors:
      - Distance
      - Time slots
      - Traffic conditions
      - Package priority

    postconditions:
      - Route optimized
      - Navigation ready

  # COD Management
  - id: UC-AGT-010
    name: Deposit COD Collection
    description: Agent deposits collected COD cash
    priority: critical
    frequency: daily

    preconditions:
      - COD money collected
      - Deposit location available
      - Within deposit policy limits

    main_flow:
      - step: 1
        action: Agent navigates to deposit location
        system_response: Show deposit points

      - step: 2
        action: Agent arrives at location
        system_response: Verify geofence

      - step: 3
        action: Agent counts total collection
        system_response: Display expected amount

      - step: 4
        action: Agent hands over cash
        system_response: Receive confirmation

      - step: 5
        action: Agent uploads deposit receipt
        system_response: Reconcile with system

    deposit_locations:
      - Hub/office
      - Bank branch
      - ATM deposit
      - Partner store

    postconditions:
      - Cash deposited
      - Agent liability cleared
      - System reconciled

  # Communication
  - id: UC-AGT-011
    name: Contact Recipient
    description: Agent calls or messages recipient
    priority: high
    frequency: very_high

    preconditions:
      - Active delivery assignment
      - Recipient contact available

    main_flow:
      - step: 1
        action: Agent needs to contact recipient
        system_response: Show contact options

      - step: 2
        action: Agent initiates contact
        system_response: Connect via masked number

      - step: 3
        action: Communication occurs
        system_response: Log attempt

    contact_reasons:
      - Confirm availability
      - Get directions
      - Notify arrival
      - Address clarification

    postconditions:
      - Contact attempted
      - Result logged

  - id: UC-AGT-012
    name: Report Issue to Operations
    description: Agent escalates issue to operations
    priority: medium
    frequency: low

    preconditions:
      - Issue encountered
      - Agent action not sufficient

    main_flow:
      - step: 1
        action: Agent selects issue type
        system_response: Show issue categories

      - step: 2
        action: Agent provides details
        system_response: Capture description

      - step: 3
        action: Agent submits report
        system_response: Create support ticket

      - step: 4
        action: Operations responds
        system_response: Notify agent

    issue_types:
      - Package damaged
      - Vehicle breakdown
      - Safety concern
      - Customer dispute
      - Access problem

    postconditions:
      - Issue reported
      - Ticket created
      - Awaiting resolution

  # Earnings & Performance
  - id: UC-AGT-013
    name: View Earnings
    description: Agent checks earnings and payouts
    priority: medium
    frequency: daily

    preconditions:
      - Agent authenticated
      - Earnings data available

    main_flow:
      - step: 1
        action: Agent opens earnings screen
        system_response: Display earnings summary

      - step: 2
        action: Agent views breakdown
        system_response: Show by delivery, tips, bonuses

      - step: 3
        action: Agent views payout schedule
        system_response: Show pending/completed payouts

    earnings_components:
      - Base delivery fee
      - Distance bonus
      - Tips
      - Incentive bonuses
      - COD commission

    postconditions:
      - Earnings visible
      - Payout status clear

  - id: UC-AGT-014
    name: View Performance Dashboard
    description: Agent reviews performance metrics
    priority: medium
    frequency: weekly

    preconditions:
      - Agent authenticated
      - Performance data available

    main_flow:
      - step: 1
        action: Agent opens performance screen
        system_response: Display dashboard

      - step: 2
        action: Agent reviews metrics
        system_response: Show KPIs with trends

      - step: 3
        action: Agent views feedback
        system_response: Show recent ratings

    performance_metrics:
      - On-time delivery rate
      - Customer rating
      - Acceptance rate
      - Completion rate
      - COD collection accuracy

    postconditions:
      - Performance visible
      - Areas for improvement identified

  - id: UC-AGT-015
    name: End Shift
    description: Agent completes their shift
    priority: high
    frequency: daily

    preconditions:
      - Agent on active shift
      - All deliveries completed or reassigned
      - COD deposited if required

    main_flow:
      - step: 1
        action: Agent requests end shift
        system_response: Check outstanding tasks

      - step: 2
        action: System validates shift end
        system_response: Show shift summary

      - step: 3
        action: Agent confirms shift end
        system_response: Mark unavailable

      - step: 4
        action: System calculates earnings
        system_response: Display shift earnings

    shift_summary:
      - Total deliveries
      - Distance covered
      - Earnings
      - Performance score
      - COD collected

    postconditions:
      - Agent off shift
      - Tracking stopped
      - Earnings calculated

metrics:
  - name: acceptance_rate
    description: Percentage of assignments accepted
    target: > 85%

  - name: completion_rate
    description: Successful deliveries vs attempts
    target: > 95%

  - name: on_time_rate
    description: Deliveries within SLA
    target: > 90%

  - name: customer_rating
    description: Average customer rating
    target: > 4.5

  - name: cod_accuracy
    description: COD reconciliation accuracy
    target: > 99.9%
