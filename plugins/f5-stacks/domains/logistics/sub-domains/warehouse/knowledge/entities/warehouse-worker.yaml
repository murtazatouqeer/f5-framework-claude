name: WarehouseWorker
display_name: Warehouse Worker
description: |
  Warehouse associate with role-based access and certifications.
  Tracks performance metrics, equipment certifications, and shift assignments.

domain: logistics
subdomain: warehouse
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: employee_id
    type: string
    required: true
    validation:
      pattern: "^EMP-[0-9]{6}$"
    example: "EMP-001234"

  - name: warehouse_id
    type: uuid
    required: true

  - name: user_id
    type: uuid
    required: true
    description: Link to system user account

  - name: status
    type: enum
    required: true
    validation:
      values: [active, inactive, on_leave, terminated]
    default: active

  # Personal Info
  - name: first_name
    type: string
    required: true

  - name: last_name
    type: string
    required: true

  - name: email
    type: string
    required: true
    validation:
      format: email

  - name: phone
    type: string
    required: false

  # Role & Department
  - name: role
    type: enum
    required: true
    validation:
      values: [associate, lead, supervisor, manager, admin]
    default: associate

  - name: department
    type: enum
    required: true
    validation:
      values: [receiving, putaway, picking, packing, shipping, inventory, returns, general]

  - name: reports_to
    type: uuid
    required: false

  # Shift
  - name: default_shift
    type: enum
    required: true
    validation:
      values: [day, swing, night, flexible]
    default: day

  - name: shift_start_time
    type: string
    required: false
    example: "08:00"

  - name: shift_end_time
    type: string
    required: false
    example: "16:00"

  # Zone Assignment
  - name: assigned_zones
    type: array
    required: false
    description: Zones worker is authorized to work in

  - name: home_zone_id
    type: uuid
    required: false

  # Certifications
  - name: certifications
    type: array
    required: false
    description: Equipment and skill certifications
    example:
      - type: "forklift"
        certification_number: "FL-12345"
        issued_date: "2024-01-15"
        expiry_date: "2025-01-15"
        status: "active"
      - type: "hazmat"
        certification_number: "HZ-67890"
        issued_date: "2024-03-01"
        expiry_date: "2025-03-01"
        status: "active"

  - name: equipment_authorized
    type: array
    required: false
    description: Equipment worker can operate
    example: ["rf_gun", "pallet_jack", "forklift", "reach_truck"]

  # Training
  - name: training_completed
    type: array
    required: false
    description: Completed training modules
    example:
      - module: "safety_basics"
        completed_date: "2024-01-10"
        score: 95
      - module: "rf_scanner_operation"
        completed_date: "2024-01-12"
        score: 90

  - name: training_due
    type: array
    required: false
    description: Training modules due for completion

  # Performance Metrics
  - name: performance_rating
    type: decimal
    required: false
    description: Overall performance score (0-100)

  - name: pick_rate_uph
    type: decimal
    required: false
    description: Units picked per hour

  - name: pack_rate_uph
    type: decimal
    required: false
    description: Units packed per hour

  - name: putaway_rate_uph
    type: decimal
    required: false
    description: Units put away per hour

  - name: accuracy_rate
    type: decimal
    required: false
    description: Task accuracy percentage

  - name: attendance_rate
    type: decimal
    required: false
    description: Attendance percentage

  # Current Assignment
  - name: current_task_id
    type: uuid
    required: false
    description: Currently assigned task

  - name: current_location_id
    type: uuid
    required: false
    description: Current location in warehouse

  - name: last_activity_at
    type: timestamp
    required: false

  - name: is_available
    type: boolean
    required: true
    default: true

  # RF Device
  - name: assigned_device_id
    type: string
    required: false
    description: Assigned RF scanner or device

  # Labor Tracking
  - name: clock_in_time
    type: timestamp
    required: false

  - name: clock_out_time
    type: timestamp
    required: false

  - name: break_start_time
    type: timestamp
    required: false

  - name: is_clocked_in
    type: boolean
    required: true
    default: false

  - name: is_on_break
    type: boolean
    required: true
    default: false

  # Emergency Contact
  - name: emergency_contact_name
    type: string
    required: false

  - name: emergency_contact_phone
    type: string
    required: false

  # Hire Info
  - name: hire_date
    type: date
    required: true

  - name: termination_date
    type: date
    required: false

  # Notes
  - name: notes
    type: text
    required: false

  # Timestamps
  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: warehouse
    type: belongs_to
    entity: Warehouse
    required: true

  - name: user
    type: belongs_to
    entity: User
    required: true

  - name: manager
    type: belongs_to
    entity: WarehouseWorker
    required: false

  - name: home_zone
    type: belongs_to
    entity: Zone
    required: false

  - name: direct_reports
    type: has_many
    entity: WarehouseWorker

  - name: pick_tasks
    type: has_many
    entity: PickTask

  - name: putaway_tasks
    type: has_many
    entity: PutawayTask

  - name: pack_tasks
    type: has_many
    entity: PackTask

  - name: cycle_counts
    type: has_many
    entity: CycleCount

indexes:
  - [employee_id]
  - [warehouse_id, status]
  - [warehouse_id, department]
  - [warehouse_id, role]
  - [user_id]
  - [reports_to]
  - [is_available]

computed_fields:
  - name: full_name
    formula: first_name + ' ' + last_name
  - name: tenure_days
    formula: today() - hire_date
  - name: is_certified_forklift
    formula: certifications.any(type == 'forklift' && status == 'active')
  - name: shift_duration_hours
    formula: (shift_end_time - shift_start_time) / 60

state_machine:
  initial: active
  states:
    - name: active
      description: Currently employed and working
    - name: inactive
      description: Temporarily inactive
    - name: on_leave
      description: On approved leave
    - name: terminated
      description: Employment ended
  transitions:
    - from: active
      to: inactive
      trigger: deactivate
    - from: active
      to: on_leave
      trigger: start_leave
    - from: on_leave
      to: active
      trigger: end_leave
    - from: inactive
      to: active
      trigger: reactivate
    - from: [active, inactive, on_leave]
      to: terminated
      trigger: terminate

business_rules:
  - BR-WRK-001: Forklift tasks require valid certification
  - BR-WRK-002: Workers can only be assigned to authorized zones
  - BR-WRK-003: Expired certifications block equipment use
  - BR-WRK-004: Supervisors required for high-value adjustments

events:
  - name: worker.clocked_in
    payload: [id, warehouse_id, clock_in_time]
  - name: worker.clocked_out
    payload: [id, clock_out_time, hours_worked]
  - name: worker.task_assigned
    payload: [id, task_id, task_type]
  - name: worker.certification_expiring
    payload: [id, certification_type, expiry_date]
