name: Vehicle
display_name: Vehicle
description: |
  Fleet vehicle asset with complete lifecycle management.
  Tracks specifications, equipment, documents, and real-time status.

domain: logistics
subdomain: fleet
category: core

attributes:
  - name: id
    type: uuid
    required: true

  - name: vehicle_id
    type: string
    required: true
    validation:
      pattern: "^VH-[0-9]{4}$"
    example: "VH-0001"

  - name: registration_number
    type: string
    required: true
    description: License plate number
    example: "ABC-1234"

  - name: vin
    type: string
    required: true
    description: Vehicle Identification Number
    validation:
      length: 17

  - name: status
    type: enum
    required: true
    validation:
      values: [available, in_use, maintenance, out_of_service, retired]
    default: available

  # Specifications
  - name: vehicle_type
    type: enum
    required: true
    validation:
      values: [truck, van, car, motorcycle, trailer]

  - name: vehicle_class
    type: enum
    required: true
    validation:
      values: [light_duty, medium_duty, heavy_duty]

  - name: make
    type: string
    required: true
    example: "Volvo"

  - name: model
    type: string
    required: true
    example: "FH16"

  - name: year
    type: integer
    required: true

  - name: fuel_type
    type: enum
    required: true
    validation:
      values: [diesel, gasoline, electric, hybrid, cng, lpg]

  - name: transmission
    type: enum
    required: true
    validation:
      values: [manual, automatic]

  - name: engine_capacity_cc
    type: integer
    required: false

  - name: color
    type: string
    required: false

  # Capacity
  - name: max_weight_kg
    type: decimal
    required: true
    description: Maximum payload capacity

  - name: tare_weight_kg
    type: decimal
    required: true
    description: Empty vehicle weight

  - name: gvwr_kg
    type: decimal
    required: true
    description: Gross Vehicle Weight Rating

  - name: cargo_volume_cbm
    type: decimal
    required: false

  - name: cargo_length_cm
    type: decimal
    required: false

  - name: cargo_width_cm
    type: decimal
    required: false

  - name: cargo_height_cm
    type: decimal
    required: false

  - name: pallet_capacity
    type: integer
    required: false

  - name: passenger_capacity
    type: integer
    required: false
    default: 2

  # Dimensions
  - name: overall_length_cm
    type: decimal
    required: false

  - name: overall_width_cm
    type: decimal
    required: false

  - name: overall_height_cm
    type: decimal
    required: false

  # Equipment
  - name: has_gps
    type: boolean
    required: true
    default: true

  - name: gps_device_id
    type: string
    required: false

  - name: has_dashcam
    type: boolean
    required: true
    default: false

  - name: has_refrigeration
    type: boolean
    required: true
    default: false

  - name: temperature_min_c
    type: decimal
    required: false
    description: Minimum temperature for reefer

  - name: temperature_max_c
    type: decimal
    required: false

  - name: has_lift_gate
    type: boolean
    required: true
    default: false

  - name: has_tail_lift
    type: boolean
    required: true
    default: false

  - name: has_adr_certification
    type: boolean
    required: true
    default: false
    description: Hazmat transport certified

  - name: equipment_list
    type: array
    required: false
    example: ["pallet_jack", "straps", "blankets", "dolly"]

  # Current Location
  - name: current_lat
    type: decimal
    required: false

  - name: current_lng
    type: decimal
    required: false

  - name: current_speed_kmh
    type: decimal
    required: false

  - name: current_heading
    type: decimal
    required: false

  - name: last_location_update
    type: timestamp
    required: false

  - name: ignition_on
    type: boolean
    required: false

  # Odometer & Hours
  - name: current_odometer_km
    type: decimal
    required: true
    default: 0

  - name: engine_hours
    type: decimal
    required: false

  - name: last_service_odometer
    type: decimal
    required: false

  - name: next_service_odometer
    type: decimal
    required: false

  - name: next_service_date
    type: date
    required: false

  # Documents
  - name: registration_expiry
    type: date
    required: true

  - name: insurance_policy_number
    type: string
    required: false

  - name: insurance_provider
    type: string
    required: false

  - name: insurance_expiry
    type: date
    required: true

  - name: road_tax_expiry
    type: date
    required: false

  - name: fitness_certificate_expiry
    type: date
    required: false

  - name: emission_test_expiry
    type: date
    required: false

  # Assignment
  - name: assigned_driver_id
    type: uuid
    required: false

  - name: assigned_depot_id
    type: uuid
    required: false

  - name: home_depot_id
    type: uuid
    required: true

  # Financial
  - name: purchase_date
    type: date
    required: false

  - name: purchase_price
    type: decimal
    required: false

  - name: depreciation_method
    type: enum
    required: false
    validation:
      values: [straight_line, declining_balance, units_of_production]

  - name: current_value
    type: decimal
    required: false

  - name: monthly_lease_cost
    type: decimal
    required: false

  - name: ownership_type
    type: enum
    required: true
    validation:
      values: [owned, leased, rented]
    default: owned

  # Fuel
  - name: fuel_tank_capacity_l
    type: decimal
    required: false

  - name: average_fuel_consumption
    type: decimal
    required: false
    description: Liters per 100 km

  # Notes
  - name: notes
    type: text
    required: false

  # Timestamps
  - name: created_at
    type: timestamp
    required: true

  - name: updated_at
    type: timestamp
    required: true

relationships:
  - name: assigned_driver
    type: belongs_to
    entity: Driver
    required: false

  - name: home_depot
    type: belongs_to
    entity: Depot
    required: true

  - name: assigned_depot
    type: belongs_to
    entity: Depot
    required: false

  - name: trips
    type: has_many
    entity: Trip

  - name: maintenance_records
    type: has_many
    entity: MaintenanceRecord

  - name: fuel_logs
    type: has_many
    entity: FuelLog

  - name: inspections
    type: has_many
    entity: VehicleInspection

  - name: gps_tracking
    type: has_many
    entity: GPSTracking

  - name: incidents
    type: has_many
    entity: Incident

indexes:
  - [vehicle_id]
  - [registration_number]
  - [vin]
  - [status]
  - [home_depot_id, status]
  - [assigned_driver_id]
  - [next_service_date]

computed_fields:
  - name: days_until_registration_expiry
    formula: registration_expiry - today()
  - name: days_until_insurance_expiry
    formula: insurance_expiry - today()
  - name: km_until_next_service
    formula: next_service_odometer - current_odometer_km
  - name: age_years
    formula: (today() - purchase_date) / 365

state_machine:
  initial: available
  states:
    - name: available
      description: Ready for assignment
    - name: in_use
      description: Currently on a trip
    - name: maintenance
      description: Under maintenance
    - name: out_of_service
      description: Temporarily unavailable
    - name: retired
      description: Permanently removed from fleet
  transitions:
    - from: available
      to: in_use
      trigger: assign_trip
    - from: available
      to: maintenance
      trigger: schedule_maintenance
    - from: available
      to: out_of_service
      trigger: take_offline
    - from: in_use
      to: available
      trigger: complete_trip
    - from: in_use
      to: maintenance
      trigger: breakdown
    - from: maintenance
      to: available
      trigger: complete_maintenance
    - from: out_of_service
      to: available
      trigger: return_to_service
    - from: out_of_service
      to: retired
      trigger: retire
    - from: [available, maintenance]
      to: retired
      trigger: retire

business_rules:
  - BR-VEH-001: Registration must be valid for trip assignment
  - BR-VEH-002: Insurance must be valid for trip assignment
  - BR-VEH-003: Vehicle must pass inspection before use
  - BR-VEH-004: Maintenance due vehicles restricted from long trips

events:
  - name: vehicle.created
    payload: [id, vehicle_id, vehicle_type]
  - name: vehicle.assigned
    payload: [id, driver_id, trip_id]
  - name: vehicle.maintenance_due
    payload: [id, current_odometer_km, next_service_odometer]
  - name: vehicle.document_expiring
    payload: [id, document_type, expiry_date]
