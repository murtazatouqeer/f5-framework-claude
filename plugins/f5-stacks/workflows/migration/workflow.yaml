# F5 Legacy Migration Workflow
# For projects migrating old systems without documentation

name: legacy-migration
version: 1.0.0
description: |
  Workflow để tạo SRS cho dự án migrate hệ thống cũ
  khi không có tài liệu sẵn có.

phases:
  # ══════════════════════════════════════════════════════════════════
  # PHASE 1: DISCOVERY - Thu thập thông tin
  # ══════════════════════════════════════════════════════════════════
  - id: 1
    name: discovery
    display_name: "Phase 1: Discovery"
    description: "Thu thập thông tin từ nhiều nguồn"
    duration: "1-2 weeks"

    activities:
      - id: 1.1
        name: system_inventory
        description: "Liệt kê tất cả screens, modules, features"
        inputs:
          - "Access to running system"
          - "User accounts for all roles"
        outputs:
          - "system-inventory.md"
          - "screenshots/"
        tools:
          - "f5 migrate inventory"
          - "Browser screen recording"

      - id: 1.2
        name: stakeholder_identification
        description: "Xác định người liên quan"
        outputs:
          - "stakeholder-map.md"
        tools:
          - "f5 ba stakeholders"

      - id: 1.3
        name: source_collection
        description: "Thu thập tất cả sources có sẵn"
        inputs:
          - "Database connection"
          - "Source code repository"
          - "API endpoints"
          - "Existing documents (if any)"
        outputs:
          - "sources-inventory.md"

    gate:
      name: "Discovery Gate"
      checklist:
        - "System inventory hoàn thành (≥80% screens documented)"
        - "Stakeholder map đầy đủ"
        - "Database access confirmed"
        - "Source code access confirmed"

  # ══════════════════════════════════════════════════════════════════
  # PHASE 2: REVERSE ENGINEERING - Phân tích kỹ thuật
  # ══════════════════════════════════════════════════════════════════
  - id: 2
    name: reverse_engineering
    display_name: "Phase 2: Reverse Engineering"
    description: "Phân tích DB, Code, API để extract requirements"
    duration: "1-2 weeks"

    activities:
      - id: 2.1
        name: database_analysis
        description: "Phân tích database schema"
        inputs:
          - "Database connection string"
        outputs:
          - "database-schema.md"
          - "erd-diagram.md"
          - "data-dictionary.md"
        tools:
          - "f5 migrate db-analyze"

      - id: 2.2
        name: api_analysis
        description: "Phân tích API endpoints"
        inputs:
          - "API base URL"
          - "Swagger/OpenAPI (if exists)"
          - "Source code"
        outputs:
          - "api-inventory.md"
        tools:
          - "f5 migrate api-analyze"

      - id: 2.3
        name: code_analysis
        description: "Phân tích source code"
        inputs:
          - "Source code repository"
        outputs:
          - "code-structure.md"
          - "business-rules-from-code.md"
        tools:
          - "f5 migrate code-analyze"

      - id: 2.4
        name: user_flow_mapping
        description: "Map user flows từ observation"
        inputs:
          - "System access"
          - "screenshots/"
        outputs:
          - "user-flows.md"
        tools:
          - "f5 migrate flow-map"

    gate:
      name: "Reverse Engineering Gate"
      checklist:
        - "Database schema documented"
        - "ERD diagram generated"
        - "API endpoints listed"
        - "Major user flows mapped"
        - "Business rules extracted from code"

  # ══════════════════════════════════════════════════════════════════
  # PHASE 3: ELICITATION - Phỏng vấn stakeholders
  # ══════════════════════════════════════════════════════════════════
  - id: 3
    name: elicitation
    display_name: "Phase 3: Elicitation"
    description: "Phỏng vấn stakeholders để bổ sung thông tin"
    duration: "1-2 weeks"

    activities:
      - id: 3.1
        name: prepare_questions
        description: "Chuẩn bị câu hỏi dựa trên Phase 1-2"
        inputs:
          - "system-inventory.md"
          - "database-schema.md"
          - "user-flows.md"
        outputs:
          - "interview-questions.md"
        tools:
          - "f5 migrate prepare-interview"

      - id: 3.2
        name: conduct_interviews
        description: "Thực hiện phỏng vấn"
        inputs:
          - "interview-questions.md"
          - "stakeholder-map.md"
        outputs:
          - "interview-notes/"
        tools:
          - "f5 ba elicit --interview"

      - id: 3.3
        name: validate_findings
        description: "Xác nhận thông tin với stakeholders"
        inputs:
          - "All documents from Phase 1-2"
          - "interview-notes/"
        outputs:
          - "validation-report.md"

    gate:
      name: "Elicitation Gate"
      checklist:
        - "Tất cả key stakeholders đã được phỏng vấn"
        - "Business rules được xác nhận"
        - "Edge cases được document"
        - "Priorities được xác định"

  # ══════════════════════════════════════════════════════════════════
  # PHASE 4: AS-IS DOCUMENTATION - Document hệ thống hiện tại
  # ══════════════════════════════════════════════════════════════════
  - id: 4
    name: as_is_documentation
    display_name: "Phase 4: AS-IS Documentation"
    description: "Tạo tài liệu mô tả hệ thống hiện tại"
    duration: "1 week"

    activities:
      - id: 4.1
        name: consolidate_information
        description: "Tổng hợp thông tin từ tất cả nguồn"
        inputs:
          - "All outputs from Phase 1-3"
        outputs:
          - "consolidated-info.md"
        tools:
          - "f5 migrate consolidate"

      - id: 4.2
        name: create_as_is_srs
        description: "Tạo AS-IS SRS"
        inputs:
          - "consolidated-info.md"
        outputs:
          - "AS-IS-SRS.md"
        tools:
          - "f5 migrate as-is --srs"

      - id: 4.3
        name: review_as_is
        description: "Review AS-IS với stakeholders"
        inputs:
          - "AS-IS-SRS.md"
        outputs:
          - "as-is-feedback.md"

    gate:
      name: "AS-IS Gate"
      checklist:
        - "AS-IS SRS hoàn thành"
        - "Stakeholders đã review"
        - "Không còn gaps lớn"
        - "Sign-off từ Product Owner"

  # ══════════════════════════════════════════════════════════════════
  # PHASE 5: TO-BE DOCUMENTATION - Document hệ thống mới
  # ══════════════════════════════════════════════════════════════════
  - id: 5
    name: to_be_documentation
    display_name: "Phase 5: TO-BE Documentation"
    description: "Tạo tài liệu cho hệ thống mới"
    duration: "1-2 weeks"

    activities:
      - id: 5.1
        name: define_changes
        description: "Xác định thay đổi từ AS-IS"
        inputs:
          - "AS-IS-SRS.md"
          - "Improvement requests"
          - "New feature requests"
        outputs:
          - "change-requests.md"
        tools:
          - "f5 migrate changes"

      - id: 5.2
        name: create_to_be_srs
        description: "Tạo TO-BE SRS"
        inputs:
          - "AS-IS-SRS.md"
          - "change-requests.md"
        outputs:
          - "TO-BE-SRS.md"
        tools:
          - "f5 migrate to-be --srs"

      - id: 5.3
        name: gap_analysis
        description: "Phân tích gaps giữa AS-IS và TO-BE"
        inputs:
          - "AS-IS-SRS.md"
          - "TO-BE-SRS.md"
        outputs:
          - "gap-analysis.md"
        tools:
          - "f5 migrate gap-analysis"

      - id: 5.4
        name: migration_plan
        description: "Lập kế hoạch migration"
        inputs:
          - "gap-analysis.md"
        outputs:
          - "migration-plan.md"

    gate:
      name: "TO-BE Gate"
      checklist:
        - "TO-BE SRS hoàn thành"
        - "Gap analysis hoàn thành"
        - "Migration plan được approve"
        - "Final sign-off"

# Output documents
outputs:
  phase_1:
    - system-inventory.md
    - stakeholder-map.md
    - screenshots/
  phase_2:
    - database-schema.md
    - erd-diagram.md
    - data-dictionary.md
    - api-inventory.md
    - user-flows.md
    - business-rules-from-code.md
  phase_3:
    - interview-notes/
    - validation-report.md
  phase_4:
    - AS-IS-SRS.md
  phase_5:
    - TO-BE-SRS.md
    - gap-analysis.md
    - migration-plan.md

# Templates
templates:
  system_inventory: templates/system-inventory-template.md
  as_is_srs: templates/as-is-srs-template.md
  to_be_srs: templates/to-be-srs-template.md
  gap_analysis: templates/gap-analysis-template.md
  migration_plan: templates/migration-plan-template.md
