name: rails
display_name: Ruby on Rails (API Mode)
description: |
  Full-stack Ruby web framework optimized for programmer happiness.
  API mode for building JSON APIs with convention over configuration.
  Follows "Convention over Configuration" and "Don't Repeat Yourself" principles.

category: backend
language: ruby
runtime: ruby
version: 2.0.0

version_support:
  minimum: "7.0"
  recommended: "7.1"
  ruby: ">=3.2"

core_concepts:
  - active_record:
      description: "ORM with conventions and migrations"
      importance: critical
  - migrations:
      description: "Database schema versioning"
      importance: critical
  - concerns:
      description: "Shared module behavior (DRY)"
      importance: high
  - serializers:
      description: "JSON response formatting"
      importance: high
  - service_objects:
      description: "Business logic encapsulation"
      importance: high
  - jobs:
      description: "Background processing with ActiveJob"
      importance: medium
  - callbacks:
      description: "Model lifecycle hooks"
      importance: medium
  - validations:
      description: "Data integrity at model level"
      importance: critical

architecture_patterns:
  - mvc:
      description: "Model-View-Controller"
      use_when: "Standard Rails apps"
      components:
        - models: "ActiveRecord for data and business rules"
        - controllers: "Request handling and response"
        - serializers: "JSON views for API mode"
  - service_objects:
      description: "Business logic in services"
      use_when: "Complex operations spanning multiple models"
      benefits:
        - "Thin controllers"
        - "Testable business logic"
        - "Single responsibility"
  - interactors:
      description: "Single-purpose operations with organizers"
      use_when: "Step-by-step workflows"
      gem: "interactor"
  - form_objects:
      description: "Complex form handling"
      use_when: "Multi-model forms, virtual attributes"
      gem: "reform"

database_options:
  - active_record:
      description: "Rails default ORM"
      best_for: "Most use cases"
      features:
        - "Migrations"
        - "Associations"
        - "Validations"
        - "Callbacks"
        - "Query interface"
  - rom_rb:
      description: "Ruby Object Mapper"
      best_for: "Complex domains, DDD"
      when_to_use: "Need strict separation of concerns"

testing_stack:
  unit: rspec
  factories: factory_bot
  mocking: rspec_mocks
  coverage: simplecov
  api_testing: rspec_request_specs
  matchers: shoulda_matchers

common_gems:
  core:
    - name: "rails"
      purpose: "Web framework"
    - name: "pg"
      purpose: "PostgreSQL adapter"
    - name: "puma"
      purpose: "Web server"
    - name: "bootsnap"
      purpose: "Boot time optimization"
  api:
    - name: "jsonapi-serializer"
      purpose: "JSON:API compliant serialization"
    - name: "blueprinter"
      purpose: "Fast JSON serialization"
    - name: "active_model_serializers"
      purpose: "Traditional JSON serialization"
    - name: "jbuilder"
      purpose: "JSON templates"
    - name: "rack-cors"
      purpose: "CORS handling"
  auth:
    - name: "devise"
      purpose: "Authentication solution"
    - name: "devise-jwt"
      purpose: "JWT tokens for Devise"
    - name: "pundit"
      purpose: "Authorization policies"
    - name: "cancancan"
      purpose: "Alternative authorization"
  async:
    - name: "sidekiq"
      purpose: "Background job processing"
    - name: "redis"
      purpose: "Cache and job queue"
    - name: "sidekiq-scheduler"
      purpose: "Scheduled jobs"
  testing:
    - name: "rspec-rails"
      purpose: "Testing framework"
    - name: "factory_bot_rails"
      purpose: "Test fixtures"
    - name: "shoulda-matchers"
      purpose: "One-liner tests"
    - name: "faker"
      purpose: "Fake data generation"
    - name: "database_cleaner"
      purpose: "Test database cleanup"
    - name: "webmock"
      purpose: "HTTP request stubbing"
    - name: "vcr"
      purpose: "HTTP interaction recording"
  utilities:
    - name: "kaminari"
      purpose: "Pagination"
    - name: "ransack"
      purpose: "Search and filtering"
    - name: "aasm"
      purpose: "State machines"
    - name: "paper_trail"
      purpose: "Model versioning"
    - name: "friendly_id"
      purpose: "Slugs for URLs"

project_structure:
  recommended: |
    app/
    ├── controllers/
    │   ├── application_controller.rb
    │   ├── concerns/
    │   │   └── exception_handler.rb
    │   └── api/
    │       └── v1/
    │           ├── base_controller.rb
    │           └── [resource]_controller.rb
    ├── models/
    │   ├── application_record.rb
    │   └── concerns/
    │       ├── soft_deletable.rb
    │       └── has_uuid.rb
    ├── serializers/
    │   └── [resource]_serializer.rb
    ├── services/
    │   ├── result.rb
    │   └── [domain]/
    │       └── [action]_[resource].rb
    ├── policies/
    │   ├── application_policy.rb
    │   └── [resource]_policy.rb
    ├── queries/
    │   └── [resource]_query.rb
    ├── jobs/
    │   └── application_job.rb
    └── mailers/
        └── application_mailer.rb
    config/
    ├── routes.rb
    ├── application.rb
    └── initializers/
        ├── cors.rb
        ├── devise.rb
        └── sidekiq.rb
    db/
    ├── migrate/
    ├── schema.rb
    └── seeds.rb
    spec/
    ├── rails_helper.rb
    ├── spec_helper.rb
    ├── support/
    │   ├── auth_helpers.rb
    │   └── request_helpers.rb
    ├── models/
    ├── requests/
    │   └── api/
    │       └── v1/
    ├── services/
    └── factories/

skills:
  architecture:
    - name: project-structure
      path: .claude/skills/stacks/backend/rails/architecture/project-structure.md
    - name: service-objects
      path: .claude/skills/stacks/backend/rails/architecture/service-objects.md
    - name: concerns
      path: .claude/skills/stacks/backend/rails/architecture/concerns.md
  database:
    - name: active-record
      path: .claude/skills/stacks/backend/rails/database/active-record.md
    - name: migrations
      path: .claude/skills/stacks/backend/rails/database/migrations.md
    - name: associations
      path: .claude/skills/stacks/backend/rails/database/associations.md
    - name: scopes
      path: .claude/skills/stacks/backend/rails/database/scopes.md
  api:
    - name: api-mode
      path: .claude/skills/stacks/backend/rails/api/api-mode.md
    - name: serializers
      path: .claude/skills/stacks/backend/rails/api/serializers.md
    - name: versioning
      path: .claude/skills/stacks/backend/rails/api/versioning.md
  security:
    - name: devise-jwt
      path: .claude/skills/stacks/backend/rails/security/devise-jwt.md
    - name: pundit-policies
      path: .claude/skills/stacks/backend/rails/security/pundit-policies.md
    - name: api-authentication
      path: .claude/skills/stacks/backend/rails/security/api-authentication.md
  testing:
    - name: rspec-patterns
      path: .claude/skills/stacks/backend/rails/testing/rspec-patterns.md
    - name: factory-bot
      path: .claude/skills/stacks/backend/rails/testing/factory-bot.md
    - name: request-specs
      path: .claude/skills/stacks/backend/rails/testing/request-specs.md
  performance:
    - name: caching
      path: .claude/skills/stacks/backend/rails/performance/caching.md
    - name: sidekiq
      path: .claude/skills/stacks/backend/rails/performance/sidekiq.md
    - name: eager-loading
      path: .claude/skills/stacks/backend/rails/performance/eager-loading.md

templates:
  - name: rails-controller
    path: templates/rails-controller.md
    description: "API controller template with CRUD actions"
  - name: rails-model
    path: templates/rails-model.md
    description: "ActiveRecord model template"
  - name: rails-serializer
    path: templates/rails-serializer.md
    description: "JSON serializer template"
  - name: rails-service
    path: templates/rails-service.md
    description: "Service object template"
  - name: rails-policy
    path: templates/rails-policy.md
    description: "Pundit policy template"
  - name: rails-migration
    path: templates/rails-migration.md
    description: "Database migration template"
  - name: rails-spec
    path: templates/rails-spec.md
    description: "RSpec test template"

agents:
  - name: controller-generator
    path: .claude/agents/stacks/backend/rails/controller-generator.md
    description: "Generates Rails API controllers"
  - name: model-generator
    path: .claude/agents/stacks/backend/rails/model-generator.md
    description: "Generates ActiveRecord models"
  - name: serializer-generator
    path: .claude/agents/stacks/backend/rails/serializer-generator.md
    description: "Generates JSON serializers"
  - name: service-generator
    path: .claude/agents/stacks/backend/rails/service-generator.md
    description: "Generates service objects"
  - name: test-generator
    path: .claude/agents/stacks/backend/rails/test-generator.md
    description: "Generates RSpec tests"

examples:
  - name: crud-api
    path: examples/crud-api/example.md
    description: "Complete CRUD API example"
  - name: auth-module
    path: examples/auth-module/example.md
    description: "JWT authentication module"

conventions:
  naming:
    models: "singular, CamelCase (User, OrderItem)"
    controllers: "plural, snake_case (users_controller.rb)"
    tables: "plural, snake_case (users, order_items)"
    foreign_keys: "singular_id (user_id, order_item_id)"
    serializers: "singular, CamelCase + Serializer (UserSerializer)"
    services: "Domain::ActionResource (Users::CreateUser)"
    policies: "singular, CamelCase + Policy (UserPolicy)"

  file_organization:
    controllers: "app/controllers/api/v[version]/"
    models: "app/models/"
    serializers: "app/serializers/"
    services: "app/services/[domain]/"
    policies: "app/policies/"
    specs: "spec/[type]/"

best_practices:
  - "Keep controllers thin, move logic to services"
  - "Use concerns for shared model behavior"
  - "Prefer service objects over fat models"
  - "Always use strong parameters"
  - "Use scopes for reusable queries"
  - "Write request specs over controller specs"
  - "Use factories over fixtures"
  - "Implement proper error handling"
  - "Version your APIs from the start"
  - "Use background jobs for slow operations"
