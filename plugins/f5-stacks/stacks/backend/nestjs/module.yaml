# stacks/backend/nestjs/module.yaml
name: nestjs
display_name: NestJS
version: 2.0.0
type: tech-stack

description: |
  Progressive Node.js framework for building efficient,
  reliable and scalable server-side applications.
  Built with TypeScript, inspired by Angular architecture.

extends:
  - backend

category: backend
language: typescript
runtime: nodejs

version_support:
  minimum: "10.0.0"
  recommended: "10.3.0"
  node: ">=18.0.0"

capabilities:
  language:
    - typescript
  framework:
    - nestjs
  features:
    - dependency-injection
    - decorators
    - modules
    - guards
    - interceptors
    - pipes
    - filters
    - middleware
  orm:
    - typeorm
    - prisma
    - mikro-orm
    - mongoose
  testing:
    - jest
    - supertest
    - istanbul

core_concepts:
  modules:
    description: "Organize code into cohesive blocks"
    decorator: "@Module()"
  controllers:
    description: "Handle incoming requests"
    decorator: "@Controller()"
  providers:
    description: "Services, repositories, factories"
    decorator: "@Injectable()"
  middleware:
    description: "Functions before route handlers"
    interface: "NestMiddleware"
  guards:
    description: "Authorization logic"
    interface: "CanActivate"
  interceptors:
    description: "Transform data, extend behavior"
    interface: "NestInterceptor"
  pipes:
    description: "Validation and transformation"
    interface: "PipeTransform"
  filters:
    description: "Exception handling"
    interface: "ExceptionFilter"
  decorators:
    description: "Attach metadata"
    type: "Custom decorators"

architecture_patterns:
  modular_monolith:
    description: "Single app with feature modules"
    use_when: "Small to medium projects"
    skill: "architecture/modular-architecture"
  clean_architecture:
    description: "Domain-centric with layers"
    use_when: "Complex business logic"
    skill: "architecture/clean-architecture"
  cqrs:
    description: "Command Query Responsibility Segregation"
    use_when: "Event-driven, complex domains"
    skill: "architecture/cqrs-pattern"
  microservices:
    description: "Distributed services"
    use_when: "Large scale, independent scaling"

database_options:
  typeorm:
    description: "Full-featured ORM"
    best_for: "SQL databases, complex relations"
    skill: "database/typeorm-patterns"
  prisma:
    description: "Modern ORM with type safety"
    best_for: "Type-safe queries, migrations"
    skill: "database/prisma-patterns"
  mongoose:
    description: "MongoDB ODM"
    best_for: "MongoDB projects"
  mikro-orm:
    description: "Data-mapper ORM"
    best_for: "DDD projects"

testing_stack:
  unit: jest
  e2e: supertest
  coverage: istanbul

common_packages:
  core:
    - "@nestjs/core"
    - "@nestjs/common"
    - "@nestjs/platform-express"
  database:
    - "@nestjs/typeorm"
    - "typeorm"
    - "@nestjs/prisma"
  auth:
    - "@nestjs/passport"
    - "@nestjs/jwt"
    - "passport-jwt"
  validation:
    - "class-validator"
    - "class-transformer"
  api:
    - "@nestjs/swagger"
  queue:
    - "@nestjs/bull"
    - "bull"
  cache:
    - "@nestjs/cache-manager"
    - "cache-manager"
  cqrs:
    - "@nestjs/cqrs"
  event:
    - "@nestjs/event-emitter"

project_structure:
  recommended: |
    src/
    ├── main.ts
    ├── app.module.ts
    ├── common/
    │   ├── decorators/
    │   ├── dto/
    │   ├── filters/
    │   ├── guards/
    │   ├── interceptors/
    │   └── pipes/
    ├── config/
    │   └── configuration.ts
    └── modules/
        └── {feature}/
            ├── {feature}.module.ts
            ├── {feature}.controller.ts
            ├── {feature}.service.ts
            ├── dto/
            ├── entities/
            └── __tests__/

# Skills - Patterns and Best Practices
skills:
  # Architecture
  - name: modular-architecture
    path: .claude/skills/stacks/backend/nestjs/architecture/modular-architecture.md
    description: "NestJS Modular Architecture patterns"
  - name: clean-architecture
    path: .claude/skills/stacks/backend/nestjs/architecture/clean-architecture.md
    description: "Clean Architecture implementation"
  - name: cqrs-pattern
    path: .claude/skills/stacks/backend/nestjs/architecture/cqrs-pattern.md
    description: "CQRS with @nestjs/cqrs"

  # Database
  - name: typeorm-patterns
    path: .claude/skills/stacks/backend/nestjs/database/typeorm-patterns.md
    description: "TypeORM patterns and best practices"
  - name: prisma-patterns
    path: .claude/skills/stacks/backend/nestjs/database/prisma-patterns.md
    description: "Prisma patterns in NestJS"
  - name: repository-pattern
    path: .claude/skills/stacks/backend/nestjs/database/repository-pattern.md
    description: "Repository pattern implementation"

  # Security
  - name: authentication
    path: .claude/skills/stacks/backend/nestjs/security/authentication.md
    description: "JWT Authentication patterns"
  - name: authorization
    path: .claude/skills/stacks/backend/nestjs/security/authorization.md
    description: "RBAC and ABAC patterns"
  - name: guards-strategies
    path: .claude/skills/stacks/backend/nestjs/security/guards-strategies.md
    description: "Guard strategies and patterns"

  # Validation
  - name: dto-validation
    path: .claude/skills/stacks/backend/nestjs/validation/dto-validation.md
    description: "DTO validation with class-validator"
  - name: custom-validators
    path: .claude/skills/stacks/backend/nestjs/validation/custom-validators.md
    description: "Custom validation decorators"

  # Error Handling
  - name: exception-filters
    path: .claude/skills/stacks/backend/nestjs/error-handling/exception-filters.md
    description: "Exception filters patterns"
  - name: error-responses
    path: .claude/skills/stacks/backend/nestjs/error-handling/error-responses.md
    description: "Standardized error responses"

  # Testing
  - name: unit-testing
    path: .claude/skills/stacks/backend/nestjs/testing/unit-testing.md
    description: "Unit testing patterns"
  - name: e2e-testing
    path: .claude/skills/stacks/backend/nestjs/testing/e2e-testing.md
    description: "E2E testing with supertest"

  # Performance
  - name: caching
    path: .claude/skills/stacks/backend/nestjs/performance/caching.md
    description: "Caching strategies"
  - name: queue-processing
    path: .claude/skills/stacks/backend/nestjs/performance/queue-processing.md
    description: "Queue processing with Bull"

# Templates
templates:
  # Existing (enhanced)
  srs: templates/nestjs-srs.md
  service: templates/nestjs-service.md
  controller: templates/nestjs-controller.md
  module: templates/nestjs-module.md

  # New templates
  dto: templates/nestjs-dto.md
  entity: templates/nestjs-entity.md
  repository: templates/nestjs-repository.md
  guard: templates/nestjs-guard.md
  interceptor: templates/nestjs-interceptor.md
  filter: templates/nestjs-filter.md
  pipe: templates/nestjs-pipe.md
  test: templates/nestjs-test.md

# Agents
agents:
  - id: nestjs-module-designer
    file: .claude/agents/stacks/backend/nestjs/module-designer.md
    triggers: ["nestjs module", "nest module", "create module"]
    description: "Design NestJS module structure"

  - id: nestjs-service-generator
    file: .claude/agents/stacks/backend/nestjs/service-generator.md
    triggers: ["nestjs service", "nest service", "create service"]
    description: "Generate NestJS service with business logic"

  - id: nestjs-controller-generator
    file: .claude/agents/stacks/backend/nestjs/controller-generator.md
    triggers: ["nestjs controller", "nest controller", "create controller"]
    description: "Generate NestJS controller with endpoints"

  - id: nestjs-dto-generator
    file: .claude/agents/stacks/backend/nestjs/dto-generator.md
    triggers: ["nestjs dto", "nest dto", "create dto"]
    description: "Generate DTOs with validation"

  - id: nestjs-entity-generator
    file: .claude/agents/stacks/backend/nestjs/entity-generator.md
    triggers: ["nestjs entity", "nest entity", "create entity"]
    description: "Generate TypeORM entities"

  - id: nestjs-test-generator
    file: .claude/agents/stacks/backend/nestjs/test-generator.md
    triggers: ["nestjs test", "nest test", "create test"]
    description: "Generate unit and e2e tests"

# Examples
examples:
  - name: crud-module
    path: examples/crud-module/
    description: "Complete CRUD module example"
  - name: auth-module
    path: examples/auth-module/
    description: "Authentication module example"
