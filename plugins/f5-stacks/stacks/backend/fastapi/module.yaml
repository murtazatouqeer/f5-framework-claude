# stacks/backend/fastapi/module.yaml
name: fastapi
display_name: FastAPI
version: 2.0.0
type: tech-stack

description: |
  Modern, fast (high-performance) web framework for building APIs with Python.
  Based on standard Python type hints with automatic OpenAPI documentation.

category: backend
language: python
runtime: python

extends:
  - backend

version_support:
  minimum: "0.100.0"
  recommended: "0.109.0"
  python: ">=3.10"

core_concepts:
  - path_operations: "HTTP method decorators (@app.get, @app.post)"
  - pydantic_models: "Data validation and serialization"
  - dependency_injection: "Built-in DI system"
  - async_await: "Native async support"
  - automatic_docs: "OpenAPI and JSON Schema"
  - type_hints: "Python type annotations"

architecture_patterns:
  - modular:
      description: "Routers organized by feature"
      use_when: "Most applications"
  - clean_architecture:
      description: "Domain-centric with layers"
      use_when: "Complex business logic"
  - hexagonal:
      description: "Ports and adapters"
      use_when: "Infrastructure independence"

database_options:
  - sqlalchemy:
      description: "Full-featured ORM (sync/async)"
      best_for: "SQL databases, complex queries"
  - tortoise_orm:
      description: "Async ORM inspired by Django"
      best_for: "Async-first projects"
  - databases:
      description: "Async database support"
      best_for: "Simple async queries"
  - sqlmodel:
      description: "SQLAlchemy + Pydantic hybrid"
      best_for: "Simpler models, less boilerplate"

capabilities:
  language:
    - python
  framework:
    - fastapi
  features:
    - async-await
    - pydantic
    - openapi
    - dependency-injection
    - sqlalchemy
    - background-tasks
    - websockets
    - middleware
    - exception-handlers
  database:
    - postgresql
    - mysql
    - mongodb
    - sqlite
    - redis
  testing:
    - pytest
    - pytest-asyncio
    - httpx
    - factory-boy

testing_stack:
  unit: pytest
  async: pytest-asyncio
  client: httpx
  coverage: pytest-cov

common_packages:
  core:
    - fastapi
    - uvicorn[standard]
    - pydantic[email]
    - pydantic-settings
  database:
    - sqlalchemy[asyncio]
    - asyncpg
    - alembic
    - greenlet
  auth:
    - python-jose[cryptography]
    - passlib[bcrypt]
    - python-multipart
  api:
    - httpx
    - aiohttp
  cache:
    - redis
    - aioredis
  async:
    - celery
    - aio-pika
  testing:
    - pytest
    - pytest-asyncio
    - pytest-cov
    - httpx
    - factory-boy
    - faker
  utilities:
    - python-decouple
    - loguru
    - python-slugify
    - orjson

project_structure:
  recommended: |
    app/
    ├── main.py                    # Application entry
    ├── config.py                  # Settings
    ├── database.py                # DB connection
    ├── dependencies.py            # Common dependencies
    ├── core/
    │   ├── security.py
    │   ├── exceptions.py
    │   └── pagination.py
    ├── models/                    # SQLAlchemy models
    │   ├── base.py
    │   └── {entity}.py
    ├── schemas/                   # Pydantic schemas
    │   └── {entity}.py
    ├── repositories/              # Data access
    │   └── {entity}.py
    ├── services/                  # Business logic
    │   └── {entity}.py
    ├── api/
    │   ├── deps.py               # API dependencies
    │   └── v1/
    │       ├── router.py
    │       └── endpoints/
    │           └── {entity}.py
    └── tests/
        ├── conftest.py
        └── api/
            └── test_{entity}.py

skills:
  - name: project-structure
    path: .claude/skills/stacks/backend/fastapi/architecture/project-structure.md
  - name: dependency-injection
    path: .claude/skills/stacks/backend/fastapi/architecture/dependency-injection.md
  - name: clean-architecture
    path: .claude/skills/stacks/backend/fastapi/architecture/clean-architecture.md
  - name: sqlalchemy-patterns
    path: .claude/skills/stacks/backend/fastapi/database/sqlalchemy-patterns.md
  - name: async-sqlalchemy
    path: .claude/skills/stacks/backend/fastapi/database/async-sqlalchemy.md
  - name: alembic-migrations
    path: .claude/skills/stacks/backend/fastapi/database/alembic-migrations.md
  - name: repository-pattern
    path: .claude/skills/stacks/backend/fastapi/database/repository-pattern.md
  - name: oauth2-jwt
    path: .claude/skills/stacks/backend/fastapi/security/oauth2-jwt.md
  - name: api-key-auth
    path: .claude/skills/stacks/backend/fastapi/security/api-key-auth.md
  - name: rbac-permissions
    path: .claude/skills/stacks/backend/fastapi/security/rbac-permissions.md
  - name: pydantic-models
    path: .claude/skills/stacks/backend/fastapi/validation/pydantic-models.md
  - name: custom-validators
    path: .claude/skills/stacks/backend/fastapi/validation/custom-validators.md
  - name: exception-handlers
    path: .claude/skills/stacks/backend/fastapi/error-handling/exception-handlers.md
  - name: error-responses
    path: .claude/skills/stacks/backend/fastapi/error-handling/error-responses.md
  - name: pytest-asyncio
    path: .claude/skills/stacks/backend/fastapi/testing/pytest-asyncio.md
  - name: test-client
    path: .claude/skills/stacks/backend/fastapi/testing/test-client.md
  - name: fixtures
    path: .claude/skills/stacks/backend/fastapi/testing/fixtures.md
  - name: async-patterns
    path: .claude/skills/stacks/backend/fastapi/performance/async-patterns.md
  - name: caching
    path: .claude/skills/stacks/backend/fastapi/performance/caching.md
  - name: background-tasks
    path: .claude/skills/stacks/backend/fastapi/performance/background-tasks.md

templates:
  - name: fastapi-router
    path: templates/fastapi-router.md
  - name: fastapi-model
    path: templates/fastapi-model.md
  - name: fastapi-schema
    path: templates/fastapi-schema.md
  - name: fastapi-service
    path: templates/fastapi-service.md
  - name: fastapi-repository
    path: templates/fastapi-repository.md
  - name: fastapi-dependency
    path: templates/fastapi-dependency.md
  - name: fastapi-middleware
    path: templates/fastapi-middleware.md
  - name: fastapi-test
    path: templates/fastapi-test.md

agents:
  - id: router-generator
    file: .claude/agents/stacks/backend/fastapi/router-generator.md
    triggers: ["fastapi router", "fastapi endpoint", "api endpoint"]
  - id: model-generator
    file: .claude/agents/stacks/backend/fastapi/model-generator.md
    triggers: ["sqlalchemy model", "fastapi model", "database model"]
  - id: schema-generator
    file: .claude/agents/stacks/backend/fastapi/schema-generator.md
    triggers: ["pydantic schema", "fastapi schema", "dto"]
  - id: service-generator
    file: .claude/agents/stacks/backend/fastapi/service-generator.md
    triggers: ["fastapi service", "business logic", "service layer"]
  - id: test-generator
    file: .claude/agents/stacks/backend/fastapi/test-generator.md
    triggers: ["pytest", "fastapi test", "api test"]

examples:
  - name: crud-api
    path: examples/crud-api/
    description: "Complete CRUD API example with products"
  - name: auth-module
    path: examples/auth-module/
    description: "JWT authentication with OAuth2"
