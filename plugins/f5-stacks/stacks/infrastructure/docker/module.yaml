name: docker
display_name: Docker
description: |
  Container platform for building, shipping, and running applications.
  Includes Dockerfile best practices, multi-stage builds, and Docker Compose orchestration.

category: infrastructure
type: containerization

version_support:
  minimum: "24.0"
  recommended: "25.0"
  compose_minimum: "2.24"
  compose_recommended: "2.27"

core_concepts:
  images:
    description: "Read-only templates for creating containers"
    key_points:
      - "Layered filesystem"
      - "Built from Dockerfile"
      - "Immutable once created"
  containers:
    description: "Runnable instances of images"
    key_points:
      - "Isolated process"
      - "Writable layer on top of image"
      - "Ephemeral by default"
  dockerfile:
    description: "Instructions to build images"
    key_points:
      - "FROM, RUN, COPY, CMD"
      - "Multi-stage builds"
      - "Layer optimization"
  compose:
    description: "Multi-container orchestration"
    key_points:
      - "services, networks, volumes"
      - "Development and production configs"
      - "Dependency management"
  volumes:
    description: "Persistent data storage"
    key_points:
      - "Named volumes"
      - "Bind mounts"
      - "tmpfs mounts"
  networks:
    description: "Container communication"
    key_points:
      - "Bridge, host, overlay"
      - "Service discovery"
      - "Network isolation"
  registry:
    description: "Image storage and distribution"
    key_points:
      - "Docker Hub"
      - "Private registries"
      - "Image tagging"

dockerfile_patterns:
  multi_stage:
    description: "Separate build and runtime stages"
    use_when:
      - "Production images"
      - "Compiled languages (Go, Rust, Java)"
      - "Need minimal final image"
    benefits:
      - "Smaller images"
      - "No build tools in production"
      - "Better security"
  single_stage:
    description: "Simple single stage build"
    use_when:
      - "Simple applications"
      - "Scripting languages"
      - "Development images"
  builder_pattern:
    description: "External build, copy artifacts"
    use_when:
      - "Complex build requirements"
      - "CI/CD pipelines"
      - "Shared build artifacts"

compose_patterns:
  development:
    description: "Local development with hot reload"
    features:
      - "Bind mounts for live code reload"
      - "Debug ports exposed"
      - "Development environment variables"
      - "Override files"
  production:
    description: "Production-ready deployment"
    features:
      - "Health checks"
      - "Resource limits"
      - "Restart policies"
      - "Secrets management"
  microservices:
    description: "Multi-service architecture"
    features:
      - "Service discovery"
      - "Network isolation"
      - "Load balancing"
      - "Scaling"

base_images:
  node:
    recommended: "node:20-alpine"
    alternatives:
      - "node:20-slim"
      - "node:20-bookworm"
    size_comparison:
      alpine: "~180MB"
      slim: "~250MB"
      bookworm: "~1GB"
  python:
    recommended: "python:3.12-slim"
    alternatives:
      - "python:3.12-alpine"
      - "python:3.12-bookworm"
    notes: "Alpine may have issues with some C extensions"
  go:
    build: "golang:1.22-alpine"
    runtime: "gcr.io/distroless/static-debian12"
    notes: "Distroless for minimal attack surface (~2MB)"
  java:
    recommended: "eclipse-temurin:21-jre-alpine"
    alternatives:
      - "amazoncorretto:21-alpine"
      - "eclipse-temurin:21-jre-jammy"
  rust:
    build: "rust:1.75-alpine"
    runtime: "gcr.io/distroless/cc-debian12"
  dotnet:
    recommended: "mcr.microsoft.com/dotnet/aspnet:8.0-alpine"
    sdk: "mcr.microsoft.com/dotnet/sdk:8.0-alpine"

security_practices:
  image_security:
    - name: "Use minimal base images"
      description: "Alpine or distroless reduce attack surface"
    - name: "Pin image versions"
      description: "Use specific tags, not :latest"
    - name: "Scan for vulnerabilities"
      description: "Use docker scout, trivy, or snyk"
  runtime_security:
    - name: "Run as non-root"
      description: "Create and use dedicated user"
    - name: "Read-only filesystem"
      description: "Use --read-only flag when possible"
    - name: "Drop capabilities"
      description: "Use --cap-drop=ALL, add only needed"
    - name: "No privileged mode"
      description: "Avoid --privileged flag"
  secrets_management:
    - name: "Never embed secrets in images"
      description: "Use runtime injection"
    - name: "Use Docker secrets"
      description: "For Swarm mode"
    - name: "Environment variables"
      description: "For development only"
    - name: "External secret managers"
      description: "Vault, AWS Secrets Manager, etc."

optimization_techniques:
  image_size:
    - name: "Multi-stage builds"
      description: "Separate build and runtime"
    - name: "Minimal base images"
      description: "Alpine, slim, distroless"
    - name: "Clean up in same layer"
      description: "RUN apt-get && rm -rf in one command"
    - name: "Use .dockerignore"
      description: "Exclude unnecessary files"
  build_performance:
    - name: "Layer caching"
      description: "Order instructions for cache efficiency"
    - name: "Copy dependencies first"
      description: "package.json before source code"
    - name: "BuildKit"
      description: "Enable for parallel builds"
    - name: "Cache mounts"
      description: "Use --mount=type=cache"
  runtime_performance:
    - name: "Resource limits"
      description: "Set CPU and memory limits"
    - name: "Health checks"
      description: "Enable container health monitoring"
    - name: "Proper signal handling"
      description: "Use exec form CMD, handle SIGTERM"

commands:
  build:
    basic: "docker build -t myapp:latest ."
    with_target: "docker build --target production -t myapp:prod ."
    no_cache: "docker build --no-cache -t myapp:latest ."
    buildkit: "DOCKER_BUILDKIT=1 docker build -t myapp:latest ."
  run:
    basic: "docker run -d -p 3000:3000 myapp:latest"
    with_env: "docker run -d -e NODE_ENV=production myapp:latest"
    with_volume: "docker run -d -v ./data:/app/data myapp:latest"
    interactive: "docker run -it --rm myapp:latest /bin/sh"
  compose:
    up: "docker compose up -d"
    down: "docker compose down"
    logs: "docker compose logs -f"
    build: "docker compose build --no-cache"
    prod: "docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d"
  debug:
    exec: "docker exec -it container_name /bin/sh"
    logs: "docker logs -f container_name"
    inspect: "docker inspect container_name"
    stats: "docker stats"

skills:
  - name: fundamentals/docker-basics
    path: .claude/skills/stacks/infrastructure/docker/fundamentals/docker-basics.md
  - name: fundamentals/images-containers
    path: .claude/skills/stacks/infrastructure/docker/fundamentals/images-containers.md
  - name: fundamentals/dockerfile-syntax
    path: .claude/skills/stacks/infrastructure/docker/fundamentals/dockerfile-syntax.md
  - name: fundamentals/build-context
    path: .claude/skills/stacks/infrastructure/docker/fundamentals/build-context.md
  - name: dockerfile/multi-stage-builds
    path: .claude/skills/stacks/infrastructure/docker/dockerfile/multi-stage-builds.md
  - name: dockerfile/layer-optimization
    path: .claude/skills/stacks/infrastructure/docker/dockerfile/layer-optimization.md
  - name: dockerfile/caching-strategies
    path: .claude/skills/stacks/infrastructure/docker/dockerfile/caching-strategies.md
  - name: dockerfile/best-practices
    path: .claude/skills/stacks/infrastructure/docker/dockerfile/best-practices.md
  - name: compose/compose-basics
    path: .claude/skills/stacks/infrastructure/docker/compose/compose-basics.md
  - name: compose/services
    path: .claude/skills/stacks/infrastructure/docker/compose/services.md
  - name: compose/networks
    path: .claude/skills/stacks/infrastructure/docker/compose/networks.md
  - name: compose/volumes
    path: .claude/skills/stacks/infrastructure/docker/compose/volumes.md
  - name: compose/environment
    path: .claude/skills/stacks/infrastructure/docker/compose/environment.md
  - name: networking/network-types
    path: .claude/skills/stacks/infrastructure/docker/networking/network-types.md
  - name: networking/port-mapping
    path: .claude/skills/stacks/infrastructure/docker/networking/port-mapping.md
  - name: networking/dns-discovery
    path: .claude/skills/stacks/infrastructure/docker/networking/dns-discovery.md
  - name: storage/volumes
    path: .claude/skills/stacks/infrastructure/docker/storage/volumes.md
  - name: storage/bind-mounts
    path: .claude/skills/stacks/infrastructure/docker/storage/bind-mounts.md
  - name: storage/tmpfs
    path: .claude/skills/stacks/infrastructure/docker/storage/tmpfs.md
  - name: security/image-security
    path: .claude/skills/stacks/infrastructure/docker/security/image-security.md
  - name: security/runtime-security
    path: .claude/skills/stacks/infrastructure/docker/security/runtime-security.md
  - name: security/secrets-management
    path: .claude/skills/stacks/infrastructure/docker/security/secrets-management.md
  - name: security/vulnerability-scanning
    path: .claude/skills/stacks/infrastructure/docker/security/vulnerability-scanning.md
  - name: optimization/image-size
    path: .claude/skills/stacks/infrastructure/docker/optimization/image-size.md
  - name: optimization/build-performance
    path: .claude/skills/stacks/infrastructure/docker/optimization/build-performance.md
  - name: optimization/runtime-performance
    path: .claude/skills/stacks/infrastructure/docker/optimization/runtime-performance.md
  - name: registry/docker-hub
    path: .claude/skills/stacks/infrastructure/docker/registry/docker-hub.md
  - name: registry/private-registry
    path: .claude/skills/stacks/infrastructure/docker/registry/private-registry.md
  - name: registry/image-tagging
    path: .claude/skills/stacks/infrastructure/docker/registry/image-tagging.md

templates:
  - name: dockerfile-node
    path: templates/dockerfile-node.md
    description: "Multi-stage Dockerfile for Node.js applications"
  - name: dockerfile-python
    path: templates/dockerfile-python.md
    description: "Multi-stage Dockerfile for Python applications"
  - name: dockerfile-go
    path: templates/dockerfile-go.md
    description: "Multi-stage Dockerfile for Go applications"
  - name: dockerfile-java
    path: templates/dockerfile-java.md
    description: "Multi-stage Dockerfile for Java/Spring applications"
  - name: compose-fullstack
    path: templates/compose-fullstack.md
    description: "Full-stack Docker Compose with frontend, backend, database"
  - name: compose-microservices
    path: templates/compose-microservices.md
    description: "Microservices Docker Compose with service mesh"
  - name: compose-dev
    path: templates/compose-dev.md
    description: "Development Docker Compose with hot reload"

agents:
  - name: dockerfile-generator
    path: .claude/agents/stacks/infrastructure/docker/dockerfile-generator.md
    description: "Generates optimized Dockerfiles for any language"
  - name: compose-generator
    path: .claude/agents/stacks/infrastructure/docker/compose-generator.md
    description: "Generates Docker Compose configurations"
  - name: optimization-agent
    path: .claude/agents/stacks/infrastructure/docker/optimization-agent.md
    description: "Analyzes and optimizes Docker configurations"
  - name: security-scanner
    path: .claude/agents/stacks/infrastructure/docker/security-scanner.md
    description: "Scans for security issues in Docker setups"
  - name: debug-agent
    path: .claude/agents/stacks/infrastructure/docker/debug-agent.md
    description: "Helps debug Docker container issues"
