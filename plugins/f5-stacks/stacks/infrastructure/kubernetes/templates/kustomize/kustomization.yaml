# Kustomize Template - kustomization.yaml
# F5 Framework - Infrastructure Stack
#
# Variables:
#   {{app_name}}     - Application name
#   {{namespace}}    - Kubernetes namespace
#   {{image}}        - Container image

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Metadata
metadata:
  name: {{app_name | default: "myapp"}}
  annotations:
    f5.io/template: "kustomize"
    f5.io/version: "1.0.0"

# Namespace for all resources
namespace: {{namespace | default: "default"}}

# Common labels added to all resources
commonLabels:
  app.kubernetes.io/name: {{app_name | default: "myapp"}}
  app.kubernetes.io/managed-by: kustomize
  f5.io/framework: "true"

# Common annotations
commonAnnotations:
  f5.io/generated: "true"

# Resource files to include
resources:
  - deployment.yaml
  - service.yaml
  - configmap.yaml
  # - secret.yaml  # Prefer external secret management
  # - ingress.yaml
  # - hpa.yaml
  # - pdb.yaml
  # - serviceaccount.yaml
  # - networkpolicy.yaml

# Image transformers
images:
  - name: {{app_name | default: "myapp"}}
    newName: {{image_repository | default: "myorg/myapp"}}
    newTag: {{image_tag | default: "latest"}}

# ConfigMap generators
configMapGenerator:
  - name: {{app_name | default: "myapp"}}-config
    literals:
      - APP_ENV={{environment | default: "production"}}
      - LOG_LEVEL={{log_level | default: "info"}}
      - LOG_FORMAT={{log_format | default: "json"}}
    options:
      disableNameSuffixHash: true

# Secret generators (use external secrets in production)
# secretGenerator:
#   - name: {{app_name | default: "myapp"}}-secrets
#     literals:
#       - DATABASE_PASSWORD=changeme
#     options:
#       disableNameSuffixHash: true

# Patches for customization
patches:
  # Patch replicas
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: {{replicas | default: 3}}
    target:
      kind: Deployment
      name: {{app_name | default: "myapp"}}

  # Patch resources
  - patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources
        value:
          requests:
            cpu: {{cpu_request | default: "100m"}}
            memory: {{mem_request | default: "128Mi"}}
          limits:
            cpu: {{cpu_limit | default: "500m"}}
            memory: {{mem_limit | default: "512Mi"}}
    target:
      kind: Deployment
      name: {{app_name | default: "myapp"}}

# Strategic merge patches
patchesStrategicMerge: []
  # - patch-deployment.yaml

# JSON patches
patchesJson6902: []

# Replacements (Kustomize v4.1+)
replacements: []

# Components (reusable kustomization pieces)
components: []
  # - ../components/monitoring
  # - ../components/security

# Generators
generators: []

# Transformers
transformers: []

# Validators
validators: []

# Build metadata
buildMetadata:
  - managedByLabel
