# Learning Profile Schema
# Defines the structure for project-specific learning profiles

$schema: "http://json-schema.org/draft-07/schema#"
title: "F5 Learning Profile Schema"
description: "Schema for project learning profiles and pattern detection"
type: object

required:
  - version
  - project_id
  - scanned_at

properties:
  version:
    type: string
    pattern: "^\\d+\\.\\d+\\.\\d+$"
    description: "Learning profile version"

  project_id:
    type: string
    description: "Project identifier"

  scanned_at:
    type: string
    format: date-time
    description: "Last scan timestamp"

  confidence_score:
    type: number
    minimum: 0
    maximum: 100
    description: "Overall confidence in learned patterns"

  files_analyzed:
    type: integer
    minimum: 0
    description: "Number of files analyzed"

  naming_conventions:
    type: object
    properties:
      files:
        type: object
        properties:
          pattern:
            type: string
            enum: ["kebab-case", "camelCase", "PascalCase", "snake_case"]
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
            minimum: 0
            maximum: 100
      variables:
        type: object
        properties:
          pattern:
            type: string
            enum: ["camelCase", "snake_case", "PascalCase", "SCREAMING_SNAKE_CASE"]
          prefixes:
            type: object
            properties:
              boolean:
                type: string
              private:
                type: string
              constant:
                type: string
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
      functions:
        type: object
        properties:
          pattern:
            type: string
          verb_prefixes:
            type: array
            items:
              type: string
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
      classes:
        type: object
        properties:
          pattern:
            type: string
          suffixes:
            type: object
            additionalProperties:
              type: string
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
      interfaces:
        type: object
        properties:
          prefix:
            type: string
          pattern:
            type: string
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
      types:
        type: object
        properties:
          suffix:
            type: string
          pattern:
            type: string
          examples:
            type: array
            items:
              type: string
          confidence:
            type: number
    description: "Naming convention patterns"

  code_style:
    type: object
    properties:
      indentation:
        type: object
        properties:
          type:
            type: string
            enum: ["spaces", "tabs"]
          size:
            type: integer
            minimum: 1
            maximum: 8
          confidence:
            type: number
      quotes:
        type: object
        properties:
          type:
            type: string
            enum: ["single", "double"]
          jsx:
            type: string
            enum: ["single", "double"]
          confidence:
            type: number
      semicolons:
        type: object
        properties:
          use:
            type: boolean
          confidence:
            type: number
      trailing_commas:
        type: object
        properties:
          style:
            type: string
            enum: ["none", "es5", "all"]
          confidence:
            type: number
      max_line_length:
        type: integer
        minimum: 40
        maximum: 200
      imports:
        type: object
        properties:
          order:
            type: array
            items:
              type: string
          group_by:
            type: string
            enum: ["type", "source", "none"]
          newline_between_groups:
            type: boolean
          confidence:
            type: number
      prefer_arrow_functions:
        type: boolean
      prefer_const:
        type: boolean
      explicit_return_types:
        type: boolean
    description: "Code style preferences"

  architecture_patterns:
    type: object
    properties:
      primary:
        type: string
        enum: ["clean-architecture", "mvc", "mvvm", "hexagonal", "layered", "microservices", "modular-monolith"]
      layers:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            path:
              type: string
            dependencies:
              type: array
              items:
                type: string
      dependency_direction:
        type: string
        enum: ["inward", "downward", "none"]
      confidence:
        type: number
    description: "Architecture patterns detected"

  error_handling:
    type: object
    properties:
      pattern:
        type: string
        enum: ["try-catch", "result-type", "either-monad", "error-first-callback", "promise-catch"]
      custom_error_classes:
        type: boolean
      error_codes:
        type: boolean
      logging_pattern:
        type: string
      examples:
        type: array
        items:
          type: string
      confidence:
        type: number
    description: "Error handling patterns"

  testing:
    type: object
    properties:
      framework:
        type: string
      naming_pattern:
        type: string
      file_location:
        type: string
        enum: ["colocated", "separate-folder", "root-tests"]
      describe_style:
        type: string
        enum: ["behavior", "unit", "feature"]
      mock_pattern:
        type: string
      confidence:
        type: number
    description: "Testing patterns"

  documentation:
    type: object
    properties:
      style:
        type: string
        enum: ["jsdoc", "tsdoc", "none", "minimal"]
      required_for:
        type: array
        items:
          type: string
          enum: ["public", "exported", "complex", "all"]
      param_descriptions:
        type: boolean
      return_descriptions:
        type: boolean
      example_usage:
        type: boolean
      confidence:
        type: number
    description: "Documentation patterns"

  custom_rules:
    type: array
    items:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        pattern:
          type: string
        example:
          type: string
        severity:
          type: string
          enum: ["error", "warning", "info"]
        auto_fix:
          type: boolean
    description: "Custom project-specific rules"

  learned_from_corrections:
    type: array
    items:
      type: object
      properties:
        date:
          type: string
          format: date-time
        file:
          type: string
        original:
          type: string
        corrected:
          type: string
        rule_created:
          type: string
    description: "Patterns learned from user corrections"

# Example
examples:
  - version: "1.0.0"
    project_id: "my-project"
    scanned_at: "2024-01-15T10:00:00Z"
    confidence_score: 85
    files_analyzed: 150
    naming_conventions:
      files:
        pattern: "kebab-case"
        examples: ["user-service.ts", "auth-controller.ts"]
        confidence: 95
      variables:
        pattern: "camelCase"
        prefixes:
          boolean: "is"
          private: "_"
          constant: "UPPER_SNAKE"
        examples: ["userName", "isActive", "_privateVar"]
        confidence: 90
      functions:
        pattern: "camelCase"
        verb_prefixes: ["get", "set", "create", "update", "delete", "find", "handle"]
        examples: ["getUserById", "createOrder", "handleSubmit"]
        confidence: 92
      classes:
        pattern: "PascalCase"
        suffixes:
          service: "Service"
          controller: "Controller"
          repository: "Repository"
        examples: ["UserService", "AuthController"]
        confidence: 98
    code_style:
      indentation:
        type: "spaces"
        size: 2
        confidence: 100
      quotes:
        type: "single"
        jsx: "double"
        confidence: 95
      semicolons:
        use: true
        confidence: 98
    architecture_patterns:
      primary: "clean-architecture"
      layers:
        - name: "domain"
          path: "src/domain"
          dependencies: []
        - name: "application"
          path: "src/application"
          dependencies: ["domain"]
        - name: "infrastructure"
          path: "src/infrastructure"
          dependencies: ["domain", "application"]
      dependency_direction: "inward"
      confidence: 88
