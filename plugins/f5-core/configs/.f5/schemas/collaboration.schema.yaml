# Collaboration Schema
# Schema for team collaboration features

$schema: "http://json-schema.org/draft-07/schema#"
title: "F5 Collaboration Schema"
description: "Schema for team collaboration, sessions, handoffs, and shared knowledge"

definitions:
  # Team member definition
  team_member:
    type: object
    required:
      - id
      - name
      - role
    properties:
      id:
        type: string
        description: "Unique identifier (e.g., email or username)"
      name:
        type: string
        description: "Display name"
      role:
        type: string
        enum: [senior, middle, junior, fresher, tester, lead, pm]
      skills:
        type: array
        items:
          type: string
        description: "Technical skills"
      availability:
        type: string
        enum: [available, busy, away, offline]
        default: available
      current_task:
        type: string
        description: "Current assigned task/requirement"
      timezone:
        type: string
        description: "Timezone for scheduling"
      mentor_id:
        type: string
        description: "ID of mentor (for juniors/freshers)"

  # Collaboration session
  collab_session:
    type: object
    required:
      - id
      - project_id
      - created_by
      - created_at
    properties:
      id:
        type: string
      project_id:
        type: string
      created_by:
        type: string
        description: "Team member ID who created session"
      created_at:
        type: string
        format: date-time
      participants:
        type: array
        items:
          type: object
          properties:
            member_id:
              type: string
            joined_at:
              type: string
              format: date-time
            role:
              type: string
              enum: [owner, editor, viewer]
            last_active:
              type: string
              format: date-time
      status:
        type: string
        enum: [active, paused, completed, archived]
        default: active
      shared_context:
        type: object
        properties:
          checkpoint_id:
            type: string
          current_gate:
            type: string
          current_requirement:
            type: string
          key_decisions:
            type: array
            items:
              type: string
          blockers:
            type: array
            items:
              type: string
      chat_history:
        type: array
        items:
          type: object
          properties:
            timestamp:
              type: string
              format: date-time
            member_id:
              type: string
            message:
              type: string
            type:
              type: string
              enum: [message, decision, blocker, update]

  # Task handoff
  handoff:
    type: object
    required:
      - id
      - from_member
      - to_member
      - task
      - created_at
    properties:
      id:
        type: string
      from_member:
        type: string
      to_member:
        type: string
      task:
        type: object
        properties:
          project_id:
            type: string
          requirement_id:
            type: string
          description:
            type: string
          current_status:
            type: string
          files_involved:
            type: array
            items:
              type: string
        required:
          - requirement_id
          - description
      context:
        type: object
        properties:
          checkpoint_id:
            type: string
          summary:
            type: string
          key_points:
            type: array
            items:
              type: string
          warnings:
            type: array
            items:
              type: string
          next_steps:
            type: array
            items:
              type: string
      created_at:
        type: string
        format: date-time
      accepted_at:
        type: string
        format: date-time
      completed_at:
        type: string
        format: date-time
      status:
        type: string
        enum: [pending, accepted, rejected, completed]
        default: pending

  # Shared knowledge item
  shared_knowledge:
    type: object
    required:
      - id
      - project_id
      - category
      - title
      - content
      - created_by
    properties:
      id:
        type: string
      project_id:
        type: string
      category:
        type: string
        enum: [decision, learning, warning, reference, convention]
      title:
        type: string
      content:
        type: string
      created_by:
        type: string
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
      approved_by:
        type: array
        items:
          type: string
      visibility:
        type: string
        enum: [team, project, public]
        default: team
      tags:
        type: array
        items:
          type: string

  # Task assignment
  task_assignment:
    type: object
    required:
      - id
      - requirement_id
      - assignee
      - assigned_by
    properties:
      id:
        type: string
      project_id:
        type: string
      requirement_id:
        type: string
      assignee:
        type: string
        description: "Team member ID"
      assigned_by:
        type: string
      assigned_at:
        type: string
        format: date-time
      due_date:
        type: string
        format: date-time
      priority:
        type: string
        enum: [critical, high, medium, low]
        default: medium
      status:
        type: string
        enum: [assigned, in_progress, review, completed, blocked]
        default: assigned
      estimated_hours:
        type: number
        minimum: 0
      actual_hours:
        type: number
        minimum: 0
      dependencies:
        type: array
        items:
          type: string
      notes:
        type: string

  # Activity log
  activity_log:
    type: object
    required:
      - id
      - project_id
      - member_id
      - action
      - timestamp
    properties:
      id:
        type: string
      project_id:
        type: string
      member_id:
        type: string
      action:
        type: string
        enum:
          - session_start
          - session_end
          - task_start
          - task_complete
          - task_blocked
          - handoff_create
          - handoff_accept
          - decision_made
          - blocker_added
          - blocker_resolved
          - code_commit
          - review_request
          - review_complete
          - gate_passed
          - requirement_complete
      details:
        type: object
      timestamp:
        type: string
        format: date-time

  # Conflict record
  conflict:
    type: object
    required:
      - id
      - project_id
      - type
      - involved_members
      - description
    properties:
      id:
        type: string
      project_id:
        type: string
      type:
        type: string
        enum: [file_conflict, decision_conflict, assignment_conflict]
      involved_members:
        type: array
        items:
          type: string
        minItems: 2
      description:
        type: string
      file_path:
        type: string
      created_at:
        type: string
        format: date-time
      resolved_at:
        type: string
        format: date-time
      resolution:
        type: string
      resolved_by:
        type: string
