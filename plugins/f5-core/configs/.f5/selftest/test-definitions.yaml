# F5 Framework - Self-Test Definitions
# Version: 2.0.0
# Purpose: Diagnostic test definitions for /f5-selftest command

version: "2.0.0"

# ============================================================
# TEST CATEGORIES
# ============================================================
categories:
  config:
    name: "Configuration Tests"
    name_ja: "Ë®≠ÂÆö„ÉÜ„Çπ„Éà"
    description: "Verify project configuration"
    icon: "‚öôÔ∏è"
    priority: 1

  memory:
    name: "Memory System Tests"
    name_ja: "„É°„É¢„É™„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà"
    description: "Verify memory system"
    icon: "üß†"
    priority: 2

  gates:
    name: "Quality Gates Tests"
    name_ja: "ÂìÅË≥™„Ç≤„Éº„Éà„ÉÜ„Çπ„Éà"
    description: "Verify gate system"
    icon: "üöß"
    priority: 3

  mcp:
    name: "MCP Server Tests"
    name_ja: "MCP„Çµ„Éº„Éê„Éº„ÉÜ„Çπ„Éà"
    description: "Verify MCP connections"
    icon: "üîå"
    priority: 4

  commands:
    name: "Command Tests"
    name_ja: "„Ç≥„Éû„É≥„Éâ„ÉÜ„Çπ„Éà"
    description: "Verify command files"
    icon: "üéØ"
    priority: 5

  integration:
    name: "Integration Tests"
    name_ja: "Áµ±Âêà„ÉÜ„Çπ„Éà"
    description: "Verify component integration"
    icon: "üîó"
    priority: 6

# ============================================================
# TEST DEFINITIONS
# ============================================================
tests:
  # Configuration Tests
  config_exists:
    category: config
    name: "Config File Exists"
    name_ja: "Ë®≠ÂÆö„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if .f5/config.json exists"
    check:
      type: "file_exists"
      path: ".f5/config.json"
    severity: critical
    auto_fix:
      available: true
      action: "create_default_config"
      description: "Create default config.json"

  config_valid:
    category: config
    name: "Config File Valid"
    name_ja: "Ë®≠ÂÆö„Éï„Ç°„Ç§„É´Ê§úË®º"
    description: "Validate config.json structure"
    check:
      type: "json_valid"
      path: ".f5/config.json"
      required_fields:
        - "version"
        - "name"
    severity: critical
    auto_fix:
      available: false
      suggestion: "Fix JSON syntax errors in config.json"

  profile_exists:
    category: config
    name: "Profile File Exists"
    name_ja: "„Éó„É≠„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if .f5/profile.yaml exists"
    check:
      type: "file_exists"
      path: ".f5/profile.yaml"
    severity: warning
    auto_fix:
      available: true
      action: "create_default_profile"
      description: "Create default profile.yaml"

  profile_valid:
    category: config
    name: "Profile File Valid"
    name_ja: "„Éó„É≠„Éï„Ç°„Ç§„É´Ê§úË®º"
    description: "Validate profile.yaml structure"
    check:
      type: "yaml_valid"
      path: ".f5/profile.yaml"
    severity: warning
    auto_fix:
      available: false
      suggestion: "Fix YAML syntax errors in profile.yaml"

  # Memory System Tests
  memory_dir_exists:
    category: memory
    name: "Memory Directory Exists"
    name_ja: "„É°„É¢„É™„Éá„Ç£„É¨„ÇØ„Éà„É™Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if .f5/memory/ directory exists"
    check:
      type: "directory_exists"
      path: ".f5/memory"
    severity: critical
    auto_fix:
      available: true
      action: "create_memory_directory"
      description: "Create memory directory structure"

  constitution_exists:
    category: memory
    name: "Constitution File Exists"
    name_ja: "„Ç≥„É≥„Çπ„ÉÜ„Ç£„ÉÜ„É•„Éº„Ç∑„Éß„É≥Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if constitution.md exists"
    check:
      type: "file_exists"
      path: ".f5/memory/constitution.md"
    severity: warning
    auto_fix:
      available: true
      action: "create_default_constitution"
      description: "Create default constitution.md"

  session_exists:
    category: memory
    name: "Session File Exists"
    name_ja: "„Çª„ÉÉ„Ç∑„Éß„É≥„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if session.md exists"
    check:
      type: "file_exists"
      path: ".f5/memory/session.md"
    severity: info
    auto_fix:
      available: true
      action: "create_default_session"
      description: "Create default session.md"

  decisions_exists:
    category: memory
    name: "Decisions File Exists"
    name_ja: "Ê±∫ÂÆö„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if decisions.md exists"
    check:
      type: "file_exists"
      path: ".f5/memory/decisions.md"
    severity: info
    auto_fix:
      available: true
      action: "create_default_decisions"
      description: "Create default decisions.md"

  learnings_exists:
    category: memory
    name: "Learnings File Exists"
    name_ja: "Â≠¶Áøí„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if learnings.md exists"
    check:
      type: "file_exists"
      path: ".f5/memory/learnings.md"
    severity: info
    auto_fix:
      available: true
      action: "create_default_learnings"
      description: "Create default learnings.md"

  # Quality Gates Tests
  gates_status_exists:
    category: gates
    name: "Gates Status File Exists"
    name_ja: "„Ç≤„Éº„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÂ≠òÂú®Á¢∫Ë™ç"
    description: "Check if gates-status.yaml exists"
    check:
      type: "file_exists"
      path: ".f5/quality/gates-status.yaml"
    severity: warning
    auto_fix:
      available: true
      action: "create_gates_status"
      description: "Create gates-status.yaml"

  gates_status_valid:
    category: gates
    name: "Gates Status Valid"
    name_ja: "„Ç≤„Éº„Éà„Çπ„ÉÜ„Éº„Çø„ÇπÊ§úË®º"
    description: "Validate gates-status.yaml structure"
    check:
      type: "yaml_valid"
      path: ".f5/quality/gates-status.yaml"
      required_fields:
        - "gates"
    severity: warning
    auto_fix:
      available: false
      suggestion: "Fix YAML syntax in gates-status.yaml"

  checklists_dir_exists:
    category: gates
    name: "Checklists Directory Exists"
    name_ja: "„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if checklists directory exists"
    check:
      type: "directory_exists"
      path: ".f5/quality/checklists"
    severity: info
    auto_fix:
      available: true
      action: "create_checklists_directory"
      description: "Create checklists directory"

  # MCP Server Tests
  context7_available:
    category: mcp
    name: "Context7 Available"
    name_ja: "Context7Âà©Áî®ÂèØËÉΩÁ¢∫Ë™ç"
    description: "Check if Context7 MCP is available"
    check:
      type: "mcp_available"
      server: "context7"
    severity: warning
    auto_fix:
      available: false
      suggestion: "Check Context7 MCP configuration"
    fallback: "websearch"

  sequential_available:
    category: mcp
    name: "Sequential Available"
    name_ja: "SequentialÂà©Áî®ÂèØËÉΩÁ¢∫Ë™ç"
    description: "Check if Sequential MCP is available"
    check:
      type: "mcp_available"
      server: "sequential-thinking"
    severity: info
    auto_fix:
      available: false
      suggestion: "Check Sequential MCP configuration"
    fallback: "native_reasoning"

  serena_available:
    category: mcp
    name: "Serena Available"
    name_ja: "SerenaÂà©Áî®ÂèØËÉΩÁ¢∫Ë™ç"
    description: "Check if Serena MCP is available"
    check:
      type: "mcp_available"
      server: "serena"
    severity: info
    auto_fix:
      available: false
      suggestion: "Check Serena MCP configuration"
    fallback: "native_analysis"

  playwright_available:
    category: mcp
    name: "Playwright Available"
    name_ja: "PlaywrightÂà©Áî®ÂèØËÉΩÁ¢∫Ë™ç"
    description: "Check if Playwright MCP is available"
    check:
      type: "mcp_available"
      server: "playwright"
    severity: info
    auto_fix:
      available: false
      suggestion: "Check Playwright MCP configuration"
    fallback: "native_testing"

  magic_available:
    category: mcp
    name: "Magic (21st.dev) Available"
    name_ja: "MagicÂà©Áî®ÂèØËÉΩÁ¢∫Ë™ç"
    description: "Check if Magic MCP is available"
    check:
      type: "mcp_available"
      server: "magic"
    severity: info
    auto_fix:
      available: false
      suggestion: "Check Magic MCP configuration"
    fallback: "native_generation"

  # Command Tests
  commands_dir_exists:
    category: commands
    name: "Commands Directory Exists"
    name_ja: "„Ç≥„Éû„É≥„Éâ„Éá„Ç£„É¨„ÇØ„Éà„É™Â≠òÂú®Á¢∫Ë™ç"
    description: "Check if .claude/commands/ exists"
    check:
      type: "directory_exists"
      path: ".claude/commands"
    severity: critical
    auto_fix:
      available: true
      action: "create_commands_directory"
      description: "Create commands directory"

  core_commands_exist:
    category: commands
    name: "Core Commands Exist"
    name_ja: "„Ç≥„Ç¢„Ç≥„Éû„É≥„ÉâÂ≠òÂú®Á¢∫Ë™ç"
    description: "Check if core F5 commands exist"
    check:
      type: "files_exist"
      paths:
        - ".claude/commands/f5-init.md"
        - ".claude/commands/f5-load.md"
        - ".claude/commands/f5-gate.md"
    severity: critical
    auto_fix:
      available: false
      suggestion: "Re-install F5 Framework commands"

  command_syntax_valid:
    category: commands
    name: "Command Syntax Valid"
    name_ja: "„Ç≥„Éû„É≥„ÉâÊßãÊñáÊ§úË®º"
    description: "Validate command file syntax"
    check:
      type: "markdown_valid"
      path: ".claude/commands/*.md"
    severity: warning
    auto_fix:
      available: false
      suggestion: "Fix markdown syntax in command files"

  # Integration Tests
  domain_integration:
    category: integration
    name: "Domain Integration"
    name_ja: "„Éâ„É°„Ç§„É≥Áµ±ÂêàÁ¢∫Ë™ç"
    description: "Check domain directory integration"
    check:
      type: "conditional_directory"
      condition: "config.domain.name != null"
      path: "domains/{config.domain.name}"
    severity: info
    auto_fix:
      available: false
      suggestion: "Create domain directory or update config"

  tdd_integration:
    category: integration
    name: "TDD Integration"
    name_ja: "TDDÁµ±ÂêàÁ¢∫Ë™ç"
    description: "Check TDD system integration"
    check:
      type: "files_exist"
      paths:
        - ".f5/tdd/config.yaml"
        - ".claude/commands/f5-tdd.md"
    severity: info
    auto_fix:
      available: false
      suggestion: "Initialize TDD system with /f5-tdd setup"

  error_handling_integration:
    category: integration
    name: "Error Handling Integration"
    name_ja: "„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Áµ±ÂêàÁ¢∫Ë™ç"
    description: "Check error handling system"
    check:
      type: "file_exists"
      path: ".f5/error-handling.yaml"
    severity: info
    auto_fix:
      available: true
      action: "create_error_handling"
      description: "Create error handling configuration"

  verbosity_integration:
    category: integration
    name: "Verbosity Integration"
    name_ja: "ÂÜóÈï∑ÊÄßÁµ±ÂêàÁ¢∫Ë™ç"
    description: "Check verbosity system"
    check:
      type: "file_exists"
      path: ".f5/verbosity-integration.yaml"
    severity: info
    auto_fix:
      available: true
      action: "create_verbosity_config"
      description: "Create verbosity configuration"

# ============================================================
# AUTO-FIX ACTIONS
# ============================================================
auto_fix_actions:
  create_default_config:
    description: "Create default config.json"
    steps:
      - "Create .f5 directory if not exists"
      - "Generate config.json with default values"
      - "Set version to 2.0.0"

  create_default_profile:
    description: "Create default profile.yaml"
    steps:
      - "Generate profile.yaml template"
      - "Set default team and customer values"

  create_memory_directory:
    description: "Create memory directory structure"
    steps:
      - "Create .f5/memory directory"
      - "Create constitution.md"
      - "Create session.md"
      - "Create decisions.md"
      - "Create learnings.md"

  create_default_constitution:
    description: "Create default constitution.md"
    template: |
      # Project Constitution

      ## Non-Negotiable Rules

      1. All code must pass lint checks
      2. Test coverage must be >= 80%
      3. All features require REQ-ID traceability

      ## Definition of Done

      - [ ] Code reviewed
      - [ ] Tests passing
      - [ ] Documentation updated

  create_default_session:
    description: "Create default session.md"
    template: |
      # Session Context

      ## Current Focus

      - No active tasks

      ## Recent Changes

      - Session initialized

      ## Blockers

      - None

  create_default_decisions:
    description: "Create default decisions.md"
    template: |
      # Architecture Decision Records

      ## Active Decisions

      - None recorded

      ## Template

      ### ADR-XXX: Title
      - **Status**: Proposed | Accepted | Deprecated
      - **Context**: Why is this needed?
      - **Decision**: What was decided?
      - **Consequences**: What are the implications?

  create_default_learnings:
    description: "Create default learnings.md"
    template: |
      # Project Learnings

      ## Patterns That Work

      - None recorded

      ## Mistakes to Avoid

      - None recorded

      ## Best Practices

      - None recorded

  create_gates_status:
    description: "Create gates-status.yaml"
    template: |
      # Quality Gates Status
      version: "2.0.0"
      gates:
        D1:
          status: pending
          checklist: []
        D2:
          status: pending
          checklist: []
        D3:
          status: pending
          checklist: []
        D4:
          status: pending
          checklist: []
        G2:
          status: pending
          checklist: []
        G3:
          status: pending
          checklist: []
        G4:
          status: pending
          checklist: []

  create_checklists_directory:
    description: "Create checklists directory"
    steps:
      - "Create .f5/quality/checklists directory"

  create_commands_directory:
    description: "Create commands directory"
    steps:
      - "Create .claude/commands directory"

  create_error_handling:
    description: "Create error handling configuration"
    steps:
      - "Create .f5/error-handling.yaml from template"

  create_verbosity_config:
    description: "Create verbosity configuration"
    steps:
      - "Create .f5/verbosity-integration.yaml from template"

# ============================================================
# TEST SUITES
# ============================================================
suites:
  quick:
    name: "Quick Health Check"
    name_ja: "„ÇØ„Ç§„ÉÉ„ÇØ„Éò„É´„Çπ„ÉÅ„Çß„ÉÉ„ÇØ"
    description: "Essential tests only"
    tests:
      - config_exists
      - memory_dir_exists
      - gates_status_exists
      - commands_dir_exists

  standard:
    name: "Standard Test Suite"
    name_ja: "Ê®ôÊ∫ñ„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà"
    description: "All important tests"
    tests:
      - config_exists
      - config_valid
      - profile_exists
      - memory_dir_exists
      - constitution_exists
      - session_exists
      - gates_status_exists
      - gates_status_valid
      - commands_dir_exists
      - core_commands_exist

  full:
    name: "Full Test Suite"
    name_ja: "ÂÆåÂÖ®„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà"
    description: "All available tests"
    tests: "all"

  mcp:
    name: "MCP Server Tests"
    name_ja: "MCP„Çµ„Éº„Éê„Éº„ÉÜ„Çπ„Éà"
    description: "MCP availability tests"
    tests:
      - context7_available
      - sequential_available
      - serena_available
      - playwright_available
      - magic_available

  integration:
    name: "Integration Tests"
    name_ja: "Áµ±Âêà„ÉÜ„Çπ„Éà"
    description: "Component integration tests"
    tests:
      - domain_integration
      - tdd_integration
      - error_handling_integration
      - verbosity_integration

# ============================================================
# REPORTING
# ============================================================
reporting:
  formats:
    - console
    - markdown
    - json

  console:
    pass: "‚úÖ"
    fail: "‚ùå"
    warning: "‚ö†Ô∏è"
    info: "‚ÑπÔ∏è"
    skip: "‚è≠Ô∏è"

  summary:
    template: |
      ## Self-Test Results

      | Category | Passed | Failed | Warnings |
      |----------|--------|--------|----------|
      {{#each categories}}
      | {{name}} | {{passed}} | {{failed}} | {{warnings}} |
      {{/each}}

      **Total**: {{total_passed}}/{{total_tests}} passed

  detailed:
    template: |
      ## Self-Test Detailed Results

      {{#each results}}
      ### {{category}}

      {{#each tests}}
      - {{status_icon}} **{{name}}**: {{message}}
        {{#if auto_fix_available}}
        - Auto-fix available: {{auto_fix_description}}
        {{/if}}
      {{/each}}

      {{/each}}

# ============================================================
# SCHEDULING
# ============================================================
scheduling:
  on_load: true
  on_gate_change: true
  periodic:
    enabled: false
    interval: "1h"
