{
  "id": "f5-reporting-generator",
  "name": "Dynamic Report Generator Workflow",
  "description": "Generate reports with custom queries, visualizations, and export formats",
  "version": "1.0.0",
  "f5Metadata": {
    "domain": "reporting",
    "category": "analytics",
    "complexity": "medium",
    "estimatedDuration": "20-25 minutes",
    "requiredSkills": ["f5-backend", "f5-db", "f5-frontend"],
    "mcpServers": ["context7", "serena"],
    "qualityGates": ["D3", "G2", "G3"],
    "argumentHint": "Implement dynamic report generation for {{projectName}}"
  },
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "position": { "x": 300, "y": 50 },
      "data": {
        "label": "Report Request"
      }
    },
    {
      "id": "subagent-parse-params",
      "type": "subAgent",
      "position": { "x": 300, "y": 150 },
      "data": {
        "label": "Parse Report Parameters",
        "description": "Parse and validate report configuration",
        "prompt": "Parse report params:\n1. Extract report type\n2. Parse date range parameters\n3. Parse filter criteria\n4. Parse grouping/aggregation options\n5. Validate parameter combinations\n6. Return parsed configuration",
        "agentType": "backend-architect",
        "outputPorts": ["valid", "invalid"]
      }
    },
    {
      "id": "switch-report-type",
      "type": "switch",
      "position": { "x": 300, "y": 290 },
      "data": {
        "label": "Report Type",
        "description": "Route to report type handler",
        "evaluationTarget": "Selected report type",
        "cases": [
          { "id": "case-sales", "label": "Sales Report", "condition": "Sales analytics report" },
          { "id": "case-inventory", "label": "Inventory Report", "condition": "Inventory status report" },
          { "id": "case-users", "label": "User Analytics", "condition": "User activity report" },
          { "id": "case-custom", "label": "Custom Query", "condition": "Custom SQL/query report" }
        ]
      }
    },
    {
      "id": "subagent-query-data",
      "type": "subAgent",
      "position": { "x": 300, "y": 450 },
      "data": {
        "label": "Execute Query",
        "description": "Execute report query and fetch data",
        "prompt": "Execute query:\n1. Build optimized query for report type\n2. Apply date range filters\n3. Apply business filters\n4. Execute with pagination for large datasets\n5. Apply aggregations and grouping\n6. Calculate derived metrics\n7. Return raw data with metadata",
        "agentType": "backend-architect",
        "outputPorts": ["success", "error", "timeout"]
      }
    },
    {
      "id": "subagent-transform-data",
      "type": "subAgent",
      "position": { "x": 300, "y": 590 },
      "data": {
        "label": "Transform Data",
        "description": "Transform data for visualization",
        "prompt": "Transform data:\n1. Apply data transformations\n2. Calculate percentages and ratios\n3. Apply number formatting\n4. Generate chart-ready data structures\n5. Create summary statistics\n6. Handle null/missing values\n7. Return transformed dataset",
        "agentType": "backend-architect",
        "outputPorts": ["transformed"]
      }
    },
    {
      "id": "askuser-format",
      "type": "askUserQuestion",
      "position": { "x": 300, "y": 730 },
      "data": {
        "label": "Select Export Format",
        "description": "Choose report output format",
        "question": "Select the export format for your report:",
        "selectionMode": "predefined",
        "options": [
          {
            "id": "pdf",
            "label": "PDF Document",
            "description": "Formatted PDF with charts and tables"
          },
          {
            "id": "excel",
            "label": "Excel Spreadsheet",
            "description": "XLSX file with data and formulas"
          },
          {
            "id": "csv",
            "label": "CSV File",
            "description": "Plain CSV data export"
          },
          {
            "id": "json",
            "label": "JSON Data",
            "description": "Raw JSON data structure"
          }
        ],
        "multiSelect": false
      }
    },
    {
      "id": "switch-format",
      "type": "switch",
      "position": { "x": 300, "y": 900 },
      "data": {
        "label": "Generate Format",
        "description": "Generate report in selected format",
        "evaluationTarget": "Selected export format",
        "cases": [
          { "id": "case-pdf", "label": "PDF", "condition": "PDF format selected" },
          { "id": "case-excel", "label": "Excel", "condition": "Excel format selected" },
          { "id": "case-csv", "label": "CSV", "condition": "CSV format selected" }
        ]
      }
    },
    {
      "id": "mcp-generate-report",
      "type": "mcp",
      "position": { "x": 300, "y": 1060 },
      "data": {
        "label": "Generate Report File",
        "description": "Generate final report document",
        "serverName": "serena",
        "toolName": "write_memory",
        "mode": "structured",
        "parameters": {
          "memory_file_name": "generated-reports",
          "content": "Report generated with format, size, and download URL"
        },
        "outputPorts": ["generated"]
      }
    },
    {
      "id": "prompt-return-report",
      "type": "prompt",
      "position": { "x": 300, "y": 1190 },
      "data": {
        "label": "Return Report",
        "description": "Return generated report with download link",
        "prompt": "Return report:\n- Include download URL (signed, time-limited)\n- Include report metadata\n- Include generation timestamp\n- Include file size\n- Schedule cleanup after expiry",
        "outputPorts": ["done"]
      }
    },
    {
      "id": "end-success",
      "type": "end",
      "position": { "x": 300, "y": 1320 },
      "data": {
        "label": "Report Generated"
      }
    }
  ],
  "connections": [
    {
      "id": "conn-1",
      "source": "start-1",
      "target": "subagent-parse-params",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "id": "conn-2",
      "source": "subagent-parse-params",
      "target": "switch-report-type",
      "sourceHandle": "output-valid",
      "targetHandle": "input"
    },
    {
      "id": "conn-3",
      "source": "switch-report-type",
      "target": "subagent-query-data",
      "sourceHandle": "case-sales",
      "targetHandle": "input"
    },
    {
      "id": "conn-4",
      "source": "switch-report-type",
      "target": "subagent-query-data",
      "sourceHandle": "case-inventory",
      "targetHandle": "input"
    },
    {
      "id": "conn-5",
      "source": "switch-report-type",
      "target": "subagent-query-data",
      "sourceHandle": "case-users",
      "targetHandle": "input"
    },
    {
      "id": "conn-6",
      "source": "switch-report-type",
      "target": "subagent-query-data",
      "sourceHandle": "case-custom",
      "targetHandle": "input"
    },
    {
      "id": "conn-7",
      "source": "subagent-query-data",
      "target": "subagent-transform-data",
      "sourceHandle": "output-success",
      "targetHandle": "input"
    },
    {
      "id": "conn-8",
      "source": "subagent-transform-data",
      "target": "askuser-format",
      "sourceHandle": "output-transformed",
      "targetHandle": "input"
    },
    {
      "id": "conn-9",
      "source": "askuser-format",
      "target": "switch-format",
      "sourceHandle": "output-pdf",
      "targetHandle": "input"
    },
    {
      "id": "conn-10",
      "source": "switch-format",
      "target": "mcp-generate-report",
      "sourceHandle": "case-pdf",
      "targetHandle": "input"
    },
    {
      "id": "conn-11",
      "source": "switch-format",
      "target": "mcp-generate-report",
      "sourceHandle": "case-excel",
      "targetHandle": "input"
    },
    {
      "id": "conn-12",
      "source": "switch-format",
      "target": "mcp-generate-report",
      "sourceHandle": "case-csv",
      "targetHandle": "input"
    },
    {
      "id": "conn-13",
      "source": "mcp-generate-report",
      "target": "prompt-return-report",
      "sourceHandle": "output-generated",
      "targetHandle": "input"
    },
    {
      "id": "conn-14",
      "source": "prompt-return-report",
      "target": "end-success",
      "sourceHandle": "output-done",
      "targetHandle": "input"
    }
  ]
}
