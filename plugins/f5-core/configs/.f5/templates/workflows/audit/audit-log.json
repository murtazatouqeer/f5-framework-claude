{
  "id": "f5-audit-log",
  "name": "Audit Logging Workflow",
  "description": "Compliance audit logging with retention and tamper-proof storage",
  "version": "1.0.0",
  "f5Metadata": {
    "domain": "audit",
    "category": "compliance",
    "complexity": "medium",
    "estimatedDuration": "15-20 minutes",
    "requiredSkills": ["f5-backend", "f5-security", "f5-db"],
    "mcpServers": ["sequential-thinking", "github"],
    "qualityGates": ["D3", "D4", "G2", "G2.5"],
    "argumentHint": "Implement compliance audit logging for {{projectName}}"
  },
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "position": { "x": 300, "y": 50 },
      "data": {
        "label": "Audit Event"
      }
    },
    {
      "id": "subagent-enrich-event",
      "type": "subAgent",
      "position": { "x": 300, "y": 150 },
      "data": {
        "label": "Enrich Audit Event",
        "description": "Add context to audit event",
        "prompt": "Enrich audit event:\n1. Add timestamp (UTC ISO 8601)\n2. Add actor identity (user ID, IP, user agent)\n3. Add action details (operation, resource, method)\n4. Add request/response hashes\n5. Add session context\n6. Add correlation ID\n7. Return enriched event",
        "agentType": "security-engineer",
        "outputPorts": ["enriched"]
      }
    },
    {
      "id": "switch-severity",
      "type": "switch",
      "position": { "x": 300, "y": 290 },
      "data": {
        "label": "Event Severity",
        "description": "Route based on event severity",
        "evaluationTarget": "Audit event severity level",
        "cases": [
          { "id": "case-critical", "label": "Critical", "condition": "Security breach or data exposure" },
          { "id": "case-high", "label": "High", "condition": "Failed authentication or authorization" },
          { "id": "case-medium", "label": "Medium", "condition": "Configuration change or data modification" },
          { "id": "case-low", "label": "Low", "condition": "Read access or routine operation" }
        ]
      }
    },
    {
      "id": "subagent-alert-security",
      "type": "subAgent",
      "position": { "x": 100, "y": 450 },
      "data": {
        "label": "Security Alert",
        "description": "Trigger immediate security alert",
        "prompt": "Trigger security alert:\n1. Send to security team immediately\n2. Create incident ticket\n3. Trigger automated response if configured\n4. Lock affected accounts if needed\n5. Preserve evidence\n6. Return alert confirmation",
        "agentType": "security-engineer",
        "outputPorts": ["alerted"]
      }
    },
    {
      "id": "mcp-store-immutable",
      "type": "mcp",
      "position": { "x": 300, "y": 450 },
      "data": {
        "label": "Store Immutable Log",
        "description": "Store audit log in immutable storage",
        "serverName": "github",
        "toolName": "create_or_update_file",
        "mode": "structured",
        "parameters": {
          "path": "audit-logs/",
          "message": "Audit log entry stored in append-only storage"
        },
        "outputPorts": ["stored"]
      }
    },
    {
      "id": "subagent-calculate-hash",
      "type": "subAgent",
      "position": { "x": 300, "y": 590 },
      "data": {
        "label": "Calculate Chain Hash",
        "description": "Calculate hash chain for tamper detection",
        "prompt": "Calculate chain hash:\n1. Get previous log entry hash\n2. Combine with current entry\n3. Calculate SHA-256 hash\n4. Store hash chain entry\n5. Periodically publish hash to blockchain/TSA\n6. Return hash verification",
        "agentType": "security-engineer",
        "outputPorts": ["verified"]
      }
    },
    {
      "id": "ifelse-retention",
      "type": "ifElse",
      "position": { "x": 300, "y": 730 },
      "data": {
        "label": "Apply Retention?",
        "description": "Check if retention policy should run",
        "condition": "Daily retention check scheduled"
      }
    },
    {
      "id": "subagent-apply-retention",
      "type": "subAgent",
      "position": { "x": 150, "y": 860 },
      "data": {
        "label": "Apply Retention Policy",
        "description": "Archive or delete old audit logs",
        "prompt": "Apply retention:\n1. Find logs older than retention period\n2. For compliance: archive to cold storage\n3. For non-compliance: schedule deletion\n4. Generate retention report\n5. Update retention metrics\n6. Return retention summary",
        "agentType": "backend-architect",
        "outputPorts": ["applied"]
      }
    },
    {
      "id": "qualitygate-compliance",
      "type": "qualityGate",
      "position": { "x": 300, "y": 990 },
      "data": {
        "label": "G2.5: Compliance Review",
        "description": "Verify audit logging meets compliance requirements",
        "gateId": "G2.5",
        "gateName": "Compliance Review",
        "checklistItems": [
          "All required events captured",
          "Immutable storage configured",
          "Hash chain verified",
          "Retention policy enforced",
          "Access to logs restricted"
        ],
        "outputPorts": ["passed", "failed"]
      }
    },
    {
      "id": "prompt-success",
      "type": "prompt",
      "position": { "x": 300, "y": 1120 },
      "data": {
        "label": "Return Audit Success",
        "description": "Confirm audit log recorded",
        "prompt": "Return audit confirmation:\n- Include audit log ID\n- Include chain hash\n- Include timestamp\n- Include retention policy applied",
        "outputPorts": ["done"]
      }
    },
    {
      "id": "end-success",
      "type": "end",
      "position": { "x": 300, "y": 1250 },
      "data": {
        "label": "Audit Logged"
      }
    }
  ],
  "connections": [
    {
      "id": "conn-1",
      "source": "start-1",
      "target": "subagent-enrich-event",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "id": "conn-2",
      "source": "subagent-enrich-event",
      "target": "switch-severity",
      "sourceHandle": "output-enriched",
      "targetHandle": "input"
    },
    {
      "id": "conn-3",
      "source": "switch-severity",
      "target": "subagent-alert-security",
      "sourceHandle": "case-critical",
      "targetHandle": "input"
    },
    {
      "id": "conn-4",
      "source": "switch-severity",
      "target": "mcp-store-immutable",
      "sourceHandle": "case-high",
      "targetHandle": "input"
    },
    {
      "id": "conn-5",
      "source": "switch-severity",
      "target": "mcp-store-immutable",
      "sourceHandle": "case-medium",
      "targetHandle": "input"
    },
    {
      "id": "conn-6",
      "source": "switch-severity",
      "target": "mcp-store-immutable",
      "sourceHandle": "case-low",
      "targetHandle": "input"
    },
    {
      "id": "conn-7",
      "source": "subagent-alert-security",
      "target": "mcp-store-immutable",
      "sourceHandle": "output-alerted",
      "targetHandle": "input"
    },
    {
      "id": "conn-8",
      "source": "mcp-store-immutable",
      "target": "subagent-calculate-hash",
      "sourceHandle": "output-stored",
      "targetHandle": "input"
    },
    {
      "id": "conn-9",
      "source": "subagent-calculate-hash",
      "target": "ifelse-retention",
      "sourceHandle": "output-verified",
      "targetHandle": "input"
    },
    {
      "id": "conn-10",
      "source": "ifelse-retention",
      "target": "subagent-apply-retention",
      "sourceHandle": "branch-0",
      "targetHandle": "input",
      "label": "Apply"
    },
    {
      "id": "conn-11",
      "source": "ifelse-retention",
      "target": "qualitygate-compliance",
      "sourceHandle": "branch-1",
      "targetHandle": "input",
      "label": "Skip"
    },
    {
      "id": "conn-12",
      "source": "subagent-apply-retention",
      "target": "qualitygate-compliance",
      "sourceHandle": "output-applied",
      "targetHandle": "input"
    },
    {
      "id": "conn-13",
      "source": "qualitygate-compliance",
      "target": "prompt-success",
      "sourceHandle": "branch-0",
      "targetHandle": "input"
    },
    {
      "id": "conn-14",
      "source": "prompt-success",
      "target": "end-success",
      "sourceHandle": "output-done",
      "targetHandle": "input"
    }
  ]
}
