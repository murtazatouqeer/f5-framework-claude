{
  "id": "f5-notification-multi-channel",
  "name": "Multi-Channel Notification Workflow",
  "description": "Send notifications via email, SMS, and push with preference management",
  "version": "1.0.0",
  "f5Metadata": {
    "domain": "notification",
    "category": "messaging",
    "complexity": "medium",
    "estimatedDuration": "15-20 minutes",
    "requiredSkills": ["f5-backend", "f5-frontend"],
    "mcpServers": ["github", "playwright"],
    "qualityGates": ["D3", "G2", "G3"],
    "argumentHint": "Implement multi-channel notifications for {{projectName}}"
  },
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "position": { "x": 300, "y": 50 },
      "data": {
        "label": "Notification Trigger"
      }
    },
    {
      "id": "subagent-load-preferences",
      "type": "subAgent",
      "position": { "x": 300, "y": 150 },
      "data": {
        "label": "Load User Preferences",
        "description": "Load notification preferences for recipient",
        "prompt": "Load preferences:\n1. Get user notification settings\n2. Check enabled channels (email, SMS, push)\n3. Check quiet hours settings\n4. Get preferred language\n5. Check notification frequency limits\n6. Return active channels and preferences",
        "agentType": "backend-architect",
        "outputPorts": ["loaded", "user_not_found"]
      }
    },
    {
      "id": "ifelse-quiet-hours",
      "type": "ifElse",
      "position": { "x": 300, "y": 290 },
      "data": {
        "label": "Quiet Hours?",
        "description": "Check if notification should be delayed",
        "condition": "Current time is within user's quiet hours"
      }
    },
    {
      "id": "subagent-queue-later",
      "type": "subAgent",
      "position": { "x": 500, "y": 420 },
      "data": {
        "label": "Queue for Later",
        "description": "Queue notification for delivery after quiet hours",
        "prompt": "Queue notification:\n1. Calculate next available time\n2. Create scheduled notification\n3. Store in notification queue\n4. Return scheduled time",
        "agentType": "backend-architect",
        "outputPorts": ["queued"]
      }
    },
    {
      "id": "subagent-prepare-content",
      "type": "subAgent",
      "position": { "x": 150, "y": 420 },
      "data": {
        "label": "Prepare Content",
        "description": "Prepare notification content for each channel",
        "prompt": "Prepare content:\n1. Load notification template\n2. Apply user's language\n3. Merge template variables\n4. Format for each channel:\n   - Email: HTML and plain text\n   - SMS: Short text (160 chars)\n   - Push: Title and body\n5. Return formatted content per channel",
        "agentType": "backend-architect",
        "outputPorts": ["prepared"]
      }
    },
    {
      "id": "switch-channels",
      "type": "switch",
      "position": { "x": 150, "y": 560 },
      "data": {
        "label": "Dispatch Channels",
        "description": "Send to each enabled channel",
        "evaluationTarget": "Enabled notification channels",
        "cases": [
          { "id": "case-email", "label": "Email", "condition": "Email channel enabled" },
          { "id": "case-sms", "label": "SMS", "condition": "SMS channel enabled" },
          { "id": "case-push", "label": "Push", "condition": "Push channel enabled" }
        ]
      }
    },
    {
      "id": "mcp-send-email",
      "type": "mcp",
      "position": { "x": 0, "y": 720 },
      "data": {
        "label": "Send Email",
        "description": "Send email notification",
        "serverName": "github",
        "toolName": "create_issue",
        "mode": "structured",
        "parameters": {
          "title": "Email Notification Sent",
          "body": "Email dispatched via SMTP/SES"
        },
        "outputPorts": ["sent", "failed"]
      }
    },
    {
      "id": "mcp-send-sms",
      "type": "mcp",
      "position": { "x": 150, "y": 720 },
      "data": {
        "label": "Send SMS",
        "description": "Send SMS notification",
        "serverName": "github",
        "toolName": "create_issue",
        "mode": "structured",
        "parameters": {
          "title": "SMS Notification Sent",
          "body": "SMS dispatched via Twilio/SNS"
        },
        "outputPorts": ["sent", "failed"]
      }
    },
    {
      "id": "mcp-send-push",
      "type": "mcp",
      "position": { "x": 300, "y": 720 },
      "data": {
        "label": "Send Push",
        "description": "Send push notification",
        "serverName": "github",
        "toolName": "create_issue",
        "mode": "structured",
        "parameters": {
          "title": "Push Notification Sent",
          "body": "Push dispatched via FCM/APNs"
        },
        "outputPorts": ["sent", "failed"]
      }
    },
    {
      "id": "subagent-record-delivery",
      "type": "subAgent",
      "position": { "x": 150, "y": 880 },
      "data": {
        "label": "Record Delivery",
        "description": "Record notification delivery status",
        "prompt": "Record delivery:\n1. Update notification status per channel\n2. Record delivery timestamps\n3. Store failure reasons if any\n4. Update user notification history\n5. Calculate delivery metrics",
        "agentType": "backend-architect",
        "outputPorts": ["recorded"]
      }
    },
    {
      "id": "end-sent",
      "type": "end",
      "position": { "x": 150, "y": 1010 },
      "data": {
        "label": "Notification Sent"
      }
    },
    {
      "id": "end-queued",
      "type": "end",
      "position": { "x": 500, "y": 560 },
      "data": {
        "label": "Notification Queued"
      }
    }
  ],
  "connections": [
    {
      "id": "conn-1",
      "source": "start-1",
      "target": "subagent-load-preferences",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "id": "conn-2",
      "source": "subagent-load-preferences",
      "target": "ifelse-quiet-hours",
      "sourceHandle": "output-loaded",
      "targetHandle": "input"
    },
    {
      "id": "conn-3",
      "source": "ifelse-quiet-hours",
      "target": "subagent-prepare-content",
      "sourceHandle": "branch-0",
      "targetHandle": "input",
      "label": "Send Now"
    },
    {
      "id": "conn-4",
      "source": "ifelse-quiet-hours",
      "target": "subagent-queue-later",
      "sourceHandle": "branch-1",
      "targetHandle": "input",
      "label": "Queue"
    },
    {
      "id": "conn-5",
      "source": "subagent-queue-later",
      "target": "end-queued",
      "sourceHandle": "output-queued",
      "targetHandle": "input"
    },
    {
      "id": "conn-6",
      "source": "subagent-prepare-content",
      "target": "switch-channels",
      "sourceHandle": "output-prepared",
      "targetHandle": "input"
    },
    {
      "id": "conn-7",
      "source": "switch-channels",
      "target": "mcp-send-email",
      "sourceHandle": "case-email",
      "targetHandle": "input"
    },
    {
      "id": "conn-8",
      "source": "switch-channels",
      "target": "mcp-send-sms",
      "sourceHandle": "case-sms",
      "targetHandle": "input"
    },
    {
      "id": "conn-9",
      "source": "switch-channels",
      "target": "mcp-send-push",
      "sourceHandle": "case-push",
      "targetHandle": "input"
    },
    {
      "id": "conn-10",
      "source": "mcp-send-email",
      "target": "subagent-record-delivery",
      "sourceHandle": "output-sent",
      "targetHandle": "input"
    },
    {
      "id": "conn-11",
      "source": "mcp-send-sms",
      "target": "subagent-record-delivery",
      "sourceHandle": "output-sent",
      "targetHandle": "input"
    },
    {
      "id": "conn-12",
      "source": "mcp-send-push",
      "target": "subagent-record-delivery",
      "sourceHandle": "output-sent",
      "targetHandle": "input"
    },
    {
      "id": "conn-13",
      "source": "subagent-record-delivery",
      "target": "end-sent",
      "sourceHandle": "output-recorded",
      "targetHandle": "input"
    }
  ]
}
