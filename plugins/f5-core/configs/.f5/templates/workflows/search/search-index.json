{
  "id": "f5-search-index",
  "name": "Search Indexing Workflow",
  "description": "Search indexing and optimization with Elasticsearch/Algolia integration",
  "version": "1.0.0",
  "f5Metadata": {
    "domain": "search",
    "category": "indexing",
    "complexity": "medium",
    "estimatedDuration": "20-25 minutes",
    "requiredSkills": ["f5-backend", "f5-db"],
    "mcpServers": ["serena", "context7"],
    "qualityGates": ["D3", "G2", "G3"],
    "argumentHint": "Implement search indexing with Elasticsearch for {{projectName}}"
  },
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "position": { "x": 300, "y": 50 },
      "data": {
        "label": "Index Event"
      }
    },
    {
      "id": "switch-event",
      "type": "switch",
      "position": { "x": 300, "y": 150 },
      "data": {
        "label": "Index Event Type",
        "description": "Route based on indexing operation",
        "evaluationTarget": "Type of indexing event",
        "cases": [
          { "id": "case-create", "label": "Create Index", "condition": "New document to index" },
          { "id": "case-update", "label": "Update Index", "condition": "Existing document updated" },
          { "id": "case-delete", "label": "Delete Index", "condition": "Document deleted" },
          { "id": "case-reindex", "label": "Full Reindex", "condition": "Rebuild entire index" }
        ]
      }
    },
    {
      "id": "subagent-prepare-document",
      "type": "subAgent",
      "position": { "x": 100, "y": 320 },
      "data": {
        "label": "Prepare Document",
        "description": "Prepare document for indexing",
        "prompt": "Prepare document:\n1. Extract searchable fields\n2. Apply text normalization\n3. Generate search tokens\n4. Apply field boosting weights\n5. Generate synonyms and variations\n6. Create document structure\n7. Return prepared document",
        "agentType": "backend-architect",
        "outputPorts": ["prepared", "error"]
      }
    },
    {
      "id": "subagent-delete-document",
      "type": "subAgent",
      "position": { "x": 300, "y": 320 },
      "data": {
        "label": "Delete Document",
        "description": "Remove document from index",
        "prompt": "Delete document:\n1. Get document ID\n2. Remove from search index\n3. Clear related caches\n4. Log deletion event\n5. Return deletion confirmation",
        "agentType": "backend-architect",
        "outputPorts": ["deleted", "not_found"]
      }
    },
    {
      "id": "subagent-full-reindex",
      "type": "subAgent",
      "position": { "x": 500, "y": 320 },
      "data": {
        "label": "Full Reindex",
        "description": "Rebuild entire search index",
        "prompt": "Full reindex:\n1. Create new index with updated mapping\n2. Stream all documents from source\n3. Batch index documents (1000 per batch)\n4. Track progress and errors\n5. Swap alias to new index\n6. Delete old index\n7. Return reindex summary",
        "agentType": "backend-architect",
        "outputPorts": ["completed", "error"]
      }
    },
    {
      "id": "mcp-index-document",
      "type": "mcp",
      "position": { "x": 100, "y": 480 },
      "data": {
        "label": "Index Document",
        "description": "Send document to search engine",
        "serverName": "serena",
        "toolName": "write_memory",
        "mode": "structured",
        "parameters": {
          "memory_file_name": "search-index",
          "content": "Document indexed in search engine"
        },
        "outputPorts": ["indexed", "failed"]
      }
    },
    {
      "id": "subagent-update-analytics",
      "type": "subAgent",
      "position": { "x": 300, "y": 610 },
      "data": {
        "label": "Update Search Analytics",
        "description": "Update search analytics and suggestions",
        "prompt": "Update analytics:\n1. Update term frequency counts\n2. Refresh autocomplete suggestions\n3. Update popularity scores\n4. Recalculate relevance factors\n5. Clear stale analytics data",
        "agentType": "backend-architect",
        "outputPorts": ["updated"]
      }
    },
    {
      "id": "qualitygate-g3",
      "type": "qualityGate",
      "position": { "x": 300, "y": 750 },
      "data": {
        "label": "G3: Testing Gate",
        "description": "Verify search functionality",
        "gateId": "G3",
        "gateName": "Testing Complete",
        "checklistItems": [
          "Indexing operations functional",
          "Search returns relevant results",
          "Autocomplete working",
          "Filters and facets correct",
          "Performance within SLA"
        ],
        "outputPorts": ["passed", "failed"]
      }
    },
    {
      "id": "prompt-success",
      "type": "prompt",
      "position": { "x": 300, "y": 880 },
      "data": {
        "label": "Return Success",
        "description": "Return indexing success response",
        "prompt": "Return success:\n- Include indexed document ID\n- Include index timestamp\n- Include searchable fields\n- Include index statistics",
        "outputPorts": ["done"]
      }
    },
    {
      "id": "end-success",
      "type": "end",
      "position": { "x": 300, "y": 1010 },
      "data": {
        "label": "Indexing Complete"
      }
    }
  ],
  "connections": [
    {
      "id": "conn-1",
      "source": "start-1",
      "target": "switch-event",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "id": "conn-2",
      "source": "switch-event",
      "target": "subagent-prepare-document",
      "sourceHandle": "case-create",
      "targetHandle": "input"
    },
    {
      "id": "conn-3",
      "source": "switch-event",
      "target": "subagent-prepare-document",
      "sourceHandle": "case-update",
      "targetHandle": "input"
    },
    {
      "id": "conn-4",
      "source": "switch-event",
      "target": "subagent-delete-document",
      "sourceHandle": "case-delete",
      "targetHandle": "input"
    },
    {
      "id": "conn-5",
      "source": "switch-event",
      "target": "subagent-full-reindex",
      "sourceHandle": "case-reindex",
      "targetHandle": "input"
    },
    {
      "id": "conn-6",
      "source": "subagent-prepare-document",
      "target": "mcp-index-document",
      "sourceHandle": "output-prepared",
      "targetHandle": "input"
    },
    {
      "id": "conn-7",
      "source": "mcp-index-document",
      "target": "subagent-update-analytics",
      "sourceHandle": "output-indexed",
      "targetHandle": "input"
    },
    {
      "id": "conn-8",
      "source": "subagent-delete-document",
      "target": "subagent-update-analytics",
      "sourceHandle": "output-deleted",
      "targetHandle": "input"
    },
    {
      "id": "conn-9",
      "source": "subagent-full-reindex",
      "target": "subagent-update-analytics",
      "sourceHandle": "output-completed",
      "targetHandle": "input"
    },
    {
      "id": "conn-10",
      "source": "subagent-update-analytics",
      "target": "qualitygate-g3",
      "sourceHandle": "output-updated",
      "targetHandle": "input"
    },
    {
      "id": "conn-11",
      "source": "qualitygate-g3",
      "target": "prompt-success",
      "sourceHandle": "branch-0",
      "targetHandle": "input"
    },
    {
      "id": "conn-12",
      "source": "prompt-success",
      "target": "end-success",
      "sourceHandle": "output-done",
      "targetHandle": "input"
    }
  ]
}
