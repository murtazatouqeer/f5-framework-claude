# F5 Session Management Configuration
# Version: 1.0.0

# ═══════════════════════════════════════════════════════════════
# SESSION SETTINGS
# ═══════════════════════════════════════════════════════════════

session:
  # Auto-save session state
  auto_save: true
  save_interval_minutes: 5

  # Session storage location
  storage_path: ".f5/sessions/"

  # Maximum sessions to retain
  max_sessions: 20

  # Session expiry (days)
  expiry_days: 30

  # Session naming
  naming:
    format: "sess_{date}_{time}"
    date_format: "YYYYMMDD"
    time_format: "HHmmss"

# ═══════════════════════════════════════════════════════════════
# SESSION STATE
# ═══════════════════════════════════════════════════════════════

state_tracking:
  # What to track
  track:
    - current_gate: true
    - active_persona: true
    - active_mode: true
    - active_agents: true
    - current_sip: true
    - tdd_session: true
    - loaded_skills: true
    - conversation_context: true

  # Context to preserve
  context:
    - project_stack: true
    - recent_files: true
    - recent_commands: true
    - decisions_made: true
    - issues_found: true

  # Limits
  limits:
    max_recent_files: 20
    max_recent_commands: 50
    max_decisions: 100
    max_context_size_kb: 500

# ═══════════════════════════════════════════════════════════════
# CHECKPOINTS
# ═══════════════════════════════════════════════════════════════

checkpoints:
  # Auto-checkpoint triggers
  auto_checkpoint:
    enabled: true
    triggers:
      - "gate_complete"
      - "tdd_cycle_complete"
      - "major_decision"
      - "implementation_complete"
      - "before_risky_operation"

  # Checkpoint content
  content:
    - timestamp: true
    - session_state: true
    - conversation_summary: true
    - files_modified: true
    - decisions: true
    - next_steps: true

  # Maximum checkpoints per session
  max_per_session: 50

  # Checkpoint format
  format: |
    # Checkpoint: {{name}}

    **Time:** {{timestamp}}
    **Session:** {{session_id}}

    ## State
    - Gate: {{gate}}
    - Persona: {{persona}}
    - Mode: {{mode}}

    ## Summary
    {{summary}}

    ## Files Modified
    {{files}}

    ## Decisions Made
    {{decisions}}

    ## Next Steps
    {{next_steps}}

# ═══════════════════════════════════════════════════════════════
# CONTEXT RESTORATION
# ═══════════════════════════════════════════════════════════════

restoration:
  # Auto-restore on session start
  auto_restore: true

  # What to restore
  restore_items:
    - gate_status: true
    - persona: true
    - mode: true
    - tdd_session: true
    - recent_context: true

  # Ask for confirmation before restore
  confirm_restore: true

  # Restoration prompt
  prompt_template: |
    Restoring previous session context:

    - Project: {{project_name}}
    - Stack: {{stack}}
    - Gate: {{gate}}
    - Last Activity: {{last_activity}}

    Continue from where we left off?

# ═══════════════════════════════════════════════════════════════
# SESSION COMMANDS
# ═══════════════════════════════════════════════════════════════

commands:
  save:
    description: "Save current session state"
    description_ja: "現在のセッション状態を保存"
    creates_checkpoint: true
    parameters:
      - name: "name"
        required: false
        description: "Optional session name"

  restore:
    description: "Restore previous session"
    description_ja: "前のセッションを復元"
    shows_options: true
    parameters:
      - name: "session_id"
        required: false
        description: "Session ID to restore"
      - name: "checkpoint"
        required: false
        description: "Checkpoint name to restore"

  checkpoint:
    description: "Create named checkpoint"
    description_ja: "名前付きチェックポイントを作成"
    requires_name: true
    parameters:
      - name: "name"
        required: true
        description: "Checkpoint name"

  list:
    description: "List saved sessions"
    description_ja: "保存されたセッションの一覧"

  status:
    description: "Show current session status"
    description_ja: "現在のセッション状態を表示"

  clear:
    description: "Clear session state"
    description_ja: "セッション状態をクリア"
    requires_confirmation: true
    parameters:
      - name: "older-than"
        required: false
        description: "Clear sessions older than (e.g., 30d)"

# ═══════════════════════════════════════════════════════════════
# SESSION FILE STRUCTURE
# ═══════════════════════════════════════════════════════════════

file_structure:
  session_directory: |
    .f5/sessions/
    └── sess_20240115_143022/
        ├── state.json           # Session state
        ├── context.json         # Context data
        ├── decisions.json       # Decisions made
        ├── files.json           # Modified files list
        └── checkpoints/
            ├── auth-complete.json
            └── refactor-done.json

  state_schema:
    session_id: "string"
    created_at: "datetime"
    updated_at: "datetime"
    gate: "string"
    persona: "string"
    mode: "string"
    tdd_session: "object"
    sip_session: "object"

  context_schema:
    project_name: "string"
    stack: "string"
    recent_files: "array"
    recent_commands: "array"
    loaded_skills: "array"

  checkpoint_schema:
    name: "string"
    created_at: "datetime"
    state: "object"
    summary: "string"
    files_modified: "array"
    decisions: "array"
    next_steps: "array"

# ═══════════════════════════════════════════════════════════════
# INTEGRATION
# ═══════════════════════════════════════════════════════════════

integration:
  # Gate integration
  gates:
    save_on_complete: true
    restore_gate_status: true
    create_checkpoint_on_pass: true

  # Persona integration
  personas:
    save_active_persona: true
    restore_persona: true

  # Mode integration
  modes:
    save_active_mode: true
    restore_mode: true

  # TDD integration
  tdd:
    save_tdd_state: true
    restore_tdd_session: true
    checkpoint_on_cycle_complete: true

  # SIP integration
  sip:
    save_sip_state: true
    restore_sip_session: true

  # Memory system
  memory:
    sync_with_session_md: true
    update_on_save: true

# ═══════════════════════════════════════════════════════════════
# CLEANUP
# ═══════════════════════════════════════════════════════════════

cleanup:
  # Auto-cleanup old sessions
  auto_cleanup:
    enabled: true
    older_than_days: 30
    keep_minimum: 5

  # Cleanup on commands
  commands:
    clear_old:
      description: "Clear sessions older than specified days"
    clear_all:
      description: "Clear all sessions (requires confirmation)"
    archive:
      description: "Archive old sessions to zip"

# ═══════════════════════════════════════════════════════════════
# SETTINGS
# ═══════════════════════════════════════════════════════════════

settings:
  # Logging
  logging:
    enabled: true
    level: "info"
    log_saves: true
    log_restores: true
    log_checkpoints: true

  # Notifications
  notifications:
    show_auto_save: false
    show_checkpoint: true
    show_restore: true

  # Performance
  performance:
    compress_old_sessions: true
    lazy_load_context: true
