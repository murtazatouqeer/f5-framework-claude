# F5 Framework - Centralized Error Handling System
# Version: 2.0.0
# Purpose: Unified error definitions, recovery actions, and graceful degradation

version: "2.0.0"

# ============================================================
# ERROR CATEGORIES
# ============================================================
categories:
  CFG:
    name: "Configuration Error"
    name_ja: "è¨­å®šã‚¨ãƒ©ãƒ¼"
    description: "Errors related to missing or invalid configuration"
    severity_default: "error"
    icon: "âš™ï¸"

  SES:
    name: "Session Error"
    name_ja: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼"
    description: "Errors related to session management and state"
    severity_default: "warning"
    icon: "ğŸ“‹"

  GAT:
    name: "Gate Error"
    name_ja: "ã‚²ãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼"
    description: "Errors related to quality gates and validation"
    severity_default: "error"
    icon: "ğŸš§"

  MCP:
    name: "MCP Server Error"
    name_ja: "MCPã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼"
    description: "Errors related to MCP server connections"
    severity_default: "warning"
    icon: "ğŸ”Œ"

  SKL:
    name: "Skill Error"
    name_ja: "ã‚¹ã‚­ãƒ«ã‚¨ãƒ©ãƒ¼"
    description: "Errors related to skill/command execution"
    severity_default: "warning"
    icon: "ğŸ¯"

  AGT:
    name: "Agent Error"
    name_ja: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼"
    description: "Errors related to agent operations"
    severity_default: "warning"
    icon: "ğŸ¤–"

  FIL:
    name: "File Error"
    name_ja: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼"
    description: "Errors related to file operations"
    severity_default: "error"
    icon: "ğŸ“"

  WFL:
    name: "Workflow Error"
    name_ja: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ©ãƒ¼"
    description: "Errors related to workflow execution"
    severity_default: "warning"
    icon: "ğŸ”„"

# ============================================================
# ERROR DEFINITIONS
# ============================================================
errors:
  # Configuration Errors (CFG)
  CFG001:
    category: CFG
    severity: error
    message: "Missing config.json file"
    message_ja: "config.jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Project not initialized or config file deleted"
    recovery:
      auto: true
      action: "init_config"
      fallback: "Use default configuration"
    suggestion: "Run /f5-init to initialize project"

  CFG002:
    category: CFG
    severity: error
    message: "Invalid config.json format"
    message_ja: "config.jsonã®å½¢å¼ãŒç„¡åŠ¹ã§ã™"
    cause: "Malformed JSON or missing required fields"
    recovery:
      auto: false
      action: "validate_config"
      fallback: null
    suggestion: "Check config.json syntax and required fields"

  CFG003:
    category: CFG
    severity: warning
    message: "Missing profile.yaml file"
    message_ja: "profile.yamlãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Profile not configured"
    recovery:
      auto: true
      action: "create_default_profile"
      fallback: "Use default profile settings"
    suggestion: "Run /f5-init --profile to create profile"

  CFG004:
    category: CFG
    severity: warning
    message: "Unknown domain specified"
    message_ja: "ä¸æ˜ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™"
    cause: "Domain not found in domains directory"
    recovery:
      auto: false
      action: "list_available_domains"
      fallback: "Continue without domain-specific knowledge"
    suggestion: "Check available domains in /domains directory"

  CFG005:
    category: CFG
    severity: warning
    message: "Missing memory directory"
    message_ja: "ãƒ¡ãƒ¢ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Memory system not initialized"
    recovery:
      auto: true
      action: "init_memory"
      fallback: "Create memory directory structure"
    suggestion: "Run /f5-load to initialize memory"

  # Session Errors (SES)
  SES001:
    category: SES
    severity: warning
    message: "Session not loaded"
    message_ja: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“"
    cause: "/f5-load not executed"
    recovery:
      auto: false
      action: "prompt_load"
      fallback: "Continue with limited context"
    suggestion: "Run /f5-load at session start"

  SES002:
    category: SES
    severity: warning
    message: "Stale session data"
    message_ja: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒå¤ããªã£ã¦ã„ã¾ã™"
    cause: "Session file older than 24 hours"
    recovery:
      auto: true
      action: "refresh_session"
      fallback: "Use stale data with warning"
    suggestion: "Run /f5-load --refresh to update"

  SES003:
    category: SES
    severity: info
    message: "Constitution not read"
    message_ja: "ã‚³ãƒ³ã‚¹ãƒ†ã‚£ãƒ†ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“"
    cause: "constitution.md not checked this session"
    recovery:
      auto: true
      action: "read_constitution"
      fallback: "Remind to check constitution"
    suggestion: "Check .f5/memory/constitution.md"

  SES004:
    category: SES
    severity: warning
    message: "Memory file corrupted"
    message_ja: "ãƒ¡ãƒ¢ãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã¾ã™"
    cause: "Invalid format or encoding issue"
    recovery:
      auto: false
      action: "restore_memory_backup"
      fallback: "Create fresh memory file"
    suggestion: "Check memory file encoding (UTF-8)"

  # Gate Errors (GAT)
  GAT001:
    category: GAT
    severity: error
    message: "Gate prerequisites not met"
    message_ja: "ã‚²ãƒ¼ãƒˆã®å‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã¾ã›ã‚“"
    cause: "Previous gate not completed"
    recovery:
      auto: false
      action: "show_prerequisites"
      fallback: null
    suggestion: "Complete prerequisite gates first"

  GAT002:
    category: GAT
    severity: error
    message: "Gate checklist incomplete"
    message_ja: "ã‚²ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒæœªå®Œäº†ã§ã™"
    cause: "Required items not checked"
    recovery:
      auto: false
      action: "show_unchecked_items"
      fallback: null
    suggestion: "Complete all checklist items"

  GAT003:
    category: GAT
    severity: warning
    message: "Gate status file missing"
    message_ja: "ã‚²ãƒ¼ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "gates-status.yaml not found"
    recovery:
      auto: true
      action: "init_gate_status"
      fallback: "Create default gate status"
    suggestion: "Run /f5-gate status to initialize"

  GAT004:
    category: GAT
    severity: error
    message: "Customer approval required"
    message_ja: "é¡§å®¢æ‰¿èªãŒå¿…è¦ã§ã™"
    cause: "Gate requires external sign-off"
    recovery:
      auto: false
      action: "generate_approval_request"
      fallback: null
    suggestion: "Request customer approval before proceeding"

  GAT005:
    category: GAT
    severity: warning
    message: "Gate deadline approaching"
    message_ja: "ã‚²ãƒ¼ãƒˆæœŸé™ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™"
    cause: "Less than 2 days to deadline"
    recovery:
      auto: false
      action: "show_remaining_tasks"
      fallback: "Continue with urgency flag"
    suggestion: "Prioritize gate completion tasks"

  # MCP Server Errors (MCP)
  MCP001:
    category: MCP
    severity: warning
    message: "MCP server not available"
    message_ja: "MCPã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"
    cause: "Server not running or connection failed"
    recovery:
      auto: true
      action: "use_fallback_tool"
      fallback: "Use native Claude capabilities"
    suggestion: "Check MCP server configuration"

  MCP002:
    category: MCP
    severity: warning
    message: "MCP server timeout"
    message_ja: "MCPã‚µãƒ¼ãƒãƒ¼ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"
    cause: "Server response exceeded timeout"
    recovery:
      auto: true
      action: "retry_with_timeout"
      fallback: "Use native tools"
    suggestion: "Check server load and network"

  MCP003:
    category: MCP
    severity: info
    message: "MCP server degraded mode"
    message_ja: "MCPã‚µãƒ¼ãƒãƒ¼ãŒç¸®é€€ãƒ¢ãƒ¼ãƒ‰ã§ã™"
    cause: "Partial functionality available"
    recovery:
      auto: true
      action: "use_available_features"
      fallback: "Continue with limited features"
    suggestion: "Some features may be unavailable"

  MCP004:
    category: MCP
    severity: warning
    message: "Context7 documentation not found"
    message_ja: "Context7ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Library not in Context7 database"
    recovery:
      auto: true
      action: "fallback_to_websearch"
      fallback: "Use web search for documentation"
    suggestion: "Try alternative documentation sources"

  # Skill Errors (SKL)
  SKL001:
    category: SKL
    severity: warning
    message: "Skill file not found"
    message_ja: "ã‚¹ã‚­ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Command file missing from .claude/commands"
    recovery:
      auto: false
      action: "list_available_skills"
      fallback: null
    suggestion: "Check available commands with /help"

  SKL002:
    category: SKL
    severity: warning
    message: "Skill execution failed"
    message_ja: "ã‚¹ã‚­ãƒ«ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ"
    cause: "Runtime error during skill execution"
    recovery:
      auto: false
      action: "show_error_details"
      fallback: "Manual execution guidance"
    suggestion: "Check skill requirements and inputs"

  SKL003:
    category: SKL
    severity: info
    message: "Skill deprecated"
    message_ja: "ã‚¹ã‚­ãƒ«ã¯éæ¨å¥¨ã§ã™"
    cause: "Skill marked for removal"
    recovery:
      auto: false
      action: "suggest_replacement"
      fallback: "Continue with deprecation warning"
    suggestion: "Use recommended replacement skill"

  # Agent Errors (AGT)
  AGT001:
    category: AGT
    severity: warning
    message: "Agent not available"
    message_ja: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"
    cause: "Agent type not recognized"
    recovery:
      auto: true
      action: "use_default_agent"
      fallback: "Use general-purpose agent"
    suggestion: "Check available agent types"

  AGT002:
    category: AGT
    severity: warning
    message: "Agent task timeout"
    message_ja: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"
    cause: "Task exceeded time limit"
    recovery:
      auto: false
      action: "break_into_subtasks"
      fallback: "Reduce task scope"
    suggestion: "Break task into smaller pieces"

  AGT003:
    category: AGT
    severity: info
    message: "Agent context limit"
    message_ja: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶é™"
    cause: "Agent context approaching limit"
    recovery:
      auto: true
      action: "summarize_and_continue"
      fallback: "Create new agent with summary"
    suggestion: "Consider task decomposition"

  # File Errors (FIL)
  FIL001:
    category: FIL
    severity: error
    message: "File not found"
    message_ja: "ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    cause: "Specified file does not exist"
    recovery:
      auto: false
      action: "search_similar_files"
      fallback: null
    suggestion: "Check file path and name"

  FIL002:
    category: FIL
    severity: error
    message: "File permission denied"
    message_ja: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"
    cause: "Insufficient permissions"
    recovery:
      auto: false
      action: "check_permissions"
      fallback: null
    suggestion: "Check file permissions"

  FIL003:
    category: FIL
    severity: warning
    message: "File encoding issue"
    message_ja: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å•é¡Œ"
    cause: "Non-UTF-8 encoding detected"
    recovery:
      auto: true
      action: "convert_encoding"
      fallback: "Read with fallback encoding"
    suggestion: "Convert file to UTF-8"

  FIL004:
    category: FIL
    severity: warning
    message: "Large file warning"
    message_ja: "å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®è­¦å‘Š"
    cause: "File exceeds recommended size"
    recovery:
      auto: false
      action: "suggest_chunking"
      fallback: "Process with memory warning"
    suggestion: "Consider processing in chunks"

  # Workflow Errors (WFL)
  WFL001:
    category: WFL
    severity: warning
    message: "Workflow step failed"
    message_ja: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—ãŒå¤±æ•—ã—ã¾ã—ãŸ"
    cause: "Step execution returned error"
    recovery:
      auto: false
      action: "retry_step"
      fallback: "Skip step with warning"
    suggestion: "Check step requirements"

  WFL002:
    category: WFL
    severity: warning
    message: "Workflow dependency missing"
    message_ja: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾å­˜é–¢ä¿‚ãŒä¸è¶³ã—ã¦ã„ã¾ã™"
    cause: "Required input not available"
    recovery:
      auto: false
      action: "resolve_dependency"
      fallback: null
    suggestion: "Complete dependent steps first"

  WFL003:
    category: WFL
    severity: info
    message: "Workflow paused"
    message_ja: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒä¸€æ™‚åœæ­¢ã—ã¦ã„ã¾ã™"
    cause: "Awaiting external input"
    recovery:
      auto: false
      action: "show_pending_inputs"
      fallback: "Continue when ready"
    suggestion: "Provide required inputs to continue"

  WFL004:
    category: WFL
    severity: warning
    message: "Traceability broken"
    message_ja: "ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãŒå£Šã‚Œã¦ã„ã¾ã™"
    cause: "Implementation not linked to requirement"
    recovery:
      auto: false
      action: "scan_for_traceability"
      fallback: null
    suggestion: "Add REQ-XXX comment to code"

# ============================================================
# RECOVERY ACTIONS
# ============================================================
recovery_actions:
  init_config:
    description: "Initialize default configuration"
    steps:
      - "Create .f5 directory"
      - "Generate default config.json"
      - "Set version to 2.0.0"
    auto_execute: true

  validate_config:
    description: "Validate configuration file"
    steps:
      - "Parse JSON syntax"
      - "Check required fields"
      - "Validate field types"
    auto_execute: false

  create_default_profile:
    description: "Create default profile"
    steps:
      - "Generate profile.yaml"
      - "Set default team settings"
      - "Configure customer defaults"
    auto_execute: true

  init_memory:
    description: "Initialize memory system"
    steps:
      - "Create memory directory"
      - "Create constitution.md"
      - "Create session.md"
      - "Create decisions.md"
      - "Create learnings.md"
    auto_execute: true

  prompt_load:
    description: "Prompt user to load session"
    steps:
      - "Display reminder message"
      - "Suggest /f5-load command"
    auto_execute: false

  refresh_session:
    description: "Refresh session data"
    steps:
      - "Update session timestamp"
      - "Reload configuration"
      - "Check gate status"
    auto_execute: true

  read_constitution:
    description: "Read constitution file"
    steps:
      - "Load constitution.md"
      - "Parse rules"
      - "Display summary"
    auto_execute: true

  init_gate_status:
    description: "Initialize gate status"
    steps:
      - "Create gates-status.yaml"
      - "Set all gates to pending"
      - "Initialize checklists"
    auto_execute: true

  use_fallback_tool:
    description: "Use fallback when MCP unavailable"
    steps:
      - "Detect MCP failure"
      - "Select native alternative"
      - "Log degradation"
    auto_execute: true

  use_default_agent:
    description: "Fall back to general agent"
    steps:
      - "Detect agent unavailability"
      - "Route to general-purpose agent"
      - "Preserve task context"
    auto_execute: true

# ============================================================
# GRACEFUL DEGRADATION
# ============================================================
graceful_degradation:
  levels:
    - level: 1
      name: "Full Functionality"
      name_ja: "å®Œå…¨æ©Ÿèƒ½"
      description: "All features available"

    - level: 2
      name: "Minor Degradation"
      name_ja: "è»½åº¦ç¸®é€€"
      description: "Some MCP servers unavailable, using fallbacks"

    - level: 3
      name: "Moderate Degradation"
      name_ja: "ä¸­åº¦ç¸®é€€"
      description: "Core features only, no advanced integrations"

    - level: 4
      name: "Minimal Mode"
      name_ja: "æœ€å°ãƒ¢ãƒ¼ãƒ‰"
      description: "Basic read/write operations only"

    - level: 5
      name: "Emergency Mode"
      name_ja: "ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰"
      description: "Manual guidance only, no automation"

  fallback_chains:
    documentation:
      primary: "context7"
      fallback_1: "websearch"
      fallback_2: "native_knowledge"

    code_analysis:
      primary: "serena"
      fallback_1: "sequential"
      fallback_2: "native_analysis"

    ui_generation:
      primary: "magic"
      fallback_1: "native_generation"

    search:
      primary: "tavily"
      fallback_1: "websearch"
      fallback_2: "native_search"

    testing:
      primary: "playwright"
      fallback_1: "native_testing"

# ============================================================
# INTERNATIONALIZATION
# ============================================================
i18n:
  default_language: "en"
  supported_languages:
    - en
    - ja

  templates:
    error_display:
      en: "[{icon}] {category}{code}: {message}"
      ja: "[{icon}] {category}{code}: {message_ja}"

    recovery_suggestion:
      en: "Suggestion: {suggestion}"
      ja: "ææ¡ˆ: {suggestion}"

    auto_recovery:
      en: "Auto-recovering: {action}"
      ja: "è‡ªå‹•å›å¾©ä¸­: {action}"

    degradation_notice:
      en: "Operating in {level} mode"
      ja: "{level}ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­"

# ============================================================
# LOGGING
# ============================================================
logging:
  enabled: true
  file: ".f5/logs/errors.log"
  max_size: "10MB"
  rotation: 5

  levels:
    - debug
    - info
    - warning
    - error
    - critical

  format: "[{timestamp}] [{level}] [{category}] {code}: {message}"

  include:
    - timestamp
    - level
    - category
    - code
    - message
    - recovery_action
    - resolution
