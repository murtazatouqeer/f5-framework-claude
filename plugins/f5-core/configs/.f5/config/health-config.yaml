# F5 Framework - Health Dashboard Configuration
# Version: 2.0.0
# Purpose: Health monitoring, metrics aggregation, and recommendations

version: "2.0.0"

# ============================================================
# HEALTH CATEGORIES
# ============================================================
categories:
  system:
    name: "System Health"
    name_ja: "ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§"
    description: "Core framework components"
    icon: "ğŸ¥"
    weight: 1.0

  configuration:
    name: "Configuration Health"
    name_ja: "è¨­å®šå¥å…¨æ€§"
    description: "Project configuration status"
    icon: "âš™ï¸"
    weight: 0.9

  workflow:
    name: "Workflow Health"
    name_ja: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¥å…¨æ€§"
    description: "Development workflow status"
    icon: "ğŸ”„"
    weight: 0.8

  quality:
    name: "Quality Health"
    name_ja: "å“è³ªå¥å…¨æ€§"
    description: "Code and process quality"
    icon: "âœ¨"
    weight: 0.9

  integration:
    name: "Integration Health"
    name_ja: "çµ±åˆå¥å…¨æ€§"
    description: "MCP and external integrations"
    icon: "ğŸ”—"
    weight: 0.7

# ============================================================
# HEALTH METRICS
# ============================================================
metrics:
  # System Metrics
  config_valid:
    category: system
    name: "Configuration Valid"
    check: "config.json valid and complete"
    healthy: true
    warning: false
    critical: false
    weight: 1.0

  memory_initialized:
    category: system
    name: "Memory System"
    check: "Memory files exist and accessible"
    healthy: true
    warning: "partial files"
    critical: false
    weight: 0.9

  commands_available:
    category: system
    name: "Commands Available"
    check: "Core commands exist"
    healthy: ">= 10 commands"
    warning: ">= 5 commands"
    critical: "< 5 commands"
    weight: 0.8

  # Configuration Metrics
  profile_complete:
    category: configuration
    name: "Profile Complete"
    check: "profile.yaml has all sections"
    healthy: "all sections present"
    warning: "missing optional sections"
    critical: "missing required sections"
    weight: 0.7

  domain_configured:
    category: configuration
    name: "Domain Configured"
    check: "Domain knowledge available"
    healthy: "domain loaded"
    warning: "domain specified but not found"
    critical: false
    weight: 0.6

  # Workflow Metrics
  gate_progress:
    category: workflow
    name: "Gate Progress"
    check: "Quality gate advancement"
    healthy: "on schedule"
    warning: "1 gate behind"
    critical: "> 1 gate behind"
    weight: 0.9

  traceability:
    category: workflow
    name: "Traceability"
    check: "Code-requirement links"
    healthy: ">= 90% traced"
    warning: ">= 70% traced"
    critical: "< 70% traced"
    weight: 0.8

  blockers:
    category: workflow
    name: "Blockers"
    check: "Outstanding blockers"
    healthy: "0 blockers"
    warning: "1-2 blockers"
    critical: "> 2 blockers"
    weight: 0.9

  # Quality Metrics
  error_rate:
    category: quality
    name: "Error Rate"
    check: "Recent error frequency"
    healthy: "< 5%"
    warning: "5-15%"
    critical: "> 15%"
    weight: 0.8

  test_coverage:
    category: quality
    name: "Test Coverage"
    check: "Code test coverage"
    healthy: ">= 80%"
    warning: "60-80%"
    critical: "< 60%"
    weight: 0.9

  # Integration Metrics
  mcp_availability:
    category: integration
    name: "MCP Availability"
    check: "MCP server status"
    healthy: ">= 80% available"
    warning: "50-80% available"
    critical: "< 50% available"
    weight: 0.7

  mcp_fallback_rate:
    category: integration
    name: "MCP Fallback Rate"
    check: "Fallback usage frequency"
    healthy: "< 10%"
    warning: "10-25%"
    critical: "> 25%"
    weight: 0.6

# ============================================================
# HEALTH SCORE CALCULATION
# ============================================================
scoring:
  # Score ranges
  ranges:
    excellent:
      min: 90
      max: 100
      label: "Excellent"
      label_ja: "å„ªç§€"
      icon: "ğŸŒŸ"
      color: "green"

    good:
      min: 75
      max: 89
      label: "Good"
      label_ja: "è‰¯å¥½"
      icon: "âœ…"
      color: "green"

    fair:
      min: 60
      max: 74
      label: "Fair"
      label_ja: "æ™®é€š"
      icon: "ğŸ”¶"
      color: "yellow"

    poor:
      min: 40
      max: 59
      label: "Poor"
      label_ja: "ä¸è‰¯"
      icon: "âš ï¸"
      color: "orange"

    critical:
      min: 0
      max: 39
      label: "Critical"
      label_ja: "å±æ©Ÿçš„"
      icon: "ğŸ”´"
      color: "red"

  # Calculation method
  method: "weighted_average"

  # Status mapping
  status_scores:
    healthy: 100
    warning: 60
    critical: 20
    unknown: 50

# ============================================================
# HEALTH DASHBOARD DISPLAY
# ============================================================
dashboard:
  # Main dashboard
  main:
    sections:
      - type: "score"
        title: "Overall Health"
        size: "large"

      - type: "categories"
        title: "Category Breakdown"
        show_scores: true

      - type: "metrics"
        title: "Key Metrics"
        max_items: 8
        filter: "important"

      - type: "issues"
        title: "Active Issues"
        max_items: 5

      - type: "recommendations"
        title: "Recommendations"
        max_items: 3

  # Compact dashboard (for --compact)
  compact:
    format: "single_line"
    template: "Health: {score}/100 {icon} | {category_summary}"

  # Detailed dashboard (for --full)
  detailed:
    sections:
      - type: "score"
        title: "Overall Health"
        show_trend: true
        show_history: true

      - type: "categories"
        title: "Category Analysis"
        show_metrics: true
        show_recommendations: true

      - type: "metrics"
        title: "All Metrics"
        show_all: true

      - type: "issues"
        title: "Issues & Blockers"
        show_all: true

      - type: "recommendations"
        title: "All Recommendations"
        show_all: true

      - type: "history"
        title: "Health History"
        days: 7

# ============================================================
# RECOMMENDATIONS ENGINE
# ============================================================
recommendations:
  # Auto-generated based on health status
  rules:
    - condition: "config_valid == critical"
      priority: 1
      message: "Fix configuration immediately - run /f5-selftest --fix"
      message_ja: "è¨­å®šã‚’ç›´ã¡ã«ä¿®æ­£ - /f5-selftest --fix ã‚’å®Ÿè¡Œ"

    - condition: "memory_initialized == warning"
      priority: 2
      message: "Initialize memory system with /f5-load"
      message_ja: "/f5-load ã§ãƒ¡ãƒ¢ãƒªã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–"

    - condition: "gate_progress == warning"
      priority: 2
      message: "Gate progress behind schedule - review blockers"
      message_ja: "ã‚²ãƒ¼ãƒˆé€²æ—ãŒé…å»¶ - ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’ç¢ºèª"

    - condition: "gate_progress == critical"
      priority: 1
      message: "Critical gate delay - escalate blockers immediately"
      message_ja: "é‡å¤§ãªã‚²ãƒ¼ãƒˆé…å»¶ - ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’ç›´ã¡ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆ"

    - condition: "traceability == warning"
      priority: 3
      message: "Improve traceability - add REQ-XXX comments to code"
      message_ja: "ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ã‚’æ”¹å–„ - ã‚³ãƒ¼ãƒ‰ã«REQ-XXXã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ "

    - condition: "error_rate == warning"
      priority: 2
      message: "Error rate increasing - review /f5-analytics errors"
      message_ja: "ã‚¨ãƒ©ãƒ¼ç‡ä¸Šæ˜‡ - /f5-analytics errors ã‚’ç¢ºèª"

    - condition: "mcp_availability == warning"
      priority: 3
      message: "Some MCP servers unavailable - check configuration"
      message_ja: "ä¸€éƒ¨MCPã‚µãƒ¼ãƒãƒ¼åˆ©ç”¨ä¸å¯ - è¨­å®šã‚’ç¢ºèª"

    - condition: "mcp_fallback_rate == warning"
      priority: 3
      message: "High MCP fallback rate - verify server connections"
      message_ja: "MCPãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‡ãŒé«˜ã„ - ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚’ç¢ºèª"

    - condition: "test_coverage == warning"
      priority: 2
      message: "Test coverage below target - use /f5-tdd for new features"
      message_ja: "ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç›®æ¨™ä»¥ä¸‹ - æ–°æ©Ÿèƒ½ã«/f5-tddã‚’ä½¿ç”¨"

    - condition: "blockers > 0"
      priority: 1
      message: "Active blockers detected - address before proceeding"
      message_ja: "ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’æ¤œå‡º - ç¶šè¡Œå‰ã«å¯¾å‡¦"

  # Proactive suggestions (not based on issues)
  tips:
    - condition: "session_duration > 2h"
      message: "Consider taking a break or checkpointing"
      message_ja: "ä¼‘æ†©ã¾ãŸã¯ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’æ¤œè¨"

    - condition: "gate_almost_complete"
      message: "Gate nearly complete - review checklist for final items"
      message_ja: "ã‚²ãƒ¼ãƒˆã»ã¼å®Œäº† - æœ€çµ‚é …ç›®ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèª"

    - condition: "new_session"
      message: "Remember to run /f5-load at session start"
      message_ja: "ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«/f5-loadã‚’å®Ÿè¡Œ"

# ============================================================
# HEALTH HISTORY
# ============================================================
history:
  enabled: true
  storage: ".f5/analytics/health-history.json"

  tracking:
    - overall_score
    - category_scores
    - metric_status
    - issues_count
    - recommendations_count

  retention:
    hourly: "24h"
    daily: "30d"
    weekly: "90d"

  snapshots:
    on_gate_change: true
    on_session_end: true
    periodic: "1h"

# ============================================================
# ALERTS
# ============================================================
alerts:
  enabled: true

  thresholds:
    overall_score:
      warning: 70
      critical: 50

    category_score:
      warning: 60
      critical: 40

  notifications:
    console: true
    log_file: ".f5/logs/health-alerts.log"

# ============================================================
# DISPLAY TEMPLATES
# ============================================================
templates:
  # ASCII Health Bar
  health_bar:
    width: 20
    filled: "â–ˆ"
    empty: "â–‘"
    format: "[{bar}] {score}%"

  # Category Summary
  category_summary:
    format: "{icon} {name}: {score}% ({status})"

  # Metric Display
  metric_display:
    healthy: "âœ… {name}"
    warning: "âš ï¸ {name}"
    critical: "ğŸ”´ {name}"

  # Issue Display
  issue_display:
    format: "â€¢ {icon} {message} (Priority: {priority})"

  # Recommendation Display
  recommendation_display:
    format: "ğŸ’¡ {message}"

# ============================================================
# INTEGRATION
# ============================================================
integration:
  # Auto-check on commands
  auto_check:
    on_load: true
    on_gate_change: true
    on_session_start: true

  # Feed into other systems
  feeds:
    analytics: true
    selftest: true
    status: true

  # API endpoint (if enabled)
  api:
    enabled: false
    endpoint: null
