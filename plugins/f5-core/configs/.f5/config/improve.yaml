# F5 Improve Configuration
# Configure /f5-improve command behavior

improve:
  enabled: true
  default_mode: "preview"          # preview | safe | interactive | auto
  default_type: "all"              # quality | performance | security | maintainability | all
  auto_apply_risk: "low"           # Only auto-apply changes with this risk level or lower
  create_backup: true              # Create git backup before applying changes
  run_tests_after: false           # Run tests after applying changes
  history_retention_days: 30       # How long to keep improvement history

  # Improvement types configuration
  types:
    quality:
      enabled: true
      rules:
        max_function_length: 20    # Lines
        max_complexity: 10         # Cyclomatic complexity
        max_duplication: 5         # Percentage
        enforce_naming: true
        enforce_imports: true

    performance:
      enabled: true
      rules:
        detect_n_plus_1: true
        suggest_caching: true
        detect_sequential_async: true
        detect_memory_leaks: true
        suggest_indexes: true

    security:
      enabled: true
      rules:
        check_auth_guards: true
        check_input_validation: true
        check_dependencies: true
        check_secrets: true
        check_sql_injection: true

    maintainability:
      enabled: true
      rules:
        require_jsdoc: true
        forbid_any: true
        check_todos: true
        check_comments: true
        check_test_coverage: true

  # Risk assessment
  risk_levels:
    low:
      auto_apply: true
      examples:
        - "Remove unused imports"
        - "Fix import order"
        - "Add missing semicolons"
        - "Fix formatting"
    medium:
      auto_apply: false
      requires_review: true
      examples:
        - "Parallelize async operations"
        - "Add caching decorators"
        - "Refactor for complexity"
    high:
      auto_apply: false
      requires_review: true
      manual_only: true
      examples:
        - "Change business logic"
        - "Modify authentication flow"
        - "Update database queries"

  # Exclude patterns
  exclude:
    - "**/*.spec.ts"
    - "**/*.test.ts"
    - "**/*.spec.js"
    - "**/*.test.js"
    - "**/node_modules/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/*.d.ts"
    - "**/coverage/**"
    - "**/.git/**"

  # Stack-specific settings
  stacks:
    nestjs:
      lint_command: "npm run lint"
      lint_fix_command: "npm run lint:fix"
      type_check_command: "npx tsc --noEmit"
      format_command: "npx prettier --write"
      format_check_command: "npx prettier --check"
      test_command: "npm run test"
      audit_command: "npm audit --json"

    spring:
      lint_command: "mvn checkstyle:check"
      type_check_command: "mvn compile"
      format_command: "mvn spotless:apply"
      format_check_command: "mvn spotless:check"
      test_command: "mvn test"
      audit_command: "mvn dependency-check:check"

    fastapi:
      lint_command: "ruff check ."
      lint_fix_command: "ruff check --fix ."
      type_check_command: "mypy app/"
      format_command: "black app/ && isort app/"
      format_check_command: "black --check app/ && isort --check-only app/"
      test_command: "pytest"
      audit_command: "pip-audit"

    go:
      lint_command: "golangci-lint run"
      lint_fix_command: "golangci-lint run --fix"
      type_check_command: "go vet ./..."
      format_command: "gofmt -w ."
      format_check_command: "gofmt -l ."
      test_command: "go test ./..."
      audit_command: "govulncheck ./..."

    react:
      lint_command: "npm run lint"
      lint_fix_command: "npm run lint:fix"
      type_check_command: "npx tsc --noEmit"
      format_command: "npx prettier --write"
      format_check_command: "npx prettier --check"
      test_command: "npm run test"
      audit_command: "npm audit --json"

    nextjs:
      lint_command: "npm run lint"
      lint_fix_command: "npm run lint -- --fix"
      type_check_command: "npx tsc --noEmit"
      format_command: "npx prettier --write"
      format_check_command: "npx prettier --check"
      test_command: "npm run test"
      audit_command: "npm audit --json"

    vue:
      lint_command: "npm run lint"
      lint_fix_command: "npm run lint -- --fix"
      type_check_command: "npx vue-tsc --noEmit"
      format_command: "npx prettier --write"
      format_check_command: "npx prettier --check"
      test_command: "npm run test"
      audit_command: "npm audit --json"

    flutter:
      lint_command: "flutter analyze"
      format_command: "dart format ."
      format_check_command: "dart format --output=none --set-exit-if-changed ."
      test_command: "flutter test"

    laravel:
      lint_command: "vendor/bin/phpcs"
      lint_fix_command: "vendor/bin/phpcbf"
      type_check_command: "vendor/bin/phpstan analyse"
      format_command: "vendor/bin/php-cs-fixer fix"
      test_command: "vendor/bin/phpunit"
