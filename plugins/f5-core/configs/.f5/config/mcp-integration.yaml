# F5 MCP (Model Context Protocol) Integration
# Version: 1.0.0

# ═══════════════════════════════════════════════════════════════
# MCP OVERVIEW
# ═══════════════════════════════════════════════════════════════

overview:
  description: |
    MCP (Model Context Protocol) allows Claude to interact with external
    tools and data sources through standardized servers.

  benefits:
    - "Access external data sources"
    - "Execute code in sandboxes"
    - "Interact with APIs"
    - "File system operations"
    - "Database queries"

# ═══════════════════════════════════════════════════════════════
# RECOMMENDED MCP SERVERS
# ═══════════════════════════════════════════════════════════════

recommended_servers:
  # Filesystem access
  filesystem:
    name: "@modelcontextprotocol/server-filesystem"
    description: "Secure file system access"
    description_ja: "安全なファイルシステムアクセス"
    use_cases:
      - "Read project files"
      - "Write generated code"
      - "Manage configuration"
    config:
      allowed_directories:
        - "${PROJECT_ROOT}"
        - "${HOME}/.f5"

  # Git integration
  git:
    name: "@modelcontextprotocol/server-git"
    description: "Git repository operations"
    description_ja: "Gitリポジトリ操作"
    use_cases:
      - "Check git status"
      - "View diffs"
      - "Commit changes"
      - "Branch management"

  # Database access
  postgres:
    name: "@modelcontextprotocol/server-postgres"
    description: "PostgreSQL database access"
    description_ja: "PostgreSQLデータベースアクセス"
    use_cases:
      - "Query database"
      - "Schema inspection"
      - "Migration verification"
    config:
      connection_string: "${DATABASE_URL}"
      read_only: true  # Safety first

  # Web fetch
  fetch:
    name: "@modelcontextprotocol/server-fetch"
    description: "HTTP requests"
    description_ja: "HTTPリクエスト"
    use_cases:
      - "API testing"
      - "Documentation fetching"
      - "External service checks"

  # Memory/context
  memory:
    name: "@modelcontextprotocol/server-memory"
    description: "Persistent memory across sessions"
    description_ja: "セッション間の永続メモリ"
    use_cases:
      - "Store project context"
      - "Remember decisions"
      - "Track progress"

  # Sequential thinking
  sequential_thinking:
    name: "@modelcontextprotocol/server-sequential-thinking"
    description: "Multi-step reasoning engine"
    description_ja: "マルチステップ推論エンジン"
    use_cases:
      - "Complex problem solving"
      - "Architectural analysis"
      - "Debugging workflows"

  # Browser automation
  playwright:
    name: "@executeautomation/playwright-mcp-server"
    description: "Browser automation and E2E testing"
    description_ja: "ブラウザ自動化とE2Eテスト"
    use_cases:
      - "E2E testing"
      - "Visual testing"
      - "Accessibility testing"
      - "Form validation"

  # Context7 documentation
  context7:
    name: "@upstash/context7-mcp"
    description: "Library documentation lookup"
    description_ja: "ライブラリドキュメント検索"
    use_cases:
      - "Framework documentation"
      - "API references"
      - "Best practices"

# ═══════════════════════════════════════════════════════════════
# F5-SPECIFIC MCP TOOLS
# ═══════════════════════════════════════════════════════════════

f5_tools:
  # Project context
  f5_project:
    description: "Access F5 project configuration"
    description_ja: "F5プロジェクト設定へのアクセス"
    operations:
      - get_config: "Read .f5/config.json"
      - get_stack: "Get current stack info"
      - get_gate: "Get current gate status"
      - get_requirements: "List requirements"

  # Skills loader
  f5_skills:
    description: "Load F5 skills on demand"
    description_ja: "F5スキルのオンデマンド読み込み"
    operations:
      - load_skill: "Load specific skill"
      - list_skills: "List available skills"
      - search_skills: "Search skills by keyword"

  # Evidence management
  f5_evidence:
    description: "Manage gate evidence"
    description_ja: "ゲートエビデンス管理"
    operations:
      - save_evidence: "Save evidence artifact"
      - get_evidence: "Retrieve evidence"
      - list_evidence: "List evidence for gate"

  # TDD session
  f5_tdd:
    description: "TDD session management"
    description_ja: "TDDセッション管理"
    operations:
      - get_session: "Get current TDD session"
      - update_phase: "Update TDD phase"
      - save_metrics: "Save TDD metrics"

  # Memory system
  f5_memory:
    description: "F5 memory system integration"
    description_ja: "F5メモリシステム統合"
    operations:
      - read_constitution: "Read project constitution"
      - read_decisions: "Read decision records"
      - write_learning: "Write new learning"
      - read_session: "Read session context"

# ═══════════════════════════════════════════════════════════════
# CONFIGURATION
# ═══════════════════════════════════════════════════════════════

configuration:
  # Claude Desktop config location
  claude_config_path:
    macos: "~/Library/Application Support/Claude/claude_desktop_config.json"
    windows: "%APPDATA%/Claude/claude_desktop_config.json"
    linux: "~/.config/Claude/claude_desktop_config.json"

  # Example config
  example_config: |
    {
      "mcpServers": {
        "filesystem": {
          "command": "npx",
          "args": [
            "-y",
            "@modelcontextprotocol/server-filesystem",
            "/path/to/project"
          ]
        },
        "git": {
          "command": "npx",
          "args": ["-y", "@modelcontextprotocol/server-git"]
        },
        "postgres": {
          "command": "npx",
          "args": ["-y", "@modelcontextprotocol/server-postgres"],
          "env": {
            "DATABASE_URL": "postgresql://localhost/mydb"
          }
        },
        "sequential-thinking": {
          "command": "npx",
          "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
        }
      }
    }

# ═══════════════════════════════════════════════════════════════
# USAGE PATTERNS
# ═══════════════════════════════════════════════════════════════

usage_patterns:
  # Reading files
  file_read:
    description: "Read project files through MCP"
    example: |
      With filesystem MCP server, I can:
      - Read source files
      - Check configuration
      - Analyze project structure

  # Database operations
  database:
    description: "Query database safely"
    example: |
      With postgres MCP server (read-only), I can:
      - Inspect schema
      - Verify migrations
      - Check data integrity

  # Git operations
  git:
    description: "Git repository operations"
    example: |
      With git MCP server, I can:
      - Check current branch
      - View uncommitted changes
      - See recent commits

  # Complex reasoning
  sequential:
    description: "Multi-step analysis"
    example: |
      With sequential-thinking MCP server, I can:
      - Break down complex problems
      - Track reasoning steps
      - Validate hypotheses

  # Browser testing
  browser:
    description: "E2E testing and validation"
    example: |
      With playwright MCP server, I can:
      - Run E2E tests
      - Capture screenshots
      - Validate UI behavior

# ═══════════════════════════════════════════════════════════════
# MCP SERVER SELECTION RULES
# ═══════════════════════════════════════════════════════════════

selection_rules:
  # Task-based selection
  task_mapping:
    "read file": filesystem
    "write file": filesystem
    "git status": git
    "git commit": git
    "query database": postgres
    "check schema": postgres
    "api request": fetch
    "complex analysis": sequential_thinking
    "debug": sequential_thinking
    "e2e test": playwright
    "visual test": playwright
    "documentation": context7
    "library help": context7

  # Gate-based recommendations
  gate_mapping:
    D1:
      recommended: [fetch, context7]
      description: "Research phase - web fetch and docs"
    D2:
      recommended: [filesystem, context7]
      description: "SRS phase - file access and docs"
    D3:
      recommended: [filesystem, sequential_thinking]
      description: "Design phase - analysis tools"
    D4:
      recommended: [filesystem, context7]
      description: "Detail design - file and docs"
    G2:
      recommended: [filesystem, git, context7]
      description: "Implementation - full development tools"
    G3:
      recommended: [filesystem, postgres, playwright]
      description: "Testing - all testing tools"
    G4:
      recommended: [filesystem, git, postgres]
      description: "Deployment - verification tools"

# ═══════════════════════════════════════════════════════════════
# SECURITY CONSIDERATIONS
# ═══════════════════════════════════════════════════════════════

security:
  # General guidelines
  guidelines:
    - "Only allow project directory for filesystem"
    - "Use read-only connections for databases in production"
    - "Be careful with auto-commit in git"
    - "Validate all external API responses"
    - "Never expose credentials in logs"

  # Server-specific security
  server_security:
    filesystem:
      - "Restrict to project root"
      - "No access to system directories"
      - "No access to home directory (except .f5)"

    postgres:
      - "Use read-only connections"
      - "No DDL operations"
      - "Connection timeout"

    git:
      - "No force push"
      - "Require confirmation for commits"
      - "No credential storage"

    fetch:
      - "Whitelist allowed domains"
      - "Timeout on requests"
      - "Validate SSL certificates"

# ═══════════════════════════════════════════════════════════════
# SETTINGS
# ═══════════════════════════════════════════════════════════════

settings:
  # Default settings
  defaults:
    timeout_seconds: 30
    retry_count: 3
    log_requests: true

  # Performance settings
  performance:
    cache_responses: true
    cache_duration_seconds: 300
    parallel_requests: false

  # Logging
  logging:
    enabled: true
    level: "info"
    include_requests: false
    include_responses: false
