# F5 Framework Multi-Agent Collaboration Configuration
# Version: 1.0.0

collaboration:
  # Enable collaboration features
  enabled: true

  # Default collaboration mode
  default_mode: "sequential"  # sequential | parallel | consultation

  # Show collaboration progress
  show_progress: true

  # Max agents in parallel
  max_parallel: 3

  # Timeout for each agent (seconds)
  agent_timeout: 300

# ═══════════════════════════════════════════════════════════════
# COLLABORATION PATTERNS
# ═══════════════════════════════════════════════════════════════

patterns:
  # Sequential execution - agents run one after another
  sequential:
    description: "Agents work in order, each receiving previous output"
    use_when:
      - "Tasks have dependencies"
      - "Output of one agent feeds into another"
      - "Order matters for correctness"
    context_passing: true
    wait_for_completion: true

  # Parallel execution - agents run simultaneously
  parallel:
    description: "Agents work simultaneously on independent subtasks"
    use_when:
      - "Tasks are independent"
      - "Speed is important"
      - "No dependencies between agents"
    context_passing: false
    merge_outputs: true
    merge_strategy: "combine"  # combine | vote | best

  # Review chain - each agent reviews previous output
  review_chain:
    description: "Each agent reviews and improves previous output"
    use_when:
      - "Quality assurance needed"
      - "Multiple perspectives required"
      - "Critical tasks"
    context_passing: true
    allow_modifications: true
    require_approval: false

  # Consultation - multiple agents provide input for decision
  consultation:
    description: "Multiple agents provide recommendations"
    use_when:
      - "Complex decisions"
      - "Trade-offs need evaluation"
      - "Multiple expertise areas"
    voting: false
    present_all_opinions: true
    final_decision: "user"  # user | pm_agent | highest_priority

# ═══════════════════════════════════════════════════════════════
# AGENT RELATIONSHIPS
# ═══════════════════════════════════════════════════════════════

relationships:
  # Define how agents interact with each other

  system_architect:
    triggers:
      # These agents are often needed after architect
      - agent: api_designer
        when: "API design needed"
      - agent: security_scanner
        when: "Security architecture review"
      - agent: backend
        when: "Implementation planning"
    consulted_by:
      # These agents may ask for architect input
      - security_scanner
      - performance_analyzer
    reviews:
      - api_designer
      - code_generator
    conflicts_with: []
    synergizes_with:
      - api_designer
      - security_scanner

  security_scanner:
    triggers:
      - agent: code_reviewer
        when: "Security issues found"
      - agent: code_generator
        when: "Security fixes needed"
    consulted_by:
      - system_architect
      - code_reviewer
      - backend
    reviews:
      - code_generator
      - api_designer
      - backend
    conflicts_with: []
    synergizes_with:
      - code_reviewer

  code_generator:
    triggers:
      - agent: test_writer
        when: "Code generated"
      - agent: documenter
        when: "API implemented"
    consulted_by:
      - test_writer
    reviews: []
    conflicts_with:
      - refactorer  # Don't generate and refactor simultaneously
    synergizes_with:
      - test_writer

  test_writer:
    triggers:
      - agent: code_reviewer
        when: "Tests written"
    consulted_by:
      - code_generator
      - debugger
    reviews:
      - code_generator
    conflicts_with: []
    synergizes_with:
      - code_generator
      - debugger

  code_reviewer:
    triggers:
      - agent: refactorer
        when: "Code quality issues found"
      - agent: security_scanner
        when: "Security concerns found"
    consulted_by:
      - code_generator
      - refactorer
    reviews:
      - code_generator
      - refactorer
      - test_writer
    conflicts_with: []
    synergizes_with:
      - security_scanner
      - test_writer

  debugger:
    triggers:
      - agent: code_generator
        when: "Fix identified"
      - agent: test_writer
        when: "Regression test needed"
    consulted_by:
      - performance_analyzer
    reviews: []
    conflicts_with: []
    synergizes_with:
      - test_writer
      - performance_analyzer

  refactorer:
    triggers:
      - agent: test_writer
        when: "Refactoring complete"
      - agent: code_reviewer
        when: "Review needed"
    consulted_by:
      - code_reviewer
    reviews: []
    conflicts_with:
      - code_generator  # Don't generate and refactor simultaneously
    synergizes_with:
      - code_reviewer
      - test_writer

  performance_analyzer:
    triggers:
      - agent: refactorer
        when: "Performance issues found"
      - agent: backend
        when: "Optimization needed"
    consulted_by:
      - system_architect
    reviews:
      - code_generator
      - backend
    conflicts_with: []
    synergizes_with:
      - debugger
      - refactorer

  api_designer:
    triggers:
      - agent: code_generator
        when: "API spec complete"
      - agent: documenter
        when: "Documentation needed"
    consulted_by:
      - backend
      - frontend
    reviews: []
    conflicts_with: []
    synergizes_with:
      - system_architect
      - documenter

  documenter:
    triggers: []
    consulted_by:
      - code_generator
      - api_designer
    reviews: []
    conflicts_with: []
    synergizes_with:
      - api_designer

# ═══════════════════════════════════════════════════════════════
# AUTO-CHAIN RULES
# ═══════════════════════════════════════════════════════════════

auto_chains:
  # Predefined chains for common workflows

  feature_development:
    trigger_keywords:
      - "implement feature"
      - "new feature"
      - "add functionality"
      - "create new"
    chain:
      - agent: system_architect
        action: "Design review"
        optional: true
        skip_if: "simple task"
      - agent: api_designer
        action: "API contract"
        optional: true
        skip_if: "no API needed"
      - agent: code_generator
        action: "Implementation"
        required: true
      - agent: test_writer
        action: "Unit tests"
        required: true
      - agent: security_scanner
        action: "Security review"
        required: true
      - agent: code_reviewer
        action: "Code review"
        required: true
      - agent: documenter
        action: "Documentation"
        optional: true
    estimated_time: "30-60 minutes"

  bug_fix:
    trigger_keywords:
      - "fix bug"
      - "debug"
      - "error"
      - "not working"
      - "broken"
    chain:
      - agent: debugger
        action: "Root cause analysis"
        required: true
      - agent: code_generator
        action: "Implement fix"
        required: true
      - agent: test_writer
        action: "Regression test"
        required: true
      - agent: code_reviewer
        action: "Review fix"
        required: true
    estimated_time: "15-30 minutes"

  security_audit:
    trigger_keywords:
      - "security audit"
      - "security review"
      - "vulnerability scan"
      - "penetration test"
    chain:
      - agent: security_scanner
        action: "Full security scan"
        required: true
      - agent: code_reviewer
        action: "Manual security review"
        required: true
      - agent: code_generator
        action: "Implement fixes"
        conditional: "if vulnerabilities found"
      - agent: test_writer
        action: "Security tests"
        required: true
      - agent: documenter
        action: "Security report"
        required: true
    estimated_time: "45-90 minutes"

  performance_optimization:
    trigger_keywords:
      - "optimize performance"
      - "slow"
      - "improve speed"
      - "latency"
    chain:
      - agent: performance_analyzer
        action: "Profile and analyze"
        required: true
      - agent: system_architect
        action: "Architecture review"
        optional: true
      - agent: refactorer
        action: "Implement optimizations"
        required: true
      - agent: test_writer
        action: "Performance tests"
        required: true
      - agent: code_reviewer
        action: "Review changes"
        required: true
    estimated_time: "30-60 minutes"

  code_quality:
    trigger_keywords:
      - "improve code quality"
      - "refactor"
      - "clean up"
      - "technical debt"
    chain:
      - agent: code_reviewer
        action: "Quality assessment"
        required: true
      - agent: refactorer
        action: "Refactoring"
        required: true
      - agent: test_writer
        action: "Update tests"
        required: true
      - agent: security_scanner
        action: "Security check"
        required: true
      - agent: code_reviewer
        action: "Final review"
        required: true
    estimated_time: "30-45 minutes"

  api_design:
    trigger_keywords:
      - "design API"
      - "API endpoints"
      - "REST API"
      - "GraphQL schema"
    chain:
      - agent: system_architect
        action: "Architecture review"
        optional: true
      - agent: api_designer
        action: "API design"
        required: true
      - agent: security_scanner
        action: "API security review"
        required: true
      - agent: documenter
        action: "API documentation"
        required: true
      - agent: code_reviewer
        action: "Design review"
        required: true
    estimated_time: "20-40 minutes"

  full_stack_feature:
    trigger_keywords:
      - "full stack"
      - "frontend and backend"
      - "end to end"
    chain:
      - agent: system_architect
        action: "Architecture design"
        required: true
      - agent: api_designer
        action: "API contract"
        required: true
      # Parallel execution for frontend and backend
      - parallel:
          - agent: backend
            action: "Backend implementation"
          - agent: frontend
            action: "Frontend implementation"
      - agent: test_writer
        action: "Integration tests"
        required: true
      - agent: security_scanner
        action: "Security review"
        required: true
      - agent: code_reviewer
        action: "Code review"
        required: true
    estimated_time: "60-120 minutes"

# ═══════════════════════════════════════════════════════════════
# COLLABORATION FLAGS
# ═══════════════════════════════════════════════════════════════

flags:
  --chain:
    description: "Execute agents in sequence, passing context"
    example: "@f5:backend --chain 'implement user service'"
    behavior:
      - "PM Agent determines optimal chain"
      - "Each agent receives previous output"
      - "Stops on first failure"
    auto_chain: true

  --parallel:
    description: "Execute agents simultaneously"
    example: "@f5:backend @f5:frontend --parallel 'implement feature'"
    behavior:
      - "Agents run concurrently"
      - "Outputs merged at end"
      - "Independent subtasks"
    requires_multiple_agents: true

  --consult:
    description: "Get input from multiple agents before deciding"
    example: "@f5:architect --consult 'microservices vs monolith'"
    behavior:
      - "Multiple agents provide recommendations"
      - "All opinions presented"
      - "User makes final decision"
    agents_consulted: ["system_architect", "security_scanner", "performance_analyzer"]

  --review:
    description: "Add review step after each agent"
    example: "@f5:backend --review 'implement payment service'"
    behavior:
      - "Each output reviewed by code_reviewer"
      - "Security-critical: also reviewed by security_scanner"
      - "Changes suggested before proceeding"
    always_include: ["code_reviewer"]

  --safe:
    description: "Preview changes without applying"
    example: "@f5:refactor --safe 'improve code structure'"
    behavior:
      - "Show proposed changes"
      - "Require explicit approval"
      - "Create backups before changes"
    preview_only: true

  --deep:
    description: "Thorough analysis with all relevant agents"
    example: "@f5:security --deep 'audit auth module'"
    behavior:
      - "Include all related agents"
      - "Comprehensive analysis"
      - "Detailed documentation"
    include_all_relevant: true

# ═══════════════════════════════════════════════════════════════
# SYNERGY & CONFLICT RULES
# ═══════════════════════════════════════════════════════════════

synergies:
  # Agent combinations that work well together

  - agents: [security_scanner, code_reviewer]
    boost: 15
    context: "Security-focused code review"
    combined_output: true
    description: "Enhanced security analysis with code context"

  - agents: [code_generator, test_writer]
    boost: 20
    context: "TDD workflow"
    combined_output: false
    description: "Generate code with comprehensive tests"

  - agents: [refactorer, code_reviewer, test_writer]
    boost: 10
    context: "Safe refactoring"
    combined_output: false
    description: "Refactor with review and test coverage"

  - agents: [system_architect, api_designer]
    boost: 15
    context: "System design"
    combined_output: true
    description: "Architecture with API contracts"

  - agents: [debugger, performance_analyzer]
    boost: 10
    context: "Performance debugging"
    combined_output: true
    description: "Debug performance issues effectively"

  - agents: [security_scanner, system_architect]
    boost: 15
    context: "Secure architecture"
    combined_output: true
    description: "Design with security in mind"

conflicts:
  # Agent combinations to avoid

  - agents: [code_generator, refactorer]
    reason: "Don't generate new code and refactor simultaneously"
    resolution: "sequential"
    order: [code_generator, refactorer]

  - agents: [documenter, debugger]
    reason: "Focus on fixing before documenting"
    resolution: "sequential"
    order: [debugger, documenter]

  - agents: [refactorer, migrator]
    reason: "Complete migration before refactoring"
    resolution: "sequential"
    order: [migrator, refactorer]

# ═══════════════════════════════════════════════════════════════
# CONTEXT PASSING
# ═══════════════════════════════════════════════════════════════

context_passing:
  enabled: true

  # What to pass between agents
  include:
    - original_request
    - previous_outputs
    - decisions_made
    - files_modified
    - errors_encountered
    - security_concerns
    - performance_notes

  # Context template
  template: |
    ## Collaboration Context

    ### Original Request
    {original_request}

    ### Previous Agent: {previous_agent}
    **Action**: {previous_action}
    **Output Summary**: {previous_output_summary}
    **Files Modified**: {files_modified}

    ### Decisions Made
    {decisions}

    ### Notes for You
    {notes_for_current_agent}

    ### Your Task
    {current_task}

  # Max context size (tokens)
  max_context_tokens: 4000

  # Summarize if too long
  auto_summarize: true

# ═══════════════════════════════════════════════════════════════
# OUTPUT MERGING (for parallel execution)
# ═══════════════════════════════════════════════════════════════

output_merging:
  # How to merge parallel outputs

  strategies:
    combine:
      description: "Combine all outputs into single document"
      format: |
        ## Combined Output

        ### From {agent_1}
        {output_1}

        ### From {agent_2}
        {output_2}

        ### Merged Files
        {merged_files}

    vote:
      description: "Agents vote on best approach"
      requires_minimum: 2
      tie_breaker: "pm_agent"

    best:
      description: "Select best output based on criteria"
      criteria:
        - completeness
        - quality
        - security
        - performance
      selector: "pm_agent"

  # Conflict resolution in merged outputs
  conflict_resolution:
    file_conflicts: "show_diff_and_ask"
    recommendation_conflicts: "present_all"
    code_conflicts: "manual_merge"
