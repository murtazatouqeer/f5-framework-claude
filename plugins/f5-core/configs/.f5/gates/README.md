# F5 Framework Evidence Collection

## Overview

This directory stores evidence artifacts for gate compliance. Evidence is automatically collected when running gate checks and can be used for:

- **Audit trails** - Complete history of gate decisions
- **Compliance verification** - Proof of quality standards met
- **Historical analysis** - Track quality trends over time
- **Stakeholder reporting** - Professional reports for customers

## Directory Structure

```
.f5/evidence/
├── README.md                    # This documentation
├── D1/                          # Research Complete evidence
│   ├── D1-check-YYYY-MM-DD.md   # Check reports
│   └── D1-report-YYYY-MM-DD.md  # Full gate reports
├── D2/                          # SRS Approved evidence
│   ├── D2-check-YYYY-MM-DD.md
│   └── D2-report-YYYY-MM-DD.md
├── D3/                          # Basic Design Approved evidence
│   ├── D3-check-YYYY-MM-DD.md
│   └── D3-report-YYYY-MM-DD.md
├── D4/                          # Detail Design Approved evidence
│   ├── D4-check-YYYY-MM-DD.md
│   └── D4-report-YYYY-MM-DD.md
├── G2/                          # Implementation Ready evidence
│   ├── G2-check-YYYY-MM-DD.md
│   ├── G2-report-YYYY-MM-DD.md
│   ├── coverage/                # Coverage reports
│   ├── test-results/            # Test result XMLs
│   └── security/                # Security scan results
├── G3/                          # Testing Complete evidence
│   ├── G3-check-YYYY-MM-DD.md
│   ├── G3-report-YYYY-MM-DD.md
│   ├── unit-test-report.md
│   ├── integration-test-report.md
│   ├── e2e-test-report.md
│   └── performance-test-report.md
├── G4/                          # Deployment Ready evidence
│   ├── G4-check-YYYY-MM-DD.md
│   ├── G4-report-YYYY-MM-DD.md
│   ├── staging-deployment.md
│   ├── uat-approval.md
│   └── security-review.md
└── templates/                   # Report templates
    ├── gate-report.md
    ├── test-report.md
    ├── security-report.md
    └── deployment-report.md
```

---

## Evidence Types

### 1. Check Reports

Generated by `/f5-gate check <gate>`

**Filename:** `<gate>-check-YYYY-MM-DD.md`

**Contents:**
- Automated check results
- Pass/fail status for each check
- Metrics and thresholds comparison
- Warnings and errors
- Duration and timestamp

**Example:**
```markdown
# G2 Check Report - 2024-01-15

## Automated Checks
| Check | Status | Duration |
|-------|--------|----------|
| Lint | ✅ Pass | 5.2s |
| Type Check | ✅ Pass | 12.3s |
| Unit Tests | ✅ Pass | 45.1s |
| Coverage | ⚠️ Warning | 8.5s |

## Metrics
| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| Coverage | ≥80% | 78% | ⚠️ |
```

### 2. Gate Reports

Generated by `/f5-gate report <gate>`

**Filename:** `<gate>-report-YYYY-MM-DD.md`

**Contents:**
- Executive summary
- Detailed metrics with targets
- Checklist completion status
- Approvals with timestamps
- Artifacts list
- Conclusion and recommendations

### 3. Test Reports

Collected during test execution

**Formats:**
- **JUnit XML** (`junit.xml`) - Standard test results format
- **Coverage HTML** (`lcov-report/`) - Visual coverage report
- **Coverage JSON** (`coverage-final.json`) - Machine-readable coverage
- **Coverage Summary** (`coverage-summary.json`) - Quick metrics

**Types:**
- Unit test report
- Integration test report
- E2E test report
- Performance test report
- Security test report

### 4. Security Reports

Collected during security scans

**Formats:**
- npm audit JSON
- OWASP dependency check report
- Custom security scan results
- Vulnerability assessment

**Contents:**
- Vulnerability count by severity
- CVE details
- Fix recommendations
- Compliance status (OWASP Top 10)

### 5. Deployment Records

Collected during deployment operations

**Contents:**
- Deployment timestamp
- Version deployed
- Previous version
- Environment details
- Health check results
- Smoke test results
- Rollback information

---

## Automatic Collection

Evidence is automatically collected when you run:

```bash
# Collects check evidence
/f5-gate check G2

# Collects comprehensive evidence
/f5-gate report G2

# Collects deployment evidence
/f5-deploy staging
/f5-deploy production

# Collects test evidence
/f5-test run --type all

# Collects security evidence
/f5-review security
```

### What Gets Collected

| Command | Evidence Collected |
|---------|-------------------|
| `/f5-gate check <gate>` | Check report, metrics, warnings |
| `/f5-gate report <gate>` | Full report, all artifacts |
| `/f5-test run` | Test results, coverage, durations |
| `/f5-deploy staging` | Deployment log, health checks |
| `/f5-deploy production` | Full deployment evidence |
| `/f5-review security` | Security scan results |

---

## Manual Evidence Addition

Add custom evidence manually:

### Add Document Evidence

```bash
# Copy analysis document
cp my-analysis.md .f5/evidence/D1/

# Add with timestamp
cp security-review.md .f5/evidence/G4/security-review-$(date +%Y-%m-%d).md
```

### Add Approval Evidence

```bash
# Create approval record
cat << EOF >> .f5/evidence/G2/approvals.md
## Approval Record

| Role | Approver | Date | Status |
|------|----------|------|--------|
| Tech Lead | @tech_lead | 2024-01-15 | ✅ Approved |
| Dev Lead | @dev_lead | 2024-01-15 | ✅ Approved |
EOF
```

### Add External Links

```bash
# Link to external artifacts
cat << EOF >> .f5/evidence/G3/external-links.md
## External Evidence

- Jira Tickets: [PROJ-123](https://jira.example.com/PROJ-123)
- PR: [#456](https://github.com/org/repo/pull/456)
- Figma: [Design Review](https://figma.com/...)
EOF
```

---

## Retention Policy

### Default Retention

Default retention: **90 days**

Configure in `.f5/gates.yaml`:

```yaml
global:
  evidence:
    retention_days: 90
```

### Retention by Type

| Evidence Type | Default Retention | Recommended |
|---------------|-------------------|-------------|
| Check Reports | 90 days | 90 days |
| Gate Reports | 365 days | 1 year |
| Test Results | 30 days | 30-90 days |
| Security Scans | 365 days | 1 year |
| Deployment Records | 365 days | 2 years |

### Cleanup Commands

```bash
# View old evidence
find .f5/evidence -type f -mtime +90

# Clean evidence older than 90 days
/f5-gate evidence clean --older-than 90d

# Archive before cleanup
/f5-gate evidence archive --older-than 90d
/f5-gate evidence clean --older-than 90d
```

---

## Evidence for Compliance

### For Audits

All gate checks are timestamped and stored, providing:

- **Who approved what** - Approver names and roles
- **When approvals occurred** - ISO 8601 timestamps
- **What checks were run** - Command history
- **What the results were** - Detailed metrics

### Audit Trail Example

```
2024-01-10 09:00 - D4 passed (architect: @john, tech_lead: @jane)
2024-01-12 14:30 - G2 check started
2024-01-12 14:35 - G2 check passed (coverage: 85%, tests: 150/150)
2024-01-12 15:00 - G2 approved (dev_lead: @mike)
2024-01-15 10:00 - G3 check started
2024-01-15 10:15 - G3 passed (all tests passing)
```

### For Traceability

Evidence links to:

| From | To | Link Type |
|------|-----|-----------|
| Requirements | Code | REQ-XXX comments |
| Code | Tests | Test file naming |
| Tests | Results | JUnit XML |
| Results | Evidence | Check reports |

### Compliance Standards

F5 evidence collection supports:

- **ISO 27001** - Information security audit trails
- **SOC 2** - Security compliance evidence
- **HIPAA** - Healthcare data handling proof
- **PCI DSS** - Payment security documentation
- **GDPR** - Data protection compliance

---

## Commands Reference

### View Evidence

```bash
# List evidence for a gate
ls -la .f5/evidence/G2/

# View latest check report
cat .f5/evidence/G2/G2-check-$(date +%Y-%m-%d).md

# View all evidence
find .f5/evidence -name "*.md" -type f
```

### Generate Reports

```bash
# Generate gate report
/f5-gate report G2

# Generate with specific format
/f5-gate report G2 --format html
/f5-gate report G2 --format pdf

# Generate summary report
/f5-gate report summary
```

### Manage Evidence

```bash
# Clean old evidence
/f5-gate evidence clean --older-than 90d

# Archive evidence
/f5-gate evidence archive --gate G2 --format zip

# Export for audit
/f5-gate evidence export --gate G2 --output audit-G2.zip

# Verify evidence integrity
/f5-gate evidence verify
```

---

## Best Practices

### 1. Don't Delete Evidence

Evidence is needed for audit trails. Instead of deleting:

```bash
# Archive old evidence
/f5-gate evidence archive --older-than 180d

# Move to long-term storage
mv .f5/evidence/2023/ /archive/project/evidence/
```

### 2. Review Before Gate Completion

Always review evidence before completing a gate:

```bash
# Check evidence exists
ls .f5/evidence/G2/

# Verify check passed
cat .f5/evidence/G2/G2-check-*.md | head -50

# Confirm all approvals
grep -i "approved" .f5/evidence/G2/
```

### 3. Link to External Artifacts

Reference external systems:

```markdown
## External References

- **PR:** #456 (merged 2024-01-15)
- **Jira:** PROJ-123, PROJ-124
- **Confluence:** [Design Doc](https://...)
- **Figma:** [Mockups](https://...)
```

### 4. Timestamp Everything

Use ISO 8601 format consistently:

```markdown
**Generated:** 2024-01-15T10:30:00Z
**Approved:** 2024-01-15T14:00:00+09:00
```

### 5. Include Approver Information

Always record who approved and when:

```markdown
## Approvals

| Role | Name | Email | Date | Signature |
|------|------|-------|------|-----------|
| Tech Lead | John Doe | john@example.com | 2024-01-15 | ✅ |
| QA Lead | Jane Smith | jane@example.com | 2024-01-15 | ✅ |
```

---

## Template Usage

Templates use Handlebars-style placeholders (`{{variable}}`).

### Variables

| Variable | Description |
|----------|-------------|
| `{{PROJECT_NAME}}` | Project name from config.json |
| `{{VERSION}}` | Current version |
| `{{DATE}}` | Report generation date |
| `{{TIMESTAMP}}` | ISO 8601 timestamp |
| `{{GATE_ID}}` | Gate identifier (D1-G4) |
| `{{GATE_NAME}}` | Gate full name |
| `{{STATUS}}` | Pass/Fail/Warning |

### Loops

```handlebars
{{#each ITEMS}}
- {{name}}: {{value}}
{{/each}}
```

### Conditionals

```handlebars
{{#if CONDITION}}
Content when true
{{else}}
Content when false
{{/if}}
```

---

## Integration with CI/CD

### GitHub Actions

Evidence is automatically uploaded as artifacts:

```yaml
- name: Upload Gate Evidence
  uses: actions/upload-artifact@v4
  with:
    name: gate-evidence-${{ env.GATE }}
    path: .f5/evidence/${{ env.GATE }}/
    retention-days: 30
```

### GitLab CI

```yaml
artifacts:
  paths:
    - .f5/evidence/
  expire_in: 30 days
```

### Jenkins

```groovy
archiveArtifacts artifacts: '.f5/evidence/**/*', fingerprint: true
```

---

## Troubleshooting

### Evidence Not Collected

```bash
# Check if directory exists
ls -la .f5/evidence/

# Check permissions
ls -la .f5/evidence/G2/

# Run check with verbose output
/f5-gate check G2 --verbose
```

### Missing Evidence Files

```bash
# Regenerate check report
/f5-gate check G2 --force

# Regenerate full report
/f5-gate report G2 --force
```

### Corrupted Evidence

```bash
# Verify file integrity
file .f5/evidence/G2/*.md

# Check for valid markdown
npx markdownlint .f5/evidence/G2/*.md

# Regenerate if needed
/f5-gate check G2 --force
```

---

## See Also

- `/f5-gate` - Gate management command
- `.f5/gates.yaml` - Gate configuration
- `/f5-test` - Test execution with evidence
- `/f5-deploy` - Deployment with evidence
- `/f5-review` - Code review with evidence
