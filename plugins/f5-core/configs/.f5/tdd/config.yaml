# F5 TDD Configuration
# Version: 1.0.0
#
# This file configures TDD (Test-Driven Development) behavior for F5 Framework.

# ═══════════════════════════════════════════════════════════════
# GENERAL SETTINGS
# ═══════════════════════════════════════════════════════════════

general:
  # Auto-run tests after changes
  auto_run_tests: true

  # Show test output in real-time
  verbose_output: true

  # Maximum session duration (hours)
  max_session_duration: 8

  # Session timeout (minutes of inactivity)
  session_timeout: 60

  # Auto-save session state
  auto_save: true
  auto_save_interval: 5  # minutes

  # Commit after successful cycle
  auto_commit: false
  commit_message_template: "feat({{feature}}): TDD cycle {{cycle}} complete"

# ═══════════════════════════════════════════════════════════════
# COVERAGE TARGETS
# ═══════════════════════════════════════════════════════════════

coverage:
  # Required coverage to complete TDD session
  targets:
    statements: 80
    branches: 75
    functions: 80
    lines: 80

  # Warn if below these thresholds
  warnings:
    statements: 70
    branches: 65
    functions: 70
    lines: 70

  # Critical thresholds (block completion)
  critical:
    statements: 60
    branches: 55
    functions: 60
    lines: 60

  # Enforce coverage check before session complete
  enforce: true

  # Coverage report format
  report_format:
    - text
    - html
    - json

# ═══════════════════════════════════════════════════════════════
# PHASE SETTINGS
# ═══════════════════════════════════════════════════════════════

phases:
  red:
    # Minimum tests required before moving to GREEN
    min_tests: 1

    # Require all tests to fail
    require_all_failing: true

    # Auto-generate test suggestions
    auto_suggest: true

    # Test categories to include when generating
    categories:
      happy_path:
        enabled: true
        min_tests: 2
        priority: 1
      validation:
        enabled: true
        min_tests: 3
        priority: 2
      error_handling:
        enabled: true
        min_tests: 2
        priority: 2
      edge_cases:
        enabled: true
        min_tests: 2
        priority: 3
      security:
        enabled: true
        min_tests: 1
        priority: 1
      performance:
        enabled: false
        min_tests: 1
        priority: 4

    # Maximum time in RED phase (minutes)
    max_duration: 30

    # Warn if exceeding duration
    duration_warning: 20

  green:
    # Maximum time in GREEN phase (minutes)
    max_duration: 60

    # Require all tests passing before moving to REFACTOR
    require_all_passing: true

    # Allow skipping tests temporarily (not recommended)
    allow_skip: false

    # Warn if exceeding duration
    duration_warning: 45

    # Run tests after each file save
    test_on_save: true

  refactor:
    # Maximum time in REFACTOR phase (minutes)
    max_duration: 45

    # Run tests after each change
    test_on_change: true

    # Auto-detect code smells
    detect_smells: true

    # Code smell detection rules
    smell_rules:
      long_method:
        enabled: true
        threshold: 20  # lines
      long_parameter_list:
        enabled: true
        threshold: 4
      duplicate_code:
        enabled: true
        threshold: 5  # lines
      magic_numbers:
        enabled: true
      dead_code:
        enabled: true

    # Suggest refactorings
    suggest_refactorings: true

    # Complexity threshold
    max_complexity: 10

    # Warn if exceeding duration
    duration_warning: 30

# ═══════════════════════════════════════════════════════════════
# TEST GENERATION
# ═══════════════════════════════════════════════════════════════

test_generation:
  # Include mock setup in generated tests
  include_mocks: true

  # Generate describe blocks for organization
  use_describe_blocks: true

  # Use AAA pattern (Arrange-Act-Assert)
  use_aaa_pattern: true

  # Include comments in generated tests
  include_comments: true

  # Test naming convention
  # Options: should, it, spec, given_when_then
  naming_convention: should

  # Example: "should create user when valid data provided"
  naming_template: "should {{behavior}} when {{condition}}"

  # Include snapshot tests for React components
  include_snapshots: false

  # Include accessibility tests for React components
  include_a11y_tests: true

# ═══════════════════════════════════════════════════════════════
# STACK-SPECIFIC SETTINGS
# ═══════════════════════════════════════════════════════════════

stacks:
  nestjs:
    test_framework: jest
    test_file_pattern: "*.spec.ts"
    test_directory: "__tests__"
    test_command: "npm run test"
    coverage_command: "npm run test:cov"
    watch_command: "npm run test:watch"
    test_setup: |
      import { Test, TestingModule } from '@nestjs/testing';
    mock_library: jest

  spring:
    test_framework: junit5
    test_file_pattern: "*Test.java"
    test_directory: "src/test/java"
    test_command: "./mvnw test"
    coverage_command: "./mvnw jacoco:report"
    test_setup: |
      import org.junit.jupiter.api.*;
      import org.mockito.*;
    mock_library: mockito

  django:
    test_framework: pytest
    test_file_pattern: "test_*.py"
    test_directory: "tests"
    test_command: "pytest"
    coverage_command: "pytest --cov"
    watch_command: "pytest-watch"
    test_setup: |
      import pytest
      from unittest.mock import Mock, patch
    mock_library: pytest-mock

  fastapi:
    test_framework: pytest
    test_file_pattern: "test_*.py"
    test_directory: "tests"
    test_command: "pytest"
    coverage_command: "pytest --cov"
    watch_command: "pytest-watch"
    test_setup: |
      import pytest
      from httpx import AsyncClient
      from fastapi.testclient import TestClient
    mock_library: pytest-mock

  react:
    test_framework: vitest
    test_file_pattern: "*.test.tsx"
    test_directory: "__tests__"
    test_command: "npm run test"
    coverage_command: "npm run test:cov"
    watch_command: "npm run test:watch"
    test_setup: |
      import { render, screen, fireEvent } from '@testing-library/react';
      import userEvent from '@testing-library/user-event';
    mock_library: vitest

  vue:
    test_framework: vitest
    test_file_pattern: "*.spec.ts"
    test_directory: "__tests__"
    test_command: "npm run test"
    coverage_command: "npm run test:cov"
    test_setup: |
      import { mount } from '@vue/test-utils';
    mock_library: vitest

  go:
    test_framework: go_test
    test_file_pattern: "*_test.go"
    test_directory: ""  # Same directory
    test_command: "go test ./..."
    coverage_command: "go test -cover ./..."
    test_setup: |
      import (
        "testing"
        "github.com/stretchr/testify/assert"
        "github.com/stretchr/testify/mock"
      )
    mock_library: testify

# ═══════════════════════════════════════════════════════════════
# REPORTING
# ═══════════════════════════════════════════════════════════════

reporting:
  # Generate session report on complete
  generate_report: true

  # Report format
  format: markdown

  # Alternative formats available
  available_formats:
    - markdown
    - html
    - json
    - pdf

  # Include in report
  include:
    - summary
    - timeline
    - cycle_details
    - coverage_progress
    - time_breakdown
    - files_modified
    - metrics
    - traceability
    - recommendations

  # Save reports
  save_location: ".f5/tdd/sessions/{session_id}/report.md"

  # Also save to evidence
  save_to_evidence: true
  evidence_location: ".f5/evidence/G3/tdd-{session_id}.md"

# ═══════════════════════════════════════════════════════════════
# NOTIFICATIONS
# ═══════════════════════════════════════════════════════════════

notifications:
  # Notify on phase completion
  on_phase_complete: true

  # Notify on cycle completion
  on_cycle_complete: true

  # Notify on test failure during refactor
  on_refactor_failure: true

  # Notify on session complete
  on_session_complete: true

  # Notify on coverage milestone
  on_coverage_milestone: true
  coverage_milestones:
    - 50
    - 75
    - 80
    - 90

  # Sound notification (terminal bell)
  sound: false

  # Desktop notification (if supported)
  desktop: false

# ═══════════════════════════════════════════════════════════════
# INTEGRATION
# ═══════════════════════════════════════════════════════════════

integration:
  # Link with SIP (Strict Implementation Protocol)
  sip_integration: true

  # Link with requirements
  requirement_linking: true
  requirement_prefixes:
    - REQ
    - FR
    - NFR
    - US
    - UC

  # Update gate G3 evidence automatically
  gate_evidence: true

  # Sync with Jira (if configured)
  jira_sync: false

  # Add TDD log comments to code
  code_comments: true
  comment_template: "// TDD: {{session_id}} - {{requirement}}"

# ═══════════════════════════════════════════════════════════════
# METRICS
# ═══════════════════════════════════════════════════════════════

metrics:
  # Track session metrics
  track_sessions: true

  # Track phase durations
  track_phases: true

  # Track test categories
  track_categories: true

  # Calculate efficiency scores
  calculate_efficiency: true

  # Store historical data
  historical_retention_days: 90

  # Export format
  export_format: json

  # Quality indicators
  quality_indicators:
    test_code_ratio:
      target: 1.5
      warning: 1.0
    cycle_velocity:
      target: 3  # cycles per hour
      warning: 2
    phase_balance:
      red_target: 30  # percentage
      green_target: 45
      refactor_target: 25
      variance_allowed: 10

# ═══════════════════════════════════════════════════════════════
# ADVANCED
# ═══════════════════════════════════════════════════════════════

advanced:
  # Debug mode
  debug: false

  # Log level
  log_level: info  # debug, info, warn, error

  # Parallel test execution
  parallel_tests: true

  # Test isolation
  test_isolation: true

  # Cleanup after session
  cleanup_temp_files: true

  # Backup before changes
  create_backup: false

  # Session recovery
  enable_recovery: true
  recovery_interval: 2  # minutes
